!function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,(function(t,e){"use strict";var n=[],r=Object.getPrototypeOf,o=n.slice,i=n.flat?function(t){return n.flat.call(t)}:function(t){return n.concat.apply([],t)},a=n.push,s=n.indexOf,u={},c=u.toString,l=u.hasOwnProperty,f=l.toString,h=f.call(Object),d={},p=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},v=function(t){return null!=t&&t===t.window},m=t.document,g={type:!0,src:!0,nonce:!0,noModule:!0};function y(t,e,n){var r,o,i=(n=n||m).createElement("script");if(i.text=t,e)for(r in g)(o=e[r]||e.getAttribute&&e.getAttribute(r))&&i.setAttribute(r,o);n.head.appendChild(i).parentNode.removeChild(i)}function b(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?u[c.call(t)]||"object":typeof t}var x="3.5.1",w=function(t,e){return new w.fn.init(t,e)};function _(t){var e=!!t&&"length"in t&&t.length,n=b(t);return!p(t)&&!v(t)&&("array"===n||0===e||"number"==typeof e&&0<e&&e-1 in t)}w.fn=w.prototype={jquery:x,constructor:w,length:0,toArray:function(){return o.call(this)},get:function(t){return null==t?o.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=w.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return w.each(this,t)},map:function(t){return this.pushStack(w.map(this,(function(e,n){return t.call(e,n,e)})))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(w.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(w.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,n=+t+(t<0?e:0);return this.pushStack(0<=n&&n<e?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var t,e,n,r,o,i,a=arguments[0]||{},s=1,u=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[s]||{},s++),"object"==typeof a||p(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(t=arguments[s]))for(e in t)r=t[e],"__proto__"!==e&&a!==r&&(c&&r&&(w.isPlainObject(r)||(o=Array.isArray(r)))?(n=a[e],i=o&&!Array.isArray(n)?[]:o||w.isPlainObject(n)?n:{},o=!1,a[e]=w.extend(c,i,r)):void 0!==r&&(a[e]=r));return a},w.extend({expando:"jQuery"+(x+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,n;return!(!t||"[object Object]"!==c.call(t)||(e=r(t))&&("function"!=typeof(n=l.call(e,"constructor")&&e.constructor)||f.call(n)!==h))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,n){y(t,{nonce:e&&e.nonce},n)},each:function(t,e){var n,r=0;if(_(t))for(n=t.length;r<n&&!1!==e.call(t[r],r,t[r]);r++);else for(r in t)if(!1===e.call(t[r],r,t[r]))break;return t},makeArray:function(t,e){var n=e||[];return null!=t&&(_(Object(t))?w.merge(n,"string"==typeof t?[t]:t):a.call(n,t)),n},inArray:function(t,e,n){return null==e?-1:s.call(e,t,n)},merge:function(t,e){for(var n=+e.length,r=0,o=t.length;r<n;r++)t[o++]=e[r];return t.length=o,t},grep:function(t,e,n){for(var r=[],o=0,i=t.length,a=!n;o<i;o++)!e(t[o],o)!==a&&r.push(t[o]);return r},map:function(t,e,n){var r,o,a=0,s=[];if(_(t))for(r=t.length;a<r;a++)null!=(o=e(t[a],a,n))&&s.push(o);else for(a in t)null!=(o=e(t[a],a,n))&&s.push(o);return i(s)},guid:1,support:d}),"function"==typeof Symbol&&(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){u["[object "+e+"]"]=e.toLowerCase()}));var C=function(t){var e,n,r,o,i,a,s,u,c,l,f,h,d,p,v,m,g,y,b,x="sizzle"+1*new Date,w=t.document,_=0,C=0,E=ut(),S=ut(),I=ut(),T=ut(),k=function(t,e){return t===e&&(f=!0),0},D={}.hasOwnProperty,A=[],R=A.pop,N=A.push,F=A.push,O=A.slice,M=function(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1},P="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}"+L+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+L+"*("+B+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+L+"*\\]",z=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",U=new RegExp(L+"+","g"),j=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),H=new RegExp("^"+L+"*,"+L+"*"),V=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),q=new RegExp(L+"|>"),G=new RegExp(z),K=new RegExp("^"+B+"$"),X={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+z),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+P+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},$=/HTML$/i,Y=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=new RegExp("\\\\[\\da-fA-F]{1,6}"+L+"?|\\\\([^\\r\\n\\f])","g"),nt=function(t,e){var n="0x"+t.slice(1)-65536;return e||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},rt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ot=function(t,e){return e?"\0"===t?"ï¿½":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},it=function(){h()},at=xt((function(t){return!0===t.disabled&&"fieldset"===t.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{F.apply(A=O.call(w.childNodes),w.childNodes)}catch(e){F={apply:A.length?function(t,e){N.apply(t,O.call(e))}:function(t,e){for(var n=t.length,r=0;t[n++]=e[r++];);t.length=n-1}}}function st(t,e,r,o){var i,s,c,l,f,p,g,y=e&&e.ownerDocument,w=e?e.nodeType:9;if(r=r||[],"string"!=typeof t||!t||1!==w&&9!==w&&11!==w)return r;if(!o&&(h(e),e=e||d,v)){if(11!==w&&(f=Z.exec(t)))if(i=f[1]){if(9===w){if(!(c=e.getElementById(i)))return r;if(c.id===i)return r.push(c),r}else if(y&&(c=y.getElementById(i))&&b(e,c)&&c.id===i)return r.push(c),r}else{if(f[2])return F.apply(r,e.getElementsByTagName(t)),r;if((i=f[3])&&n.getElementsByClassName&&e.getElementsByClassName)return F.apply(r,e.getElementsByClassName(i)),r}if(n.qsa&&!T[t+" "]&&(!m||!m.test(t))&&(1!==w||"object"!==e.nodeName.toLowerCase())){if(g=t,y=e,1===w&&(q.test(t)||V.test(t))){for((y=tt.test(t)&&gt(e.parentNode)||e)===e&&n.scope||((l=e.getAttribute("id"))?l=l.replace(rt,ot):e.setAttribute("id",l=x)),s=(p=a(t)).length;s--;)p[s]=(l?"#"+l:":scope")+" "+bt(p[s]);g=p.join(",")}try{return F.apply(r,y.querySelectorAll(g)),r}catch(e){T(t,!0)}finally{l===x&&e.removeAttribute("id")}}}return u(t.replace(j,"$1"),e,r,o)}function ut(){var t=[];return function e(n,o){return t.push(n+" ")>r.cacheLength&&delete e[t.shift()],e[n+" "]=o}}function ct(t){return t[x]=!0,t}function lt(t){var e=d.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ft(t,e){for(var n=t.split("|"),o=n.length;o--;)r.attrHandle[n[o]]=e}function ht(t,e){var n=e&&t,r=n&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function dt(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function pt(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function vt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&at(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function mt(t){return ct((function(e){return e=+e,ct((function(n,r){for(var o,i=t([],n.length,e),a=i.length;a--;)n[o=i[a]]&&(n[o]=!(r[o]=n[o]))}))}))}function gt(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in n=st.support={},i=st.isXML=function(t){var e=(t.ownerDocument||t).documentElement;return!$.test(t.namespaceURI||e&&e.nodeName||"HTML")},h=st.setDocument=function(t){var e,o,a=t?t.ownerDocument||t:w;return a!=d&&9===a.nodeType&&a.documentElement&&(p=(d=a).documentElement,v=!i(d),w!=d&&(o=d.defaultView)&&o.top!==o&&(o.addEventListener?o.addEventListener("unload",it,!1):o.attachEvent&&o.attachEvent("onunload",it)),n.scope=lt((function(t){return p.appendChild(t).appendChild(d.createElement("div")),void 0!==t.querySelectorAll&&!t.querySelectorAll(":scope fieldset div").length})),n.attributes=lt((function(t){return t.className="i",!t.getAttribute("className")})),n.getElementsByTagName=lt((function(t){return t.appendChild(d.createComment("")),!t.getElementsByTagName("*").length})),n.getElementsByClassName=J.test(d.getElementsByClassName),n.getById=lt((function(t){return p.appendChild(t).id=x,!d.getElementsByName||!d.getElementsByName(x).length})),n.getById?(r.filter.ID=function(t){var e=t.replace(et,nt);return function(t){return t.getAttribute("id")===e}},r.find.ID=function(t,e){if(void 0!==e.getElementById&&v){var n=e.getElementById(t);return n?[n]:[]}}):(r.filter.ID=function(t){var e=t.replace(et,nt);return function(t){var n=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return n&&n.value===e}},r.find.ID=function(t,e){if(void 0!==e.getElementById&&v){var n,r,o,i=e.getElementById(t);if(i){if((n=i.getAttributeNode("id"))&&n.value===t)return[i];for(o=e.getElementsByName(t),r=0;i=o[r++];)if((n=i.getAttributeNode("id"))&&n.value===t)return[i]}return[]}}),r.find.TAG=n.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):n.qsa?e.querySelectorAll(t):void 0}:function(t,e){var n,r=[],o=0,i=e.getElementsByTagName(t);if("*"===t){for(;n=i[o++];)1===n.nodeType&&r.push(n);return r}return i},r.find.CLASS=n.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&v)return e.getElementsByClassName(t)},g=[],m=[],(n.qsa=J.test(d.querySelectorAll))&&(lt((function(t){var e;p.appendChild(t).innerHTML="<a id='"+x+"'></a><select id='"+x+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+L+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||m.push("\\["+L+"*(?:value|"+P+")"),t.querySelectorAll("[id~="+x+"-]").length||m.push("~="),(e=d.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||m.push("\\["+L+"*name"+L+"*="+L+"*(?:''|\"\")"),t.querySelectorAll(":checked").length||m.push(":checked"),t.querySelectorAll("a#"+x+"+*").length||m.push(".#.+[+~]"),t.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),lt((function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=d.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&m.push("name"+L+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),p.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),m.push(",.*:")}))),(n.matchesSelector=J.test(y=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&lt((function(t){n.disconnectedMatch=y.call(t,"*"),y.call(t,"[s!='']:x"),g.push("!=",z)})),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),e=J.test(p.compareDocumentPosition),b=e||J.test(p.contains)?function(t,e){var n=9===t.nodeType?t.documentElement:t,r=e&&e.parentNode;return t===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):t.compareDocumentPosition&&16&t.compareDocumentPosition(r)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},k=e?function(t,e){if(t===e)return f=!0,0;var r=!t.compareDocumentPosition-!e.compareDocumentPosition;return r||(1&(r=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!n.sortDetached&&e.compareDocumentPosition(t)===r?t==d||t.ownerDocument==w&&b(w,t)?-1:e==d||e.ownerDocument==w&&b(w,e)?1:l?M(l,t)-M(l,e):0:4&r?-1:1)}:function(t,e){if(t===e)return f=!0,0;var n,r=0,o=t.parentNode,i=e.parentNode,a=[t],s=[e];if(!o||!i)return t==d?-1:e==d?1:o?-1:i?1:l?M(l,t)-M(l,e):0;if(o===i)return ht(t,e);for(n=t;n=n.parentNode;)a.unshift(n);for(n=e;n=n.parentNode;)s.unshift(n);for(;a[r]===s[r];)r++;return r?ht(a[r],s[r]):a[r]==w?-1:s[r]==w?1:0}),d},st.matches=function(t,e){return st(t,null,null,e)},st.matchesSelector=function(t,e){if(h(t),n.matchesSelector&&v&&!T[e+" "]&&(!g||!g.test(e))&&(!m||!m.test(e)))try{var r=y.call(t,e);if(r||n.disconnectedMatch||t.document&&11!==t.document.nodeType)return r}catch(t){T(e,!0)}return 0<st(e,d,null,[t]).length},st.contains=function(t,e){return(t.ownerDocument||t)!=d&&h(t),b(t,e)},st.attr=function(t,e){(t.ownerDocument||t)!=d&&h(t);var o=r.attrHandle[e.toLowerCase()],i=o&&D.call(r.attrHandle,e.toLowerCase())?o(t,e,!v):void 0;return void 0!==i?i:n.attributes||!v?t.getAttribute(e):(i=t.getAttributeNode(e))&&i.specified?i.value:null},st.escape=function(t){return(t+"").replace(rt,ot)},st.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},st.uniqueSort=function(t){var e,r=[],o=0,i=0;if(f=!n.detectDuplicates,l=!n.sortStable&&t.slice(0),t.sort(k),f){for(;e=t[i++];)e===t[i]&&(o=r.push(i));for(;o--;)t.splice(r[o],1)}return l=null,t},o=st.getText=function(t){var e,n="",r=0,i=t.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=o(t)}else if(3===i||4===i)return t.nodeValue}else for(;e=t[r++];)n+=o(e);return n},(r=st.selectors={cacheLength:50,createPseudo:ct,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(et,nt),t[3]=(t[3]||t[4]||t[5]||"").replace(et,nt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||st.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&st.error(t[0]),t},PSEUDO:function(t){var e,n=!t[6]&&t[2];return X.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":n&&G.test(n)&&(e=a(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(et,nt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=E[t+" "];return e||(e=new RegExp("(^|"+L+")"+t+"("+L+"|$)"))&&E(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,n){return function(r){var o=st.attr(r,t);return null==o?"!="===e:!e||(o+="","="===e?o===n:"!="===e?o!==n:"^="===e?n&&0===o.indexOf(n):"*="===e?n&&-1<o.indexOf(n):"$="===e?n&&o.slice(-n.length)===n:"~="===e?-1<(" "+o.replace(U," ")+" ").indexOf(n):"|="===e&&(o===n||o.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,n,r,o){var i="nth"!==t.slice(0,3),a="last"!==t.slice(-4),s="of-type"===e;return 1===r&&0===o?function(t){return!!t.parentNode}:function(e,n,u){var c,l,f,h,d,p,v=i!==a?"nextSibling":"previousSibling",m=e.parentNode,g=s&&e.nodeName.toLowerCase(),y=!u&&!s,b=!1;if(m){if(i){for(;v;){for(h=e;h=h[v];)if(s?h.nodeName.toLowerCase()===g:1===h.nodeType)return!1;p=v="only"===t&&!p&&"nextSibling"}return!0}if(p=[a?m.firstChild:m.lastChild],a&&y){for(b=(d=(c=(l=(f=(h=m)[x]||(h[x]={}))[h.uniqueID]||(f[h.uniqueID]={}))[t]||[])[0]===_&&c[1])&&c[2],h=d&&m.childNodes[d];h=++d&&h&&h[v]||(b=d=0)||p.pop();)if(1===h.nodeType&&++b&&h===e){l[t]=[_,d,b];break}}else if(y&&(b=d=(c=(l=(f=(h=e)[x]||(h[x]={}))[h.uniqueID]||(f[h.uniqueID]={}))[t]||[])[0]===_&&c[1]),!1===b)for(;(h=++d&&h&&h[v]||(b=d=0)||p.pop())&&((s?h.nodeName.toLowerCase()!==g:1!==h.nodeType)||!++b||(y&&((l=(f=h[x]||(h[x]={}))[h.uniqueID]||(f[h.uniqueID]={}))[t]=[_,b]),h!==e)););return(b-=o)===r||b%r==0&&0<=b/r}}},PSEUDO:function(t,e){var n,o=r.pseudos[t]||r.setFilters[t.toLowerCase()]||st.error("unsupported pseudo: "+t);return o[x]?o(e):1<o.length?(n=[t,t,"",e],r.setFilters.hasOwnProperty(t.toLowerCase())?ct((function(t,n){for(var r,i=o(t,e),a=i.length;a--;)t[r=M(t,i[a])]=!(n[r]=i[a])})):function(t){return o(t,0,n)}):o}},pseudos:{not:ct((function(t){var e=[],n=[],r=s(t.replace(j,"$1"));return r[x]?ct((function(t,e,n,o){for(var i,a=r(t,null,o,[]),s=t.length;s--;)(i=a[s])&&(t[s]=!(e[s]=i))})):function(t,o,i){return e[0]=t,r(e,null,i,n),e[0]=null,!n.pop()}})),has:ct((function(t){return function(e){return 0<st(t,e).length}})),contains:ct((function(t){return t=t.replace(et,nt),function(e){return-1<(e.textContent||o(e)).indexOf(t)}})),lang:ct((function(t){return K.test(t||"")||st.error("unsupported lang: "+t),t=t.replace(et,nt).toLowerCase(),function(e){var n;do{if(n=v?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(n=n.toLowerCase())===t||0===n.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var n=t.location&&t.location.hash;return n&&n.slice(1)===e.id},root:function(t){return t===p},focus:function(t){return t===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:vt(!1),disabled:vt(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!r.pseudos.empty(t)},header:function(t){return Q.test(t.nodeName)},input:function(t){return Y.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:mt((function(){return[0]})),last:mt((function(t,e){return[e-1]})),eq:mt((function(t,e,n){return[n<0?n+e:n]})),even:mt((function(t,e){for(var n=0;n<e;n+=2)t.push(n);return t})),odd:mt((function(t,e){for(var n=1;n<e;n+=2)t.push(n);return t})),lt:mt((function(t,e,n){for(var r=n<0?n+e:e<n?e:n;0<=--r;)t.push(r);return t})),gt:mt((function(t,e,n){for(var r=n<0?n+e:n;++r<e;)t.push(r);return t}))}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[e]=dt(e);for(e in{submit:!0,reset:!0})r.pseudos[e]=pt(e);function yt(){}function bt(t){for(var e=0,n=t.length,r="";e<n;e++)r+=t[e].value;return r}function xt(t,e,n){var r=e.dir,o=e.next,i=o||r,a=n&&"parentNode"===i,s=C++;return e.first?function(e,n,o){for(;e=e[r];)if(1===e.nodeType||a)return t(e,n,o);return!1}:function(e,n,u){var c,l,f,h=[_,s];if(u){for(;e=e[r];)if((1===e.nodeType||a)&&t(e,n,u))return!0}else for(;e=e[r];)if(1===e.nodeType||a)if(l=(f=e[x]||(e[x]={}))[e.uniqueID]||(f[e.uniqueID]={}),o&&o===e.nodeName.toLowerCase())e=e[r]||e;else{if((c=l[i])&&c[0]===_&&c[1]===s)return h[2]=c[2];if((l[i]=h)[2]=t(e,n,u))return!0}return!1}}function wt(t){return 1<t.length?function(e,n,r){for(var o=t.length;o--;)if(!t[o](e,n,r))return!1;return!0}:t[0]}function _t(t,e,n,r,o){for(var i,a=[],s=0,u=t.length,c=null!=e;s<u;s++)(i=t[s])&&(n&&!n(i,r,o)||(a.push(i),c&&e.push(s)));return a}function Ct(t,e,n,r,o,i){return r&&!r[x]&&(r=Ct(r)),o&&!o[x]&&(o=Ct(o,i)),ct((function(i,a,s,u){var c,l,f,h=[],d=[],p=a.length,v=i||function(t,e,n){for(var r=0,o=e.length;r<o;r++)st(t,e[r],n);return n}(e||"*",s.nodeType?[s]:s,[]),m=!t||!i&&e?v:_t(v,h,t,s,u),g=n?o||(i?t:p||r)?[]:a:m;if(n&&n(m,g,s,u),r)for(c=_t(g,d),r(c,[],s,u),l=c.length;l--;)(f=c[l])&&(g[d[l]]=!(m[d[l]]=f));if(i){if(o||t){if(o){for(c=[],l=g.length;l--;)(f=g[l])&&c.push(m[l]=f);o(null,g=[],c,u)}for(l=g.length;l--;)(f=g[l])&&-1<(c=o?M(i,f):h[l])&&(i[c]=!(a[c]=f))}}else g=_t(g===a?g.splice(p,g.length):g),o?o(null,a,g,u):F.apply(a,g)}))}function Et(t){for(var e,n,o,i=t.length,a=r.relative[t[0].type],s=a||r.relative[" "],u=a?1:0,l=xt((function(t){return t===e}),s,!0),f=xt((function(t){return-1<M(e,t)}),s,!0),h=[function(t,n,r){var o=!a&&(r||n!==c)||((e=n).nodeType?l(t,n,r):f(t,n,r));return e=null,o}];u<i;u++)if(n=r.relative[t[u].type])h=[xt(wt(h),n)];else{if((n=r.filter[t[u].type].apply(null,t[u].matches))[x]){for(o=++u;o<i&&!r.relative[t[o].type];o++);return Ct(1<u&&wt(h),1<u&&bt(t.slice(0,u-1).concat({value:" "===t[u-2].type?"*":""})).replace(j,"$1"),n,u<o&&Et(t.slice(u,o)),o<i&&Et(t=t.slice(o)),o<i&&bt(t))}h.push(n)}return wt(h)}return yt.prototype=r.filters=r.pseudos,r.setFilters=new yt,a=st.tokenize=function(t,e){var n,o,i,a,s,u,c,l=S[t+" "];if(l)return e?0:l.slice(0);for(s=t,u=[],c=r.preFilter;s;){for(a in n&&!(o=H.exec(s))||(o&&(s=s.slice(o[0].length)||s),u.push(i=[])),n=!1,(o=V.exec(s))&&(n=o.shift(),i.push({value:n,type:o[0].replace(j," ")}),s=s.slice(n.length)),r.filter)!(o=X[a].exec(s))||c[a]&&!(o=c[a](o))||(n=o.shift(),i.push({value:n,type:a,matches:o}),s=s.slice(n.length));if(!n)break}return e?s.length:s?st.error(t):S(t,u).slice(0)},s=st.compile=function(t,e){var n,o,i,s,u,l,f=[],p=[],m=I[t+" "];if(!m){for(e||(e=a(t)),n=e.length;n--;)(m=Et(e[n]))[x]?f.push(m):p.push(m);(m=I(t,(o=p,s=0<(i=f).length,u=0<o.length,l=function(t,e,n,a,l){var f,p,m,g=0,y="0",b=t&&[],x=[],w=c,C=t||u&&r.find.TAG("*",l),E=_+=null==w?1:Math.random()||.1,S=C.length;for(l&&(c=e==d||e||l);y!==S&&null!=(f=C[y]);y++){if(u&&f){for(p=0,e||f.ownerDocument==d||(h(f),n=!v);m=o[p++];)if(m(f,e||d,n)){a.push(f);break}l&&(_=E)}s&&((f=!m&&f)&&g--,t&&b.push(f))}if(g+=y,s&&y!==g){for(p=0;m=i[p++];)m(b,x,e,n);if(t){if(0<g)for(;y--;)b[y]||x[y]||(x[y]=R.call(a));x=_t(x)}F.apply(a,x),l&&!t&&0<x.length&&1<g+i.length&&st.uniqueSort(a)}return l&&(_=E,c=w),b},s?ct(l):l))).selector=t}return m},u=st.select=function(t,e,n,o){var i,u,c,l,f,h="function"==typeof t&&t,d=!o&&a(t=h.selector||t);if(n=n||[],1===d.length){if(2<(u=d[0]=d[0].slice(0)).length&&"ID"===(c=u[0]).type&&9===e.nodeType&&v&&r.relative[u[1].type]){if(!(e=(r.find.ID(c.matches[0].replace(et,nt),e)||[])[0]))return n;h&&(e=e.parentNode),t=t.slice(u.shift().value.length)}for(i=X.needsContext.test(t)?0:u.length;i--&&!r.relative[l=(c=u[i]).type];)if((f=r.find[l])&&(o=f(c.matches[0].replace(et,nt),tt.test(u[0].type)&&gt(e.parentNode)||e))){if(u.splice(i,1),!(t=o.length&&bt(u)))return F.apply(n,o),n;break}}return(h||s(t,d))(o,e,!v,n,!e||tt.test(t)&&gt(e.parentNode)||e),n},n.sortStable=x.split("").sort(k).join("")===x,n.detectDuplicates=!!f,h(),n.sortDetached=lt((function(t){return 1&t.compareDocumentPosition(d.createElement("fieldset"))})),lt((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||ft("type|href|height|width",(function(t,e,n){if(!n)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),n.attributes&&lt((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||ft("value",(function(t,e,n){if(!n&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),lt((function(t){return null==t.getAttribute("disabled")}))||ft(P,(function(t,e,n){var r;if(!n)return!0===t[e]?e.toLowerCase():(r=t.getAttributeNode(e))&&r.specified?r.value:null})),st}(t);w.find=C,w.expr=C.selectors,w.expr[":"]=w.expr.pseudos,w.uniqueSort=w.unique=C.uniqueSort,w.text=C.getText,w.isXMLDoc=C.isXML,w.contains=C.contains,w.escapeSelector=C.escape;var E=function(t,e,n){for(var r=[],o=void 0!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(o&&w(t).is(n))break;r.push(t)}return r},S=function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n},I=w.expr.match.needsContext;function T(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}var k=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function D(t,e,n){return p(e)?w.grep(t,(function(t,r){return!!e.call(t,r,t)!==n})):e.nodeType?w.grep(t,(function(t){return t===e!==n})):"string"!=typeof e?w.grep(t,(function(t){return-1<s.call(e,t)!==n})):w.filter(e,t,n)}w.filter=function(t,e,n){var r=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===r.nodeType?w.find.matchesSelector(r,t)?[r]:[]:w.find.matches(t,w.grep(e,(function(t){return 1===t.nodeType})))},w.fn.extend({find:function(t){var e,n,r=this.length,o=this;if("string"!=typeof t)return this.pushStack(w(t).filter((function(){for(e=0;e<r;e++)if(w.contains(o[e],this))return!0})));for(n=this.pushStack([]),e=0;e<r;e++)w.find(t,o[e],n);return 1<r?w.uniqueSort(n):n},filter:function(t){return this.pushStack(D(this,t||[],!1))},not:function(t){return this.pushStack(D(this,t||[],!0))},is:function(t){return!!D(this,"string"==typeof t&&I.test(t)?w(t):t||[],!1).length}});var A,R=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(t,e,n){var r,o;if(!t)return this;if(n=n||A,"string"==typeof t){if(!(r="<"===t[0]&&">"===t[t.length-1]&&3<=t.length?[null,t,null]:R.exec(t))||!r[1]&&e)return!e||e.jquery?(e||n).find(t):this.constructor(e).find(t);if(r[1]){if(w.merge(this,w.parseHTML(r[1],(e=e instanceof w?e[0]:e)&&e.nodeType?e.ownerDocument||e:m,!0)),k.test(r[1])&&w.isPlainObject(e))for(r in e)p(this[r])?this[r](e[r]):this.attr(r,e[r]);return this}return(o=m.getElementById(r[2]))&&(this[0]=o,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):p(t)?void 0!==n.ready?n.ready(t):t(w):w.makeArray(t,this)}).prototype=w.fn,A=w(m);var N=/^(?:parents|prev(?:Until|All))/,F={children:!0,contents:!0,next:!0,prev:!0};function O(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}w.fn.extend({has:function(t){var e=w(t,this),n=e.length;return this.filter((function(){for(var t=0;t<n;t++)if(w.contains(this,e[t]))return!0}))},closest:function(t,e){var n,r=0,o=this.length,i=[],a="string"!=typeof t&&w(t);if(!I.test(t))for(;r<o;r++)for(n=this[r];n&&n!==e;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&w.find.matchesSelector(n,t))){i.push(n);break}return this.pushStack(1<i.length?w.uniqueSort(i):i)},index:function(t){return t?"string"==typeof t?s.call(w(t),this[0]):s.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),w.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return E(t,"parentNode")},parentsUntil:function(t,e,n){return E(t,"parentNode",n)},next:function(t){return O(t,"nextSibling")},prev:function(t){return O(t,"previousSibling")},nextAll:function(t){return E(t,"nextSibling")},prevAll:function(t){return E(t,"previousSibling")},nextUntil:function(t,e,n){return E(t,"nextSibling",n)},prevUntil:function(t,e,n){return E(t,"previousSibling",n)},siblings:function(t){return S((t.parentNode||{}).firstChild,t)},children:function(t){return S(t.firstChild)},contents:function(t){return null!=t.contentDocument&&r(t.contentDocument)?t.contentDocument:(T(t,"template")&&(t=t.content||t),w.merge([],t.childNodes))}},(function(t,e){w.fn[t]=function(n,r){var o=w.map(this,e,n);return"Until"!==t.slice(-5)&&(r=n),r&&"string"==typeof r&&(o=w.filter(r,o)),1<this.length&&(F[t]||w.uniqueSort(o),N.test(t)&&o.reverse()),this.pushStack(o)}}));var M=/[^\x20\t\r\n\f]+/g;function P(t){return t}function L(t){throw t}function B(t,e,n,r){var o;try{t&&p(o=t.promise)?o.call(t).done(e).fail(n):t&&p(o=t.then)?o.call(t,e,n):e.apply(void 0,[t].slice(r))}catch(t){n.apply(void 0,[t])}}w.Callbacks=function(t){var e;t="string"==typeof t?(e={},w.each(t.match(M)||[],(function(t,n){e[n]=!0})),e):w.extend({},t);var n,r,o,i,a=[],s=[],u=-1,c=function(){for(i=i||t.once,o=n=!0;s.length;u=-1)for(r=s.shift();++u<a.length;)!1===a[u].apply(r[0],r[1])&&t.stopOnFalse&&(u=a.length,r=!1);t.memory||(r=!1),n=!1,i&&(a=r?[]:"")},l={add:function(){return a&&(r&&!n&&(u=a.length-1,s.push(r)),function e(n){w.each(n,(function(n,r){p(r)?t.unique&&l.has(r)||a.push(r):r&&r.length&&"string"!==b(r)&&e(r)}))}(arguments),r&&!n&&c()),this},remove:function(){return w.each(arguments,(function(t,e){for(var n;-1<(n=w.inArray(e,a,n));)a.splice(n,1),n<=u&&u--})),this},has:function(t){return t?-1<w.inArray(t,a):0<a.length},empty:function(){return a&&(a=[]),this},disable:function(){return i=s=[],a=r="",this},disabled:function(){return!a},lock:function(){return i=s=[],r||n||(a=r=""),this},locked:function(){return!!i},fireWith:function(t,e){return i||(e=[t,(e=e||[]).slice?e.slice():e],s.push(e),n||c()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!o}};return l},w.extend({Deferred:function(e){var n=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],r="pending",o={state:function(){return r},always:function(){return i.done(arguments).fail(arguments),this},catch:function(t){return o.then(null,t)},pipe:function(){var t=arguments;return w.Deferred((function(e){w.each(n,(function(n,r){var o=p(t[r[4]])&&t[r[4]];i[r[1]]((function(){var t=o&&o.apply(this,arguments);t&&p(t.promise)?t.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[r[0]+"With"](this,o?[t]:arguments)}))})),t=null})).promise()},then:function(e,r,o){var i=0;function a(e,n,r,o){return function(){var s=this,u=arguments,c=function(){var t,c;if(!(e<i)){if((t=r.apply(s,u))===n.promise())throw new TypeError("Thenable self-resolution");p(c=t&&("object"==typeof t||"function"==typeof t)&&t.then)?o?c.call(t,a(i,n,P,o),a(i,n,L,o)):(i++,c.call(t,a(i,n,P,o),a(i,n,L,o),a(i,n,P,n.notifyWith))):(r!==P&&(s=void 0,u=[t]),(o||n.resolveWith)(s,u))}},l=o?c:function(){try{c()}catch(c){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(c,l.stackTrace),i<=e+1&&(r!==L&&(s=void 0,u=[c]),n.rejectWith(s,u))}};e?l():(w.Deferred.getStackHook&&(l.stackTrace=w.Deferred.getStackHook()),t.setTimeout(l))}}return w.Deferred((function(t){n[0][3].add(a(0,t,p(o)?o:P,t.notifyWith)),n[1][3].add(a(0,t,p(e)?e:P)),n[2][3].add(a(0,t,p(r)?r:L))})).promise()},promise:function(t){return null!=t?w.extend(t,o):o}},i={};return w.each(n,(function(t,e){var a=e[2],s=e[5];o[e[1]]=a.add,s&&a.add((function(){r=s}),n[3-t][2].disable,n[3-t][3].disable,n[0][2].lock,n[0][3].lock),a.add(e[3].fire),i[e[0]]=function(){return i[e[0]+"With"](this===i?void 0:this,arguments),this},i[e[0]+"With"]=a.fireWith})),o.promise(i),e&&e.call(i,i),i},when:function(t){var e=arguments.length,n=e,r=Array(n),i=o.call(arguments),a=w.Deferred(),s=function(t){return function(n){r[t]=this,i[t]=1<arguments.length?o.call(arguments):n,--e||a.resolveWith(r,i)}};if(e<=1&&(B(t,a.done(s(n)).resolve,a.reject,!e),"pending"===a.state()||p(i[n]&&i[n].then)))return a.then();for(;n--;)B(i[n],s(n),a.reject);return a.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(e,n){t.console&&t.console.warn&&e&&W.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,n)},w.readyException=function(e){t.setTimeout((function(){throw e}))};var z=w.Deferred();function U(){m.removeEventListener("DOMContentLoaded",U),t.removeEventListener("load",U),w.ready()}w.fn.ready=function(t){return z.then(t).catch((function(t){w.readyException(t)})),this},w.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--w.readyWait:w.isReady)||(w.isReady=!0)!==t&&0<--w.readyWait||z.resolveWith(m,[w])}}),w.ready.then=z.then,"complete"===m.readyState||"loading"!==m.readyState&&!m.documentElement.doScroll?t.setTimeout(w.ready):(m.addEventListener("DOMContentLoaded",U),t.addEventListener("load",U));var j=function(t,e,n,r,o,i,a){var s=0,u=t.length,c=null==n;if("object"===b(n))for(s in o=!0,n)j(t,e,s,n[s],!0,i,a);else if(void 0!==r&&(o=!0,p(r)||(a=!0),c&&(a?(e.call(t,r),e=null):(c=e,e=function(t,e,n){return c.call(w(t),n)})),e))for(;s<u;s++)e(t[s],n,a?r:r.call(t[s],s,e(t[s],n)));return o?t:c?e.call(t):u?e(t[0],n):i},H=/^-ms-/,V=/-([a-z])/g;function q(t,e){return e.toUpperCase()}function G(t){return t.replace(H,"ms-").replace(V,q)}var K=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function X(){this.expando=w.expando+X.uid++}X.uid=1,X.prototype={cache:function(t){var e=t[this.expando];return e||(e={},K(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,n){var r,o=this.cache(t);if("string"==typeof e)o[G(e)]=n;else for(r in e)o[G(r)]=e[r];return o},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][G(e)]},access:function(t,e,n){return void 0===e||e&&"string"==typeof e&&void 0===n?this.get(t,e):(this.set(t,e,n),void 0!==n?n:e)},remove:function(t,e){var n,r=t[this.expando];if(void 0!==r){if(void 0!==e){n=(e=Array.isArray(e)?e.map(G):(e=G(e))in r?[e]:e.match(M)||[]).length;for(;n--;)delete r[e[n]]}(void 0===e||w.isEmptyObject(r))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!w.isEmptyObject(e)}};var $=new X,Y=new X,Q=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,J=/[A-Z]/g;function Z(t,e,n){var r,o;if(void 0===n&&1===t.nodeType)if(r="data-"+e.replace(J,"-$&").toLowerCase(),"string"==typeof(n=t.getAttribute(r))){try{n="true"===(o=n)||"false"!==o&&("null"===o?null:o===+o+""?+o:Q.test(o)?JSON.parse(o):o)}catch(t){}Y.set(t,e,n)}else n=void 0;return n}w.extend({hasData:function(t){return Y.hasData(t)||$.hasData(t)},data:function(t,e,n){return Y.access(t,e,n)},removeData:function(t,e){Y.remove(t,e)},_data:function(t,e,n){return $.access(t,e,n)},_removeData:function(t,e){$.remove(t,e)}}),w.fn.extend({data:function(t,e){var n,r,o,i=this[0],a=i&&i.attributes;if(void 0===t){if(this.length&&(o=Y.get(i),1===i.nodeType&&!$.get(i,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&0===(r=a[n].name).indexOf("data-")&&(r=G(r.slice(5)),Z(i,r,o[r]));$.set(i,"hasDataAttrs",!0)}return o}return"object"==typeof t?this.each((function(){Y.set(this,t)})):j(this,(function(e){var n;if(i&&void 0===e)return void 0!==(n=Y.get(i,t))||void 0!==(n=Z(i,t))?n:void 0;this.each((function(){Y.set(this,t,e)}))}),null,e,1<arguments.length,null,!0)},removeData:function(t){return this.each((function(){Y.remove(this,t)}))}}),w.extend({queue:function(t,e,n){var r;if(t)return r=$.get(t,e=(e||"fx")+"queue"),n&&(!r||Array.isArray(n)?r=$.access(t,e,w.makeArray(n)):r.push(n)),r||[]},dequeue:function(t,e){var n=w.queue(t,e=e||"fx"),r=n.length,o=n.shift(),i=w._queueHooks(t,e);"inprogress"===o&&(o=n.shift(),r--),o&&("fx"===e&&n.unshift("inprogress"),delete i.stop,o.call(t,(function(){w.dequeue(t,e)}),i)),!r&&i&&i.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return $.get(t,n)||$.access(t,n,{empty:w.Callbacks("once memory").add((function(){$.remove(t,[e+"queue",n])}))})}}),w.fn.extend({queue:function(t,e){var n=2;return"string"!=typeof t&&(e=t,t="fx",n--),arguments.length<n?w.queue(this[0],t):void 0===e?this:this.each((function(){var n=w.queue(this,t,e);w._queueHooks(this,t),"fx"===t&&"inprogress"!==n[0]&&w.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){w.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var n,r=1,o=w.Deferred(),i=this,a=this.length,s=function(){--r||o.resolveWith(i,[i])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)(n=$.get(i[a],t+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),o.promise(e)}});var tt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,et=new RegExp("^(?:([+-])=|)("+tt+")([a-z%]*)$","i"),nt=["Top","Right","Bottom","Left"],rt=m.documentElement,ot=function(t){return w.contains(t.ownerDocument,t)},it={composed:!0};rt.getRootNode&&(ot=function(t){return w.contains(t.ownerDocument,t)||t.getRootNode(it)===t.ownerDocument});var at=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&ot(t)&&"none"===w.css(t,"display")};function st(t,e,n,r){var o,i,a=20,s=r?function(){return r.cur()}:function(){return w.css(t,e,"")},u=s(),c=n&&n[3]||(w.cssNumber[e]?"":"px"),l=t.nodeType&&(w.cssNumber[e]||"px"!==c&&+u)&&et.exec(w.css(t,e));if(l&&l[3]!==c){for(c=c||l[3],l=+(u/=2)||1;a--;)w.style(t,e,l+c),(1-i)*(1-(i=s()/u||.5))<=0&&(a=0),l/=i;w.style(t,e,(l*=2)+c),n=n||[]}return n&&(l=+l||+u||0,o=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=c,r.start=l,r.end=o)),o}var ut={};function ct(t,e){for(var n,r,o,i,a,s,u,c=[],l=0,f=t.length;l<f;l++)(r=t[l]).style&&(n=r.style.display,e?("none"===n&&(c[l]=$.get(r,"display")||null,c[l]||(r.style.display="")),""===r.style.display&&at(r)&&(c[l]=(u=a=i=void 0,a=(o=r).ownerDocument,(u=ut[s=o.nodeName])||(i=a.body.appendChild(a.createElement(s)),u=w.css(i,"display"),i.parentNode.removeChild(i),"none"===u&&(u="block"),ut[s]=u)))):"none"!==n&&(c[l]="none",$.set(r,"display",n)));for(l=0;l<f;l++)null!=c[l]&&(t[l].style.display=c[l]);return t}w.fn.extend({show:function(){return ct(this,!0)},hide:function(){return ct(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){at(this)?w(this).show():w(this).hide()}))}});var lt,ft,ht=/^(?:checkbox|radio)$/i,dt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,pt=/^$|^module$|\/(?:java|ecma)script/i;lt=m.createDocumentFragment().appendChild(m.createElement("div")),(ft=m.createElement("input")).setAttribute("type","radio"),ft.setAttribute("checked","checked"),ft.setAttribute("name","t"),lt.appendChild(ft),d.checkClone=lt.cloneNode(!0).cloneNode(!0).lastChild.checked,lt.innerHTML="<textarea>x</textarea>",d.noCloneChecked=!!lt.cloneNode(!0).lastChild.defaultValue,lt.innerHTML="<option></option>",d.option=!!lt.lastChild;var vt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function mt(t,e){var n;return n=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&T(t,e)?w.merge([t],n):n}function gt(t,e){for(var n=0,r=t.length;n<r;n++)$.set(t[n],"globalEval",!e||$.get(e[n],"globalEval"))}vt.tbody=vt.tfoot=vt.colgroup=vt.caption=vt.thead,vt.th=vt.td,d.option||(vt.optgroup=vt.option=[1,"<select multiple='multiple'>","</select>"]);var yt=/<|&#?\w+;/;function bt(t,e,n,r,o){for(var i,a,s,u,c,l,f=e.createDocumentFragment(),h=[],d=0,p=t.length;d<p;d++)if((i=t[d])||0===i)if("object"===b(i))w.merge(h,i.nodeType?[i]:i);else if(yt.test(i)){for(a=a||f.appendChild(e.createElement("div")),s=(dt.exec(i)||["",""])[1].toLowerCase(),a.innerHTML=(u=vt[s]||vt._default)[1]+w.htmlPrefilter(i)+u[2],l=u[0];l--;)a=a.lastChild;w.merge(h,a.childNodes),(a=f.firstChild).textContent=""}else h.push(e.createTextNode(i));for(f.textContent="",d=0;i=h[d++];)if(r&&-1<w.inArray(i,r))o&&o.push(i);else if(c=ot(i),a=mt(f.appendChild(i),"script"),c&&gt(a),n)for(l=0;i=a[l++];)pt.test(i.type||"")&&n.push(i);return f}var xt=/^key/,wt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,_t=/^([^.]*)(?:\.(.+)|)/;function Ct(){return!0}function Et(){return!1}function St(t,e){return t===function(){try{return m.activeElement}catch(t){}}()==("focus"===e)}function It(t,e,n,r,o,i){var a,s;if("object"==typeof e){for(s in"string"!=typeof n&&(r=r||n,n=void 0),e)It(t,s,n,r,e[s],i);return t}if(null==r&&null==o?(o=n,r=n=void 0):null==o&&("string"==typeof n?(o=r,r=void 0):(o=r,r=n,n=void 0)),!1===o)o=Et;else if(!o)return t;return 1===i&&(a=o,(o=function(t){return w().off(t),a.apply(this,arguments)}).guid=a.guid||(a.guid=w.guid++)),t.each((function(){w.event.add(this,e,o,r,n)}))}function Tt(t,e,n){n?($.set(t,e,!1),w.event.add(t,e,{namespace:!1,handler:function(t){var r,i,a=$.get(this,e);if(1&t.isTrigger&&this[e]){if(a.length)(w.event.special[e]||{}).delegateType&&t.stopPropagation();else if(a=o.call(arguments),$.set(this,e,a),r=n(this,e),this[e](),a!==(i=$.get(this,e))||r?$.set(this,e,!1):i={},a!==i)return t.stopImmediatePropagation(),t.preventDefault(),i.value}else a.length&&($.set(this,e,{value:w.event.trigger(w.extend(a[0],w.Event.prototype),a.slice(1),this)}),t.stopImmediatePropagation())}})):void 0===$.get(t,e)&&w.event.add(t,e,Ct)}w.event={global:{},add:function(t,e,n,r,o){var i,a,s,u,c,l,f,h,d,p,v,m=$.get(t);if(K(t))for(n.handler&&(n=(i=n).handler,o=i.selector),o&&w.find.matchesSelector(rt,o),n.guid||(n.guid=w.guid++),(u=m.events)||(u=m.events=Object.create(null)),(a=m.handle)||(a=m.handle=function(e){return void 0!==w&&w.event.triggered!==e.type?w.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(M)||[""]).length;c--;)d=v=(s=_t.exec(e[c])||[])[1],p=(s[2]||"").split(".").sort(),d&&(f=w.event.special[d]||{},f=w.event.special[d=(o?f.delegateType:f.bindType)||d]||{},l=w.extend({type:d,origType:v,data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&w.expr.match.needsContext.test(o),namespace:p.join(".")},i),(h=u[d])||((h=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,p,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,l),l.handler.guid||(l.handler.guid=n.guid)),o?h.splice(h.delegateCount++,0,l):h.push(l),w.event.global[d]=!0)},remove:function(t,e,n,r,o){var i,a,s,u,c,l,f,h,d,p,v,m=$.hasData(t)&&$.get(t);if(m&&(u=m.events)){for(c=(e=(e||"").match(M)||[""]).length;c--;)if(d=v=(s=_t.exec(e[c])||[])[1],p=(s[2]||"").split(".").sort(),d){for(f=w.event.special[d]||{},h=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=i=h.length;i--;)l=h[i],!o&&v!==l.origType||n&&n.guid!==l.guid||s&&!s.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(h.splice(i,1),l.selector&&h.delegateCount--,f.remove&&f.remove.call(t,l));a&&!h.length&&(f.teardown&&!1!==f.teardown.call(t,p,m.handle)||w.removeEvent(t,d,m.handle),delete u[d])}else for(d in u)w.event.remove(t,d+e[c],n,r,!0);w.isEmptyObject(u)&&$.remove(t,"handle events")}},dispatch:function(t){var e,n,r,o,i,a,s=new Array(arguments.length),u=w.event.fix(t),c=($.get(this,"events")||Object.create(null))[u.type]||[],l=w.event.special[u.type]||{};for(s[0]=u,e=1;e<arguments.length;e++)s[e]=arguments[e];if(u.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,u)){for(a=w.event.handlers.call(this,u,c),e=0;(o=a[e++])&&!u.isPropagationStopped();)for(u.currentTarget=o.elem,n=0;(i=o.handlers[n++])&&!u.isImmediatePropagationStopped();)u.rnamespace&&!1!==i.namespace&&!u.rnamespace.test(i.namespace)||(u.handleObj=i,u.data=i.data,void 0!==(r=((w.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,u),u.result}},handlers:function(t,e){var n,r,o,i,a,s=[],u=e.delegateCount,c=t.target;if(u&&c.nodeType&&!("click"===t.type&&1<=t.button))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(i=[],a={},n=0;n<u;n++)void 0===a[o=(r=e[n]).selector+" "]&&(a[o]=r.needsContext?-1<w(o,this).index(c):w.find(o,this,null,[c]).length),a[o]&&i.push(r);i.length&&s.push({elem:c,handlers:i})}return c=this,u<e.length&&s.push({elem:c,handlers:e.slice(u)}),s},addProp:function(t,e){Object.defineProperty(w.Event.prototype,t,{enumerable:!0,configurable:!0,get:p(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[w.expando]?t:new w.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return ht.test(e.type)&&e.click&&T(e,"input")&&Tt(e,"click",Ct),!1},trigger:function(t){var e=this||t;return ht.test(e.type)&&e.click&&T(e,"input")&&Tt(e,"click"),!0},_default:function(t){var e=t.target;return ht.test(e.type)&&e.click&&T(e,"input")&&$.get(e,"click")||T(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},w.removeEvent=function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n)},w.Event=function(t,e){if(!(this instanceof w.Event))return new w.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Ct:Et,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&w.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[w.expando]=!0},w.Event.prototype={constructor:w.Event,isDefaultPrevented:Et,isPropagationStopped:Et,isImmediatePropagationStopped:Et,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Ct,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Ct,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Ct,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&xt.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&wt.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},w.event.addProp),w.each({focus:"focusin",blur:"focusout"},(function(t,e){w.event.special[t]={setup:function(){return Tt(this,t,St),!1},trigger:function(){return Tt(this,t),!0},delegateType:e}})),w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){w.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,r=t.relatedTarget,o=t.handleObj;return r&&(r===this||w.contains(this,r))||(t.type=o.origType,n=o.handler.apply(this,arguments),t.type=e),n}}})),w.fn.extend({on:function(t,e,n,r){return It(this,t,e,n,r)},one:function(t,e,n,r){return It(this,t,e,n,r,1)},off:function(t,e,n){var r,o;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,w(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(o in t)this.off(o,e,t[o]);return this}return!1!==e&&"function"!=typeof e||(n=e,e=void 0),!1===n&&(n=Et),this.each((function(){w.event.remove(this,t,n,e)}))}});var kt=/<script|<style|<link/i,Dt=/checked\s*(?:[^=]|=\s*.checked.)/i,At=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Rt(t,e){return T(t,"table")&&T(11!==e.nodeType?e:e.firstChild,"tr")&&w(t).children("tbody")[0]||t}function Nt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Ft(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Ot(t,e){var n,r,o,i,a,s;if(1===e.nodeType){if($.hasData(t)&&(s=$.get(t).events))for(o in $.remove(e,"handle events"),s)for(n=0,r=s[o].length;n<r;n++)w.event.add(e,o,s[o][n]);Y.hasData(t)&&(i=Y.access(t),a=w.extend({},i),Y.set(e,a))}}function Mt(t,e,n,r){e=i(e);var o,a,s,u,c,l,f=0,h=t.length,v=h-1,m=e[0],g=p(m);if(g||1<h&&"string"==typeof m&&!d.checkClone&&Dt.test(m))return t.each((function(o){var i=t.eq(o);g&&(e[0]=m.call(this,o,i.html())),Mt(i,e,n,r)}));if(h&&(a=(o=bt(e,t[0].ownerDocument,!1,t,r)).firstChild,1===o.childNodes.length&&(o=a),a||r)){for(u=(s=w.map(mt(o,"script"),Nt)).length;f<h;f++)c=o,f!==v&&(c=w.clone(c,!0,!0),u&&w.merge(s,mt(c,"script"))),n.call(t[f],c,f);if(u)for(l=s[s.length-1].ownerDocument,w.map(s,Ft),f=0;f<u;f++)pt.test((c=s[f]).type||"")&&!$.access(c,"globalEval")&&w.contains(l,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?w._evalUrl&&!c.noModule&&w._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},l):y(c.textContent.replace(At,""),c,l))}return t}function Pt(t,e,n){for(var r,o=e?w.filter(e,t):t,i=0;null!=(r=o[i]);i++)n||1!==r.nodeType||w.cleanData(mt(r)),r.parentNode&&(n&&ot(r)&&gt(mt(r,"script")),r.parentNode.removeChild(r));return t}w.extend({htmlPrefilter:function(t){return t},clone:function(t,e,n){var r,o,i,a,s,u,c,l=t.cloneNode(!0),f=ot(t);if(!(d.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||w.isXMLDoc(t)))for(a=mt(l),r=0,o=(i=mt(t)).length;r<o;r++)s=i[r],"input"===(c=(u=a[r]).nodeName.toLowerCase())&&ht.test(s.type)?u.checked=s.checked:"input"!==c&&"textarea"!==c||(u.defaultValue=s.defaultValue);if(e)if(n)for(i=i||mt(t),a=a||mt(l),r=0,o=i.length;r<o;r++)Ot(i[r],a[r]);else Ot(t,l);return 0<(a=mt(l,"script")).length&&gt(a,!f&&mt(t,"script")),l},cleanData:function(t){for(var e,n,r,o=w.event.special,i=0;void 0!==(n=t[i]);i++)if(K(n)){if(e=n[$.expando]){if(e.events)for(r in e.events)o[r]?w.event.remove(n,r):w.removeEvent(n,r,e.handle);n[$.expando]=void 0}n[Y.expando]&&(n[Y.expando]=void 0)}}}),w.fn.extend({detach:function(t){return Pt(this,t,!0)},remove:function(t){return Pt(this,t)},text:function(t){return j(this,(function(t){return void 0===t?w.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return Mt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Rt(this,t).appendChild(t)}))},prepend:function(){return Mt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Rt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return Mt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return Mt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(w.cleanData(mt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return w.clone(this,t,e)}))},html:function(t){return j(this,(function(t){var e=this[0]||{},n=0,r=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!kt.test(t)&&!vt[(dt.exec(t)||["",""])[1].toLowerCase()]){t=w.htmlPrefilter(t);try{for(;n<r;n++)1===(e=this[n]||{}).nodeType&&(w.cleanData(mt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return Mt(this,arguments,(function(e){var n=this.parentNode;w.inArray(this,t)<0&&(w.cleanData(mt(this)),n&&n.replaceChild(e,this))}),t)}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){w.fn[t]=function(t){for(var n,r=[],o=w(t),i=o.length-1,s=0;s<=i;s++)n=s===i?this:this.clone(!0),w(o[s])[e](n),a.apply(r,n.get());return this.pushStack(r)}}));var Lt=new RegExp("^("+tt+")(?!px)[a-z%]+$","i"),Bt=function(e){var n=e.ownerDocument.defaultView;return n&&n.opener||(n=t),n.getComputedStyle(e)},Wt=function(t,e,n){var r,o,i={};for(o in e)i[o]=t.style[o],t.style[o]=e[o];for(o in r=n.call(t),e)t.style[o]=i[o];return r},zt=new RegExp(nt.join("|"),"i");function Ut(t,e,n){var r,o,i,a,s=t.style;return(n=n||Bt(t))&&(""!==(a=n.getPropertyValue(e)||n[e])||ot(t)||(a=w.style(t,e)),!d.pixelBoxStyles()&&Lt.test(a)&&zt.test(e)&&(r=s.width,o=s.minWidth,i=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=o,s.maxWidth=i)),void 0!==a?a+"":a}function jt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",rt.appendChild(c).appendChild(l);var e=t.getComputedStyle(l);r="1%"!==e.top,u=12===n(e.marginLeft),l.style.right="60%",a=36===n(e.right),o=36===n(e.width),l.style.position="absolute",i=12===n(l.offsetWidth/3),rt.removeChild(c),l=null}}function n(t){return Math.round(parseFloat(t))}var r,o,i,a,s,u,c=m.createElement("div"),l=m.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",d.clearCloneStyle="content-box"===l.style.backgroundClip,w.extend(d,{boxSizingReliable:function(){return e(),o},pixelBoxStyles:function(){return e(),a},pixelPosition:function(){return e(),r},reliableMarginLeft:function(){return e(),u},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,n,r,o;return null==s&&(e=m.createElement("table"),n=m.createElement("tr"),r=m.createElement("div"),e.style.cssText="position:absolute;left:-11111px",n.style.height="1px",r.style.height="9px",rt.appendChild(e).appendChild(n).appendChild(r),o=t.getComputedStyle(n),s=3<parseInt(o.height),rt.removeChild(e)),s}}))}();var Ht=["Webkit","Moz","ms"],Vt=m.createElement("div").style,qt={};function Gt(t){return w.cssProps[t]||qt[t]||(t in Vt?t:qt[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),n=Ht.length;n--;)if((t=Ht[n]+e)in Vt)return t}(t)||t)}var Kt=/^(none|table(?!-c[ea]).+)/,Xt=/^--/,$t={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:"0",fontWeight:"400"};function Qt(t,e,n){var r=et.exec(e);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):e}function Jt(t,e,n,r,o,i){var a="width"===e?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=w.css(t,n+nt[a],!0,o)),r?("content"===n&&(u-=w.css(t,"padding"+nt[a],!0,o)),"margin"!==n&&(u-=w.css(t,"border"+nt[a]+"Width",!0,o))):(u+=w.css(t,"padding"+nt[a],!0,o),"padding"!==n?u+=w.css(t,"border"+nt[a]+"Width",!0,o):s+=w.css(t,"border"+nt[a]+"Width",!0,o));return!r&&0<=i&&(u+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-i-u-s-.5))||0),u}function Zt(t,e,n){var r=Bt(t),o=(!d.boxSizingReliable()||n)&&"border-box"===w.css(t,"boxSizing",!1,r),i=o,a=Ut(t,e,r),s="offset"+e[0].toUpperCase()+e.slice(1);if(Lt.test(a)){if(!n)return a;a="auto"}return(!d.boxSizingReliable()&&o||!d.reliableTrDimensions()&&T(t,"tr")||"auto"===a||!parseFloat(a)&&"inline"===w.css(t,"display",!1,r))&&t.getClientRects().length&&(o="border-box"===w.css(t,"boxSizing",!1,r),(i=s in t)&&(a=t[s])),(a=parseFloat(a)||0)+Jt(t,e,n||(o?"border":"content"),i,r,a)+"px"}function te(t,e,n,r,o){return new te.prototype.init(t,e,n,r,o)}w.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=Ut(t,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,n,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,i,a,s=G(e),u=Xt.test(e),c=t.style;if(u||(e=Gt(s)),a=w.cssHooks[e]||w.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(o=a.get(t,!1,r))?o:c[e];"string"==(i=typeof n)&&(o=et.exec(n))&&o[1]&&(n=st(t,e,o),i="number"),null!=n&&n==n&&("number"!==i||u||(n+=o&&o[3]||(w.cssNumber[s]?"":"px")),d.clearCloneStyle||""!==n||0!==e.indexOf("background")||(c[e]="inherit"),a&&"set"in a&&void 0===(n=a.set(t,n,r))||(u?c.setProperty(e,n):c[e]=n))}},css:function(t,e,n,r){var o,i,a,s=G(e);return Xt.test(e)||(e=Gt(s)),(a=w.cssHooks[e]||w.cssHooks[s])&&"get"in a&&(o=a.get(t,!0,n)),void 0===o&&(o=Ut(t,e,r)),"normal"===o&&e in Yt&&(o=Yt[e]),""===n||n?(i=parseFloat(o),!0===n||isFinite(i)?i||0:o):o}}),w.each(["height","width"],(function(t,e){w.cssHooks[e]={get:function(t,n,r){if(n)return!Kt.test(w.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?Zt(t,e,r):Wt(t,$t,(function(){return Zt(t,e,r)}))},set:function(t,n,r){var o,i=Bt(t),a=!d.scrollboxSize()&&"absolute"===i.position,s=(a||r)&&"border-box"===w.css(t,"boxSizing",!1,i),u=r?Jt(t,e,r,s,i):0;return s&&a&&(u-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(i[e])-Jt(t,e,"border",!1,i)-.5)),u&&(o=et.exec(n))&&"px"!==(o[3]||"px")&&(t.style[e]=n,n=w.css(t,e)),Qt(0,n,u)}}})),w.cssHooks.marginLeft=jt(d.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Ut(t,"marginLeft"))||t.getBoundingClientRect().left-Wt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),w.each({margin:"",padding:"",border:"Width"},(function(t,e){w.cssHooks[t+e]={expand:function(n){for(var r=0,o={},i="string"==typeof n?n.split(" "):[n];r<4;r++)o[t+nt[r]+e]=i[r]||i[r-2]||i[0];return o}},"margin"!==t&&(w.cssHooks[t+e].set=Qt)})),w.fn.extend({css:function(t,e){return j(this,(function(t,e,n){var r,o,i={},a=0;if(Array.isArray(e)){for(r=Bt(t),o=e.length;a<o;a++)i[e[a]]=w.css(t,e[a],!1,r);return i}return void 0!==n?w.style(t,e,n):w.css(t,e)}),t,e,1<arguments.length)}}),((w.Tween=te).prototype={constructor:te,init:function(t,e,n,r,o,i){this.elem=t,this.prop=n,this.easing=o||w.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=r,this.unit=i||(w.cssNumber[n]?"":"px")},cur:function(){var t=te.propHooks[this.prop];return t&&t.get?t.get(this):te.propHooks._default.get(this)},run:function(t){var e,n=te.propHooks[this.prop];return this.pos=e=this.options.duration?w.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):te.propHooks._default.set(this),this}}).init.prototype=te.prototype,(te.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=w.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){w.fx.step[t.prop]?w.fx.step[t.prop](t):1!==t.elem.nodeType||!w.cssHooks[t.prop]&&null==t.elem.style[Gt(t.prop)]?t.elem[t.prop]=t.now:w.style(t.elem,t.prop,t.now+t.unit)}}}).scrollTop=te.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},w.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},w.fx=te.prototype.init,w.fx.step={};var ee,ne,re,oe,ie=/^(?:toggle|show|hide)$/,ae=/queueHooks$/;function se(){ne&&(!1===m.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(se):t.setTimeout(se,w.fx.interval),w.fx.tick())}function ue(){return t.setTimeout((function(){ee=void 0})),ee=Date.now()}function ce(t,e){var n,r=0,o={height:t};for(e=e?1:0;r<4;r+=2-e)o["margin"+(n=nt[r])]=o["padding"+n]=t;return e&&(o.opacity=o.width=t),o}function le(t,e,n){for(var r,o=(fe.tweeners[e]||[]).concat(fe.tweeners["*"]),i=0,a=o.length;i<a;i++)if(r=o[i].call(n,e,t))return r}function fe(t,e,n){var r,o,i=0,a=fe.prefilters.length,s=w.Deferred().always((function(){delete u.elem})),u=function(){if(o)return!1;for(var e=ee||ue(),n=Math.max(0,c.startTime+c.duration-e),r=1-(n/c.duration||0),i=0,a=c.tweens.length;i<a;i++)c.tweens[i].run(r);return s.notifyWith(t,[c,r,n]),r<1&&a?n:(a||s.notifyWith(t,[c,1,0]),s.resolveWith(t,[c]),!1)},c=s.promise({elem:t,props:w.extend({},e),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},n),originalProperties:e,originalOptions:n,startTime:ee||ue(),duration:n.duration,tweens:[],createTween:function(e,n){var r=w.Tween(t,c.opts,e,n,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(r),r},stop:function(e){var n=0,r=e?c.tweens.length:0;if(o)return this;for(o=!0;n<r;n++)c.tweens[n].run(1);return e?(s.notifyWith(t,[c,1,0]),s.resolveWith(t,[c,e])):s.rejectWith(t,[c,e]),this}}),l=c.props;for(function(t,e){var n,r,o,i,a;for(n in t)if(o=e[r=G(n)],i=t[n],Array.isArray(i)&&(o=i[1],i=t[n]=i[0]),n!==r&&(t[r]=i,delete t[n]),(a=w.cssHooks[r])&&"expand"in a)for(n in i=a.expand(i),delete t[r],i)n in t||(t[n]=i[n],e[n]=o);else e[r]=o}(l,c.opts.specialEasing);i<a;i++)if(r=fe.prefilters[i].call(c,t,l,c.opts))return p(r.stop)&&(w._queueHooks(c.elem,c.opts.queue).stop=r.stop.bind(r)),r;return w.map(l,le,c),p(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),w.fx.timer(w.extend(u,{elem:t,anim:c,queue:c.opts.queue})),c}w.Animation=w.extend(fe,{tweeners:{"*":[function(t,e){var n=this.createTween(t,e);return st(n.elem,t,et.exec(e),n),n}]},tweener:function(t,e){p(t)?(e=t,t=["*"]):t=t.match(M);for(var n,r=0,o=t.length;r<o;r++)(fe.tweeners[n=t[r]]=fe.tweeners[n]||[]).unshift(e)},prefilters:[function(t,e,n){var r,o,i,a,s,u,c,l,f="width"in e||"height"in e,h=this,d={},p=t.style,v=t.nodeType&&at(t),m=$.get(t,"fxshow");for(r in n.queue||(null==(a=w._queueHooks(t,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,h.always((function(){h.always((function(){a.unqueued--,w.queue(t,"fx").length||a.empty.fire()}))}))),e)if(ie.test(o=e[r])){if(delete e[r],i=i||"toggle"===o,o===(v?"hide":"show")){if("show"!==o||!m||void 0===m[r])continue;v=!0}d[r]=m&&m[r]||w.style(t,r)}if((u=!w.isEmptyObject(e))||!w.isEmptyObject(d))for(r in f&&1===t.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(c=m&&m.display)&&(c=$.get(t,"display")),"none"===(l=w.css(t,"display"))&&(c?l=c:(ct([t],!0),c=t.style.display||c,l=w.css(t,"display"),ct([t]))),("inline"===l||"inline-block"===l&&null!=c)&&"none"===w.css(t,"float")&&(u||(h.done((function(){p.display=c})),null==c&&(c="none"===(l=p.display)?"":l)),p.display="inline-block")),n.overflow&&(p.overflow="hidden",h.always((function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}))),u=!1,d)u||(m?"hidden"in m&&(v=m.hidden):m=$.access(t,"fxshow",{display:c}),i&&(m.hidden=!v),v&&ct([t],!0),h.done((function(){for(r in v||ct([t]),$.remove(t,"fxshow"),d)w.style(t,r,d[r])}))),u=le(v?m[r]:0,r,h),r in m||(m[r]=u.start,v&&(u.end=u.start,u.start=0))}],prefilter:function(t,e){e?fe.prefilters.unshift(t):fe.prefilters.push(t)}}),w.speed=function(t,e,n){var r=t&&"object"==typeof t?w.extend({},t):{complete:n||!n&&e||p(t)&&t,duration:t,easing:n&&e||e&&!p(e)&&e};return w.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration=r.duration in w.fx.speeds?w.fx.speeds[r.duration]:w.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){p(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.fn.extend({fadeTo:function(t,e,n,r){return this.filter(at).css("opacity",0).show().end().animate({opacity:e},t,n,r)},animate:function(t,e,n,r){var o=w.isEmptyObject(t),i=w.speed(e,n,r),a=function(){var e=fe(this,w.extend({},t),i);(o||$.get(this,"finish"))&&e.stop(!0)};return a.finish=a,o||!1===i.queue?this.each(a):this.queue(i.queue,a)},stop:function(t,e,n){var r=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,o=null!=t&&t+"queueHooks",i=w.timers,a=$.get(this);if(o)a[o]&&a[o].stop&&r(a[o]);else for(o in a)a[o]&&a[o].stop&&ae.test(o)&&r(a[o]);for(o=i.length;o--;)i[o].elem!==this||null!=t&&i[o].queue!==t||(i[o].anim.stop(n),e=!1,i.splice(o,1));!e&&n||w.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,n=$.get(this),r=n[t+"queue"],o=n[t+"queueHooks"],i=w.timers,a=r?r.length:0;for(n.finish=!0,w.queue(this,t,[]),o&&o.stop&&o.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===t&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<a;e++)r[e]&&r[e].finish&&r[e].finish.call(this);delete n.finish}))}}),w.each(["toggle","show","hide"],(function(t,e){var n=w.fn[e];w.fn[e]=function(t,r,o){return null==t||"boolean"==typeof t?n.apply(this,arguments):this.animate(ce(e,!0),t,r,o)}})),w.each({slideDown:ce("show"),slideUp:ce("hide"),slideToggle:ce("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){w.fn[t]=function(t,n,r){return this.animate(e,t,n,r)}})),w.timers=[],w.fx.tick=function(){var t,e=0,n=w.timers;for(ee=Date.now();e<n.length;e++)(t=n[e])()||n[e]!==t||n.splice(e--,1);n.length||w.fx.stop(),ee=void 0},w.fx.timer=function(t){w.timers.push(t),w.fx.start()},w.fx.interval=13,w.fx.start=function(){ne||(ne=!0,se())},w.fx.stop=function(){ne=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(e,n){return e=w.fx&&w.fx.speeds[e]||e,this.queue(n=n||"fx",(function(n,r){var o=t.setTimeout(n,e);r.stop=function(){t.clearTimeout(o)}}))},re=m.createElement("input"),oe=m.createElement("select").appendChild(m.createElement("option")),re.type="checkbox",d.checkOn=""!==re.value,d.optSelected=oe.selected,(re=m.createElement("input")).value="t",re.type="radio",d.radioValue="t"===re.value;var he,de=w.expr.attrHandle;w.fn.extend({attr:function(t,e){return j(this,w.attr,t,e,1<arguments.length)},removeAttr:function(t){return this.each((function(){w.removeAttr(this,t)}))}}),w.extend({attr:function(t,e,n){var r,o,i=t.nodeType;if(3!==i&&8!==i&&2!==i)return void 0===t.getAttribute?w.prop(t,e,n):(1===i&&w.isXMLDoc(t)||(o=w.attrHooks[e.toLowerCase()]||(w.expr.match.bool.test(e)?he:void 0)),void 0!==n?null===n?void w.removeAttr(t,e):o&&"set"in o&&void 0!==(r=o.set(t,n,e))?r:(t.setAttribute(e,n+""),n):o&&"get"in o&&null!==(r=o.get(t,e))?r:null==(r=w.find.attr(t,e))?void 0:r)},attrHooks:{type:{set:function(t,e){if(!d.radioValue&&"radio"===e&&T(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}}},removeAttr:function(t,e){var n,r=0,o=e&&e.match(M);if(o&&1===t.nodeType)for(;n=o[r++];)t.removeAttribute(n)}}),he={set:function(t,e,n){return!1===e?w.removeAttr(t,n):t.setAttribute(n,n),n}},w.each(w.expr.match.bool.source.match(/\w+/g),(function(t,e){var n=de[e]||w.find.attr;de[e]=function(t,e,r){var o,i,a=e.toLowerCase();return r||(i=de[a],de[a]=o,o=null!=n(t,e,r)?a:null,de[a]=i),o}}));var pe=/^(?:input|select|textarea|button)$/i,ve=/^(?:a|area)$/i;function me(t){return(t.match(M)||[]).join(" ")}function ge(t){return t.getAttribute&&t.getAttribute("class")||""}function ye(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(M)||[]}w.fn.extend({prop:function(t,e){return j(this,w.prop,t,e,1<arguments.length)},removeProp:function(t){return this.each((function(){delete this[w.propFix[t]||t]}))}}),w.extend({prop:function(t,e,n){var r,o,i=t.nodeType;if(3!==i&&8!==i&&2!==i)return 1===i&&w.isXMLDoc(t)||(o=w.propHooks[e=w.propFix[e]||e]),void 0!==n?o&&"set"in o&&void 0!==(r=o.set(t,n,e))?r:t[e]=n:o&&"get"in o&&null!==(r=o.get(t,e))?r:t[e]},propHooks:{tabIndex:{get:function(t){var e=w.find.attr(t,"tabindex");return e?parseInt(e,10):pe.test(t.nodeName)||ve.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),d.optSelected||(w.propHooks.selected={get:function(t){return null},set:function(t){}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){w.propFix[this.toLowerCase()]=this})),w.fn.extend({addClass:function(t){var e,n,r,o,i,a,s,u=0;if(p(t))return this.each((function(e){w(this).addClass(t.call(this,e,ge(this)))}));if((e=ye(t)).length)for(;n=this[u++];)if(o=ge(n),r=1===n.nodeType&&" "+me(o)+" "){for(a=0;i=e[a++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");o!==(s=me(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,o,i,a,s,u=0;if(p(t))return this.each((function(e){w(this).removeClass(t.call(this,e,ge(this)))}));if(!arguments.length)return this.attr("class","");if((e=ye(t)).length)for(;n=this[u++];)if(o=ge(n),r=1===n.nodeType&&" "+me(o)+" "){for(a=0;i=e[a++];)for(;-1<r.indexOf(" "+i+" ");)r=r.replace(" "+i+" "," ");o!==(s=me(r))&&n.setAttribute("class",s)}return this},toggleClass:function(t,e){var n=typeof t,r="string"===n||Array.isArray(t);return"boolean"==typeof e&&r?e?this.addClass(t):this.removeClass(t):p(t)?this.each((function(n){w(this).toggleClass(t.call(this,n,ge(this),e),e)})):this.each((function(){var e,o,i,a;if(r)for(o=0,i=w(this),a=ye(t);e=a[o++];)i.hasClass(e)?i.removeClass(e):i.addClass(e);else void 0!==t&&"boolean"!==n||((e=ge(this))&&$.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":$.get(this,"__className__")||""))}))},hasClass:function(t){var e,n,r=0;for(e=" "+t+" ";n=this[r++];)if(1===n.nodeType&&-1<(" "+me(ge(n))+" ").indexOf(e))return!0;return!1}});var be=/\r/g;w.fn.extend({val:function(t){var e,n,r,o=this[0];return arguments.length?(r=p(t),this.each((function(n){var o;1===this.nodeType&&(null==(o=r?t.call(this,n,w(this).val()):t)?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=w.map(o,(function(t){return null==t?"":t+""}))),(e=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,o,"value")||(this.value=o))}))):o?(e=w.valHooks[o.type]||w.valHooks[o.nodeName.toLowerCase()])&&"get"in e&&void 0!==(n=e.get(o,"value"))?n:"string"==typeof(n=o.value)?n.replace(be,""):null==n?"":n:void 0}}),w.extend({valHooks:{option:{get:function(t){var e=w.find.attr(t,"value");return null!=e?e:me(w.text(t))}},select:{get:function(t){var e,n,r,o=t.options,i=t.selectedIndex,a="select-one"===t.type,s=a?null:[],u=a?i+1:o.length;for(r=i<0?u:a?i:0;r<u;r++)if(((n=o[r]).selected||r===i)&&!n.disabled&&(!n.parentNode.disabled||!T(n.parentNode,"optgroup"))){if(e=w(n).val(),a)return e;s.push(e)}return s},set:function(t,e){for(var n,r,o=t.options,i=w.makeArray(e),a=o.length;a--;)((r=o[a]).selected=-1<w.inArray(w.valHooks.option.get(r),i))&&(n=!0);return n||(t.selectedIndex=-1),i}}}}),w.each(["radio","checkbox"],(function(){w.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=-1<w.inArray(w(t).val(),e)}},d.checkOn||(w.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})})),d.focusin="onfocusin"in t;var xe=/^(?:focusinfocus|focusoutblur)$/,we=function(t){t.stopPropagation()};w.extend(w.event,{trigger:function(e,n,r,o){var i,a,s,u,c,f,h,d,g=[r||m],y=l.call(e,"type")?e.type:e,b=l.call(e,"namespace")?e.namespace.split("."):[];if(a=d=s=r=r||m,3!==r.nodeType&&8!==r.nodeType&&!xe.test(y+w.event.triggered)&&(-1<y.indexOf(".")&&(y=(b=y.split(".")).shift(),b.sort()),c=y.indexOf(":")<0&&"on"+y,(e=e[w.expando]?e:new w.Event(y,"object"==typeof e&&e)).isTrigger=o?2:3,e.namespace=b.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),n=null==n?[e]:w.makeArray(n,[e]),h=w.event.special[y]||{},o||!h.trigger||!1!==h.trigger.apply(r,n))){if(!o&&!h.noBubble&&!v(r)){for(xe.test((u=h.delegateType||y)+y)||(a=a.parentNode);a;a=a.parentNode)g.push(a),s=a;s===(r.ownerDocument||m)&&g.push(s.defaultView||s.parentWindow||t)}for(i=0;(a=g[i++])&&!e.isPropagationStopped();)d=a,e.type=1<i?u:h.bindType||y,(f=($.get(a,"events")||Object.create(null))[e.type]&&$.get(a,"handle"))&&f.apply(a,n),(f=c&&a[c])&&f.apply&&K(a)&&(e.result=f.apply(a,n),!1===e.result&&e.preventDefault());return e.type=y,o||e.isDefaultPrevented()||h._default&&!1!==h._default.apply(g.pop(),n)||!K(r)||c&&p(r[y])&&!v(r)&&((s=r[c])&&(r[c]=null),w.event.triggered=y,e.isPropagationStopped()&&d.addEventListener(y,we),r[y](),e.isPropagationStopped()&&d.removeEventListener(y,we),w.event.triggered=void 0,s&&(r[c]=s)),e.result}},simulate:function(t,e,n){var r=w.extend(new w.Event,n,{type:t,isSimulated:!0});w.event.trigger(r,null,e)}}),w.fn.extend({trigger:function(t,e){return this.each((function(){w.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var n=this[0];if(n)return w.event.trigger(t,e,n,!0)}}),d.focusin||w.each({focus:"focusin",blur:"focusout"},(function(t,e){var n=function(t){w.event.simulate(e,t.target,w.event.fix(t))};w.event.special[e]={setup:function(){var r=this.ownerDocument||this.document||this,o=$.access(r,e);o||r.addEventListener(t,n,!0),$.access(r,e,(o||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,o=$.access(r,e)-1;o?$.access(r,e,o):(r.removeEventListener(t,n,!0),$.remove(r,e))}}}));var _e=t.location,Ce={guid:Date.now()},Ee=/\?/;w.parseXML=function(e){var n;if(!e||"string"!=typeof e)return null;try{n=(new t.DOMParser).parseFromString(e,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+e),n};var Se=/\[\]$/,Ie=/\r?\n/g,Te=/^(?:submit|button|image|reset|file)$/i,ke=/^(?:input|select|textarea|keygen)/i;function De(t,e,n,r){var o;if(Array.isArray(e))w.each(e,(function(e,o){n||Se.test(t)?r(t,o):De(t+"["+("object"==typeof o&&null!=o?e:"")+"]",o,n,r)}));else if(n||"object"!==b(e))r(t,e);else for(o in e)De(t+"["+o+"]",e[o],n,r)}w.param=function(t,e){var n,r=[],o=function(t,e){var n=p(e)?e():e;r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==n?"":n)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!w.isPlainObject(t))w.each(t,(function(){o(this.name,this.value)}));else for(n in t)De(n,t[n],e,o);return r.join("&")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=w.prop(this,"elements");return t?w.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!w(this).is(":disabled")&&ke.test(this.nodeName)&&!Te.test(t)&&(this.checked||!ht.test(t))})).map((function(t,e){var n=w(this).val();return null==n?null:Array.isArray(n)?w.map(n,(function(t){return{name:e.name,value:t.replace(Ie,"\r\n")}})):{name:e.name,value:n.replace(Ie,"\r\n")}})).get()}});var Ae=/%20/g,Re=/#.*$/,Ne=/([?&])_=[^&]*/,Fe=/^(.*?):[ \t]*([^\r\n]*)$/gm,Oe=/^(?:GET|HEAD)$/,Me=/^\/\//,Pe={},Le={},Be="*/".concat("*"),We=m.createElement("a");function ze(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var r,o=0,i=e.toLowerCase().match(M)||[];if(p(n))for(;r=i[o++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(n)):(t[r]=t[r]||[]).push(n)}}function Ue(t,e,n,r){var o={},i=t===Le;function a(s){var u;return o[s]=!0,w.each(t[s]||[],(function(t,s){var c=s(e,n,r);return"string"!=typeof c||i||o[c]?i?!(u=c):void 0:(e.dataTypes.unshift(c),a(c),!1)})),u}return a(e.dataTypes[0])||!o["*"]&&a("*")}function je(t,e){var n,r,o=w.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((o[n]?t:r||(r={}))[n]=e[n]);return r&&w.extend(!0,t,r),t}We.href=_e.href,w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:_e.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(_e.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Be,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?je(je(t,w.ajaxSettings),e):je(w.ajaxSettings,t)},ajaxPrefilter:ze(Pe),ajaxTransport:ze(Le),ajax:function(e,n){"object"==typeof e&&(n=e,e=void 0);var r,o,i,a,s,u,c,l,f,h,d=w.ajaxSetup({},n=n||{}),p=d.context||d,v=d.context&&(p.nodeType||p.jquery)?w(p):w.event,g=w.Deferred(),y=w.Callbacks("once memory"),b=d.statusCode||{},x={},_={},C="canceled",E={readyState:0,getResponseHeader:function(t){var e;if(c){if(!a)for(a={};e=Fe.exec(i);)a[e[1].toLowerCase()+" "]=(a[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=a[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return c?i:null},setRequestHeader:function(t,e){return null==c&&(t=_[t.toLowerCase()]=_[t.toLowerCase()]||t,x[t]=e),this},overrideMimeType:function(t){return null==c&&(d.mimeType=t),this},statusCode:function(t){var e;if(t)if(c)E.always(t[E.status]);else for(e in t)b[e]=[b[e],t[e]];return this},abort:function(t){var e=t||C;return r&&r.abort(e),S(0,e),this}};if(g.promise(E),d.url=((e||d.url||_e.href)+"").replace(Me,_e.protocol+"//"),d.type=n.method||n.type||d.method||d.type,d.dataTypes=(d.dataType||"*").toLowerCase().match(M)||[""],null==d.crossDomain){u=m.createElement("a");try{u.href=d.url,u.href=u.href,d.crossDomain=We.protocol+"//"+We.host!=u.protocol+"//"+u.host}catch(e){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=w.param(d.data,d.traditional)),Ue(Pe,d,n,E),c)return E;for(f in(l=w.event&&d.global)&&0==w.active++&&w.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Oe.test(d.type),o=d.url.replace(Re,""),d.hasContent?d.data&&d.processData&&0===(d.contentType||"").indexOf("application/x-www-form-urlencoded")&&(d.data=d.data.replace(Ae,"+")):(h=d.url.slice(o.length),d.data&&(d.processData||"string"==typeof d.data)&&(o+=(Ee.test(o)?"&":"?")+d.data,delete d.data),!1===d.cache&&(o=o.replace(Ne,"$1"),h=(Ee.test(o)?"&":"?")+"_="+Ce.guid+++h),d.url=o+h),d.ifModified&&(w.lastModified[o]&&E.setRequestHeader("If-Modified-Since",w.lastModified[o]),w.etag[o]&&E.setRequestHeader("If-None-Match",w.etag[o])),(d.data&&d.hasContent&&!1!==d.contentType||n.contentType)&&E.setRequestHeader("Content-Type",d.contentType),E.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Be+"; q=0.01":""):d.accepts["*"]),d.headers)E.setRequestHeader(f,d.headers[f]);if(d.beforeSend&&(!1===d.beforeSend.call(p,E,d)||c))return E.abort();if(C="abort",y.add(d.complete),E.done(d.success),E.fail(d.error),r=Ue(Le,d,n,E)){if(E.readyState=1,l&&v.trigger("ajaxSend",[E,d]),c)return E;d.async&&0<d.timeout&&(s=t.setTimeout((function(){E.abort("timeout")}),d.timeout));try{c=!1,r.send(x,S)}catch(e){if(c)throw e;S(-1,e)}}else S(-1,"No Transport");function S(e,n,a,u){var f,h,m,x,_,C=n;c||(c=!0,s&&t.clearTimeout(s),r=void 0,i=u||"",E.readyState=0<e?4:0,f=200<=e&&e<300||304===e,a&&(x=function(t,e,n){for(var r,o,i,a,s=t.contents,u=t.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(o in s)if(s[o]&&s[o].test(r)){u.unshift(o);break}if(u[0]in n)i=u[0];else{for(o in n){if(!u[0]||t.converters[o+" "+u[0]]){i=o;break}a||(a=o)}i=i||a}if(i)return i!==u[0]&&u.unshift(i),n[i]}(d,E,a)),!f&&-1<w.inArray("script",d.dataTypes)&&(d.converters["text script"]=function(){}),x=function(t,e,n,r){var o,i,a,s,u,c={},l=t.dataTypes.slice();if(l[1])for(a in t.converters)c[a.toLowerCase()]=t.converters[a];for(i=l.shift();i;)if(t.responseFields[i]&&(n[t.responseFields[i]]=e),!u&&r&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),u=i,i=l.shift())if("*"===i)i=u;else if("*"!==u&&u!==i){if(!(a=c[u+" "+i]||c["* "+i]))for(o in c)if((s=o.split(" "))[1]===i&&(a=c[u+" "+s[0]]||c["* "+s[0]])){!0===a?a=c[o]:!0!==c[o]&&(i=s[0],l.unshift(s[1]));break}if(!0!==a)if(a&&t.throws)e=a(e);else try{e=a(e)}catch(t){return{state:"parsererror",error:a?t:"No conversion from "+u+" to "+i}}}return{state:"success",data:e}}(d,x,E,f),f?(d.ifModified&&((_=E.getResponseHeader("Last-Modified"))&&(w.lastModified[o]=_),(_=E.getResponseHeader("etag"))&&(w.etag[o]=_)),204===e||"HEAD"===d.type?C="nocontent":304===e?C="notmodified":(C=x.state,h=x.data,f=!(m=x.error))):(m=C,!e&&C||(C="error",e<0&&(e=0))),E.status=e,E.statusText=(n||C)+"",f?g.resolveWith(p,[h,C,E]):g.rejectWith(p,[E,C,m]),E.statusCode(b),b=void 0,l&&v.trigger(f?"ajaxSuccess":"ajaxError",[E,d,f?h:m]),y.fireWith(p,[E,C]),l&&(v.trigger("ajaxComplete",[E,d]),--w.active||w.event.trigger("ajaxStop")))}return E},getJSON:function(t,e,n){return w.get(t,e,n,"json")},getScript:function(t,e){return w.get(t,void 0,e,"script")}}),w.each(["get","post"],(function(t,e){w[e]=function(t,n,r,o){return p(n)&&(o=o||r,r=n,n=void 0),w.ajax(w.extend({url:t,type:e,dataType:o,data:n,success:r},w.isPlainObject(t)&&t))}})),w.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),w._evalUrl=function(t,e,n){return w.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){w.globalEval(t,e,n)}})},w.fn.extend({wrapAll:function(t){var e;return this[0]&&(p(t)&&(t=t.call(this[0])),e=w(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return p(t)?this.each((function(e){w(this).wrapInner(t.call(this,e))})):this.each((function(){var e=w(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)}))},wrap:function(t){var e=p(t);return this.each((function(n){w(this).wrapAll(e?t.call(this,n):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){w(this).replaceWith(this.childNodes)})),this}}),w.expr.pseudos.hidden=function(t){return!w.expr.pseudos.visible(t)},w.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(e){}};var He={0:200,1223:204},Ve=w.ajaxSettings.xhr();d.cors=!!Ve&&"withCredentials"in Ve,d.ajax=Ve=!!Ve,w.ajaxTransport((function(e){var n,r;if(d.cors||Ve&&!e.crossDomain)return{send:function(o,i){var a,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)s[a]=e.xhrFields[a];for(a in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest"),o)s.setRequestHeader(a,o[a]);n=function(t){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===t?s.abort():"error"===t?"number"!=typeof s.status?i(0,"error"):i(s.status,s.statusText):i(He[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&t.setTimeout((function(){n&&r()}))},n=n("abort");try{s.send(e.hasContent&&e.data||null)}catch(o){if(n)throw o}},abort:function(){n&&n()}}})),w.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return w.globalEval(t),t}}}),w.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),w.ajaxTransport("script",(function(t){var e,n;if(t.crossDomain||t.scriptAttrs)return{send:function(r,o){e=w("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",n=function(t){e.remove(),n=null,t&&o("error"===t.type?404:200,t.type)}),m.head.appendChild(e[0])},abort:function(){n&&n()}}}));var qe,Ge=[],Ke=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ge.pop()||w.expando+"_"+Ce.guid++;return this[t]=!0,t}}),w.ajaxPrefilter("json jsonp",(function(e,n,r){var o,i,a,s=!1!==e.jsonp&&(Ke.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ke.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return o=e.jsonpCallback=p(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(Ke,"$1"+o):!1!==e.jsonp&&(e.url+=(Ee.test(e.url)?"&":"?")+e.jsonp+"="+o),e.converters["script json"]=function(){return a||w.error(o+" was not called"),a[0]},e.dataTypes[0]="json",i=t[o],t[o]=function(){a=arguments},r.always((function(){void 0===i?w(t).removeProp(o):t[o]=i,e[o]&&(e.jsonpCallback=n.jsonpCallback,Ge.push(o)),a&&p(i)&&i(a[0]),a=i=void 0})),"script"})),d.createHTMLDocument=((qe=m.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===qe.childNodes.length),w.parseHTML=function(t,e,n){return"string"!=typeof t?[]:("boolean"==typeof e&&(n=e,e=!1),e||(d.createHTMLDocument?((r=(e=m.implementation.createHTMLDocument("")).createElement("base")).href=m.location.href,e.head.appendChild(r)):e=m),i=!n&&[],(o=k.exec(t))?[e.createElement(o[1])]:(o=bt([t],e,i),i&&i.length&&w(i).remove(),w.merge([],o.childNodes)));var r,o,i},w.fn.load=function(t,e,n){var r,o,i,a=this,s=t.indexOf(" ");return-1<s&&(r=me(t.slice(s)),t=t.slice(0,s)),p(e)?(n=e,e=void 0):e&&"object"==typeof e&&(o="POST"),0<a.length&&w.ajax({url:t,type:o||"GET",dataType:"html",data:e}).done((function(t){i=arguments,a.html(r?w("<div>").append(w.parseHTML(t)).find(r):t)})).always(n&&function(t,e){a.each((function(){n.apply(this,i||[t.responseText,e,t])}))}),this},w.expr.pseudos.animated=function(t){return w.grep(w.timers,(function(e){return t===e.elem})).length},w.offset={setOffset:function(t,e,n){var r,o,i,a,s,u,c=w.css(t,"position"),l=w(t),f={};"static"===c&&(t.style.position="relative"),s=l.offset(),i=w.css(t,"top"),u=w.css(t,"left"),("absolute"===c||"fixed"===c)&&-1<(i+u).indexOf("auto")?(a=(r=l.position()).top,o=r.left):(a=parseFloat(i)||0,o=parseFloat(u)||0),p(e)&&(e=e.call(t,n,w.extend({},s))),null!=e.top&&(f.top=e.top-s.top+a),null!=e.left&&(f.left=e.left-s.left+o),"using"in e?e.using.call(t,f):("number"==typeof f.top&&(f.top+="px"),"number"==typeof f.left&&(f.left+="px"),l.css(f))}},w.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){w.offset.setOffset(this,t,e)}));var e,n,r=this[0];return r?r.getClientRects().length?{top:(e=r.getBoundingClientRect()).top+(n=r.ownerDocument.defaultView).pageYOffset,left:e.left+n.pageXOffset}:{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,n,r=this[0],o={top:0,left:0};if("fixed"===w.css(r,"position"))e=r.getBoundingClientRect();else{for(e=this.offset(),n=r.ownerDocument,t=r.offsetParent||n.documentElement;t&&(t===n.body||t===n.documentElement)&&"static"===w.css(t,"position");)t=t.parentNode;t&&t!==r&&1===t.nodeType&&((o=w(t).offset()).top+=w.css(t,"borderTopWidth",!0),o.left+=w.css(t,"borderLeftWidth",!0))}return{top:e.top-o.top-w.css(r,"marginTop",!0),left:e.left-o.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===w.css(t,"position");)t=t.offsetParent;return t||rt}))}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var n="pageYOffset"===e;w.fn[t]=function(r){return j(this,(function(t,r,o){var i;if(v(t)?i=t:9===t.nodeType&&(i=t.defaultView),void 0===o)return i?i[e]:t[r];i?i.scrollTo(n?i.pageXOffset:o,n?o:i.pageYOffset):t[r]=o}),t,r,arguments.length)}})),w.each(["top","left"],(function(t,e){w.cssHooks[e]=jt(d.pixelPosition,(function(t,n){if(n)return n=Ut(t,e),Lt.test(n)?w(t).position()[e]+"px":n}))})),w.each({Height:"height",Width:"width"},(function(t,e){w.each({padding:"inner"+t,content:e,"":"outer"+t},(function(n,r){w.fn[r]=function(o,i){var a=arguments.length&&(n||"boolean"!=typeof o),s=n||(!0===o||!0===i?"margin":"border");return j(this,(function(e,n,o){var i;return v(e)?0===r.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(i=e.documentElement,Math.max(e.body["scroll"+t],i["scroll"+t],e.body["offset"+t],i["offset"+t],i["client"+t])):void 0===o?w.css(e,n,s):w.style(e,n,o,s)}),e,a?o:void 0,a)}}))})),w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){w.fn[e]=function(t){return this.on(e,t)}})),w.fn.extend({bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,r){return this.on(e,t,n,r)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){w.fn[e]=function(t,n){return 0<arguments.length?this.on(e,null,t,n):this.trigger(e)}}));var Xe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;w.proxy=function(t,e){var n,r,i;if("string"==typeof e&&(n=t[e],e=t,t=n),p(t))return r=o.call(arguments,2),(i=function(){return t.apply(e||this,r.concat(o.call(arguments)))}).guid=t.guid=t.guid||w.guid++,i},w.holdReady=function(t){t?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=T,w.isFunction=p,w.isWindow=v,w.camelCase=G,w.type=b,w.now=Date.now,w.isNumeric=function(t){var e=w.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},w.trim=function(t){return null==t?"":(t+"").replace(Xe,"")},"function"==typeof define&&define.amd&&define("jquery",[],(function(){return w}));var $e=t.jQuery,Ye=t.$;return w.noConflict=function(e){return t.$===w&&(t.$=Ye),e&&t.jQuery===w&&(t.jQuery=$e),w},void 0===e&&(t.jQuery=t.$=w),w})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Popper=e()}(this,(function(){"use strict";function t(t){return t&&"[object Function]"==={}.toString.call(t)}function e(t,e){if(1!==t.nodeType)return[];var n=t.ownerDocument.defaultView.getComputedStyle(t,null);return e?n[e]:n}function n(t){return"HTML"===t.nodeName?t:t.parentNode||t.host}function r(t){if(!t)return document.body;switch(t.nodeName){case"HTML":case"BODY":return t.ownerDocument.body;case"#document":return t.body}var o=e(t);return/(auto|scroll|overlay)/.test(o.overflow+o.overflowY+o.overflowX)?t:r(n(t))}function o(t){return t&&t.referenceNode?t.referenceNode:t}function i(t){return 11===t?K:10===t?X:K||X}function a(t){if(!t)return document.documentElement;for(var n=i(10)?document.body:null,r=t.offsetParent||null;r===n&&t.nextElementSibling;)r=(t=t.nextElementSibling).offsetParent;var o=r&&r.nodeName;return o&&"BODY"!==o&&"HTML"!==o?-1!==["TH","TD","TABLE"].indexOf(r.nodeName)&&"static"===e(r,"position")?a(r):r:t?t.ownerDocument.documentElement:document.documentElement}function s(t){return null===t.parentNode?t:s(t.parentNode)}function u(t,e){if(!(t&&t.nodeType&&e&&e.nodeType))return document.documentElement;var n=t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING,r=n?t:e,o=n?e:t,i=document.createRange();i.setStart(r,0),i.setEnd(o,0);var c=i.commonAncestorContainer;if(t!==c&&e!==c||r.contains(o))return function(t){var e=t.nodeName;return"BODY"!==e&&("HTML"===e||a(t.firstElementChild)===t)}(c)?c:a(c);var l=s(t);return l.host?u(l.host,e):u(t,s(e).host)}function c(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"top",n="top"===e?"scrollTop":"scrollLeft",r=t.nodeName;if("BODY"===r||"HTML"===r){var o=t.ownerDocument.documentElement,i=t.ownerDocument.scrollingElement||o;return i[n]}return t[n]}function l(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=c(e,"top"),o=c(e,"left"),i=n?-1:1;return t.top+=r*i,t.bottom+=r*i,t.left+=o*i,t.right+=o*i,t}function f(t,e){var n="x"===e?"Left":"Top",r="Left"==n?"Right":"Bottom";return parseFloat(t["border"+n+"Width"])+parseFloat(t["border"+r+"Width"])}function h(t,e,n,r){return H(e["offset"+t],e["scroll"+t],n["client"+t],n["offset"+t],n["scroll"+t],i(10)?parseInt(n["offset"+t])+parseInt(r["margin"+("Height"===t?"Top":"Left")])+parseInt(r["margin"+("Height"===t?"Bottom":"Right")]):0)}function d(t){var e=t.body,n=t.documentElement,r=i(10)&&getComputedStyle(n);return{height:h("Height",e,n,r),width:h("Width",e,n,r)}}function p(t){return J({},t,{right:t.left+t.width,bottom:t.top+t.height})}function v(t){var n={};try{if(i(10)){n=t.getBoundingClientRect();var r=c(t,"top"),o=c(t,"left");n.top+=r,n.left+=o,n.bottom+=r,n.right+=o}else n=t.getBoundingClientRect()}catch(e){}var a={left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top},s="HTML"===t.nodeName?d(t.ownerDocument):{},u=t.offsetWidth-(s.width||t.clientWidth||a.width),l=t.offsetHeight-(s.height||t.clientHeight||a.height);if(u||l){var h=e(t);u-=f(h,"x"),l-=f(h,"y"),a.width-=u,a.height-=l}return p(a)}function m(t,n){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=i(10),s="HTML"===n.nodeName,u=v(t),c=v(n),f=r(t),h=e(n),d=parseFloat(h.borderTopWidth),m=parseFloat(h.borderLeftWidth);o&&s&&(c.top=H(c.top,0),c.left=H(c.left,0));var g=p({top:u.top-c.top-d,left:u.left-c.left-m,width:u.width,height:u.height});if(g.marginTop=0,g.marginLeft=0,!a&&s){var y=parseFloat(h.marginTop),b=parseFloat(h.marginLeft);g.top-=d-y,g.bottom-=d-y,g.left-=m-b,g.right-=m-b,g.marginTop=y,g.marginLeft=b}return(a&&!o?n.contains(f):n===f&&"BODY"!==f.nodeName)&&(g=l(g,n)),g}function g(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=t.ownerDocument.documentElement,r=m(t,n),o=H(n.clientWidth,window.innerWidth||0),i=H(n.clientHeight,window.innerHeight||0),a=e?0:c(n),s=e?0:c(n,"left"),u={top:a-r.top+r.marginTop,left:s-r.left+r.marginLeft,width:o,height:i};return p(u)}function y(t){var r=t.nodeName;if("BODY"===r||"HTML"===r)return!1;if("fixed"===e(t,"position"))return!0;var o=n(t);return!!o&&y(o)}function b(t){if(!t||!t.parentElement||i())return document.documentElement;for(var n=t.parentElement;n&&"none"===e(n,"transform");)n=n.parentElement;return n||document.documentElement}function x(t,e,i,a){var s=4<arguments.length&&void 0!==arguments[4]&&arguments[4],c={top:0,left:0},l=s?b(t):u(t,o(e));if("viewport"===a)c=g(l,s);else{var f;"scrollParent"===a?"BODY"===(f=r(n(e))).nodeName&&(f=t.ownerDocument.documentElement):f="window"===a?t.ownerDocument.documentElement:a;var h=m(f,l,s);if("HTML"!==f.nodeName||y(l))c=h;else{var p=d(t.ownerDocument),v=p.height,x=p.width;c.top+=h.top-h.marginTop,c.bottom=v+h.top,c.left+=h.left-h.marginLeft,c.right=x+h.left}}var w="number"==typeof(i=i||0);return c.left+=w?i:i.left||0,c.top+=w?i:i.top||0,c.right-=w?i:i.right||0,c.bottom-=w?i:i.bottom||0,c}function w(t){return t.width*t.height}function _(t,e,n,r,o){var i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;if(-1===t.indexOf("auto"))return t;var a=x(n,r,i,o),s={top:{width:a.width,height:e.top-a.top},right:{width:a.right-e.right,height:a.height},bottom:{width:a.width,height:a.bottom-e.bottom},left:{width:e.left-a.left,height:a.height}},u=Object.keys(s).map((function(t){return J({key:t},s[t],{area:w(s[t])})})).sort((function(t,e){return e.area-t.area})),c=u.filter((function(t){return t.width>=n.clientWidth&&t.height>=n.clientHeight})),l=0<c.length?c[0].key:u[0].key,f=t.split("-")[1];return l+(f?"-"+f:"")}function C(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=r?b(e):u(e,o(n));return m(n,i,r)}function E(t){var e=t.ownerDocument.defaultView.getComputedStyle(t),n=parseFloat(e.marginTop||0)+parseFloat(e.marginBottom||0),r=parseFloat(e.marginLeft||0)+parseFloat(e.marginRight||0);return{width:t.offsetWidth+r,height:t.offsetHeight+n}}function S(t){var e={left:"right",right:"left",bottom:"top",top:"bottom"};return t.replace(/left|right|bottom|top/g,(function(t){return e[t]}))}function I(t,e,n){n=n.split("-")[0];var r=E(t),o={width:r.width,height:r.height},i=-1!==["right","left"].indexOf(n),a=i?"top":"left",s=i?"left":"top",u=i?"height":"width",c=i?"width":"height";return o[a]=e[a]+e[u]/2-r[u]/2,o[s]=n===s?e[s]-r[c]:e[S(s)],o}function T(t,e){return Array.prototype.find?t.find(e):t.filter(e)[0]}function k(e,n,r){return(void 0===r?e:e.slice(0,function(t,e,n){if(Array.prototype.findIndex)return t.findIndex((function(t){return t[e]===n}));var r=T(t,(function(t){return t[e]===n}));return t.indexOf(r)}(e,"name",r))).forEach((function(e){e.function&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var r=e.function||e.fn;e.enabled&&t(r)&&(n.offsets.popper=p(n.offsets.popper),n.offsets.reference=p(n.offsets.reference),n=r(n,e))})),n}function D(){if(!this.state.isDestroyed){var t={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};t.offsets.reference=C(this.state,this.popper,this.reference,this.options.positionFixed),t.placement=_(this.options.placement,t.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),t.originalPlacement=t.placement,t.positionFixed=this.options.positionFixed,t.offsets.popper=I(this.popper,t.offsets.reference,t.placement),t.offsets.popper.position=this.options.positionFixed?"fixed":"absolute",t=k(this.modifiers,t),this.state.isCreated?this.options.onUpdate(t):(this.state.isCreated=!0,this.options.onCreate(t))}}function A(t,e){return t.some((function(t){return t.enabled&&t.name===e}))}function R(t){for(var e=[!1,"ms","Webkit","Moz","O"],n=t.charAt(0).toUpperCase()+t.slice(1),r=0;r<e.length;r++){var o=e[r],i=o?""+o+n:t;if(void 0!==document.body.style[i])return i}return null}function N(){return this.state.isDestroyed=!0,A(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.position="",this.popper.style.top="",this.popper.style.left="",this.popper.style.right="",this.popper.style.bottom="",this.popper.style.willChange="",this.popper.style[R("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function F(t){var e=t.ownerDocument;return e?e.defaultView:window}function O(){this.state.eventsEnabled||(this.state=function(t,e,n,o){n.updateBound=o,F(t).addEventListener("resize",n.updateBound,{passive:!0});var i=r(t);return function t(e,n,o,i){var a="BODY"===e.nodeName,s=a?e.ownerDocument.defaultView:e;s.addEventListener(n,o,{passive:!0}),a||t(r(s.parentNode),n,o,i),i.push(s)}(i,"scroll",n.updateBound,n.scrollParents),n.scrollElement=i,n.eventsEnabled=!0,n}(this.reference,0,this.state,this.scheduleUpdate))}function M(){this.state.eventsEnabled&&(cancelAnimationFrame(this.scheduleUpdate),this.state=function(t,e){return F(t).removeEventListener("resize",e.updateBound),e.scrollParents.forEach((function(t){t.removeEventListener("scroll",e.updateBound)})),e.updateBound=null,e.scrollParents=[],e.scrollElement=null,e.eventsEnabled=!1,e}(this.reference,this.state))}function P(t){return""!==t&&!isNaN(parseFloat(t))&&isFinite(t)}function L(t,e){Object.keys(e).forEach((function(n){var r="";-1!==["width","height","top","right","bottom","left"].indexOf(n)&&P(e[n])&&(r="px"),t.style[n]=e[n]+r}))}function B(t,e,n){var r=T(t,(function(t){return t.name===e})),o=!!r&&t.some((function(t){return t.name===n&&t.enabled&&t.order<r.order}));if(!o){var i="`"+e+"`";console.warn("`"+n+"` modifier is required by "+i+" modifier in order to work, be sure to include it before "+i+"!")}return o}function W(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=et.indexOf(t),r=et.slice(n+1).concat(et.slice(0,n));return e?r.reverse():r}var z=Math.min,U=Math.floor,j=Math.round,H=Math.max,V="undefined"!=typeof window&&"undefined"!=typeof document&&"undefined"!=typeof navigator,q=function(){for(var t=["Edge","Trident","Firefox"],e=0;e<t.length;e+=1)if(V&&0<=navigator.userAgent.indexOf(t[e]))return 1;return 0}(),G=V&&window.Promise?function(t){var e=!1;return function(){e||(e=!0,window.Promise.resolve().then((function(){e=!1,t()})))}}:function(t){var e=!1;return function(){e||(e=!0,setTimeout((function(){e=!1,t()}),q))}},K=V&&!(!window.MSInputMethodContext||!document.documentMode),X=V&&/MSIE 10/.test(navigator.userAgent),$=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Y=function(){function t(t,e){for(var n,r=0;r<e.length;r++)(n=e[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),Q=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},J=Object.assign||function(t){for(var e,n=1;n<arguments.length;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Z=V&&/Firefox/i.test(navigator.userAgent),tt=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],et=tt.slice(3),nt=function(){function e(n,r){var o=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};$(this,e),this.scheduleUpdate=function(){return requestAnimationFrame(o.update)},this.update=G(this.update.bind(this)),this.options=J({},e.Defaults,i),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=n&&n.jquery?n[0]:n,this.popper=r&&r.jquery?r[0]:r,this.options.modifiers={},Object.keys(J({},e.Defaults.modifiers,i.modifiers)).forEach((function(t){o.options.modifiers[t]=J({},e.Defaults.modifiers[t]||{},i.modifiers?i.modifiers[t]:{})})),this.modifiers=Object.keys(this.options.modifiers).map((function(t){return J({name:t},o.options.modifiers[t])})).sort((function(t,e){return t.order-e.order})),this.modifiers.forEach((function(e){e.enabled&&t(e.onLoad)&&e.onLoad(o.reference,o.popper,o.options,e,o.state)})),this.update();var a=this.options.eventsEnabled;a&&this.enableEventListeners(),this.state.eventsEnabled=a}return Y(e,[{key:"update",value:function(){return D.call(this)}},{key:"destroy",value:function(){return N.call(this)}},{key:"enableEventListeners",value:function(){return O.call(this)}},{key:"disableEventListeners",value:function(){return M.call(this)}}]),e}();return nt.Utils=("undefined"==typeof window?global:window).PopperUtils,nt.placements=tt,nt.Defaults={placement:"bottom",positionFixed:!1,eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:{shift:{order:100,enabled:!0,fn:function(t){var e=t.placement,n=e.split("-")[0],r=e.split("-")[1];if(r){var o=t.offsets,i=o.reference,a=o.popper,s=-1!==["bottom","top"].indexOf(n),u=s?"left":"top",c=s?"width":"height",l={start:Q({},u,i[u]),end:Q({},u,i[u]+i[c]-a[c])};t.offsets.popper=J({},a,l[r])}return t}},offset:{order:200,enabled:!0,fn:function(t,e){var n,r=e.offset,o=t.offsets,i=o.popper,a=o.reference,s=t.placement.split("-")[0];return n=P(+r)?[+r,0]:function(t,e,n,r){var o=[0,0],i=-1!==["right","left"].indexOf(r),a=t.split(/(\+|\-)/).map((function(t){return t.trim()})),s=a.indexOf(T(a,(function(t){return-1!==t.search(/,|\s/)})));a[s]&&-1===a[s].indexOf(",")&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var u=/\s*,\s*|\s+/,c=-1===s?[a]:[a.slice(0,s).concat([a[s].split(u)[0]]),[a[s].split(u)[1]].concat(a.slice(s+1))];return(c=c.map((function(t,r){var o=(1===r?!i:i)?"height":"width",a=!1;return t.reduce((function(t,e){return""===t[t.length-1]&&-1!==["+","-"].indexOf(e)?(t[t.length-1]=e,a=!0,t):a?(t[t.length-1]+=e,a=!1,t):t.concat(e)}),[]).map((function(t){return function(t,e,n,r){var o=t.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),i=+o[1],a=o[2];if(!i)return t;if(0===a.indexOf("%")){var s;switch(a){case"%p":s=n;break;case"%":case"%r":default:s=r}return p(s)[e]/100*i}return"vh"===a||"vw"===a?("vh"===a?H(document.documentElement.clientHeight,window.innerHeight||0):H(document.documentElement.clientWidth,window.innerWidth||0))/100*i:i}(t,o,e,n)}))}))).forEach((function(t,e){t.forEach((function(n,r){P(n)&&(o[e]+=n*("-"===t[r-1]?-1:1))}))})),o}(r,i,a,s),"left"===s?(i.top+=n[0],i.left-=n[1]):"right"===s?(i.top+=n[0],i.left+=n[1]):"top"===s?(i.left+=n[0],i.top-=n[1]):"bottom"===s&&(i.left+=n[0],i.top+=n[1]),t.popper=i,t},offset:0},preventOverflow:{order:300,enabled:!0,fn:function(t,e){var n=e.boundariesElement||a(t.instance.popper);t.instance.reference===n&&(n=a(n));var r=R("transform"),o=t.instance.popper.style,i=o.top,s=o.left,u=o[r];o.top="",o.left="",o[r]="";var c=x(t.instance.popper,t.instance.reference,e.padding,n,t.positionFixed);o.top=i,o.left=s,o[r]=u,e.boundaries=c;var l=t.offsets.popper,f={primary:function(t){var n=l[t];return l[t]<c[t]&&!e.escapeWithReference&&(n=H(l[t],c[t])),Q({},t,n)},secondary:function(t){var n="right"===t?"left":"top",r=l[n];return l[t]>c[t]&&!e.escapeWithReference&&(r=z(l[n],c[t]-("right"===t?l.width:l.height))),Q({},n,r)}};return e.priority.forEach((function(t){var e=-1===["left","top"].indexOf(t)?"secondary":"primary";l=J({},l,f[e](t))})),t.offsets.popper=l,t},priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:function(t){var e=t.offsets,n=e.popper,r=e.reference,o=t.placement.split("-")[0],i=U,a=-1!==["top","bottom"].indexOf(o),s=a?"right":"bottom",u=a?"left":"top",c=a?"width":"height";return n[s]<i(r[u])&&(t.offsets.popper[u]=i(r[u])-n[c]),n[u]>i(r[s])&&(t.offsets.popper[u]=i(r[s])),t}},arrow:{order:500,enabled:!0,fn:function(t,n){var r;if(!B(t.instance.modifiers,"arrow","keepTogether"))return t;var o=n.element;if("string"==typeof o){if(!(o=t.instance.popper.querySelector(o)))return t}else if(!t.instance.popper.contains(o))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),t;var i=t.placement.split("-")[0],a=t.offsets,s=a.popper,u=a.reference,c=-1!==["left","right"].indexOf(i),l=c?"height":"width",f=c?"Top":"Left",h=f.toLowerCase(),d=c?"left":"top",v=c?"bottom":"right",m=E(o)[l];u[v]-m<s[h]&&(t.offsets.popper[h]-=s[h]-(u[v]-m)),u[h]+m>s[v]&&(t.offsets.popper[h]+=u[h]+m-s[v]),t.offsets.popper=p(t.offsets.popper);var g=u[h]+u[l]/2-m/2,y=e(t.instance.popper),b=parseFloat(y["margin"+f]),x=parseFloat(y["border"+f+"Width"]),w=g-t.offsets.popper[h]-b-x;return w=H(z(s[l]-m,w),0),t.arrowElement=o,t.offsets.arrow=(Q(r={},h,j(w)),Q(r,d,""),r),t},element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:function(t,e){if(A(t.instance.modifiers,"inner"))return t;if(t.flipped&&t.placement===t.originalPlacement)return t;var n=x(t.instance.popper,t.instance.reference,e.padding,e.boundariesElement,t.positionFixed),r=t.placement.split("-")[0],o=S(r),i=t.placement.split("-")[1]||"",a=[];switch(e.behavior){case"flip":a=[r,o];break;case"clockwise":a=W(r);break;case"counterclockwise":a=W(r,!0);break;default:a=e.behavior}return a.forEach((function(s,u){if(r!==s||a.length===u+1)return t;r=t.placement.split("-")[0],o=S(r);var c=t.offsets.popper,l=t.offsets.reference,f=U,h="left"===r&&f(c.right)>f(l.left)||"right"===r&&f(c.left)<f(l.right)||"top"===r&&f(c.bottom)>f(l.top)||"bottom"===r&&f(c.top)<f(l.bottom),d=f(c.left)<f(n.left),p=f(c.right)>f(n.right),v=f(c.top)<f(n.top),m=f(c.bottom)>f(n.bottom),g="left"===r&&d||"right"===r&&p||"top"===r&&v||"bottom"===r&&m,y=-1!==["top","bottom"].indexOf(r),b=!!e.flipVariations&&(y&&"start"===i&&d||y&&"end"===i&&p||!y&&"start"===i&&v||!y&&"end"===i&&m)||!!e.flipVariationsByContent&&(y&&"start"===i&&p||y&&"end"===i&&d||!y&&"start"===i&&m||!y&&"end"===i&&v);(h||g||b)&&(t.flipped=!0,(h||g)&&(r=a[u+1]),b&&(i=function(t){return"end"===t?"start":"start"===t?"end":t}(i)),t.placement=r+(i?"-"+i:""),t.offsets.popper=J({},t.offsets.popper,I(t.instance.popper,t.offsets.reference,t.placement)),t=k(t.instance.modifiers,t,"flip"))})),t},behavior:"flip",padding:5,boundariesElement:"viewport",flipVariations:!1,flipVariationsByContent:!1},inner:{order:700,enabled:!1,fn:function(t){var e=t.placement,n=e.split("-")[0],r=t.offsets,o=r.popper,i=r.reference,a=-1!==["left","right"].indexOf(n),s=-1===["top","left"].indexOf(n);return o[a?"left":"top"]=i[n]-(s?o[a?"width":"height"]:0),t.placement=S(e),t.offsets.popper=p(o),t}},hide:{order:800,enabled:!0,fn:function(t){if(!B(t.instance.modifiers,"hide","preventOverflow"))return t;var e=t.offsets.reference,n=T(t.instance.modifiers,(function(t){return"preventOverflow"===t.name})).boundaries;if(e.bottom<n.top||e.left>n.right||e.top>n.bottom||e.right<n.left){if(!0===t.hide)return t;t.hide=!0,t.attributes["x-out-of-boundaries"]=""}else{if(!1===t.hide)return t;t.hide=!1,t.attributes["x-out-of-boundaries"]=!1}return t}},computeStyle:{order:850,enabled:!0,fn:function(t,e){var n=e.x,r=e.y,o=t.offsets.popper,i=T(t.instance.modifiers,(function(t){return"applyStyle"===t.name})).gpuAcceleration;void 0!==i&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var s,u,c=void 0===i?e.gpuAcceleration:i,l=a(t.instance.popper),f=v(l),h={position:o.position},d=function(t,e){var n=t.offsets,r=n.popper,o=j,i=function(t){return t},a=o(n.reference.width),s=o(r.width),u=-1!==["left","right"].indexOf(t.placement),c=-1!==t.placement.indexOf("-"),l=e?u||c||a%2==s%2?o:U:i,f=e?o:i;return{left:l(1==a%2&&1==s%2&&!c&&e?r.left-1:r.left),top:f(r.top),bottom:f(r.bottom),right:l(r.right)}}(t,2>window.devicePixelRatio||!Z),p="bottom"===n?"top":"bottom",m="right"===r?"left":"right",g=R("transform");if(u="bottom"==p?"HTML"===l.nodeName?-l.clientHeight+d.bottom:-f.height+d.bottom:d.top,s="right"==m?"HTML"===l.nodeName?-l.clientWidth+d.right:-f.width+d.right:d.left,c&&g)h[g]="translate3d("+s+"px, "+u+"px, 0)",h[p]=0,h[m]=0,h.willChange="transform";else{var y="right"==m?-1:1;h[p]=u*("bottom"==p?-1:1),h[m]=s*y,h.willChange=p+", "+m}return t.attributes=J({},{"x-placement":t.placement},t.attributes),t.styles=J({},h,t.styles),t.arrowStyles=J({},t.offsets.arrow,t.arrowStyles),t},gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:function(t){return L(t.instance.popper,t.styles),function(t,e){Object.keys(e).forEach((function(n){!1===e[n]?t.removeAttribute(n):t.setAttribute(n,e[n])}))}(t.instance.popper,t.attributes),t.arrowElement&&Object.keys(t.arrowStyles).length&&L(t.arrowElement,t.arrowStyles),t},onLoad:function(t,e,n,r,o){var i=C(o,e,t,n.positionFixed),a=_(n.placement,i,e,t,n.modifiers.flip.boundariesElement,n.modifiers.flip.padding);return e.setAttribute("x-placement",a),L(e,{position:n.positionFixed?"fixed":"absolute"}),n},gpuAcceleration:void 0}}},nt})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jquery"),require("popper.js")):"function"==typeof define&&define.amd?define(["exports","jquery","popper.js"],e):e((t=t||self).bootstrap={},t.jQuery,t.Popper)}(this,(function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){var r,o,i;i=n[o=e],o in(r=t)?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var s="transitionend",u={TRANSITION_END:"bsTransitionEnd",getUID:function(t){for(;t+=~~(1e6*Math.random()),document.getElementById(t););return t},getSelectorFromElement:function(t){var e=t.getAttribute("data-target");if(!e||"#"===e){var n=t.getAttribute("href");e=n&&"#"!==n?n.trim():""}try{return document.querySelector(e)?e:null}catch(t){return null}},getTransitionDurationFromElement:function(t){if(!t)return 0;var n=e(t).css("transition-duration"),r=e(t).css("transition-delay"),o=parseFloat(n),i=parseFloat(r);return o||i?(n=n.split(",")[0],r=r.split(",")[0],1e3*(parseFloat(n)+parseFloat(r))):0},reflow:function(t){return t.offsetHeight},triggerTransitionEnd:function(t){e(t).trigger(s)},supportsTransitionEnd:function(){return Boolean(s)},isElement:function(t){return(t[0]||t).nodeType},typeCheckConfig:function(t,e,n){for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var o=n[r],i=e[r],a=i&&u.isElement(i)?"element":{}.toString.call(i).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(o).test(a))throw new Error(t.toUpperCase()+': Option "'+r+'" provided type "'+a+'" but expected type "'+o+'".')}},findShadowRoot:function(t){if(!document.documentElement.attachShadow)return null;if("function"!=typeof t.getRootNode)return t instanceof ShadowRoot?t:t.parentNode?u.findShadowRoot(t.parentNode):null;var e=t.getRootNode();return e instanceof ShadowRoot?e:null},jQueryDetection:function(){if(void 0===e)throw new TypeError("Bootstrap's JavaScript requires jQuery. jQuery must be included before Bootstrap's JavaScript.");var t=e.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1===t[0]&&9===t[1]&&t[2]<1||4<=t[0])throw new Error("Bootstrap's JavaScript requires at least jQuery v1.9.1 but less than v4.0.0")}};u.jQueryDetection(),e.fn.emulateTransitionEnd=function(t){var n=this,r=!1;return e(this).one(u.TRANSITION_END,(function(){r=!0})),setTimeout((function(){r||u.triggerTransitionEnd(n)}),t),this},e.event.special[u.TRANSITION_END]={bindType:s,delegateType:s,handle:function(t){if(e(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}};var c="alert",l="bs.alert",f="."+l,h=e.fn[c],d={CLOSE:"close"+f,CLOSED:"closed"+f,CLICK_DATA_API:"click"+f+".data-api"},p=function(){function t(t){this._element=t}var n=t.prototype;return n.close=function(t){var e=this._element;t&&(e=this._getRootElement(t)),this._triggerCloseEvent(e).isDefaultPrevented()||this._removeElement(e)},n.dispose=function(){e.removeData(this._element,l),this._element=null},n._getRootElement=function(t){var n=u.getSelectorFromElement(t),r=!1;return n&&(r=document.querySelector(n)),r||e(t).closest(".alert")[0]},n._triggerCloseEvent=function(t){var n=e.Event(d.CLOSE);return e(t).trigger(n),n},n._removeElement=function(t){var n=this;if(e(t).removeClass("show"),e(t).hasClass("fade")){var r=u.getTransitionDurationFromElement(t);e(t).one(u.TRANSITION_END,(function(e){return n._destroyElement(t,e)})).emulateTransitionEnd(r)}else this._destroyElement(t)},n._destroyElement=function(t){e(t).detach().trigger(d.CLOSED).remove()},t._jQueryInterface=function(n){return this.each((function(){var r=e(this),o=r.data(l);o||(o=new t(this),r.data(l,o)),"close"===n&&o[n](this)}))},t._handleDismiss=function(t){return function(e){e&&e.preventDefault(),t.close(this)}},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}}]),t}();e(document).on(d.CLICK_DATA_API,'[data-dismiss="alert"]',p._handleDismiss(new p)),e.fn[c]=p._jQueryInterface,e.fn[c].Constructor=p,e.fn[c].noConflict=function(){return e.fn[c]=h,p._jQueryInterface};var v="button",m="bs.button",g="."+m,y=".data-api",b=e.fn[v],x="active",w='[data-toggle^="button"]',_='input:not([type="hidden"])',C=".btn",E={CLICK_DATA_API:"click"+g+y,FOCUS_BLUR_DATA_API:"focus"+g+y+" blur"+g+y,LOAD_DATA_API:"load"+g+y},S=function(){function t(t){this._element=t}var n=t.prototype;return n.toggle=function(){var t=!0,n=!0,r=e(this._element).closest('[data-toggle="buttons"]')[0];if(r){var o=this._element.querySelector(_);if(o){if("radio"===o.type)if(o.checked&&this._element.classList.contains(x))t=!1;else{var i=r.querySelector(".active");i&&e(i).removeClass(x)}else"checkbox"===o.type?"LABEL"===this._element.tagName&&o.checked===this._element.classList.contains(x)&&(t=!1):t=!1;t&&(o.checked=!this._element.classList.contains(x),e(o).trigger("change")),o.focus(),n=!1}}this._element.hasAttribute("disabled")||this._element.classList.contains("disabled")||(n&&this._element.setAttribute("aria-pressed",!this._element.classList.contains(x)),t&&e(this._element).toggleClass(x))},n.dispose=function(){e.removeData(this._element,m),this._element=null},t._jQueryInterface=function(n){return this.each((function(){var r=e(this).data(m);r||(r=new t(this),e(this).data(m,r)),"toggle"===n&&r[n]()}))},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}}]),t}();e(document).on(E.CLICK_DATA_API,w,(function(t){var n=t.target;if(e(n).hasClass("btn")||(n=e(n).closest(C)[0]),!n||n.hasAttribute("disabled")||n.classList.contains("disabled"))t.preventDefault();else{var r=n.querySelector(_);if(r&&(r.hasAttribute("disabled")||r.classList.contains("disabled")))return void t.preventDefault();S._jQueryInterface.call(e(n),"toggle")}})).on(E.FOCUS_BLUR_DATA_API,w,(function(t){var n=e(t.target).closest(C)[0];e(n).toggleClass("focus",/^focus(in)?$/.test(t.type))})),e(window).on(E.LOAD_DATA_API,(function(){for(var t=[].slice.call(document.querySelectorAll('[data-toggle="buttons"] .btn')),e=0,n=t.length;e<n;e++){var r=t[e],o=r.querySelector(_);o.checked||o.hasAttribute("checked")?r.classList.add(x):r.classList.remove(x)}for(var i=0,a=(t=[].slice.call(document.querySelectorAll('[data-toggle="button"]'))).length;i<a;i++){var s=t[i];"true"===s.getAttribute("aria-pressed")?s.classList.add(x):s.classList.remove(x)}})),e.fn[v]=S._jQueryInterface,e.fn[v].Constructor=S,e.fn[v].noConflict=function(){return e.fn[v]=b,S._jQueryInterface};var I="carousel",T="bs.carousel",k="."+T,D=".data-api",A=e.fn[I],R={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},N={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},F="next",O="prev",M={SLIDE:"slide"+k,SLID:"slid"+k,KEYDOWN:"keydown"+k,MOUSEENTER:"mouseenter"+k,MOUSELEAVE:"mouseleave"+k,TOUCHSTART:"touchstart"+k,TOUCHMOVE:"touchmove"+k,TOUCHEND:"touchend"+k,POINTERDOWN:"pointerdown"+k,POINTERUP:"pointerup"+k,DRAG_START:"dragstart"+k,LOAD_DATA_API:"load"+k+D,CLICK_DATA_API:"click"+k+D},P="active",L=".active.carousel-item",B={TOUCH:"touch",PEN:"pen"},W=function(){function t(t,e){this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(e),this._element=t,this._indicatorsElement=this._element.querySelector(".carousel-indicators"),this._touchSupported="ontouchstart"in document.documentElement||0<navigator.maxTouchPoints,this._pointerEvent=Boolean(window.PointerEvent||window.MSPointerEvent),this._addEventListeners()}var n=t.prototype;return n.next=function(){this._isSliding||this._slide(F)},n.nextWhenVisible=function(){!document.hidden&&e(this._element).is(":visible")&&"hidden"!==e(this._element).css("visibility")&&this.next()},n.prev=function(){this._isSliding||this._slide(O)},n.pause=function(t){t||(this._isPaused=!0),this._element.querySelector(".carousel-item-next, .carousel-item-prev")&&(u.triggerTransitionEnd(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null},n.cycle=function(t){t||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config.interval&&!this._isPaused&&(this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))},n.to=function(t){var n=this;this._activeElement=this._element.querySelector(L);var r=this._getItemIndex(this._activeElement);if(!(t>this._items.length-1||t<0))if(this._isSliding)e(this._element).one(M.SLID,(function(){return n.to(t)}));else{if(r===t)return this.pause(),void this.cycle();this._slide(r<t?F:O,this._items[t])}},n.dispose=function(){e(this._element).off(k),e.removeData(this._element,T),this._items=null,this._config=null,this._element=null,this._interval=null,this._isPaused=null,this._isSliding=null,this._activeElement=null,this._indicatorsElement=null},n._getConfig=function(t){return t=a({},R,{},t),u.typeCheckConfig(I,t,N),t},n._handleSwipe=function(){var t=Math.abs(this.touchDeltaX);if(!(t<=40)){var e=t/this.touchDeltaX;(this.touchDeltaX=0)<e&&this.prev(),e<0&&this.next()}},n._addEventListeners=function(){var t=this;this._config.keyboard&&e(this._element).on(M.KEYDOWN,(function(e){return t._keydown(e)})),"hover"===this._config.pause&&e(this._element).on(M.MOUSEENTER,(function(e){return t.pause(e)})).on(M.MOUSELEAVE,(function(e){return t.cycle(e)})),this._config.touch&&this._addTouchEventListeners()},n._addTouchEventListeners=function(){var t=this;if(this._touchSupported){var n=function(e){t._pointerEvent&&B[e.originalEvent.pointerType.toUpperCase()]?t.touchStartX=e.originalEvent.clientX:t._pointerEvent||(t.touchStartX=e.originalEvent.touches[0].clientX)},r=function(e){t._pointerEvent&&B[e.originalEvent.pointerType.toUpperCase()]&&(t.touchDeltaX=e.originalEvent.clientX-t.touchStartX),t._handleSwipe(),"hover"===t._config.pause&&(t.pause(),t.touchTimeout&&clearTimeout(t.touchTimeout),t.touchTimeout=setTimeout((function(e){return t.cycle(e)}),500+t._config.interval))};e(this._element.querySelectorAll(".carousel-item img")).on(M.DRAG_START,(function(t){return t.preventDefault()})),this._pointerEvent?(e(this._element).on(M.POINTERDOWN,(function(t){return n(t)})),e(this._element).on(M.POINTERUP,(function(t){return r(t)})),this._element.classList.add("pointer-event")):(e(this._element).on(M.TOUCHSTART,(function(t){return n(t)})),e(this._element).on(M.TOUCHMOVE,(function(e){return function(e){t.touchDeltaX=e.originalEvent.touches&&1<e.originalEvent.touches.length?0:e.originalEvent.touches[0].clientX-t.touchStartX}(e)})),e(this._element).on(M.TOUCHEND,(function(t){return r(t)})))}},n._keydown=function(t){if(!/input|textarea/i.test(t.target.tagName))switch(t.which){case 37:t.preventDefault(),this.prev();break;case 39:t.preventDefault(),this.next()}},n._getItemIndex=function(t){return this._items=t&&t.parentNode?[].slice.call(t.parentNode.querySelectorAll(".carousel-item")):[],this._items.indexOf(t)},n._getItemByDirection=function(t,e){var n=t===F,r=t===O,o=this._getItemIndex(e);if((r&&0===o||n&&o===this._items.length-1)&&!this._config.wrap)return e;var i=(o+(t===O?-1:1))%this._items.length;return-1==i?this._items[this._items.length-1]:this._items[i]},n._triggerSlideEvent=function(t,n){var r=this._getItemIndex(t),o=this._getItemIndex(this._element.querySelector(L)),i=e.Event(M.SLIDE,{relatedTarget:t,direction:n,from:o,to:r});return e(this._element).trigger(i),i},n._setActiveIndicatorElement=function(t){if(this._indicatorsElement){var n=[].slice.call(this._indicatorsElement.querySelectorAll(".active"));e(n).removeClass(P);var r=this._indicatorsElement.children[this._getItemIndex(t)];r&&e(r).addClass(P)}},n._slide=function(t,n){var r,o,i,a=this,s=this._element.querySelector(L),c=this._getItemIndex(s),l=n||s&&this._getItemByDirection(t,s),f=this._getItemIndex(l),h=Boolean(this._interval);if(i=t===F?(r="carousel-item-left",o="carousel-item-next","left"):(r="carousel-item-right",o="carousel-item-prev","right"),l&&e(l).hasClass(P))this._isSliding=!1;else if(!this._triggerSlideEvent(l,i).isDefaultPrevented()&&s&&l){this._isSliding=!0,h&&this.pause(),this._setActiveIndicatorElement(l);var d=e.Event(M.SLID,{relatedTarget:l,direction:i,from:c,to:f});if(e(this._element).hasClass("slide")){e(l).addClass(o),u.reflow(l),e(s).addClass(r),e(l).addClass(r);var p=parseInt(l.getAttribute("data-interval"),10);p?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,this._config.interval=p):this._config.interval=this._config.defaultInterval||this._config.interval;var v=u.getTransitionDurationFromElement(s);e(s).one(u.TRANSITION_END,(function(){e(l).removeClass(r+" "+o).addClass(P),e(s).removeClass(P+" "+o+" "+r),a._isSliding=!1,setTimeout((function(){return e(a._element).trigger(d)}),0)})).emulateTransitionEnd(v)}else e(s).removeClass(P),e(l).addClass(P),this._isSliding=!1,e(this._element).trigger(d);h&&this.cycle()}},t._jQueryInterface=function(n){return this.each((function(){var r=e(this).data(T),o=a({},R,{},e(this).data());"object"==typeof n&&(o=a({},o,{},n));var i="string"==typeof n?n:o.slide;if(r||(r=new t(this,o),e(this).data(T,r)),"number"==typeof n)r.to(n);else if("string"==typeof i){if(void 0===r[i])throw new TypeError('No method named "'+i+'"');r[i]()}else o.interval&&o.ride&&(r.pause(),r.cycle())}))},t._dataApiClickHandler=function(n){var r=u.getSelectorFromElement(this);if(r){var o=e(r)[0];if(o&&e(o).hasClass("carousel")){var i=a({},e(o).data(),{},e(this).data()),s=this.getAttribute("data-slide-to");s&&(i.interval=!1),t._jQueryInterface.call(e(o),i),s&&e(o).data(T).to(s),n.preventDefault()}}},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}},{key:"Default",get:function(){return R}}]),t}();e(document).on(M.CLICK_DATA_API,"[data-slide], [data-slide-to]",W._dataApiClickHandler),e(window).on(M.LOAD_DATA_API,(function(){for(var t=[].slice.call(document.querySelectorAll('[data-ride="carousel"]')),n=0,r=t.length;n<r;n++){var o=e(t[n]);W._jQueryInterface.call(o,o.data())}})),e.fn[I]=W._jQueryInterface,e.fn[I].Constructor=W,e.fn[I].noConflict=function(){return e.fn[I]=A,W._jQueryInterface};var z="collapse",U="bs.collapse",j="."+U,H=e.fn[z],V={toggle:!0,parent:""},q={toggle:"boolean",parent:"(string|element)"},G={SHOW:"show"+j,SHOWN:"shown"+j,HIDE:"hide"+j,HIDDEN:"hidden"+j,CLICK_DATA_API:"click"+j+".data-api"},K="show",X="collapse",$="collapsing",Y="collapsed",Q='[data-toggle="collapse"]',J=function(){function t(t,e){this._isTransitioning=!1,this._element=t,this._config=this._getConfig(e),this._triggerArray=[].slice.call(document.querySelectorAll('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'));for(var n=[].slice.call(document.querySelectorAll(Q)),r=0,o=n.length;r<o;r++){var i=n[r],a=u.getSelectorFromElement(i),s=[].slice.call(document.querySelectorAll(a)).filter((function(e){return e===t}));null!==a&&0<s.length&&(this._selector=a,this._triggerArray.push(i))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}var n=t.prototype;return n.toggle=function(){e(this._element).hasClass(K)?this.hide():this.show()},n.show=function(){var n,r,o=this;if(!(this._isTransitioning||e(this._element).hasClass(K)||(this._parent&&0===(n=[].slice.call(this._parent.querySelectorAll(".show, .collapsing")).filter((function(t){return"string"==typeof o._config.parent?t.getAttribute("data-parent")===o._config.parent:t.classList.contains(X)}))).length&&(n=null),n&&(r=e(n).not(this._selector).data(U))&&r._isTransitioning))){var i=e.Event(G.SHOW);if(e(this._element).trigger(i),!i.isDefaultPrevented()){n&&(t._jQueryInterface.call(e(n).not(this._selector),"hide"),r||e(n).data(U,null));var a=this._getDimension();e(this._element).removeClass(X).addClass($),this._element.style[a]=0,this._triggerArray.length&&e(this._triggerArray).removeClass(Y).attr("aria-expanded",!0),this.setTransitioning(!0);var s="scroll"+(a[0].toUpperCase()+a.slice(1)),c=u.getTransitionDurationFromElement(this._element);e(this._element).one(u.TRANSITION_END,(function(){e(o._element).removeClass($).addClass(X).addClass(K),o._element.style[a]="",o.setTransitioning(!1),e(o._element).trigger(G.SHOWN)})).emulateTransitionEnd(c),this._element.style[a]=this._element[s]+"px"}}},n.hide=function(){var t=this;if(!this._isTransitioning&&e(this._element).hasClass(K)){var n=e.Event(G.HIDE);if(e(this._element).trigger(n),!n.isDefaultPrevented()){var r=this._getDimension();this._element.style[r]=this._element.getBoundingClientRect()[r]+"px",u.reflow(this._element),e(this._element).addClass($).removeClass(X).removeClass(K);var o=this._triggerArray.length;if(0<o)for(var i=0;i<o;i++){var a=this._triggerArray[i],s=u.getSelectorFromElement(a);null!==s&&(e([].slice.call(document.querySelectorAll(s))).hasClass(K)||e(a).addClass(Y).attr("aria-expanded",!1))}this.setTransitioning(!0),this._element.style[r]="";var c=u.getTransitionDurationFromElement(this._element);e(this._element).one(u.TRANSITION_END,(function(){t.setTransitioning(!1),e(t._element).removeClass($).addClass(X).trigger(G.HIDDEN)})).emulateTransitionEnd(c)}}},n.setTransitioning=function(t){this._isTransitioning=t},n.dispose=function(){e.removeData(this._element,U),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null},n._getConfig=function(t){return(t=a({},V,{},t)).toggle=Boolean(t.toggle),u.typeCheckConfig(z,t,q),t},n._getDimension=function(){return e(this._element).hasClass("width")?"width":"height"},n._getParent=function(){var n,r=this;u.isElement(this._config.parent)?(n=this._config.parent,void 0!==this._config.parent.jquery&&(n=this._config.parent[0])):n=document.querySelector(this._config.parent);var o=[].slice.call(n.querySelectorAll('[data-toggle="collapse"][data-parent="'+this._config.parent+'"]'));return e(o).each((function(e,n){r._addAriaAndCollapsedClass(t._getTargetFromElement(n),[n])})),n},n._addAriaAndCollapsedClass=function(t,n){var r=e(t).hasClass(K);n.length&&e(n).toggleClass(Y,!r).attr("aria-expanded",r)},t._getTargetFromElement=function(t){var e=u.getSelectorFromElement(t);return e?document.querySelector(e):null},t._jQueryInterface=function(n){return this.each((function(){var r=e(this),o=r.data(U),i=a({},V,{},r.data(),{},"object"==typeof n&&n?n:{});if(!o&&i.toggle&&/show|hide/.test(n)&&(i.toggle=!1),o||(o=new t(this,i),r.data(U,o)),"string"==typeof n){if(void 0===o[n])throw new TypeError('No method named "'+n+'"');o[n]()}}))},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}},{key:"Default",get:function(){return V}}]),t}();e(document).on(G.CLICK_DATA_API,Q,(function(t){"A"===t.currentTarget.tagName&&t.preventDefault();var n=e(this),r=u.getSelectorFromElement(this),o=[].slice.call(document.querySelectorAll(r));e(o).each((function(){var t=e(this),r=t.data(U)?"toggle":n.data();J._jQueryInterface.call(t,r)}))})),e.fn[z]=J._jQueryInterface,e.fn[z].Constructor=J,e.fn[z].noConflict=function(){return e.fn[z]=H,J._jQueryInterface};var Z="dropdown",tt="bs.dropdown",et="."+tt,nt=".data-api",rt=e.fn[Z],ot=new RegExp("38|40|27"),it={HIDE:"hide"+et,HIDDEN:"hidden"+et,SHOW:"show"+et,SHOWN:"shown"+et,CLICK:"click"+et,CLICK_DATA_API:"click"+et+nt,KEYDOWN_DATA_API:"keydown"+et+nt,KEYUP_DATA_API:"keyup"+et+nt},at="disabled",st="show",ut="dropdown-menu-right",ct='[data-toggle="dropdown"]',lt=".dropdown-menu",ft={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic",popperConfig:null},ht={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string",popperConfig:"(null|object)"},dt=function(){function t(t,e){this._element=t,this._popper=null,this._config=this._getConfig(e),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}var r=t.prototype;return r.toggle=function(){if(!this._element.disabled&&!e(this._element).hasClass(at)){var n=e(this._menu).hasClass(st);t._clearMenus(),n||this.show(!0)}},r.show=function(r){if(void 0===r&&(r=!1),!(this._element.disabled||e(this._element).hasClass(at)||e(this._menu).hasClass(st))){var o={relatedTarget:this._element},i=e.Event(it.SHOW,o),a=t._getParentFromElement(this._element);if(e(a).trigger(i),!i.isDefaultPrevented()){if(!this._inNavbar&&r){if(void 0===n)throw new TypeError("Bootstrap's dropdowns require Popper.js (https://popper.js.org/)");var s=this._element;"parent"===this._config.reference?s=a:u.isElement(this._config.reference)&&(s=this._config.reference,void 0!==this._config.reference.jquery&&(s=this._config.reference[0])),"scrollParent"!==this._config.boundary&&e(a).addClass("position-static"),this._popper=new n(s,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===e(a).closest(".navbar-nav").length&&e(document.body).children().on("mouseover",null,e.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),e(this._menu).toggleClass(st),e(a).toggleClass(st).trigger(e.Event(it.SHOWN,o))}}},r.hide=function(){if(!this._element.disabled&&!e(this._element).hasClass(at)&&e(this._menu).hasClass(st)){var n={relatedTarget:this._element},r=e.Event(it.HIDE,n),o=t._getParentFromElement(this._element);e(o).trigger(r),r.isDefaultPrevented()||(this._popper&&this._popper.destroy(),e(this._menu).toggleClass(st),e(o).toggleClass(st).trigger(e.Event(it.HIDDEN,n)))}},r.dispose=function(){e.removeData(this._element,tt),e(this._element).off(et),this._element=null,(this._menu=null)!==this._popper&&(this._popper.destroy(),this._popper=null)},r.update=function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()},r._addEventListeners=function(){var t=this;e(this._element).on(it.CLICK,(function(e){e.preventDefault(),e.stopPropagation(),t.toggle()}))},r._getConfig=function(t){return t=a({},this.constructor.Default,{},e(this._element).data(),{},t),u.typeCheckConfig(Z,t,this.constructor.DefaultType),t},r._getMenuElement=function(){if(!this._menu){var e=t._getParentFromElement(this._element);e&&(this._menu=e.querySelector(lt))}return this._menu},r._getPlacement=function(){var t=e(this._element.parentNode),n="bottom-start";return t.hasClass("dropup")?(n="top-start",e(this._menu).hasClass(ut)&&(n="top-end")):t.hasClass("dropright")?n="right-start":t.hasClass("dropleft")?n="left-start":e(this._menu).hasClass(ut)&&(n="bottom-end"),n},r._detectNavbar=function(){return 0<e(this._element).closest(".navbar").length},r._getOffset=function(){var t=this,e={};return"function"==typeof this._config.offset?e.fn=function(e){return e.offsets=a({},e.offsets,{},t._config.offset(e.offsets,t._element)||{}),e}:e.offset=this._config.offset,e},r._getPopperConfig=function(){var t={placement:this._getPlacement(),modifiers:{offset:this._getOffset(),flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(t.modifiers.applyStyle={enabled:!1}),a({},t,{},this._config.popperConfig)},t._jQueryInterface=function(n){return this.each((function(){var r=e(this).data(tt);if(r||(r=new t(this,"object"==typeof n?n:null),e(this).data(tt,r)),"string"==typeof n){if(void 0===r[n])throw new TypeError('No method named "'+n+'"');r[n]()}}))},t._clearMenus=function(n){if(!n||3!==n.which&&("keyup"!==n.type||9===n.which))for(var r=[].slice.call(document.querySelectorAll(ct)),o=0,i=r.length;o<i;o++){var a=t._getParentFromElement(r[o]),s=e(r[o]).data(tt),u={relatedTarget:r[o]};if(n&&"click"===n.type&&(u.clickEvent=n),s){var c=s._menu;if(e(a).hasClass(st)&&!(n&&("click"===n.type&&/input|textarea/i.test(n.target.tagName)||"keyup"===n.type&&9===n.which)&&e.contains(a,n.target))){var l=e.Event(it.HIDE,u);e(a).trigger(l),l.isDefaultPrevented()||("ontouchstart"in document.documentElement&&e(document.body).children().off("mouseover",null,e.noop),r[o].setAttribute("aria-expanded","false"),s._popper&&s._popper.destroy(),e(c).removeClass(st),e(a).removeClass(st).trigger(e.Event(it.HIDDEN,u)))}}}},t._getParentFromElement=function(t){var e,n=u.getSelectorFromElement(t);return n&&(e=document.querySelector(n)),e||t.parentNode},t._dataApiKeydownHandler=function(n){if((/input|textarea/i.test(n.target.tagName)?!(32===n.which||27!==n.which&&(40!==n.which&&38!==n.which||e(n.target).closest(lt).length)):ot.test(n.which))&&(n.preventDefault(),n.stopPropagation(),!this.disabled&&!e(this).hasClass(at))){var r=t._getParentFromElement(this),o=e(r).hasClass(st);if(o||27!==n.which)if(o&&(!o||27!==n.which&&32!==n.which)){var i=[].slice.call(r.querySelectorAll(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)")).filter((function(t){return e(t).is(":visible")}));if(0!==i.length){var a=i.indexOf(n.target);38===n.which&&0<a&&a--,40===n.which&&a<i.length-1&&a++,a<0&&(a=0),i[a].focus()}}else{if(27===n.which){var s=r.querySelector(ct);e(s).trigger("focus")}e(this).trigger("click")}}},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}},{key:"Default",get:function(){return ft}},{key:"DefaultType",get:function(){return ht}}]),t}();e(document).on(it.KEYDOWN_DATA_API,ct,dt._dataApiKeydownHandler).on(it.KEYDOWN_DATA_API,lt,dt._dataApiKeydownHandler).on(it.CLICK_DATA_API+" "+it.KEYUP_DATA_API,dt._clearMenus).on(it.CLICK_DATA_API,ct,(function(t){t.preventDefault(),t.stopPropagation(),dt._jQueryInterface.call(e(this),"toggle")})).on(it.CLICK_DATA_API,".dropdown form",(function(t){t.stopPropagation()})),e.fn[Z]=dt._jQueryInterface,e.fn[Z].Constructor=dt,e.fn[Z].noConflict=function(){return e.fn[Z]=rt,dt._jQueryInterface};var pt="modal",vt="bs.modal",mt="."+vt,gt=e.fn[pt],yt={backdrop:!0,keyboard:!0,focus:!0,show:!0},bt={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean",show:"boolean"},xt={HIDE:"hide"+mt,HIDE_PREVENTED:"hidePrevented"+mt,HIDDEN:"hidden"+mt,SHOW:"show"+mt,SHOWN:"shown"+mt,FOCUSIN:"focusin"+mt,RESIZE:"resize"+mt,CLICK_DISMISS:"click.dismiss"+mt,KEYDOWN_DISMISS:"keydown.dismiss"+mt,MOUSEUP_DISMISS:"mouseup.dismiss"+mt,MOUSEDOWN_DISMISS:"mousedown.dismiss"+mt,CLICK_DATA_API:"click"+mt+".data-api"},wt="modal-open",_t="fade",Ct="show",Et="modal-static",St=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",It=".sticky-top",Tt=function(){function t(t,e){this._config=this._getConfig(e),this._element=t,this._dialog=t.querySelector(".modal-dialog"),this._backdrop=null,this._isShown=!1,this._isBodyOverflowing=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollbarWidth=0}var n=t.prototype;return n.toggle=function(t){return this._isShown?this.hide():this.show(t)},n.show=function(t){var n=this;if(!this._isShown&&!this._isTransitioning){e(this._element).hasClass(_t)&&(this._isTransitioning=!0);var r=e.Event(xt.SHOW,{relatedTarget:t});e(this._element).trigger(r),this._isShown||r.isDefaultPrevented()||(this._isShown=!0,this._checkScrollbar(),this._setScrollbar(),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),e(this._element).on(xt.CLICK_DISMISS,'[data-dismiss="modal"]',(function(t){return n.hide(t)})),e(this._dialog).on(xt.MOUSEDOWN_DISMISS,(function(){e(n._element).one(xt.MOUSEUP_DISMISS,(function(t){e(t.target).is(n._element)&&(n._ignoreBackdropClick=!0)}))})),this._showBackdrop((function(){return n._showElement(t)})))}},n.hide=function(t){var n=this;if(t&&t.preventDefault(),this._isShown&&!this._isTransitioning){var r=e.Event(xt.HIDE);if(e(this._element).trigger(r),this._isShown&&!r.isDefaultPrevented()){this._isShown=!1;var o=e(this._element).hasClass(_t);if(o&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),e(document).off(xt.FOCUSIN),e(this._element).removeClass(Ct),e(this._element).off(xt.CLICK_DISMISS),e(this._dialog).off(xt.MOUSEDOWN_DISMISS),o){var i=u.getTransitionDurationFromElement(this._element);e(this._element).one(u.TRANSITION_END,(function(t){return n._hideModal(t)})).emulateTransitionEnd(i)}else this._hideModal()}}},n.dispose=function(){[window,this._element,this._dialog].forEach((function(t){return e(t).off(mt)})),e(document).off(xt.FOCUSIN),e.removeData(this._element,vt),this._config=null,this._element=null,this._dialog=null,this._backdrop=null,this._isShown=null,this._isBodyOverflowing=null,this._ignoreBackdropClick=null,this._isTransitioning=null,this._scrollbarWidth=null},n.handleUpdate=function(){this._adjustDialog()},n._getConfig=function(t){return t=a({},yt,{},t),u.typeCheckConfig(pt,t,bt),t},n._triggerBackdropTransition=function(){var t=this;if("static"===this._config.backdrop){var n=e.Event(xt.HIDE_PREVENTED);if(e(this._element).trigger(n),n.defaultPrevented)return;this._element.classList.add(Et);var r=u.getTransitionDurationFromElement(this._element);e(this._element).one(u.TRANSITION_END,(function(){t._element.classList.remove(Et)})).emulateTransitionEnd(r),this._element.focus()}else this.hide()},n._showElement=function(t){var n=this,r=e(this._element).hasClass(_t),o=this._dialog?this._dialog.querySelector(".modal-body"):null;function i(){n._config.focus&&n._element.focus(),n._isTransitioning=!1,e(n._element).trigger(a)}this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.appendChild(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),e(this._dialog).hasClass("modal-dialog-scrollable")&&o?o.scrollTop=0:this._element.scrollTop=0,r&&u.reflow(this._element),e(this._element).addClass(Ct),this._config.focus&&this._enforceFocus();var a=e.Event(xt.SHOWN,{relatedTarget:t});if(r){var s=u.getTransitionDurationFromElement(this._dialog);e(this._dialog).one(u.TRANSITION_END,i).emulateTransitionEnd(s)}else i()},n._enforceFocus=function(){var t=this;e(document).off(xt.FOCUSIN).on(xt.FOCUSIN,(function(n){document!==n.target&&t._element!==n.target&&0===e(t._element).has(n.target).length&&t._element.focus()}))},n._setEscapeEvent=function(){var t=this;this._isShown&&this._config.keyboard?e(this._element).on(xt.KEYDOWN_DISMISS,(function(e){27===e.which&&t._triggerBackdropTransition()})):this._isShown||e(this._element).off(xt.KEYDOWN_DISMISS)},n._setResizeEvent=function(){var t=this;this._isShown?e(window).on(xt.RESIZE,(function(e){return t.handleUpdate(e)})):e(window).off(xt.RESIZE)},n._hideModal=function(){var t=this;this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._isTransitioning=!1,this._showBackdrop((function(){e(document.body).removeClass(wt),t._resetAdjustments(),t._resetScrollbar(),e(t._element).trigger(xt.HIDDEN)}))},n._removeBackdrop=function(){this._backdrop&&(e(this._backdrop).remove(),this._backdrop=null)},n._showBackdrop=function(t){var n=this,r=e(this._element).hasClass(_t)?_t:"";if(this._isShown&&this._config.backdrop){if(this._backdrop=document.createElement("div"),this._backdrop.className="modal-backdrop",r&&this._backdrop.classList.add(r),e(this._backdrop).appendTo(document.body),e(this._element).on(xt.CLICK_DISMISS,(function(t){n._ignoreBackdropClick?n._ignoreBackdropClick=!1:t.target===t.currentTarget&&n._triggerBackdropTransition()})),r&&u.reflow(this._backdrop),e(this._backdrop).addClass(Ct),!t)return;if(!r)return void t();var o=u.getTransitionDurationFromElement(this._backdrop);e(this._backdrop).one(u.TRANSITION_END,t).emulateTransitionEnd(o)}else if(!this._isShown&&this._backdrop){e(this._backdrop).removeClass(Ct);var i=function(){n._removeBackdrop(),t&&t()};if(e(this._element).hasClass(_t)){var a=u.getTransitionDurationFromElement(this._backdrop);e(this._backdrop).one(u.TRANSITION_END,i).emulateTransitionEnd(a)}else i()}else t&&t()},n._adjustDialog=function(){var t=this._element.scrollHeight>document.documentElement.clientHeight;!this._isBodyOverflowing&&t&&(this._element.style.paddingLeft=this._scrollbarWidth+"px"),this._isBodyOverflowing&&!t&&(this._element.style.paddingRight=this._scrollbarWidth+"px")},n._resetAdjustments=function(){this._element.style.paddingLeft="",this._element.style.paddingRight=""},n._checkScrollbar=function(){var t=document.body.getBoundingClientRect();this._isBodyOverflowing=t.left+t.right<window.innerWidth,this._scrollbarWidth=this._getScrollbarWidth()},n._setScrollbar=function(){var t=this;if(this._isBodyOverflowing){var n=[].slice.call(document.querySelectorAll(St)),r=[].slice.call(document.querySelectorAll(It));e(n).each((function(n,r){var o=r.style.paddingRight,i=e(r).css("padding-right");e(r).data("padding-right",o).css("padding-right",parseFloat(i)+t._scrollbarWidth+"px")})),e(r).each((function(n,r){var o=r.style.marginRight,i=e(r).css("margin-right");e(r).data("margin-right",o).css("margin-right",parseFloat(i)-t._scrollbarWidth+"px")}));var o=document.body.style.paddingRight,i=e(document.body).css("padding-right");e(document.body).data("padding-right",o).css("padding-right",parseFloat(i)+this._scrollbarWidth+"px")}e(document.body).addClass(wt)},n._resetScrollbar=function(){var t=[].slice.call(document.querySelectorAll(St));e(t).each((function(t,n){var r=e(n).data("padding-right");e(n).removeData("padding-right"),n.style.paddingRight=r||""}));var n=[].slice.call(document.querySelectorAll(""+It));e(n).each((function(t,n){var r=e(n).data("margin-right");void 0!==r&&e(n).css("margin-right",r).removeData("margin-right")}));var r=e(document.body).data("padding-right");e(document.body).removeData("padding-right"),document.body.style.paddingRight=r||""},n._getScrollbarWidth=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",document.body.appendChild(t);var e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e},t._jQueryInterface=function(n,r){return this.each((function(){var o=e(this).data(vt),i=a({},yt,{},e(this).data(),{},"object"==typeof n&&n?n:{});if(o||(o=new t(this,i),e(this).data(vt,o)),"string"==typeof n){if(void 0===o[n])throw new TypeError('No method named "'+n+'"');o[n](r)}else i.show&&o.show(r)}))},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}},{key:"Default",get:function(){return yt}}]),t}();e(document).on(xt.CLICK_DATA_API,'[data-toggle="modal"]',(function(t){var n,r=this,o=u.getSelectorFromElement(this);o&&(n=document.querySelector(o));var i=e(n).data(vt)?"toggle":a({},e(n).data(),{},e(this).data());"A"!==this.tagName&&"AREA"!==this.tagName||t.preventDefault();var s=e(n).one(xt.SHOW,(function(t){t.isDefaultPrevented()||s.one(xt.HIDDEN,(function(){e(r).is(":visible")&&r.focus()}))}));Tt._jQueryInterface.call(e(n),i,this)})),e.fn[pt]=Tt._jQueryInterface,e.fn[pt].Constructor=Tt,e.fn[pt].noConflict=function(){return e.fn[pt]=gt,Tt._jQueryInterface};var kt=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],Dt=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,At=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;function Rt(t,e,n){if(0===t.length)return t;if(n&&"function"==typeof n)return n(t);for(var r=(new window.DOMParser).parseFromString(t,"text/html"),o=Object.keys(e),i=[].slice.call(r.body.querySelectorAll("*")),a=function(t){var n=i[t],r=n.nodeName.toLowerCase();if(-1===o.indexOf(n.nodeName.toLowerCase()))return n.parentNode.removeChild(n),"continue";var a=[].slice.call(n.attributes),s=[].concat(e["*"]||[],e[r]||[]);a.forEach((function(t){!function(t,e){var n=t.nodeName.toLowerCase();if(-1!==e.indexOf(n))return-1===kt.indexOf(n)||Boolean(t.nodeValue.match(Dt)||t.nodeValue.match(At));for(var r=e.filter((function(t){return t instanceof RegExp})),o=0,i=r.length;o<i;o++)if(n.match(r[o]))return!0;return!1}(t,s)&&n.removeAttribute(t.nodeName)}))},s=0,u=i.length;s<u;s++)a(s);return r.body.innerHTML}var Nt="tooltip",Ft="bs.tooltip",Ot="."+Ft,Mt=e.fn[Nt],Pt="bs-tooltip",Lt=new RegExp("(^|\\s)"+Pt+"\\S+","g"),Bt=["sanitize","whiteList","sanitizeFn"],Wt={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(number|string|function)",container:"(string|element|boolean)",fallbackPlacement:"(string|array)",boundary:"(string|element)",sanitize:"boolean",sanitizeFn:"(null|function)",whiteList:"object",popperConfig:"(null|object)"},zt={AUTO:"auto",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},Ut={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:0,container:!1,fallbackPlacement:"flip",boundary:"scrollParent",sanitize:!0,sanitizeFn:null,whiteList:{"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},popperConfig:null},jt="show",Ht={HIDE:"hide"+Ot,HIDDEN:"hidden"+Ot,SHOW:"show"+Ot,SHOWN:"shown"+Ot,INSERTED:"inserted"+Ot,CLICK:"click"+Ot,FOCUSIN:"focusin"+Ot,FOCUSOUT:"focusout"+Ot,MOUSEENTER:"mouseenter"+Ot,MOUSELEAVE:"mouseleave"+Ot},Vt="fade",qt="show",Gt="hover",Kt="focus",Xt=function(){function t(t,e){if(void 0===n)throw new TypeError("Bootstrap's tooltips require Popper.js (https://popper.js.org/)");this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this.element=t,this.config=this._getConfig(e),this.tip=null,this._setListeners()}var r=t.prototype;return r.enable=function(){this._isEnabled=!0},r.disable=function(){this._isEnabled=!1},r.toggleEnabled=function(){this._isEnabled=!this._isEnabled},r.toggle=function(t){if(this._isEnabled)if(t){var n=this.constructor.DATA_KEY,r=e(t.currentTarget).data(n);r||(r=new this.constructor(t.currentTarget,this._getDelegateConfig()),e(t.currentTarget).data(n,r)),r._activeTrigger.click=!r._activeTrigger.click,r._isWithActiveTrigger()?r._enter(null,r):r._leave(null,r)}else{if(e(this.getTipElement()).hasClass(qt))return void this._leave(null,this);this._enter(null,this)}},r.dispose=function(){clearTimeout(this._timeout),e.removeData(this.element,this.constructor.DATA_KEY),e(this.element).off(this.constructor.EVENT_KEY),e(this.element).closest(".modal").off("hide.bs.modal",this._hideModalHandler),this.tip&&e(this.tip).remove(),this._isEnabled=null,this._timeout=null,this._hoverState=null,this._activeTrigger=null,this._popper&&this._popper.destroy(),this._popper=null,this.element=null,this.config=null,this.tip=null},r.show=function(){var t=this;if("none"===e(this.element).css("display"))throw new Error("Please use show on visible elements");var r=e.Event(this.constructor.Event.SHOW);if(this.isWithContent()&&this._isEnabled){e(this.element).trigger(r);var o=u.findShadowRoot(this.element),i=e.contains(null!==o?o:this.element.ownerDocument.documentElement,this.element);if(r.isDefaultPrevented()||!i)return;var a=this.getTipElement(),s=u.getUID(this.constructor.NAME);a.setAttribute("id",s),this.element.setAttribute("aria-describedby",s),this.setContent(),this.config.animation&&e(a).addClass(Vt);var c="function"==typeof this.config.placement?this.config.placement.call(this,a,this.element):this.config.placement,l=this._getAttachment(c);this.addAttachmentClass(l);var f=this._getContainer();e(a).data(this.constructor.DATA_KEY,this),e.contains(this.element.ownerDocument.documentElement,this.tip)||e(a).appendTo(f),e(this.element).trigger(this.constructor.Event.INSERTED),this._popper=new n(this.element,a,this._getPopperConfig(l)),e(a).addClass(qt),"ontouchstart"in document.documentElement&&e(document.body).children().on("mouseover",null,e.noop);var h=function(){t.config.animation&&t._fixTransition();var n=t._hoverState;t._hoverState=null,e(t.element).trigger(t.constructor.Event.SHOWN),"out"===n&&t._leave(null,t)};if(e(this.tip).hasClass(Vt)){var d=u.getTransitionDurationFromElement(this.tip);e(this.tip).one(u.TRANSITION_END,h).emulateTransitionEnd(d)}else h()}},r.hide=function(t){function n(){r._hoverState!==jt&&o.parentNode&&o.parentNode.removeChild(o),r._cleanTipClass(),r.element.removeAttribute("aria-describedby"),e(r.element).trigger(r.constructor.Event.HIDDEN),null!==r._popper&&r._popper.destroy(),t&&t()}var r=this,o=this.getTipElement(),i=e.Event(this.constructor.Event.HIDE);if(e(this.element).trigger(i),!i.isDefaultPrevented()){if(e(o).removeClass(qt),"ontouchstart"in document.documentElement&&e(document.body).children().off("mouseover",null,e.noop),this._activeTrigger.click=!1,this._activeTrigger[Kt]=!1,this._activeTrigger[Gt]=!1,e(this.tip).hasClass(Vt)){var a=u.getTransitionDurationFromElement(o);e(o).one(u.TRANSITION_END,n).emulateTransitionEnd(a)}else n();this._hoverState=""}},r.update=function(){null!==this._popper&&this._popper.scheduleUpdate()},r.isWithContent=function(){return Boolean(this.getTitle())},r.addAttachmentClass=function(t){e(this.getTipElement()).addClass(Pt+"-"+t)},r.getTipElement=function(){return this.tip=this.tip||e(this.config.template)[0],this.tip},r.setContent=function(){var t=this.getTipElement();this.setElementContent(e(t.querySelectorAll(".tooltip-inner")),this.getTitle()),e(t).removeClass(Vt+" "+qt)},r.setElementContent=function(t,n){"object"!=typeof n||!n.nodeType&&!n.jquery?this.config.html?(this.config.sanitize&&(n=Rt(n,this.config.whiteList,this.config.sanitizeFn)),t.html(n)):t.text(n):this.config.html?e(n).parent().is(t)||t.empty().append(n):t.text(e(n).text())},r.getTitle=function(){return this.element.getAttribute("data-original-title")||("function"==typeof this.config.title?this.config.title.call(this.element):this.config.title)},r._getPopperConfig=function(t){var e=this;return a({},{placement:t,modifiers:{offset:this._getOffset(),flip:{behavior:this.config.fallbackPlacement},arrow:{element:".arrow"},preventOverflow:{boundariesElement:this.config.boundary}},onCreate:function(t){t.originalPlacement!==t.placement&&e._handlePopperPlacementChange(t)},onUpdate:function(t){return e._handlePopperPlacementChange(t)}},{},this.config.popperConfig)},r._getOffset=function(){var t=this,e={};return"function"==typeof this.config.offset?e.fn=function(e){return e.offsets=a({},e.offsets,{},t.config.offset(e.offsets,t.element)||{}),e}:e.offset=this.config.offset,e},r._getContainer=function(){return!1===this.config.container?document.body:u.isElement(this.config.container)?e(this.config.container):e(document).find(this.config.container)},r._getAttachment=function(t){return zt[t.toUpperCase()]},r._setListeners=function(){var t=this;this.config.trigger.split(" ").forEach((function(n){if("click"===n)e(t.element).on(t.constructor.Event.CLICK,t.config.selector,(function(e){return t.toggle(e)}));else if("manual"!==n){var r=n===Gt?t.constructor.Event.MOUSEENTER:t.constructor.Event.FOCUSIN,o=n===Gt?t.constructor.Event.MOUSELEAVE:t.constructor.Event.FOCUSOUT;e(t.element).on(r,t.config.selector,(function(e){return t._enter(e)})).on(o,t.config.selector,(function(e){return t._leave(e)}))}})),this._hideModalHandler=function(){t.element&&t.hide()},e(this.element).closest(".modal").on("hide.bs.modal",this._hideModalHandler),this.config.selector?this.config=a({},this.config,{trigger:"manual",selector:""}):this._fixTitle()},r._fixTitle=function(){var t=typeof this.element.getAttribute("data-original-title");!this.element.getAttribute("title")&&"string"==t||(this.element.setAttribute("data-original-title",this.element.getAttribute("title")||""),this.element.setAttribute("title",""))},r._enter=function(t,n){var r=this.constructor.DATA_KEY;(n=n||e(t.currentTarget).data(r))||(n=new this.constructor(t.currentTarget,this._getDelegateConfig()),e(t.currentTarget).data(r,n)),t&&(n._activeTrigger["focusin"===t.type?Kt:Gt]=!0),e(n.getTipElement()).hasClass(qt)||n._hoverState===jt?n._hoverState=jt:(clearTimeout(n._timeout),n._hoverState=jt,n.config.delay&&n.config.delay.show?n._timeout=setTimeout((function(){n._hoverState===jt&&n.show()}),n.config.delay.show):n.show())},r._leave=function(t,n){var r=this.constructor.DATA_KEY;(n=n||e(t.currentTarget).data(r))||(n=new this.constructor(t.currentTarget,this._getDelegateConfig()),e(t.currentTarget).data(r,n)),t&&(n._activeTrigger["focusout"===t.type?Kt:Gt]=!1),n._isWithActiveTrigger()||(clearTimeout(n._timeout),n._hoverState="out",n.config.delay&&n.config.delay.hide?n._timeout=setTimeout((function(){"out"===n._hoverState&&n.hide()}),n.config.delay.hide):n.hide())},r._isWithActiveTrigger=function(){for(var t in this._activeTrigger)if(this._activeTrigger[t])return!0;return!1},r._getConfig=function(t){var n=e(this.element).data();return Object.keys(n).forEach((function(t){-1!==Bt.indexOf(t)&&delete n[t]})),"number"==typeof(t=a({},this.constructor.Default,{},n,{},"object"==typeof t&&t?t:{})).delay&&(t.delay={show:t.delay,hide:t.delay}),"number"==typeof t.title&&(t.title=t.title.toString()),"number"==typeof t.content&&(t.content=t.content.toString()),u.typeCheckConfig(Nt,t,this.constructor.DefaultType),t.sanitize&&(t.template=Rt(t.template,t.whiteList,t.sanitizeFn)),t},r._getDelegateConfig=function(){var t={};if(this.config)for(var e in this.config)this.constructor.Default[e]!==this.config[e]&&(t[e]=this.config[e]);return t},r._cleanTipClass=function(){var t=e(this.getTipElement()),n=t.attr("class").match(Lt);null!==n&&n.length&&t.removeClass(n.join(""))},r._handlePopperPlacementChange=function(t){this.tip=t.instance.popper,this._cleanTipClass(),this.addAttachmentClass(this._getAttachment(t.placement))},r._fixTransition=function(){var t=this.getTipElement(),n=this.config.animation;null===t.getAttribute("x-placement")&&(e(t).removeClass(Vt),this.config.animation=!1,this.hide(),this.show(),this.config.animation=n)},t._jQueryInterface=function(n){return this.each((function(){var r=e(this).data(Ft),o="object"==typeof n&&n;if((r||!/dispose|hide/.test(n))&&(r||(r=new t(this,o),e(this).data(Ft,r)),"string"==typeof n)){if(void 0===r[n])throw new TypeError('No method named "'+n+'"');r[n]()}}))},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}},{key:"Default",get:function(){return Ut}},{key:"NAME",get:function(){return Nt}},{key:"DATA_KEY",get:function(){return Ft}},{key:"Event",get:function(){return Ht}},{key:"EVENT_KEY",get:function(){return Ot}},{key:"DefaultType",get:function(){return Wt}}]),t}();e.fn[Nt]=Xt._jQueryInterface,e.fn[Nt].Constructor=Xt,e.fn[Nt].noConflict=function(){return e.fn[Nt]=Mt,Xt._jQueryInterface};var $t="popover",Yt="bs.popover",Qt="."+Yt,Jt=e.fn[$t],Zt="bs-popover",te=new RegExp("(^|\\s)"+Zt+"\\S+","g"),ee=a({},Xt.Default,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),ne=a({},Xt.DefaultType,{content:"(string|element|function)"}),re={HIDE:"hide"+Qt,HIDDEN:"hidden"+Qt,SHOW:"show"+Qt,SHOWN:"shown"+Qt,INSERTED:"inserted"+Qt,CLICK:"click"+Qt,FOCUSIN:"focusin"+Qt,FOCUSOUT:"focusout"+Qt,MOUSEENTER:"mouseenter"+Qt,MOUSELEAVE:"mouseleave"+Qt},oe=function(t){function n(){return t.apply(this,arguments)||this}!function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}(n,t);var r=n.prototype;return r.isWithContent=function(){return this.getTitle()||this._getContent()},r.addAttachmentClass=function(t){e(this.getTipElement()).addClass(Zt+"-"+t)},r.getTipElement=function(){return this.tip=this.tip||e(this.config.template)[0],this.tip},r.setContent=function(){var t=e(this.getTipElement());this.setElementContent(t.find(".popover-header"),this.getTitle());var n=this._getContent();"function"==typeof n&&(n=n.call(this.element)),this.setElementContent(t.find(".popover-body"),n),t.removeClass("fade show")},r._getContent=function(){return this.element.getAttribute("data-content")||this.config.content},r._cleanTipClass=function(){var t=e(this.getTipElement()),n=t.attr("class").match(te);null!==n&&0<n.length&&t.removeClass(n.join(""))},n._jQueryInterface=function(t){return this.each((function(){var r=e(this).data(Yt),o="object"==typeof t?t:null;if((r||!/dispose|hide/.test(t))&&(r||(r=new n(this,o),e(this).data(Yt,r)),"string"==typeof t)){if(void 0===r[t])throw new TypeError('No method named "'+t+'"');r[t]()}}))},o(n,null,[{key:"VERSION",get:function(){return"4.4.1"}},{key:"Default",get:function(){return ee}},{key:"NAME",get:function(){return $t}},{key:"DATA_KEY",get:function(){return Yt}},{key:"Event",get:function(){return re}},{key:"EVENT_KEY",get:function(){return Qt}},{key:"DefaultType",get:function(){return ne}}]),n}(Xt);e.fn[$t]=oe._jQueryInterface,e.fn[$t].Constructor=oe,e.fn[$t].noConflict=function(){return e.fn[$t]=Jt,oe._jQueryInterface};var ie="scrollspy",ae="bs.scrollspy",se="."+ae,ue=e.fn[ie],ce={offset:10,method:"auto",target:""},le={offset:"number",method:"string",target:"(string|element)"},fe={ACTIVATE:"activate"+se,SCROLL:"scroll"+se,LOAD_DATA_API:"load"+se+".data-api"},he="active",de=".nav, .list-group",pe=".nav-link",ve=".list-group-item",me="position",ge=function(){function t(t,n){var r=this;this._element=t,this._scrollElement="BODY"===t.tagName?window:t,this._config=this._getConfig(n),this._selector=this._config.target+" "+pe+","+this._config.target+" "+ve+","+this._config.target+" .dropdown-item",this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,e(this._scrollElement).on(fe.SCROLL,(function(t){return r._process(t)})),this.refresh(),this._process()}var n=t.prototype;return n.refresh=function(){var t=this,n="auto"===this._config.method?this._scrollElement===this._scrollElement.window?"offset":me:this._config.method,r=n===me?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),[].slice.call(document.querySelectorAll(this._selector)).map((function(t){var o,i=u.getSelectorFromElement(t);if(i&&(o=document.querySelector(i)),o){var a=o.getBoundingClientRect();if(a.width||a.height)return[e(o)[n]().top+r,i]}return null})).filter((function(t){return t})).sort((function(t,e){return t[0]-e[0]})).forEach((function(e){t._offsets.push(e[0]),t._targets.push(e[1])}))},n.dispose=function(){e.removeData(this._element,ae),e(this._scrollElement).off(se),this._element=null,this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null},n._getConfig=function(t){if("string"!=typeof(t=a({},ce,{},"object"==typeof t&&t?t:{})).target){var n=e(t.target).attr("id");n||(n=u.getUID(ie),e(t.target).attr("id",n)),t.target="#"+n}return u.typeCheckConfig(ie,t,le),t},n._getScrollTop=function(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop},n._getScrollHeight=function(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},n._getOffsetHeight=function(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height},n._process=function(){var t=this._getScrollTop()+this._config.offset,e=this._getScrollHeight(),n=this._config.offset+e-this._getOffsetHeight();if(this._scrollHeight!==e&&this.refresh(),n<=t){var r=this._targets[this._targets.length-1];this._activeTarget!==r&&this._activate(r)}else{if(this._activeTarget&&t<this._offsets[0]&&0<this._offsets[0])return this._activeTarget=null,void this._clear();for(var o=this._offsets.length;o--;)this._activeTarget!==this._targets[o]&&t>=this._offsets[o]&&(void 0===this._offsets[o+1]||t<this._offsets[o+1])&&this._activate(this._targets[o])}},n._activate=function(t){this._activeTarget=t,this._clear();var n=this._selector.split(",").map((function(e){return e+'[data-target="'+t+'"],'+e+'[href="'+t+'"]'})),r=e([].slice.call(document.querySelectorAll(n.join(","))));r.hasClass("dropdown-item")?(r.closest(".dropdown").find(".dropdown-toggle").addClass(he),r.addClass(he)):(r.addClass(he),r.parents(de).prev(pe+", "+ve).addClass(he),r.parents(de).prev(".nav-item").children(pe).addClass(he)),e(this._scrollElement).trigger(fe.ACTIVATE,{relatedTarget:t})},n._clear=function(){[].slice.call(document.querySelectorAll(this._selector)).filter((function(t){return t.classList.contains(he)})).forEach((function(t){return t.classList.remove(he)}))},t._jQueryInterface=function(n){return this.each((function(){var r=e(this).data(ae);if(r||(r=new t(this,"object"==typeof n&&n),e(this).data(ae,r)),"string"==typeof n){if(void 0===r[n])throw new TypeError('No method named "'+n+'"');r[n]()}}))},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}},{key:"Default",get:function(){return ce}}]),t}();e(window).on(fe.LOAD_DATA_API,(function(){for(var t=[].slice.call(document.querySelectorAll('[data-spy="scroll"]')),n=t.length;n--;){var r=e(t[n]);ge._jQueryInterface.call(r,r.data())}})),e.fn[ie]=ge._jQueryInterface,e.fn[ie].Constructor=ge,e.fn[ie].noConflict=function(){return e.fn[ie]=ue,ge._jQueryInterface};var ye="bs.tab",be="."+ye,xe=e.fn.tab,we={HIDE:"hide"+be,HIDDEN:"hidden"+be,SHOW:"show"+be,SHOWN:"shown"+be,CLICK_DATA_API:"click"+be+".data-api"},_e="active",Ce=".active",Ee="> li > .active",Se=function(){function t(t){this._element=t}var n=t.prototype;return n.show=function(){var t=this;if(!(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&e(this._element).hasClass(_e)||e(this._element).hasClass("disabled"))){var n,r,o=e(this._element).closest(".nav, .list-group")[0],i=u.getSelectorFromElement(this._element);if(o){var a="UL"===o.nodeName||"OL"===o.nodeName?Ee:Ce;r=(r=e.makeArray(e(o).find(a)))[r.length-1]}var s=e.Event(we.HIDE,{relatedTarget:this._element}),c=e.Event(we.SHOW,{relatedTarget:r});if(r&&e(r).trigger(s),e(this._element).trigger(c),!c.isDefaultPrevented()&&!s.isDefaultPrevented()){i&&(n=document.querySelector(i)),this._activate(this._element,o);var l=function(){var n=e.Event(we.HIDDEN,{relatedTarget:t._element}),o=e.Event(we.SHOWN,{relatedTarget:r});e(r).trigger(n),e(t._element).trigger(o)};n?this._activate(n,n.parentNode,l):l()}}},n.dispose=function(){e.removeData(this._element,ye),this._element=null},n._activate=function(t,n,r){function o(){return i._transitionComplete(t,a,r)}var i=this,a=(!n||"UL"!==n.nodeName&&"OL"!==n.nodeName?e(n).children(Ce):e(n).find(Ee))[0],s=r&&a&&e(a).hasClass("fade");if(a&&s){var c=u.getTransitionDurationFromElement(a);e(a).removeClass("show").one(u.TRANSITION_END,o).emulateTransitionEnd(c)}else o()},n._transitionComplete=function(t,n,r){if(n){e(n).removeClass(_e);var o=e(n.parentNode).find("> .dropdown-menu .active")[0];o&&e(o).removeClass(_e),"tab"===n.getAttribute("role")&&n.setAttribute("aria-selected",!1)}if(e(t).addClass(_e),"tab"===t.getAttribute("role")&&t.setAttribute("aria-selected",!0),u.reflow(t),t.classList.contains("fade")&&t.classList.add("show"),t.parentNode&&e(t.parentNode).hasClass("dropdown-menu")){var i=e(t).closest(".dropdown")[0];if(i){var a=[].slice.call(i.querySelectorAll(".dropdown-toggle"));e(a).addClass(_e)}t.setAttribute("aria-expanded",!0)}r&&r()},t._jQueryInterface=function(n){return this.each((function(){var r=e(this),o=r.data(ye);if(o||(o=new t(this),r.data(ye,o)),"string"==typeof n){if(void 0===o[n])throw new TypeError('No method named "'+n+'"');o[n]()}}))},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}}]),t}();e(document).on(we.CLICK_DATA_API,'[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]',(function(t){t.preventDefault(),Se._jQueryInterface.call(e(this),"show")})),e.fn.tab=Se._jQueryInterface,e.fn.tab.Constructor=Se,e.fn.tab.noConflict=function(){return e.fn.tab=xe,Se._jQueryInterface};var Ie="toast",Te="bs.toast",ke="."+Te,De=e.fn[Ie],Ae={CLICK_DISMISS:"click.dismiss"+ke,HIDE:"hide"+ke,HIDDEN:"hidden"+ke,SHOW:"show"+ke,SHOWN:"shown"+ke},Re="show",Ne="showing",Fe={animation:"boolean",autohide:"boolean",delay:"number"},Oe={animation:!0,autohide:!0,delay:500},Me=function(){function t(t,e){this._element=t,this._config=this._getConfig(e),this._timeout=null,this._setListeners()}var n=t.prototype;return n.show=function(){var t=this,n=e.Event(Ae.SHOW);if(e(this._element).trigger(n),!n.isDefaultPrevented()){this._config.animation&&this._element.classList.add("fade");var r=function(){t._element.classList.remove(Ne),t._element.classList.add(Re),e(t._element).trigger(Ae.SHOWN),t._config.autohide&&(t._timeout=setTimeout((function(){t.hide()}),t._config.delay))};if(this._element.classList.remove("hide"),u.reflow(this._element),this._element.classList.add(Ne),this._config.animation){var o=u.getTransitionDurationFromElement(this._element);e(this._element).one(u.TRANSITION_END,r).emulateTransitionEnd(o)}else r()}},n.hide=function(){if(this._element.classList.contains(Re)){var t=e.Event(Ae.HIDE);e(this._element).trigger(t),t.isDefaultPrevented()||this._close()}},n.dispose=function(){clearTimeout(this._timeout),this._timeout=null,this._element.classList.contains(Re)&&this._element.classList.remove(Re),e(this._element).off(Ae.CLICK_DISMISS),e.removeData(this._element,Te),this._element=null,this._config=null},n._getConfig=function(t){return t=a({},Oe,{},e(this._element).data(),{},"object"==typeof t&&t?t:{}),u.typeCheckConfig(Ie,t,this.constructor.DefaultType),t},n._setListeners=function(){var t=this;e(this._element).on(Ae.CLICK_DISMISS,'[data-dismiss="toast"]',(function(){return t.hide()}))},n._close=function(){function t(){n._element.classList.add("hide"),e(n._element).trigger(Ae.HIDDEN)}var n=this;if(this._element.classList.remove(Re),this._config.animation){var r=u.getTransitionDurationFromElement(this._element);e(this._element).one(u.TRANSITION_END,t).emulateTransitionEnd(r)}else t()},t._jQueryInterface=function(n){return this.each((function(){var r=e(this),o=r.data(Te);if(o||(o=new t(this,"object"==typeof n&&n),r.data(Te,o)),"string"==typeof n){if(void 0===o[n])throw new TypeError('No method named "'+n+'"');o[n](this)}}))},o(t,null,[{key:"VERSION",get:function(){return"4.4.1"}},{key:"DefaultType",get:function(){return Fe}},{key:"Default",get:function(){return Oe}}]),t}();e.fn[Ie]=Me._jQueryInterface,e.fn[Ie].Constructor=Me,e.fn[Ie].noConflict=function(){return e.fn[Ie]=De,Me._jQueryInterface},t.Alert=p,t.Button=S,t.Carousel=W,t.Collapse=J,t.Dropdown=dt,t.Modal=Tt,t.Popover=oe,t.Scrollspy=ge,t.Tab=Se,t.Toast=Me,t.Tooltip=Xt,t.Util=u,Object.defineProperty(t,"__esModule",{value:!0})})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).faceapi=t.faceapi||{})}(this,(function(t){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function r(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function o(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var i=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.get=function(t){return t in this.flags||(this.flags[t]=this.evaluateFlag(t)),this.flags[t]},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e,n=(e={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return a(e,n[0],n[1]),n.join("=")})),e);"tfjsflags"in n&&n.tfjsflags.split(",").forEach((function(e){var n=e.split(":"),r=n[0];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,n[1])}))}},t}();function a(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function s(){return u}var u=null,c=new Map,l=new Map;function f(t,e){var n=m(t,e);return c.get(n)}function h(t){return l.get(t)}function d(t){for(var e=c.entries(),n=[];;){var r=e.next(),o=r.value;if(r.done)break;var i=o[1];o[0].split("_")[0]===t&&n.push(i)}return n}function p(t){var e=t.kernelName,n=t.backendName,r=m(e,n);if(c.has(r))throw new Error("The kernel '"+e+"' for backend '"+n+"' is already registered");c.set(r,t)}function v(t){var e=t.kernelName;l.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),l.set(e,t)}function m(t,e){return e+"_"+t}function g(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function y(t,e,n){return Math.max(t,Math.min(e,n))}function b(t){return t%2==0?t:t+1}function x(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function w(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function _(t,e,n){void 0===n&&(n=""),w(I(t,e),(function(){return n+" Shapes "+t+" and "+e+" must match"}))}function C(t){w(null!=t,(function(){return"The input to the tensor constructor must be a non-null value."}))}function E(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||z(t)&&!n)for(var r=0;r<t.length;++r)E(t[r],e,n);else e.push(t);return e}function S(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function I(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function T(t){return t%1==0}function k(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function D(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function A(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function R(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise((function(r,o){var i=0,a=function(){if(t())r();else{i++;var s=e(i);null!=n&&i>=n?o():setTimeout(a,s)}};a()}))}function N(t,e){for(var n=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var i=t.slice();return i[r]=e/n,i}function F(t,e){var n=e.length;return w((t=null==t?e.map((function(t,e){return e})):[].concat(t)).every((function(t){return t>=-n&&t<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t})),w(t.every((function(t){return T(t)})),(function(){return"All values in axis param must be integers but got axis "+t})),t.map((function(t){return t<0?n+t:t}))}function O(t,e){for(var n=[],r=[],o=null!=e&&Array.isArray(e)&&0===e.length,i=null==e||o?null:F(e,t).sort(),a=0,s=0;s<t.length;++s){if(null!=i){if(i[a]===s&&1!==t[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(null==i[a]||i[a]>s)&&1===t[s]&&(n.push(t[s]),r.push(s)),i[a]<=s&&a++}1!==t[s]&&(n.push(t[s]),r.push(s))}return{newShape:n,keptDims:r}}function M(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function P(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function L(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function B(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function W(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function z(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function U(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function j(t){if(null==t)return 0;var e=0;return t.forEach((function(t){return e+=t.length})),e}function H(t){return"string"==typeof t||t instanceof String}function V(t){return"boolean"==typeof t}function q(t){return"number"==typeof t}function G(t){return Array.isArray(t)?G(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":q(t)?"float32":H(t)?"string":V(t)?"bool":"float32"}function K(t){return!!(t&&t.constructor&&t.call&&t.apply)}function X(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function $(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function Y(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=E(t)),n&&L(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function Q(t,e){if(0===t.length)return e[0];var n=t.reduce((function(t,e){return t*e}));if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var o=new Array;if(1===n.length)for(var i=n[0],a=0;a<i;a++)o[a]=r[e+a];else{i=n[0];var s=n.slice(1),u=s.reduce((function(t,e){return t*e}));for(a=0;a<i;a++)o[a]=t(e+a*u,s,r)}return o}(0,t,e)}function J(t,e){for(var n=Z(t,e),r=0;r<n.length;r++)n[r]=1;return n}function Z(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function tt(){return s().platform.now()}function et(t){t.forEach((function(e){w(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."}))}))}function nt(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",s().platform.encode(t,e)}function rt(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",s().platform.decode(t,e)}var ot=Object.freeze({shuffle:g,clamp:y,nearestLargerEven:b,sum:x,randUniform:function(t,e){var n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(e[r]);n+=o*o}return n},assert:w,assertShapesMatch:_,assertNonNull:C,flatten:E,sizeFromShape:S,isScalarShape:function(t){return 0===t.length},arraysEqual:I,isInt:T,tanh:k,sizeToSquarishShape:D,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return g(e),e},rightPad:A,repeatedTry:R,inferFromImplicitShape:N,parseAxisParam:F,squeezeShape:O,getTypedArrayFromDType:M,getArrayFromDType:P,checkConversionForErrors:L,isValidDtype:B,hasEncodingLoss:W,isTypedArray:z,bytesPerElement:U,bytesFromStringArray:j,isString:H,isBoolean:V,isNumber:q,inferDtype:G,isFunction:K,nearestDivisor:X,computeStrides:$,toTypedArray:Y,toNestedArray:Q,makeOnesTypedArray:J,makeZerosTypedArray:Z,now:tt,assertNonNegativeIntegerDimensions:et,fetch:function(t,e){return s().platform.fetch(t,e)},encodeString:nt,decodeString:rt}),it=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new at)}return t.prototype.profileKernel=function(t,e,n){var r,o=this,i=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(t,e,n){if("float32"!==e)return!1;for(var r=0;r<t.length;r++){var o=t[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,t),i.then((function(i){var a="";null!=i.getExtraProfileInfo&&(a=i.getExtraProfileInfo()),o.logger.logKernelProfile(t,n,r,i.kernelMs,e,a)}))}))})),r},t}(),at=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,o,i){var a=A(r+"ms",9),s=A(t,25),u=e.rank,c=e.size,l=A(e.shape.toString(),14),f="";for(var h in o){var d=o[h].shape||e.shape,p=d.length;f+=h+": "+p+"D "+(p>0?d:"")+" "}console.log("%c"+s+"\t%c"+a+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+f+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}();function st(t,e,n){return A(Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":H(t)?"'"+t+"'":"bool"===n?ut(t):parseFloat(t.toFixed(7)).toString(),e)}function ut(t){return 0===t?"false":"true"}function ct(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var lt=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=S(t),null!=n){var o=n.length;w(o===this.size,(function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||P(e,this.size),this.strides=$(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),w(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"}));var o=this.locToIndex(n);this.values[o]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=0,r=0,o=t;r<o.length;r++){var i=o[r];if(i<0||i>=this.shape[n]){var a="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(a)}n++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return ft().makeTensor(this.values,this.shape,this.dtype)},t}(),ft=null,ht=null,dt=null,pt=function(){function t(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=S(t),this.strides=$(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),w(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,o){return this.throwIfDisposed(),this.reshape([t,e,n,r,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),ht.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,ht.buffer(this.shape,this.dtype,t)]}}))}))},t.prototype.bufferSync=function(){return ht.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Q(this.shape,t)]}}))}))},t.prototype.arraySync=function(){return Q(this.shape,this.dataSync())},t.prototype.data=function(){return r(this,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=ft().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map((function(t){return rt(t)}))]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}}))}))},t.prototype.dataSync=function(){this.throwIfDisposed();var t=ft().readSync(this.dataId);if("string"===this.dtype)try{return t.map((function(t){return rt(t)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,ft().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}}))}))},t.prototype.dispose=function(){this.isDisposed||(ft().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),ht.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),ht.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),ht.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),ht.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),ht.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),ht.clone(this)},t.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),ht.oneHot(this,t,e,n)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var o=$(e),i=function(t,e,n,r){var o=S(e),i=r[r.length-1],a=new Array(i).fill(0),s=e.length,u="complex64"===n?ct(t):t;if(s>1)for(var c=0;c<o/i;c++)for(var l=c*i,f=0;f<i;f++)a[f]=Math.max(a[f],st(u[l+f],0,n).length);return a}(t,e,n,o),a=e.length,s=function t(e,n,r,o,i,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[st(ct(e)[0],0,r)]:"bool"===r?[ut(e[0])]:[e[0].toString()];if(1===c){if(u>20){var l=Array.from(e.slice(0,3*s)),f=Array.from(e.slice((u-3)*s,u*s));return"complex64"===r&&(l=ct(l),f=ct(f)),["["+l.map((function(t,e){return st(t,i[e],r)})).join(", ")+", ..., "+f.map((function(t,e){return st(t,i[u-3+e],r)})).join(", ")+"]"]}return["["+("complex64"===r?ct(e):Array.from(e)).map((function(t,e){return st(t,i[e],r)})).join(", ")+"]"]}var h=n.slice(1),d=o.slice(1),p=o[0]*s,v=[];if(u>20){for(var m=0;m<3;m++){var g=(y=m*p)+p;v.push.apply(v,t(e.slice(y,g),h,r,d,i,!1))}for(v.push("..."),m=u-3;m<u;m++)g=(y=m*p)+p,v.push.apply(v,t(e.slice(y,g),h,r,d,i,m===u-1))}else for(m=0;m<u;m++){var y;g=(y=m*p)+p,v.push.apply(v,t(e.slice(y,g),h,r,d,i,m===u-1))}var b=2===c?",":"";for(v[0]="["+v[0]+b,m=1;m<v.length-1;m++)v[m]=" "+v[m]+b;var x=",\n";for(m=2;m<c;m++)x+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(a?"":x),v}(t,e,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map((function(t){return"    "+t})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),ht.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),ht.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),ht.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),ht.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),ht.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),ht.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),ht.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),ht.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),ht.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),ht.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),ht.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),ht.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,o){return void 0===n&&(n=.001),dt("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,r,n)},t.prototype.batchNorm=function(t,e,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),ht.batchNorm(this,t,e,n,r,o)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),ht.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),ht.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),ht.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),ht.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),ht.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),ht.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),ht.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),ht.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),ht.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),ht.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),ht.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),ht.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),ht.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),ht.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),ht.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),ht.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),ht.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),ht.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),ht.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),ht.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),ht.div(this,t)},t.prototype.divNoNan=function(t){return this.throwIfDisposed(),ht.divNoNan(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),ht.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),ht.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),ht.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),ht.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),ht.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),ht.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),ht.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),ht.modStrict(this,t)},t.prototype.squaredDifference=function(t){return this.throwIfDisposed(),ht.squaredDifference(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),ht.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),ht.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),ht.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),ht.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),ht.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),ht.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),ht.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),ht.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),ht.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),ht.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),ht.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),ht.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),ht.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),ht.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),ht.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),ht.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),ht.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),ht.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),ht.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),ht.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),ht.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),ht.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),ht.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),ht.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),ht.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),ht.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),ht.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),ht.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),ht.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),ht.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),ht.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),ht.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),ht.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),ht.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),ht.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),ht.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),ht.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),ht.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),ht.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),ht.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),ht.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),ht.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),ht.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),ht.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),ht.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),ht.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),ht.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),ht.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),ht.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),ht.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),ht.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),ht.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),ht.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),ht.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),ht.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),ht.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),ht.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),ht.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),ht.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),ht.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),ht.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),ht.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),ht.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),ht.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),ht.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),ht.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,o,i){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),ht.conv1d(this,t,e,n,r,o,i)},t.prototype.conv2d=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ht.conv2d(this,t,e,n,r,o,i)},t.prototype.conv2dTranspose=function(t,e,n,r,o){return this.throwIfDisposed(),ht.conv2dTranspose(this,t,e,n,r,o)},t.prototype.depthwiseConv2D=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ht.depthwiseConv2d(this,t,e,n,r,o,i)},t.prototype.separableConv2d=function(t,e,n,r,o,i){return void 0===o&&(o=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),ht.separableConv2d(this,t,e,n,r,o,i)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),ht.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),ht.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),ht.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,o){return this.throwIfDisposed(),ht.pool(this,t,e,n,r,o)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),ft().makeVariable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),ht.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),ht.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),ht.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),ht.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),this.throwIfDisposed(),ht.stridedSlice(this,t,e,n,r,o,i,a,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),ht.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),ht.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),ht.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),ht.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),ht.spectral.irfft(this)},t}();Object.defineProperty(pt,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var vt,mt,gt,yt,bt,xt=function(t){function e(e,n,r,o){var i=t.call(this,e.shape,e.dtype,e.dataId,o)||this;return i.trainable=n,i.name=r,i}return n(e,t),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!I(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");ft().disposeTensor(this),this.dataId=t.dataId,ft().incRef(this,null)},e.prototype.dispose=function(){ft().disposeVariable(this),this.isDisposedInternal=!0},e}(pt);Object.defineProperty(xt,Symbol.hasInstance,{value:function(t){return t instanceof pt&&null!=t.assign&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(vt||(vt={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(mt||(mt={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(gt||(gt={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(yt||(yt={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(bt||(bt={}));var wt={float32:yt,int32:mt,bool:gt,complex64:bt};function _t(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return wt[t][e]}function Ct(t){return _t(t,"int32")}function Et(t,e){if(t.dtype===e.dtype)return[t,e];var n=_t(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function St(t,e){w(t.dtype===e.dtype,(function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"}))}function It(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof pt)n.push(e);else if(o=e,Array.isArray(o)||"object"==typeof o){var o,i=e;for(var a in i){var s=i[a];r.has(s)||(r.add(s),t(s,n,r))}}}(t,e,new Set),e}var Tt,kt=Object.freeze({makeTypesMatch:Et,assertTypesMatch:St,isTensorInList:function(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t.id)return!0;return!1},getTensorsInContainer:It}),Dt=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),At=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Dt}return t.prototype.ready=function(){return r(this,void 0,void 0,(function(){var t,e,n;return o(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?[4,this.initializeBackend(n=t[e]).success]:[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return r(this,void 0,void 0,(function(){var e,n,r;return o(this,(function(o){switch(o.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new it(this.backendInstance),[2,!0]}}))}))},t.prototype.setupRegisteredKernels=function(){var t=this;d(this.backendName).forEach((function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)}))},t.prototype.disposeRegisteredKernels=function(t){var e=this;d(t).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(e.registry[t])}))},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,i=r.then((function(n){return!(o<e.pendingBackendInitId||(e.registry[t]=n,e.pendingBackendInit=null,0))})).catch((function(n){return!(o<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(e){return console.warn("Initialization of backend "+t+" failed"),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority}))},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),o=r.asyncInit;if(o||r.success)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),r=n.backend,o=this.readSync(e);r.disposeData(e),n.backend=t,t.move(e,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var n,r=this,o=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun((function(){return r.startScope(o)}),(function(){return r.endScope(n)}),(function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype);return this.addTapeNode(this.state.activeScope.name,{x:t},[e],(function(t){return{x:function(){return t.toFloat()}}}),[]),e},t.prototype.runKernel=function(t,e,n,r,o){return this.runKernelFunc(null,e,null,t,n,r,o)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,n){var r=this.backend.numDataIds(),o=0;n.forEach((function(t){o+="complex64"===t.dtype?3:1}));var i=r-e-o-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t,e,n,r,o,i,a){var s,u=this;void 0===i&&(i=[]),void 0===a&&(a=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,d=function(t){l&&(c=t.map((function(t){return u.keep(u.clone(t))})))},p=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=f(r,this.backendName);return h=null!=g?function(){var t=u.backend.numDataIds();m=g.kernelFunc({inputs:e,attrs:o,backend:u.backend});var n=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n);var s=n.map((function(t){return u.makeTensorFromDataId(t.dataId,t.shape,t.dtype)})),c=s.filter((function(t,e){return a[e]}));return d((i||[]).slice().concat(c)),s}:function(){var e=u.backend.numDataIds();m=u.tidy((function(){return t(u.backend,d)}));var n=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n),n},this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,e,(function(){return h()})):h()})),l&&this.addTapeNode(r,e,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map((function(t){return e[t].shape})),outputShapes:s.map((function(t){return t.shape}))}),Array.isArray(m)?s:s[0]},t.prototype.makeTensor=function(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;var o=t;"string"===(n=n||"float32")&&H(t[0])&&(o=t.map((function(t){return nt(t)})));var i=r.write(o,e,n),a=new pt(e,n,i,this.nextTensorId());if(this.incRef(a,r),"string"===n){var s=this.state.tensorInfo.get(i),u=j(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return a},t.prototype.makeTensorFromDataId=function(t,e,n,r){var o=new pt(e,n=n||"float32",t,this.nextTensorId());return this.incRef(o,r),o},t.prototype.makeVariable=function(t,e,n,r){void 0===e&&(e=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.asType(r));var o=new xt(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},t.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=t.size*U(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof xt||this.track(t)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[t])},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(t){return t.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n,r,o){var i=this,a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:o},s=h(t);null!=s&&(r=s.gradFunc),null!=r&&(a.gradient=function(t){return t=t.map((function(t,e){if(null==t){var r=n[e],o=Z(r.size,r.dtype);return i.makeTensor(o,r.shape,r.dtype)}return t})),r(t.length>1?t:t[0],o)}),this.state.activeTape.push(a)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=It(t),r=new Set(n.map((function(t){return t.id}))),o=0;o<this.state.activeScope.track.length;o++){var i=this.state.activeScope.track[o];i.kept||r.has(i.id)||i.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(t){t.kept||t.scopeId!==a.id||e.track(t)}))},t.prototype.gradients=function(t,e,n,r){var o=this;if(void 0===r&&(r=!1),w(e.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun((function(){return o.startTape()}),(function(){return o.endTape()}),(function(){return o.tidy("forward",t)}));w(i instanceof pt,(function(){return"The result y returned by f() must be a tensor."}));var a=function(t,e,n){for(var r={},o={},i=0;i<e.length;i++)r[e[i].id]=!0;for(i=0;i<t.length;i++){var a=(p=t[i]).inputs;for(var s in a){for(var u=a[s],c=!1,l=0;l<e.length;l++)if(r[u.id]){p.outputs.forEach((function(t){return r[t.id]=!0})),c=!0,o[p.id]=!0;break}if(c)break}}var f={};f[n.id]=!0;var h={};for(i=t.length-1;i>=0;i--)for(a=(p=t[i]).inputs,l=0;l<p.outputs.length;l++)if(f[p.outputs[l].id]){for(var s in a)f[a[s].id]=!0,h[p.id]=!0;break}var d=[];for(i=0;i<t.length;i++){var p;if(o[(p=t[i]).id]&&h[p.id]){var v={};for(var s in p.inputs){var m=p.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},p);g.inputs=v,g.outputs=p.outputs,d.push(g)}}return d}(this.state.activeTape,e,i);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var t,r,s={};s[i.id]=null==n?(r=J(S(t=i.shape),"float32"),Rt.makeTensor(r,t,"float32")):n,function(t,e,n){for(var r=function(r){var o=e[r],i=[];if(o.outputs.forEach((function(e){var n=t[e.id];i.push(null!=n?n:null)})),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var a=o.gradient(i),s=function(e){if(!(e in a))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(a)+".");var r=n((function(){return a[e]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+e+" must have 'float32' dtype, but has '"+r.dtype+"'");var i=o.inputs[e];if(!I(r.shape,i.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+e+"' has shape '"+r.shape+"', which does not match the shape of the input '"+i.shape+"'");if(null==t[i.id])t[i.id]=r;else{var s=t[i.id];t[i.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=e.length-1;o>=0;o--)r(o)}(s,a,(function(t){return o.tidy(t)}));var u=e.map((function(t){return s[t.id]}));return 0===o.state.gradientDepth&&(o.state.activeTape.forEach((function(t){for(var e=0,n=t.saved;e<n.length;e++)n[e].dispose()})),o.state.activeTape=null),{value:i,grads:u}}))},t.prototype.customGrad=function(t){var e=this;return w(K(t),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];w(r.every((function(t){return t instanceof pt})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i={};return r.forEach((function(t,e){i[e]=t})),e.runKernelFunc((function(e,o){return w((n=t.apply(void 0,r.concat([o]))).value instanceof pt,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),w(K(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),i,(function(t,e){var o=n.gradFunc(t,e),i=Array.isArray(o)?o:[o];w(i.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),w(i.every((function(t){return t instanceof pt})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var a={};return i.forEach((function(t,e){a[e]=function(){return t}})),a}))}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.time=function(t){return r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return e=tt(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=tt()-e,[2,n]}}))}))},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Dt,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),Rt=function(){var t=function(){if(null==Tt){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Tt=t}return Tt}();if(null==t._tfengine){var e=new i(t);t._tfengine=new At(e)}return function(t){u=t}(t._tfengine.ENV),ft=function(){return t._tfengine},t._tfengine}();function Nt(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Ft=s();Ft.registerFlag("DEBUG",(function(){return!1}),(function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ft.registerFlag("IS_BROWSER",(function(){return Nt()})),Ft.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),Ft.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ft.registerFlag("PROD",(function(){return!1})),Ft.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ft.getBool("DEBUG")})),Ft.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ft.registerFlag("IS_TEST",(function(){return!1}));var Ot,Mt,Pt,Lt={},Bt={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Wt(t,e){Lt[t]=e}function zt(t){t in Lt||(Lt[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return e.addEventListener("webglcontextlost",(function(e){e.preventDefault(),delete Lt[t]}),!1),1===t?e.getContext("webgl",Bt)||e.getContext("experimental-webgl",Bt):e.getContext("webgl2",Bt)}(t));var e=Lt[t];return e.isContextLost()?(delete Lt[t],zt(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Lt[t])}function Ut(t,e){return[e,t]}function jt(t){var e=S(t);return D(Math.ceil(e/4))}function Ht(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Vt(t,e){var n,r,o,i,a,u,c,l,f,h=t;return 2===s().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,o=h.RGBA16F,i=h.RGBA32F,a=h.RED,u=4,c=1,l=h.HALF_FLOAT,f=h.FLOAT):(n=t.RGBA,r=t.RGBA,o=t.RGBA,i=h.RGBA,a=t.RGBA,u=4,c=4,l=null!=e?e.HALF_FLOAT_OES:null,f=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:f}}function qt(t,e,n){var r=n();return e&&function(t){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Kt(t,e))}(t),r}function Gt(t){return!!(s().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function Kt(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Xt(t,e,n){return ge(t,e,(function(){return t.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function $t(t,e,n){var r=ge(t,e,(function(){return t.createShader(t.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(qt(t,e,(function(){return t.shaderSource(r,n)})),qt(t,e,(function(){return t.compileShader(r)})),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Yt(t,e,n){var r=ge(t,e,(function(){return t.createShader(t.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(qt(t,e,(function(){return t.shaderSource(r,n)})),qt(t,e,(function(){return t.compileShader(r)})),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(t,e){var n=Zt.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],o=t.split("\n"),i=o.length.toString().length+2,a=o.map((function(t,e){return A((e+1).toString(),i)+t})),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var c=a.slice(0,r-1),l=a.slice(r-1,r),f=a.slice(r);console.log(c.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+A(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(Ot||(Ot={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Mt||(Mt={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Pt||(Pt={}));var Qt,Jt,Zt=/ERROR: [0-9]+:([0-9]+):/g;function te(t,e){return ge(t,e,(function(){return t.createProgram()}),"Unable to create WebGLProgram.")}function ee(t,e,n){if(qt(t,e,(function(){return t.linkProgram(n)})),!1===t.getProgramParameter(n,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function ne(t,e,n){if(qt(t,e,(function(){return t.validateProgram(n)})),!1===t.getProgramParameter(n,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function re(t,e,n){var r=ge(t,e,(function(){return t.createBuffer()}),"Unable to create WebGLBuffer");return qt(t,e,(function(){return t.bindBuffer(t.ARRAY_BUFFER,r)})),qt(t,e,(function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)})),r}function oe(t,e,n){var r=ge(t,e,(function(){return t.createBuffer()}),"Unable to create WebGLBuffer");return qt(t,e,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)})),qt(t,e,(function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)})),r}function ie(t,e){return ge(t,e,(function(){return t.createTexture()}),"Unable to create WebGLTexture.")}function ae(t,e){var n=s().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function se(t,e){return ge(t,e,(function(){return t.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function ue(t,e,n,r,o,i,a,s){var u=t.getAttribLocation(n,r);return-1!==u&&(qt(t,e,(function(){return t.bindBuffer(t.ARRAY_BUFFER,o)})),qt(t,e,(function(){return t.vertexAttribPointer(u,i,t.FLOAT,!1,a,s)})),qt(t,e,(function(){return t.enableVertexAttribArray(u)})),!0)}function ce(t,e,n,r){ye(t,r),qt(t,e,(function(){return t.activeTexture(t.TEXTURE0+r)})),qt(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,n)}))}function le(t,e,n,r){return ge(t,e,(function(){return t.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function fe(t,e,n){return t.getUniformLocation(e,n)}function he(t,e,n,r,o,i){qt(t,e,(function(){return ce(t,e,r,i)})),qt(t,e,(function(){return t.uniform1i(o,i)}))}function de(t,e,n,r){qt(t,e,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)})),qt(t,e,(function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}))}function pe(t,e,n){qt(t,e,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)})),qt(t,e,(function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}))}function ve(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+me(t,e))}function me(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function ge(t,e,n,r){var o=qt(t,e,(function(){return n()}));if(null==o)throw new Error(r);return o}function ye(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function be(t,e){return void 0===e&&(e=2),S(t.slice(0,t.length-e))}function xe(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function we(t){var e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[be(t)].concat(xe(t))),e}function _e(t,e){var n;void 0===e&&(e=!1);var r=s().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(t=t.map((function(e,n){return n>=t.length-2?b(t[n]):t[n]}))).length&&(t=[2,t[0]])),2!==t.length){var o=O(t);t=o.newShape}var i=S(t);if(t.length<=1&&i<=r)return[1,i];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var a=be(t),u=2,c=2;return t.length&&(u=(n=xe(t))[0],c=n[1]),D(i=a*(u/2)*(c/2)).map((function(t){return 2*t}))}return D(i)}function Ce(t){return t%2==0}function Ee(t,e){if(I(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(Ce(n)&&Ce(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&Ce(t[0])&&Ce(e[0])}function Se(t){if(null==Qt){var e=zt(t);Qt=e.getParameter(e.MAX_TEXTURE_SIZE)}return Qt}function Ie(t){if(null==Jt){var e=zt(t);Jt=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Jt)}function Te(t){if(0===t)return 0;var e=zt(t);return ke(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:ke(e,"EXT_disjoint_timer_query")?1:0}function ke(t,e){return null!=t.getExtension(e)}function De(t){try{if(null!=zt(t))return!0}catch(t){return!1}return!1}function Ae(t){if(0===t)return!1;var e=zt(t);if(1===t){if(!ke(e,"OES_texture_float"))return!1}else if(!ke(e,"EXT_color_buffer_float"))return!1;return Ne(e)}function Re(t){if(0===t)return!1;var e=zt(t);if(1!==t){if(ke(e,"EXT_color_buffer_float"))return Ne(e);if(ke(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(t,e){var n=Vt(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),i}(e,n)}return!1}return!!ke(e,"OES_texture_float")&&!!ke(e,"WEBGL_color_buffer_float")&&Ne(e)}function Ne(t){var e=Vt(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),o}function Fe(t){return 2===t&&null!=zt(t).fenceSync}var Oe=Object.freeze({callAndCheck:qt,canBeRepresented:Gt,getWebGLErrorMessage:Kt,getExtensionOrThrow:Xt,createVertexShader:$t,createFragmentShader:Yt,createProgram:te,linkProgram:ee,validateProgram:ne,createStaticVertexBuffer:re,createStaticIndexBuffer:oe,getNumChannels:function(){return 2===s().getNumber("WEBGL_VERSION")?1:4},createTexture:ie,validateTextureSize:ae,createFramebuffer:se,bindVertexBufferToProgramAttribute:ue,bindTextureUnit:ce,unbindTextureUnit:function(t,e,n){ye(t,n),qt(t,e,(function(){return t.activeTexture(t.TEXTURE0+n)})),qt(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:le,getProgramUniformLocation:fe,bindTextureToProgramUniformSampler:he,bindCanvasToFramebuffer:function(t,e){qt(t,e,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),qt(t,e,(function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)})),qt(t,e,(function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)}))},bindColorTextureToFramebuffer:de,unbindColorTextureFromFramebuffer:pe,validateFramebuffer:ve,getFramebufferErrorMessage:me,getBatchDim:be,getRowsCols:xe,getShapeAs3D:we,getTextureShapeFromLogicalShape:_e,isReshapeFree:Ee,getWebGLMaxTextureSize:Se,resetMaxTextureSize:function(){Qt=null},resetMaxTexturesInShader:function(){Jt=null},getMaxTexturesInShader:Ie,getWebGLDisjointQueryTimerVersion:Te,hasExtension:ke,isWebGLVersionEnabled:De,isCapableOfRenderingToFloatTexture:Ae,isDownloadFloatTextureEnabled:Re,isWebGLFenceEnabled:Fe}),Me=s();function Pe(t){s().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Le(t,e){return Rt.tidy(t,e)}function Be(t){It(t).forEach((function(t){return t.dispose()}))}function We(t){return Rt.keep(t)}function ze(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];s().getBool("IS_TEST")||console.warn.apply(console,t)}function Ue(t,e){var n=t;if(z(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||z(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&s().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],Array.isArray(e)||z(e)){w(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"})),w(e.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"}));for(var o=n.slice(1),i=0;i<e.length;++i)t(e[i],o,r.concat(i))}else w(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(t,r,[]),r}function je(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function He(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof pt)return je(r,t.dtype,e,n),t;var o=G(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),je(r,o,e,n),null==t||!z(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+(null==t?"null":t.constructor.name)+"'");var i=Ue(t,o);z(t)||Array.isArray(t)||(t=[t]);var a="string"!==o?Y(t,o,s().getBool("DEBUG")):E(t,[],!0);return Rt.makeTensor(a,i,o)}function Ve(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map((function(t,r){return He(t,e+"["+r+"]",n)}),r)}function qe(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Ge(t,e,n){for(var r=t.length+e.length,o=[],i=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(t[i++]):o.push(e[a++]);return o}function Ke(t,e){for(var n=[],r=t.length,o=0;o<r;o++)-1===e.indexOf(o)&&n.push(t[o]);return[n,e.map((function(e){return t[e]}))]}function Xe(t,e){return Ge(t,e.map((function(t){return 1})),e)}function $e(t,e,n){w(qe(e,n),(function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."}))}function Ye(t,e){if(qe(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((function(t){return n.push(t)})),n}function Qe(t){return t.map((function(t,e){return[e,t]})).sort((function(t,e){return t[1]-e[1]})).map((function(t){return t[0]}))}function Je(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function Ze(t,e){var n=t[0].length;t.forEach((function(t,e){w(t.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")"}))})),w(e>=0&&e<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=t[0];t.forEach((function(t,o){for(var i=0;i<n;i++)w(i===e||t[i]===r[i],(function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."}))}))}function tn(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function en(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Rt.startScope(n);try{var o=r.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Rt.endScope(o),o}catch(t){throw Rt.endScope(null),t}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Me.registerFlag("HAS_WEBGL",(function(){return Me.getNumber("WEBGL_VERSION")>0})),Me.registerFlag("WEBGL_VERSION",(function(){return De(2)?2:De(1)?1:0})),Me.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Me.get("WEBGL_VERSION")})),Me.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Me.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Me.registerFlag("WEBGL_PACK",(function(){return Me.getBool("HAS_WEBGL")})),Me.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Me.getBool("WEBGL_PACK")})),Me.registerFlag("WEBGL_PACK_CLIP",(function(){return Me.getBool("WEBGL_PACK")})),Me.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Me.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Me.getBool("WEBGL_PACK")})),Me.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Me.getBool("WEBGL_PACK")})),Me.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Me.getBool("WEBGL_PACK")})),Me.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Me.getBool("WEBGL_PACK")})),Me.registerFlag("WEBGL_PACK_REDUCE",(function(){return Me.getBool("WEBGL_PACK")})),Me.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Me.getBool("WEBGL_PACK")})),Me.registerFlag("WEBGL_CONV_IM2COL",(function(){return Me.getBool("WEBGL_PACK")})),Me.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Se(Me.getNumber("WEBGL_VERSION"))})),Me.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Ie(Me.getNumber("WEBGL_VERSION"))})),Me.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var t=Me.getNumber("WEBGL_VERSION");return 0===t?0:Te(t)})),Me.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Me.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t})),Me.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Ae(Me.getNumber("WEBGL_VERSION"))})),Me.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Me.getBool("WEBGL_FORCE_F16_TEXTURES")&&Me.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Me.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Re(Me.getNumber("WEBGL_VERSION"))})),Me.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Fe(Me.getNumber("WEBGL_VERSION"))})),Me.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Me.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),dt=Pe;var nn=en({complex_:function(t,e){var n=He(t,"real","complex"),r=He(e,"imag","complex");return _(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Rt.runKernelFunc((function(t){return t.complex(n,r)}),{$real:n,$imag:r})}}),rn=en({real_:function(t){var e=He(t,"input","real");return Rt.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),on=en({imag_:function(t){var e=He(t,"input","imag");return Rt.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function an(t,e,n){return sn(t,e,Ue(t,n),n)}function sn(t,e,n,r){if(null==r&&(r=G(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!z(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){et(e);var o=S(e),i=S(n);w(o===i,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+i}));for(var a=0;a<n.length;++a){var u=a!==n.length-1||n[a]!==S(e.slice(a));w(n[a]===e[a]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "}))}}return z(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?Y(t,r,s().getBool("DEBUG")):E(t,[],!0),Rt.makeTensor(t,e,r)}function un(t,e){if((z(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&z(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return sn(t,[],[],e)}function cn(t,e){C(t);var n=Ue(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return sn(t,null,n,e)}function ln(t,e,n){if(C(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Ue(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return sn(t,e,r,n)}function fn(t,e,n){if(C(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Ue(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return sn(t,e,r,n)}function hn(t,e,n){if(C(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Ue(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return sn(t,e,r,n)}function dn(t,e,n){if(C(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Ue(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return sn(t,e,r,n)}function pn(t,e,n){if(C(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Ue(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return sn(t,e=e||r,r,n)}function vn(t,e,n,r){return void 0===e&&(e=!0),Rt.makeVariable(t,e,n,r)}function mn(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=mn(t,"float32"),r=gn(t,"float32");return nn(n,r)}var o=J(S(t),e);return Rt.makeTensor(o,t,e)}function gn(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=gn(t,"float32"),r=gn(t,"float32");return nn(n,r)}var o=Z(S(t),e);return Rt.makeTensor(o,t,e)}function yn(t,e,n){return Rt.runKernelFunc((function(r){return r.fill(t,e,n)}),{})}function bn(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return Rt.runKernelFunc((function(r){return r.linspace(t,e,n)}),{})}function xn(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return gn([0],r);var o=Z(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return cn(o,r)}var wn=en({onesLike_:function(t){var e=He(t,"x","onesLike");if("complex64"===e.dtype){var n=wn(rn(e)),r=_n(on(e));return nn(n,r)}return Rt.runKernelFunc((function(t){return t.onesLike(e)}),{$x:e},(function(t,e){return{$x:function(){return _n(t)}}}))}}),_n=en({zerosLike_:function(t){var e=He(t,"x","zerosLike");return Rt.runKernelFunc((function(t){return t.zerosLike(e)}),{$x:e},(function(t,e){return{$x:function(){return _n(t)}}}))}}),Cn=en({concat_:function(t,e){void 0===e&&(e=0),w(t.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Ve(t,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")})),e=F(e,n[0].shape)[0];var r=tn(n.map((function(t){return t.shape})),e);if(0===S(r))return an([],r);if(1===(n=n.filter((function(t){return t.size>0}))).length)return n[0];var o=n.map((function(t){return t.shape}));return Ze(o,e),Rt.runKernelFunc((function(t){return t.concat(n,e)}),n,(function(t){var n=o.map((function(t){return t[e]}));return kn(t,n,e).map((function(t){return function(){return t}}))}),"Concat",{axis:e})}}),En=en({concat1d_:function(t){return Cn(t,0)}}),Sn=en({concat2d_:function(t,e){return Cn(t,e)}}),In=en({concat3d_:function(t,e){return Cn(t,e)}}),Tn=en({concat4d_:function(t,e){return Cn(t,e)}}),kn=en({split_:function(t,e,n){void 0===n&&(n=0);var r,o=He(t,"x","split");return n=F(n,o.shape)[0],"number"==typeof e?(w(o.shape[n]%e==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(e).fill(o.shape[n]/e)):(w(o.shape[n]===e.reduce((function(t,e){return t+e})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=e),Rt.runKernelFunc((function(t){return t.split(o,r,n)}),{$x:o},(function(t){return{$x:function(){return Cn(t,n)}}}))}});function Dn(t,e){return t(e={exports:{}},e.exports),e.exports}var An=Dn((function(t){!function(t,e,n){function r(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function i(t,e){var n=new r(t),i=e&&e.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.alea=i}(0,t)})),Rn=Dn((function(t){!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function i(t,e){var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xor128=i}(0,t)})),Nn=Dn((function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function i(t,e){var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xorwow=i}(0,t)})),Fn=Dn((function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function i(t,e){null==t&&(t=+new Date);var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&(i.x&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xorshift7=i}(0,t)})),On=Dn((function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,i=e.i;return e.w=r=r+1640531527|0,n=o[i+34&127],t=o[i=i+1&127],n^=n<<13,t^=t<<17,n=o[i]=(n^=n>>>15)^(t^=t>>>12),e.i=i,n+(r^r>>>16)|0},function(t,e){var n,r,o,i,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,i=-32;i<u;++i)e&&(r^=e.charCodeAt((i+32)%e.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=0==(n=s[127&i]^=r+(a=a+1640531527|0))?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,s[o]=(r^=r>>>15)^(n^=n>>>12);t.w=a,t.X=s,t.i=o}(e,t)}function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function i(t,e){null==t&&(t=+new Date);var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&(i.X&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.xor4096=i}(0,t)})),Mn=Dn((function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function i(t,e){var n=new r(t),i=e&&e.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=n.next,a.quick=a,i&&("object"==typeof i&&o(i,n),a.state=function(){return o(n,{})}),a}e&&e.exports?e.exports=i:this.tychei=i}(0,t)})),Pn=Dn((function(t){!function(e,n){var r,o=this,i=256,a=n.pow(i,6),s=n.pow(2,52),u=2*s,c=255;function l(t,c,l){var v=[],m=d(function t(e,n){var r,o=[],i=typeof e;if(n&&"object"==i)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==i?e:e+"\0"}((c=1==c?{entropy:!0}:c||{}).entropy?[t,p(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(i):(t=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(t)),p(t)}catch(t){var n=o.navigator,a=n&&n.plugins;return[+new Date,o,a,o.screen,p(e)]}}():t,3),v),g=new f(v),y=function(){for(var t=g.g(6),e=a,n=0;t<s;)t=(t+n)*i,e*=i,n=g.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return y.int32=function(){return 0|g.g(4)},y.quick=function(){return g.g(4)/4294967296},y.double=y,d(p(g.S),e),(c.pass||l||function(t,e,r,o){return o&&(o.S&&h(o,g),t.state=function(){return h(g,{})}),r?(n.random=t,e):t})(y,m,"global"in c?c.global:this==n,c.state)}function f(t){var e,n=t.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[a=c&a+t[o%n]+(e=s[o])],s[a]=e;(r.g=function(t){for(var e,n=0,o=r.i,a=r.j,s=r.S;t--;)e=s[o=c&o+1],n=n*i+s[c&(s[o]=s[a=c&a+e])+(s[a]=e)];return r.i=o,r.j=a,n})(i)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){for(var n,r=t+"",o=0;o<r.length;)e[c&o]=c&(n^=19*e[c&o])+r.charCodeAt(o++);return p(e)}function p(t){return String.fromCharCode.apply(0,t)}if(n.seedrandom=l,d(n.random(),e),t.exports){t.exports=l;try{r=require("crypto")}catch(t){}}}([],Math)}));Pn.alea=An,Pn.xor128=Rn,Pn.xorwow=Nn,Pn.xorshift7=Fn,Pn.xor4096=On,Pn.tychei=Mn;var Ln=Pn.alea,Bn=function(){function t(t,e,n,r,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=o||Math.random();this.random=Ln(i.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var o=void 0,i=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(i=2*this.random()-1)*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),Wn=function(){function t(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;var o=r||Math.random();this.randu=Ln(o.toString()),this.randn=new Bn(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var t,e,n,r,o,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(e=1-.331*(t=r*r)*t,n=.5*t+this.d*(1-(i*=i*i)+Math.log(i)),(o=this.randu())<e||Math.log(o)<n)break}return i*=1/this.beta*this.d,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},t.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},t}(),zn=function(){function t(t,e,n,r){var o=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Ln(r)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function Un(t,e,n){return void 0===e&&(e="float32"),e=e||"float32",et(t),new lt(t,e,n)}function jn(t,e){void 0===e&&(e=!1),console.log(t.toString(e))}var Hn=en({batchToSpaceND_:function(t,e,n){var r=He(t,"x","batchToSpaceND"),o=e.reduce((function(t,e){return t*e}));return w(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),w(n.length===e.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length})),w(r.shape[0]%o==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o})),Rt.runKernelFunc((function(t){return t.batchToSpaceND(r,e,n)}),{$x:r},(function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}}))}}),Vn=en({broadcastTo_:function(t,e){var n=He(t,"broadcastTo","x"),r=n.shape;if(e.some((function(t){return!(t>0)||t%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var o=n.shape.slice();o.length<e.length;)o.unshift(1);n=n.reshape(o)}for(var i=Array.from(e),a=e.length-1;a>=0;a--)if(n.shape[a]===e[a])i[a]=1;else if(1!==n.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var s=i.map((function(t,e){return t>1?e:-1})).filter((function(t){return t>=0}));return 0===s.length?n.clone():Rt.runKernelFunc((function(t){return t.tile(n,i)}),{input:n},(function(t){return{input:function(){return t.sum(s,!0)}}}))}}),qn=en({cast_:function(t,e){var n=He(t,"x","cast");if(!B(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return Rt.runKernelFunc((function(t){return t.cast(n,e)}),{x:n},(function(t){return{x:function(){return t.clone()}}}),"Cast",{dtype:e})}}),Gn=en({clone_:function(t){var e=He(t,"x","clone",null);return Rt.runKernelFunc((function(){return Rt.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{$x:e},(function(t){return{$x:function(){return t.toFloat()}}}))}}),Kn=en({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=He(t,"x","cumsum"),i=Ye([e|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=Je(1,o.rank)[0],u=Rt.runKernelFunc((function(t){return t.cumsum(a,s,n,r)}),{permutedX:a},(function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}}));return null!=i&&(u=u.transpose(i)),u}}),Xn=en({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=He(t,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return w(o*e>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape})),w(i*e>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+" for depthToSpace with input shape\n          "+r.shape})),w(a%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape})),Rt.runKernelFunc((function(t){return t.depthToSpace(r,e,n)}),{$x:r})}}),$n=en({expandDims_:function(t,e){void 0===e&&(e=0);var n=He(t,"x","expandDims",null);w(e<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return e<0&&(w(-(n.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),e=n.rank+e+1),r.splice(e,0,1),ur(n,r)}}),Yn=en({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var o=Un([t,e],r),i=t<=e?t:e,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,e);if(null==n)return s;if(1===n.length)return hr($n(s,0),[n[0],1,1]);if(2===n.length)return hr($n($n(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return hr($n($n($n(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Qn=en({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var o=He(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?o.as2D(1,-1):o,u=Rt.runKernelFunc((function(t){return t.multinomial(s,r,e,n)}),{logits2D:s});return 1===a?u.as1D():u}}),Jn=en({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=He(t,"indices","oneHot","int32"),i=o.shape.concat([e]);return o=o.flatten(),Rt.runKernelFunc((function(t){return t.oneHot(o,e,n,r)}),{$indices:o},(function(t){return{$indices:function(){return gn(o.shape,"float32")}}})).reshape(i)}}),Zn=en({pad_:function(t,e,n){void 0===n&&(n=0);var r=He(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Rt.runKernelFunc((function(t){return t.pad(r,e,n)}),{x:r},(function(t){var n=e.map((function(t){return t[0]}));return{x:function(){return t.slice(n,r.shape)}}}),"PadV2",{paddings:e,constantValue:n})}}),tr=en({pad1d_:function(t,e,n){return void 0===n&&(n=0),w(2===e.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Zn(t,[e],n)}}),er=en({pad2d_:function(t,e,n){return void 0===n&&(n=0),w(2===e.length&&2===e[0].length&&2===e[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Zn(t,e,n)}}),nr=en({pad3d_:function(t,e,n){return void 0===n&&(n=0),w(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Zn(t,e,n)}}),rr=en({pad4d_:function(t,e,n){return void 0===n&&(n=0),w(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Zn(t,e,n)}}),or=en({rand_:function(t,e,n){var r=S(t),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=e();return Rt.makeTensor(o,t,n)}}),ir=en({randomNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Bn(e,n,r,!1,o),a=Un(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),ar=en({randomGamma_:function(t,e,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new Wn(e,n,r,o),a=Un(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),sr=en({randomUniform_:function(t,e,n,r,o){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=Un(t,r),a=new zn(e,n,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),ur=en({reshape_:function(t,e){var n=He(t,"x","reshape",null);return e=N(e,n.size),w(n.size===S(e),(function(){return"new shape and old shape must have the same number of elements."})),Rt.runKernelFunc((function(t){return t.reshape(n,e)}),{x:n},(function(t){return{x:function(){return t.reshape(n.shape)}}}),"Reshape",{shape:e})}}),cr=en({spaceToBatchND_:function(t,e,n){var r=He(t,"x","spaceToBatchND");return w(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),w(n.length===e.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length})),w(r.shape.reduce((function(t,r,o){return o>0&&o<=e.length?t&&(r+n[o-1][0]+n[o-1][1])%e[o-1]==0:t}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()})),Rt.runKernelFunc((function(t){return t.spaceToBatchND(r,e,n)}),{$x:r},(function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}}))}}),lr=en({squeeze_:function(t,e){var n=He(t,"x","squeeze");return ur(n,O(n.shape,e).newShape)}}),fr=en({stack_:function(t,e){void 0===e&&(e=0);var n=Ve(t,"tensors","stack");if(w(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(e);var r=n[0].shape,o=n[0].dtype;w(e<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(t){_(r,t.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(t){w(o===t.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=n.map((function(t){return t.expandDims(e)}));return Cn(i,e)}}),hr=en({tile_:function(t,e){var n=He(t,"x","tile",null);return w(n.rank===e.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."})),Rt.runKernelFunc((function(t,r){var o=t.tile(n,e);return r([n]),o}),{x:n},(function(t,n){var r=n[0];return{x:function(){var n=_n(r);if(1===r.rank)for(var o=0;o<e[0];++o)n=n.add(t.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<e[0];++o)for(var i=0;i<e[1];++i)n=n.add(t.slice([o*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(var a=0;a<e[2];++a)n=n.add(t.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(a=0;a<e[2];++a)for(var s=0;s<e[3];++s)n=n.add(t.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}),"Tile",{reps:e},[n])}}),dr=en({truncatedNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Bn(e,n,r,!0,o),a=Un(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),pr=en({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var n=He(t,"x","unstack");return w(e>=-n.shape.length&&e<n.shape.length,(function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),e<0&&(e+=n.shape.length),Rt.runKernelFunc((function(t){return t.unstack(n,e)}),{x:n},(function(t){return{x:function(){return fr(t,e)}}}),"Unpack",{axis:e})}}),vr=function(t,e){return r(this,void 0,void 0,(function(){var n,r,i,a,s,u,c,l,f,h;return o(this,(function(o){switch(o.label){case 0:return n=He(t,"x","setdiff1d"),r=He(e,"y","setdiff1d"),w(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),w(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),w(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return i=o.sent(),[4,r.data()];case 2:for(a=o.sent(),s=new Set(a),u=0,f=0;f<i.length;f++)s.has(i[f])||u++;for(c=new lt([u],n.dtype),l=new lt([u],"int32"),f=0,h=0;f<i.length;f++)s.has(i[f])||(c.values[h]=i[f],l.values[h]=f,h++);return[2,[c.toTensor(),l.toTensor()]]}}))}))};function mr(t,e,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=e.length,a=0;a<i;++a)o=o.concat([t[a+1]/e[a],e[a]]);o=o.concat(t.slice(i+1))}return o}function gr(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var o=e+1;o<t;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*e+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function yr(t,e,n,r){void 0===r&&(r=!0);var o=[];o.push(r?t[0]/n:t[0]*n);for(var i=1;i<t.length;++i)o.push(i<=e.length?r?e[i-1]*t[i]:t[i]/e[i-1]:t[i]);return o}function br(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function xr(t,e,n){for(var r=t.slice(0,1),o=0;o<n;++o)r.push(t[o+1]-e[o][0]-e[o][1]);return r}function wr(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=t.shape,s=n.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var c=$(t.shape).map((function(t){return t/u})).concat([1]).slice(0,r);return[s,o,u,c]}var _r=Object.freeze({prepareAndValidate:wr});function Cr(t){return t<=30?t:X(t,Math.floor(Math.sqrt(t)))}function Er(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==e.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}function Sr(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}Er(n,e,t)}function Ir(t,e,n){for(var r=e.shape.length,o=r>1?e.shape[r-1]:1,i=n.length,a=1,s=o;s<i;++s)a*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:S(e.shape)/u,sliceSize:a,strides:$(n.slice(0,o)).concat([1]),outputSize:S(n)}}var Tr=Object.freeze({validateUpdateShape:Er,validateInput:Sr,calculateShapes:Ir});function kr(t,e,n){w(t.rank===e.length,(function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."})),w(t.rank===n.length,(function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."}));for(var r=function(r){w(e[r]+n[r]<=t.shape[r],(function(){return"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"}))},o=0;o<t.rank;++o)r(o)}function Dr(t){for(var e=[],n=0;t>0;)1&t&&e.push(n),t/=2,n++;return e}function Ar(t,e,n){for(var r=[],o=0;o<t.length;o++)r[o]=Math.ceil((e[o]-t[o])/n[o]);return r}function Rr(t,e,n,r,o){var i=e[o];(t&1<<o||null==i)&&(i=(n[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[o];return i<0&&(i+=a),y(0,i,a-1)}function Nr(t,e,n,r,o){var i=e[o],a=n[o]||1;(t&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?y(0,i,s):y(-1,i,s-1)}function Fr(t,e,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(e[o]>0||n[o]!==t[o])return!1;return!0}function Or(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}var Mr=Object.freeze({assertParamsValid:kr,maskToAxes:Dr,computeOutShape:Ar,startForAxis:Rr,stopForAxis:Nr,isSliceContinous:Fr,computeFlatOffset:Or});function Pr(t,e){w(K(t),(function(){return"The f passed in variableGrads(f) must be a function"})),w(null==e||Array.isArray(e)&&e.every((function(t){return t instanceof xt})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=e;if(!n)for(var r in e=[],Rt.registeredVariables)e.push(Rt.registeredVariables[r]);var o=n?e.filter((function(t){return!t.trainable})):null,i=e.length;w((e=e.filter((function(t){return t.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."}));var a=Rt.gradients(t,e,null,!0),s=a.value,u=a.grads;w(u.some((function(t){return null!=t})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),w(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return e.forEach((function(t,e){null!=u[e]&&(c[t.name]=u[e])})),null!=o&&o.forEach((function(t){return c[t.name]=null})),{value:s,grads:c}}function Lr(t){return Rt.customGrad(t)}function Br(t){if(t.filter((function(t){return null==t})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var Wr=en({softmax_:function(t,e){void 0===e&&(e=-1);var n=He(t,"logits","softmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return Lr((function(t,n){var r=t.logSumExp([e],!0),o=t.toFloat().sub(r).exp();return n([o]),{value:o,gradFunc:function(t,n){var r=n[0],o=t.mul(r);return o.sub(o.sum([e],!0).mul(r))}}}))(n)}}),zr=en({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=He(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return Lr((function(t,n){var r=t.max(e,!0),o=t.sub(r),i=o.toFloat().sub(o.exp().sum(e,!0).log());return n([i]),{value:i,gradFunc:function(t,n){var r=n[0].exp();return t.sub(t.sum(e,!0).mul(r))}}}))(n)}}),Ur=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),jr=function(){function t(){}return t.prototype.time=function(t){return Hr("time")},t.prototype.read=function(t){return Hr("read")},t.prototype.readSync=function(t){return Hr("readSync")},t.prototype.numDataIds=function(){return Hr("numDataIds")},t.prototype.disposeData=function(t){return Hr("disposeData")},t.prototype.write=function(t,e,n){return Hr("write")},t.prototype.move=function(t,e,n,r){return Hr("move")},t.prototype.memory=function(){return Hr("memory")},t.prototype.floatPrecision=function(){return Hr("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(t,e,n,r){return Hr("batchMatMul")},t.prototype.fusedBatchMatMul=function(t){return Hr("fusedBatchMatMul")},t.prototype.slice=function(t,e,n){return Hr("slice")},t.prototype.stridedSlice=function(t,e,n,r){return Hr("stridedSlice")},t.prototype.unstack=function(t,e){return Hr("unstack")},t.prototype.reverse=function(t,e){return Hr("reverse")},t.prototype.concat=function(t,e){return Hr("concat")},t.prototype.neg=function(t){return Hr("neg")},t.prototype.add=function(t,e){return Hr("add")},t.prototype.addN=function(t){return Hr("addN")},t.prototype.subtract=function(t,e){return Hr("subtract")},t.prototype.multiply=function(t,e){return Hr("multiply")},t.prototype.realDivide=function(t,e){return Hr("realDivide")},t.prototype.floorDiv=function(t,e){return Hr("floorDiv")},t.prototype.sum=function(t,e){return Hr("sum")},t.prototype.prod=function(t,e){return Hr("prod")},t.prototype.unsortedSegmentSum=function(t,e,n){return Hr("unsortedSegmentSum")},t.prototype.argMin=function(t,e){return Hr("argMin")},t.prototype.argMax=function(t,e){return Hr("argMax")},t.prototype.equal=function(t,e){return Hr("equal")},t.prototype.notEqual=function(t,e){return Hr("notEqual")},t.prototype.less=function(t,e){return Hr("less")},t.prototype.lessEqual=function(t,e){return Hr("lessEqual")},t.prototype.greater=function(t,e){return Hr("greater")},t.prototype.greaterEqual=function(t,e){return Hr("greaterEqual")},t.prototype.logicalNot=function(t){return Hr("logicalNot")},t.prototype.logicalAnd=function(t,e){return Hr("logicalAnd")},t.prototype.logicalOr=function(t,e){return Hr("logicalOr")},t.prototype.where=function(t){return Hr("where")},t.prototype.select=function(t,e,n){return Hr("select")},t.prototype.topk=function(t,e,n){return Hr("topk")},t.prototype.min=function(t,e){return Hr("min")},t.prototype.minimum=function(t,e){return Hr("minimum")},t.prototype.mod=function(t,e){return Hr("mod")},t.prototype.max=function(t,e){return Hr("max")},t.prototype.maximum=function(t,e){return Hr("maximum")},t.prototype.all=function(t,e){return Hr("all")},t.prototype.any=function(t,e){return Hr("any")},t.prototype.squaredDifference=function(t,e){return Hr("squaredDifference")},t.prototype.ceil=function(t){return Hr("ceil")},t.prototype.floor=function(t){return Hr("floor")},t.prototype.round=function(t){return Hr("round")},t.prototype.sign=function(t){return Hr("sign")},t.prototype.isNaN=function(t){return Hr("isNaN")},t.prototype.isInf=function(t){return Hr("isInf")},t.prototype.isFinite=function(t){return Hr("isFinite")},t.prototype.pow=function(t,e){return Hr("pow")},t.prototype.exp=function(t){return Hr("exp")},t.prototype.expm1=function(t){return Hr("expm1")},t.prototype.log=function(t){return Hr("log")},t.prototype.log1p=function(t){return Hr("log1p")},t.prototype.sqrt=function(t){return Hr("sqrt")},t.prototype.rsqrt=function(t){return Hr("rsqrt")},t.prototype.square=function(t){return Hr("square")},t.prototype.reciprocal=function(t){return Hr("reciprocal")},t.prototype.relu=function(t){return Hr("relu")},t.prototype.relu6=function(t){return Hr("relu6")},t.prototype.prelu=function(t,e){return Hr("prelu")},t.prototype.elu=function(t){return Hr("elu")},t.prototype.eluDer=function(t,e){return Hr("eluDer")},t.prototype.selu=function(t){return Hr("selu")},t.prototype.int=function(t){return Hr("int")},t.prototype.clip=function(t,e,n){return Hr("clip")},t.prototype.abs=function(t){return Hr("abs")},t.prototype.complexAbs=function(t){return Hr("complexAbs")},t.prototype.sigmoid=function(t){return Hr("sigmoid")},t.prototype.softplus=function(t){return Hr("softplus")},t.prototype.sin=function(t){return Hr("sin")},t.prototype.cos=function(t){return Hr("cos")},t.prototype.tan=function(t){return Hr("tan")},t.prototype.asin=function(t){return Hr("asin")},t.prototype.acos=function(t){return Hr("acos")},t.prototype.atan=function(t){return Hr("atan")},t.prototype.atan2=function(t,e){return Hr("atan2")},t.prototype.sinh=function(t){return Hr("sinh")},t.prototype.cosh=function(t){return Hr("cosh")},t.prototype.tanh=function(t){return Hr("tanh")},t.prototype.asinh=function(t){return Hr("asinh")},t.prototype.acosh=function(t){return Hr("acosh")},t.prototype.atanh=function(t){return Hr("atanh")},t.prototype.erf=function(t){return Hr("erf")},t.prototype.step=function(t,e){return Hr("step")},t.prototype.fusedConv2d=function(t){return Hr("fusedConv2d")},t.prototype.conv2d=function(t,e,n){return Hr("conv2d")},t.prototype.conv2dDerInput=function(t,e,n){return Hr("conv2dDerInput")},t.prototype.conv2dDerFilter=function(t,e,n){return Hr("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(t){return Hr("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(t,e,n){return Hr("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){return Hr("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){return Hr("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(t,e,n){return Hr("conv3d")},t.prototype.conv3dDerInput=function(t,e,n){return Hr("conv3dDerInput")},t.prototype.conv3dDerFilter=function(t,e,n){return Hr("conv3dDerFilter")},t.prototype.maxPool=function(t,e){return Hr("maxPool")},t.prototype.maxPoolBackprop=function(t,e,n,r){return Hr("maxPoolBackprop")},t.prototype.avgPool=function(t,e){return Hr("avgPool")},t.prototype.avgPoolBackprop=function(t,e,n){return Hr("avgPoolBackprop")},t.prototype.avgPool3d=function(t,e){return Hr("avgPool3d")},t.prototype.avgPool3dBackprop=function(t,e,n){return Hr("avgPool3dBackprop")},t.prototype.maxPool3d=function(t,e){return Hr("maxPool3d")},t.prototype.maxPool3dBackprop=function(t,e,n,r){return Hr("maxPool3dBackprop")},t.prototype.reshape=function(t,e){return Hr("reshape")},t.prototype.cast=function(t,e){return Hr("cast")},t.prototype.tile=function(t,e){return Hr("tile")},t.prototype.pad=function(t,e,n){return Hr("pad")},t.prototype.transpose=function(t,e){return Hr("transpose")},t.prototype.gather=function(t,e,n){return Hr("gather")},t.prototype.gatherND=function(t,e){return Hr("gatherND")},t.prototype.scatterND=function(t,e,n){return Hr("scatterND")},t.prototype.batchToSpaceND=function(t,e,n){return Hr("batchToSpaceND")},t.prototype.spaceToBatchND=function(t,e,n){return Hr("spaceToBatchND")},t.prototype.resizeBilinear=function(t,e,n,r){return Hr("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(t,e,n){return Hr("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){return Hr("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){return Hr("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(t,e,n,r,o,i){return Hr("batchNormalization")},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){return Hr("localResponseNormalization4D")},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){return Hr("LRNGrad")},t.prototype.multinomial=function(t,e,n,r){return Hr("multinomial")},t.prototype.oneHot=function(t,e,n,r){return Hr("oneHot")},t.prototype.cumsum=function(t,e,n,r){return Hr("cumsum")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return Hr("nonMaxSuppression")},t.prototype.fft=function(t){return Hr("fft")},t.prototype.ifft=function(t){return Hr("ifft")},t.prototype.complex=function(t,e){return Hr("complex")},t.prototype.real=function(t){return Hr("real")},t.prototype.imag=function(t){return Hr("imag")},t.prototype.cropAndResize=function(t,e,n,r,o,i){return Hr("cropAndResize")},t.prototype.depthToSpace=function(t,e,n){return Hr("depthToSpace")},t.prototype.split=function(t,e,n){return Hr("split")},t.prototype.sparseToDense=function(t,e,n,r){return Hr("sparseToDense")},t.prototype.diag=function(t){return Hr("diag")},t.prototype.fill=function(t,e,n){return Hr("fill")},t.prototype.onesLike=function(t){return Hr("onesLike")},t.prototype.zerosLike=function(t){return Hr("zerosLike")},t.prototype.linspace=function(t,e,n){return Hr("linspace")},t.prototype.dispose=function(){return Hr("dispose")},t}();function Hr(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Vr(t,e){for(var n=t.length,r=[],o=0;o<n;o++){var i=n-1-o;(e[e.length-1-o]||1)>1&&1===(t[i]||1)&&r.unshift(i)}return r}function qr(t,e){for(var n=[],r=0;r<e.length;r++){var o=t[t.length-r-1],i=e.length-r-1;(null==o||1===o&&e[i]>1)&&n.unshift(i)}return n}function Gr(t,e){for(var n=[],r=Math.max(t.length,e.length),o=0;o<r;o++){var i=t[t.length-o-1];null==i&&(i=1);var a=e[e.length-o-1];if(null==a&&(a=1),1===i)n.unshift(a);else if(1===a)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(i)}}return n}function Kr(t,e,n,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=Jr(e),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,t[1],t[1]]}return $r(t,s,n,r,o,i,!1,a)}function Xr(t,e,n,r,o,i,a){void 0===a&&(a="NDHWC");var s,u,c=Zr(e),l=c[0],f=c[1],h=c[2];if("NDHWC"===a)u="channelsLast",s=[l,f,h,t[4],t[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,f,h,t[1],t[1]]}return Yr(t,s,n,r,o,!1,u,i)}function $r(t,e,n,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],h=u[3];if("channelsLast"===s)c=t[0],l=t[1],f=t[2],h=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],h=t[1],l=t[2],f=t[3]}var d,p=e[0],v=e[1],m=e[3],g=Jr(n),y=g[0],b=g[1],x=Jr(r),_=x[0],C=x[1],E=to(p,_),S=to(v,C),I=function(t,e,n,r,o,i,a,s){var u,c,l;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var f=function(t,e,n,r,o){null==r&&(r=Qr(t,e,n));var i=t[1],a=eo((t[0]-e+2*r)/n+1,o);w(T(a),(function(){return"The output # of rows ("+a+") must be an integer. Change the stride and/or zero pad parameters"}));var s=eo((i-e+2*r)/n+1,o);return w(T(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[a,s]}([e,n],i,r,t,s);c=f[0],l=f[1]}else if("same"===t){c=Math.ceil(e/r),l=Math.ceil(n/o);var h=Math.max(0,(c-1)*r+i-e),d=Math.max(0,(l-1)*o+a-n),p=Math.floor(h/2),v=h-p,m=Math.floor(d/2);u={top:p,bottom:v,left:m,right:d-m,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/r),l=Math.ceil((n-a+1)/o)}return{padInfo:u,outHeight:c,outWidth:l}}(o,l,f,y,b,E,S,i),k=I.outHeight,D=I.outWidth,A=a?m*h:m;return"channelsFirst"===s?d=[c,A,k,D]:"channelsLast"===s&&(d=[c,k,D,A]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:h,outHeight:k,outWidth:D,outChannels:A,padInfo:I.padInfo,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:v,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationHeight:_,dilationWidth:C,inShape:t,outShape:d,filterShape:e}}function Yr(t,e,n,r,o,i,a,s){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],h=u[3],d=u[4];if("channelsLast"===a)c=t[0],l=t[1],f=t[2],h=t[3],d=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=t[0],d=t[1],l=t[2],f=t[3],h=t[4]}var p,v=e[0],m=e[1],g=e[2],y=e[4],b=Zr(n),x=b[0],_=b[1],C=b[2],E=Zr(r),S=E[0],I=E[1],k=E[2],D=to(v,S),A=to(m,I),R=to(g,k),N=function(t,e,n,r,o,i,a,s,u,c,l){var f,h,d,p;if("number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};var v=function(t,e,n,r,o,i){null==o&&(o=Qr(t,e,r));var a=t[1],s=t[2],u=eo((t[0]-e+2*o)/r+1,i);w(T(u),(function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var c=eo((a-e+2*o)/r+1,i);w(T(c),(function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var l=eo((s-e+2*o)/r+1,i);return w(T(l),(function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"})),[u,c,l,1]}([e,n,r,1],s,0,o,t,l);h=v[0],d=v[1],p=v[2]}else if("same"===t){var m=((h=Math.ceil(e/o))-1)*o+s-e,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/a))-1)*a+c-r,b=Math.floor(m/2),x=m-b,_=Math.floor(g/2),C=g-_,E=Math.floor(y/2);f={top:_,bottom:C,left:E,right:y-E,front:b,back:x,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-s+1)/o),d=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/a)}return{padInfo:f,outDepth:h,outHeight:d,outWidth:p}}(o,l,f,h,x,_,C,D,A,R,s),F=N.outDepth,O=N.outHeight,M=N.outWidth,P=i?y*d:y;return"channelsFirst"===a?p=[c,P,F,O,M]:"channelsLast"===a&&(p=[c,F,O,M,P]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:f,inWidth:h,inChannels:d,outDepth:F,outHeight:O,outWidth:M,outChannels:P,padInfo:N.padInfo,strideDepth:x,strideHeight:_,strideWidth:C,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:D,effectiveFilterHeight:A,effectiveFilterWidth:R,dilationDepth:S,dilationHeight:I,dilationWidth:k,inShape:t,outShape:p,filterShape:e}}function Qr(t,e,n,r){void 0===r&&(r=1);var o=to(e,r);return Math.floor((t[0]*(n-1)-n+o)/2)}function Jr(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function Zr(t){return"number"==typeof t?[t,t,t]:t}function to(t,e){return e<=1?t:t+(t-1)*(e-1)}function eo(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function no(t){var e=Jr(t);return 1===e[0]&&1===e[1]&&1===e[2]}function ro(t,e){return no(t)||no(e)}function oo(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function io(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=gn(t.shape),o=t.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!W(t.dtype,e))return Rt.makeTensorFromDataId(t.dataId,t.shape,e);if("complex64"===t.dtype){var a=n.real(t);return i=a.cast(e),a.dispose(),i}if("int32"===e)return n.int(t);if("bool"===e){var s=un(0,t.dtype);return i=n.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function ao(t,e){return Rt.makeTensorFromDataId(t.dataId,e,t.dtype)}function so(t,e,n){var r=(e-t)/(n-1),o=Z(n,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return cn(o,"float32")}var uo=Object.freeze({castTensor:io,reshapeTensor:ao,linspaceImpl:so,upcastType:_t,axesAreInnerMostDims:qe,combineLocations:Ge,computeOutAndReduceShapes:Ke,expandShapeToKeepDim:Xe,assertAxesAreInnerMostDims:$e,getAxesPermutation:Ye,getUndoAxesPermutation:Qe,getInnerMostAxes:Je,getBroadcastDims:Vr,getReductionAxes:qr,assertAndGetBroadcastShape:Gr,assertParamsConsistent:Ze,computeOutShape:tn,computePool2DInfo:Kr,computePool3DInfo:Xr,computeConv2DInfo:$r,computeConv3DInfo:Yr,computeDefaultPad:Qr,tupleValuesAreOne:no,eitherStridesOrDilationsAreOne:ro,convertConv2DDataFormat:oo,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Cr});function co(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function lo(t,e){return{real:t[2*e],imag:t[2*e+1]}}function fo(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function ho(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function po(t,e,n){var r=function(t,e,n){return function(t,e,n){for(var r=0,o=t.length,i=0,a=!1;r<o;){var s=n(e,t[i=r+(o-r>>>1)]);s>0?r=i+1:(o=i,a=!s)}return a?r:-r-1}(t,e,n||vo)}(t,e,n);t.splice(r<0?-(r+1):r,0,e)}function vo(t,e){return t>e?1:t<e?-1:0}function mo(t,e,n,r,o){return yo(t,e,n,r,o,0).selectedIndices}function go(t,e,n,r,o,i){var a=yo(t,e,n,r,o,i);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function yo(t,e,n,r,o,i,a,s){void 0===s&&(s=!1);for(var u=Array.from(e).map((function(t,e){return{score:t,boxIndex:e,suppressBeginIndex:0}})).filter((function(t){return t.score>o})).sort(wo),c=i>0?-.5/i:0,l=[],f=[];l.length<n&&u.length>0;){var h=u.pop(),d=h.score,p=h.boxIndex,v=h.suppressBeginIndex;if(d<o)break;for(var m=!1,g=l.length-1;g>=v;--g){var y=bo(t,p,l[g]);if(y>=r){m=!0;break}if(h.score=h.score*xo(r,c,y),h.score<=o)break}h.suppressBeginIndex=l.length,m||(h.score===d?(l.push(p),f.push(h.score)):h.score>o&&po(u,h,wo))}var b=l.length;return s&&(l.fill(0,b),f.fill(0,b)),{selectedIndices:cn(l,"int32"),selectedScores:cn(f,"float32"),numValidOutputs:un(b,"int32")}}function bo(t,e,n){var r=t.subarray(4*e,4*e+4),o=t.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),d=(s-i)*(u-a),p=(f-c)*(h-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(a,l),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function xo(t,e,n){var r=Math.exp(e*n*n);return n<=t?r:0}function wo(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}function _o(t,e,n){var r=new Array(t.rank).fill(0),o=t.shape.slice();return e.map((function(e){o[n]=e;var i=t.slice(r,o);return r[n]+=e,i}))}function Co(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var o=Un(n,t.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=i[s]%t.shape[s];var u=t.locToIndex(a);o.values[r]=t.values[u]}return o.toTensor()}function Eo(t,e,n,r,o){for(var i=e[e.length-1],a=[t.length/i,i],s=a[0],u=a[1],c=M(n,s*r),l=M("int32",s*r),f=0;f<s;f++){for(var h=f*u,d=t.subarray(h,h+u),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort((function(t,e){return e.value-t.value}));var m=f*r,g=c.subarray(m,m+r),y=l.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,y[v]=p[v].index}var b=e.slice();return b[b.length-1]=r,[an(c,b,n),an(l,b,"int32")]}function So(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var o=Un(t,"int32"),i=Un([n.length,t.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]);i.values.set(a,r*t.length)}return i.toTensor()}var Io=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((function(t,e){return"T"+e}));var n=[];this.variableNames.forEach((function(t){n.push("float v"+t+" = get"+t+"AtOutCoords();")}));var r=this.variableNames.map((function(t){return"v"+t})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},To=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((function(t,e){return"T"+e}));var n=[];this.variableNames.forEach((function(t){n.push("vec4 v"+t+" = get"+t+"AtOutCoords();")}));var r=this.variableNames.map((function(t){return"v"+t})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},ko=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,i=Math.ceil(t.inSize/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===e?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function Do(t,e){return["x","y","z","w","u","v"].slice(0,e).map((function(e){return t+"."+e}))}function Ao(t,e){return 1===e?[t]:Do(t,e)}function Ro(){var t,e,n,r,o,i,a,u,c,l;return 2===s().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",u="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",o="texture2D",i="gl_FragColor",a="",u="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:u,defineSpecialInf:c,defineRound:l}}function No(t,e,n){void 0===n&&(n="index");var r=$(e);return r.map((function(e,o){return"int "+t[o]+" = "+n+" / "+e+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+e:"index -= "+t[o]+" * "+e)+";"})).join("")}function Fo(t){var e=$(t).map((function(t){return t.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var Oo="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Mo(t){return"offset"+t}function Po(t){var e=t.name,n=S(t.shapeInfo.logicalShape);return n<2?"return "+e+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function Lo(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Bo(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Wo(t,e){return e.map((function(e){return t[e]})).join(", ")}var zo=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,w(t.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var o=Math.ceil(t[t.length-1]/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var i,a,s=this.outputShape,u=s.length,c=Lo(u),l=Ao("coords",u);if(1===o){var f=Lo(a=u+1);i="\n        "+f+" sourceLocR = "+f+"("+l.join()+", 0);\n        ++"+l[u-1]+";\n        "+f+" sourceLocG = "+f+"("+l.join()+", 0);\n        ++"+l[u-2]+";\n        "+f+" sourceLocA = "+f+"("+l.join()+", 0);\n        --"+l[u-1]+";\n        "+f+" sourceLocB = "+f+"("+l.join()+", 0);\n        --"+l[u-2]+";"}else a=u,i="\n        "+c+" sourceLocR = coords;\n        ++"+l[u-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+l[u-2]+";\n        "+c+" sourceLocA = coords;\n        --"+l[u-1]+";\n        "+c+" sourceLocB = coords;\n        --"+l[u-2]+";";var h=["x","y","z","w","u","v"].slice(0,a),d="."+h[a-1],p=h.map((function(t){return"int "+t})),v=Ao("sourceLocR",a-1).concat("inIdx.r"),m=Ao("sourceLocG",a-1).concat("inIdx.g"),g=Ao("sourceLocB",a-1).concat("inIdx.b"),y=Ao("sourceLocA",a-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",_="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+m.join()+") : 0.,\n            hasNextRow ? getAChannel("+g.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",C=r?"":"\n      float getBestIndicesAChannel("+p.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+p.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+C+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+l[u-1]+" < "+(s[u-1]-1)+";\n        bool hasNextRow = "+l[u-2]+" < "+(s[u-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+d+", sourceLocG"+d+",\n          sourceLocB"+d+", sourceLocA"+d+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+x+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Uo=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n            wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+";\n            wC+= "+t.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jo=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.effectiveFilterDepth,n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-t.padInfo.front)+", "+(n-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n      const float avgMultiplier = float("+1/(t.filterDepth*t.filterHeight*t.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+e+";\n            wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+n+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+r+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ho=function(t,e,n,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Gr(t,e),Gr(t,n);var a="0.0";null!=r&&(Gr(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Gr(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Vo=function(t,e,n,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Gr(t,e),Gr(t,n);var a="vec4(0.0)";null!=r&&(Gr(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Gr(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},qo=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Gr(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Go="return a + b;",Ko="return a - b;",Xo="return a * b;",$o="return (a < 0.) ? b * a : a;",Yo=function(t,e,n){this.variableNames=["A","B"],this.outputShape=Gr(e,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Qo="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Jo=function(t,e,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Gr(e,n);var o=this.outputShape.length,i="";if(r)if(0===o||1===S(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+Lo(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=Ao("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},Zo=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),ti=function(){function t(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),ei=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},ni=function(t){this.outputShape=[],this.outputShape=tn(t,1),this.variableNames=t.map((function(t,e){return"T"+e}));var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++)r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+e[n-1]+"));");r.push("else setOutput(getT"+e.length+"(yR, yC-"+e[e.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},ri=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=tn(t,e);var n=this.outputShape,r=n.length,o=Lo(r),i=Ao("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map((function(t,e){return"T"+e}));var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var c=a[e],l=a.slice(-2),f=a.join(),h="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+f+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var d=s[u-1];h+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+oi(a,c,d)+"),\n            vec2("+oi(l,c,d)+"));\n        }"}var p=s[s.length-1];h+="\n        return getChannel(\n          getT"+s.length+"("+oi(a,c,p)+"),\n          vec2("+oi(l,c,p)+"));",this.userCode="\n      float getValue("+a.map((function(t){return"int "+t}))+") {\n        "+h+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            "+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function oi(t,e,n){var r=t.indexOf(e);return t.map((function(t,e){return e===r?t+" - "+n:t})).join()}var ii=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===t.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ai=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(r?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(r?1:2)+"], coords["+(r?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+r+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},si=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+t.strideDepth+" - "+t.padInfo.front+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ui=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-t.padInfo.front)+", "+(n-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+t.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ci=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+t.outChannels/t.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+t.strideHeight+" - "+t.padInfo.top+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+t.strideWidth+" - "+t.padInfo.left+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},li=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+r+"; dm++) {\n              int d2 = d1 * "+r+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},fi=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,i=t.padInfo.left,a=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),d=t.inChannels%4,p="channelsLast"===t.dataFormat,v=p?1:2,m=p?2:3,g=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+v+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===d)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+h+") *\n                    getW(wR, wC, "+h+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+h+", xR, xC) *\n                    getW(wR, wC, "+h+", d2);\n              }\n\n            } else if ("+(2===d)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===d)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2),\n                getW(wR, wC, "+h+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1),\n                  getX(batch, xR, xC, "+h+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC),\n                  getX(batch, "+h+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},hi=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,f=t.filterHeight,h=t.filterWidth,d=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+d+") *\n                  getW(wF, wR, wC, "+d+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1),\n                  getX(batch, xF, xR, xC, "+d+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2),\n                  getW(wF, wR, wC, "+d+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},di=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,f=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=t.outChannels/t.inChannels,v="",m="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+h+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+f+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+m+"\n        setOutput(result);\n      }\n    "},pi=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,f=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=d,v="int xR; int xC; int xCOffset;",m=0;m<h;m++)for(var g=0;g<d;g++)v+="\n          vec4 xTexelR"+m+"C"+2*g+" = vec4(0.);\n          vec4 wR"+m+"C"+g+" = vec4(0.);\n          vec4 xR"+m+"C"+g+" = vec4(0.);";for(m=0;m<h;m++)for(var y=0;y<p;y++){if(v+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(g=2*y)*f+";\n        ",1===c){if(g<d&&(v+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+".xy);\n                } else {\n                  xR"+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = xTexelR"+m+"C"+g+";\n              ",g+1<d)){var x=s%2==0?b(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(v+="\n                  xCOffset = xC + "+s%2+" + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",f>1&&(v+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+g+" = vec4(0.);\n                    }\n                  "),v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".xy);\n                "):v+="\n                  xCOffset = xC + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+";\n                "}}else g<d&&(v+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(v+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n              ",g+1<d&&(v+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+".xy, final.xy);\n                ")):(v+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+".xy);\n              ",g+1<d&&(v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n                ")),v+="}");g<d&&(v+="\n            vec4 wTexelR"+m+"C"+g+" = getW("+m+", "+g+", d1, q);\n            wR"+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+".xz);\n          ",g+1<d&&(v+="\n              vec4 wTexelR"+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+", d1, q);\n              wR"+m+"C"+(g+1)+" =\n                vec4(wTexelR"+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<h;m++)for(g=0;g<d;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var w="",_="";n&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",_="result = activation(result);");var C=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+v+"\n\n        vec4 result = dotProd;\n        "+C+"\n        "+_+"\n        setOutput(result);\n      }\n    "},vi=function(t,e,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],u=n[0],c=n[1];this.outputShape=[e[0],u,c,t[3]];var l=[a-1+".0",s-1+".0"],f=l[0],h=l[1],d=u>1?[""+(a-1)/(u-1),"(y2-y1) * height_ratio","y1*"+f+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+f],p=c>1?[""+(s-1)/(c-1),"(x2-x1) * width_ratio","x1*"+h+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+h];this.userCode="\n      const float height_ratio = float("+d[0]+");\n      const float width_ratio = float("+p[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+d[1]+";\n        float width_scale = "+p[1]+";\n\n        float in_y = "+d[2]+";\n        if( in_y < 0.0 || in_y > "+f+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+p[2]+";\n        if( in_x < 0.0 || in_x > "+h+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},mi=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Lo(r)+" coords = getOutputCoords();\n        int end = "+gi(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+gi(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===t)return""+e;if(2===t)return e+".x, "+e+".y";if(3===t)return e+".x, "+e+".y, "+e+".z";if(4===t)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function gi(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var yi=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ot.DENSE;var e=jt(t),n=Ro();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+No(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},bi=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ot.DENSE;var e=jt(t),n=Ro();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+No(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},xi=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),wi=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},_i=function(t){this.variableNames=["A"],this.outTexUsage=Mt.DOWNLOAD;var e=Ro();this.outputShape=t,this.userCode="\n      "+Oo+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},Ci=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Mt.DOWNLOAD;var e=Ro();this.outputShape=t,this.userCode="\n      "+Oo+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},Ei=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Ro(),o=e[0],i=e[1];this.outputShape=t;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+Fo(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},Si=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Ro(),o=e[0],i=e[1];this.outputShape=t;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Fo(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},Ii=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(n?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Ti=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.valueLoc&&(e.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(e.valueLoc,t)}},t}(),ki=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var o=Lo(this.rank),i=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<t.length;i++)o.push(i===e?"int(getIndices("+r[i]+"))":""+r[i]);return o.join()}(t,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Di=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=Lo(e.length),o=Lo(n.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Ai(t,e){var n=Ro();return $t(t,e,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Ri(t,e){return re(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Ni(t,e){return oe(t,e,new Uint16Array([0,1,2,2,1,3]))}function Fi(t,e,n,r,o,i,a){ae(n,r);var s=ie(t,e),u=t.TEXTURE_2D;return qt(t,e,(function(){return t.bindTexture(u,s)})),qt(t,e,(function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)})),qt(t,e,(function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)})),qt(t,e,(function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)})),qt(t,e,(function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)})),qt(t,e,(function(){return t.texImage2D(u,0,o,n,r,0,i,a,null)})),qt(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)})),s}function Oi(t,e,n,r,o){var i=Ut(n,r);return Fi(t,e,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function Mi(t,e,n,r,o){var i=Ut(n,r);return Fi(t,e,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function Pi(t,e,n,r,o){var i=Ut(n,r);return Fi(t,e,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function Li(t,e,n,r,o){var i=Ht(n,r);return Fi(t,e,i[0],i[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function Bi(t,e,n,r,o){var i=Ht(n,r);return Fi(t,e,i[0],i[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function Wi(t,e,n,r){return qt(t,e,(function(){return t.bindBuffer(t.ARRAY_BUFFER,r)})),ue(t,e,n,"clipSpacePos",r,3,20,0)&&ue(t,e,n,"uv",r,2,20,12)}function zi(t,e,n,r,o,i,a){var s,u,c;qt(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,n)})),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,c=a.internalFormatPackedFloat),s.set(i),qt(t,e,(function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,o,0,t.RGBA,u,s)})),qt(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))}function Ui(t,e,n,r){qt(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,n)})),r.data instanceof Uint8Array?qt(t,e,(function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)})):qt(t,e,(function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)})),qt(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))}function ji(t,e,n,r,o){var i=t.createBuffer();qt(t,e,(function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,i)}));var a=16*n*r;return qt(t,e,(function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)})),qt(t,e,(function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)})),qt(t,e,(function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)})),i}function Hi(t,e,n){var r=t,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Vi(t,e,n,r,o){var i=Ut(n,r),a=i[0],s=i[1],u=new Uint8Array(n*r*4);return qt(t,e,(function(){return t.readPixels(0,0,a,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function qi(t,e,n,r,o,i,a,s){var u=t,c=new Float32Array(function(t,e){var n=Ht(t,e);return n[0]*n[1]*4}(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function Gi(t,e,n,r){var o=new Float32Array(n*r*4);return qt(t,e,(function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,o)})),o}var Ki=Object.freeze({createVertexShader:Ai,createVertexBuffer:Ri,createIndexBuffer:Ni,createFloat32MatrixTexture:Oi,createFloat16MatrixTexture:Mi,createUnsignedBytesMatrixTexture:Pi,createPackedMatrixTexture:Li,createFloat16PackedMatrixTexture:Bi,bindVertexProgramAttributeStreams:Wi,uploadDenseMatrixToTexture:zi,uploadPixelDataToTexture:Ui,createBufferFromOutputTexture:ji,downloadFloat32MatrixFromBuffer:Hi,downloadByteEncodedFloatMatrixFromOutputTexture:Vi,downloadPackedMatrixFromBuffer:qi,downloadMatrixFromPackedOutputTexture:Gi}),Xi=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=s().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,Wt(e,t)):this.gl=zt(e);var n="WEBGL_color_buffer_float";if(1===s().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Xt(this.gl,this.debug,"OES_texture_float"),ke(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Xt(this.gl,this.debug,"OES_texture_half_float");else if(s().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),ke(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Xt(this.gl,this.debug,"EXT_color_buffer_half_float");else if(s().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(ke(this.gl,n="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!ke(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Ri(this.gl,this.debug),this.indexBuffer=Ni(this.gl,this.debug),this.framebuffer=se(this.gl,this.debug),this.textureConfig=Vt(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return s().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;qt(e,this.debug,(function(){return e.finish()})),qt(e,this.debug,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),qt(e,this.debug,(function(){return e.deleteFramebuffer(t.framebuffer)})),qt(e,this.debug,(function(){return e.bindBuffer(e.ARRAY_BUFFER,null)})),qt(e,this.debug,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)})),qt(e,this.debug,(function(){return e.deleteBuffer(t.indexBuffer)})),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),Oi(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),Mi(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),Pi(this.gl,this.debug,t,e)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),Ui(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,n,r){this.throwIfDisposed(),zi(this.gl,this.debug,t,e,n,r,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Bi(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Li(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(pe(this.gl,this.debug,this.framebuffer),this.outputTexture=null),qt(this.gl,this.debug,(function(){return e.gl.deleteTexture(t)}))},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,(function(){return Vi(r.gl,r.debug,e,n,r.textureConfig)}))},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,o,i){return qi(this.gl,t,0,0,0,o,i)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return Hi(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=ji(this.gl,this.debug,e,n);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(s().getBool("WEBGL_FENCE_API_ENABLED")){var o=t,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=o.clientWaitSync(i,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=i}else s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,(function(){return Gi(r.gl,r.debug,e,n)}))},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=Yt(e,this.debug,t),r=Ai(e,this.debug),o=te(e,this.debug);return qt(e,this.debug,(function(){return e.attachShader(o,r)})),qt(e,this.debug,(function(){return e.attachShader(o,n)})),ee(e,this.debug,o),this.debug&&ne(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Wi(e,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&qt(this.gl,this.debug,(function(){return e.gl.deleteProgram(t)}))},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&ne(this.gl,this.debug,this.program),qt(this.gl,this.debug,(function(){return e.gl.useProgram(t)}))},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?le(this.gl,this.debug,t,e):fe(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),qt(this.gl,this.debug,(function(){return n.gl.getAttribLocation(t,e)}))},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),he(this.gl,this.debug,0,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=Ht(e,n);this.setOutputMatrixTextureDriver(t,r[0],r[1])},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&ne(this.gl,this.debug,this.program),ve(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),qt(t,this.debug,(function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}))},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),qt(this.gl,this.debug,(function(){return t.gl.finish()}))},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Xt(this.gl,this.debug,2===s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(n){switch(n.label){case 0:return[4,R((function(){return e.disposed||e.isQueryAvailable(t,s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(t,s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise((function(n){e.addItemToPoll((function(){return t.isFencePassed()}),(function(){return n()}))}))},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map((function(t){return t.isDoneFn}))),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||R((function(){return n.pollItems(),0===n.itemsToPoll.length}))},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),de(this.gl,this.debug,t,this.framebuffer),this.debug&&ve(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(de(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ve(this.gl)):pe(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;de(r,this.debug,t,this.framebuffer),this.debug&&ve(r),this.outputTexture=t,qt(r,this.debug,(function(){return r.viewport(0,0,e,n)})),qt(r,this.debug,(function(){return r.scissor(0,0,e,n)}))},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var o=this;this.throwIfDisposed(),qt(this.gl,this.debug,(function(){return o.gl.scissor(t,e,n,r)}))},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function $i(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach((function(t,n){var r=t.logicalShape,o=e[n],i=o.shape;if(!I(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,s=o.isUniform?null:o.texData.texShape;if(!I(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}}))}var Yi=function(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=n.inChannels,o=n.strideWidth,i=n.strideHeight,a=n.padInfo,s=n.outWidth,u=n.dilationWidth,c=n.dilationHeight,l=n.dataFormat,f=a.left,h=a.top,d=r*n.filterWidth,p=Ro(),v="channelsLast"===l,m=v?0:1,g=v?1:2,y="",b=0;b<=1;b++)for(var x=0;x<=1;x++)y+="\n          blockIndex = rc.y + "+x+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+s+")) * "+i+" - "+h+";\n            d0 = offsetY + "+c+" * (pos / "+d+");\n\n            if(d0 < "+e[m]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+s+".) * "+o+". - "+f+".);\n              d1 = offsetX + "+u+" * (int(mod(float(pos), "+d+".) / "+r+".));\n\n              if(d1 < "+e[g]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+r+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+x)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+x)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+p.output+" = result;\n      }\n    "},Qi=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[];var i=e,a=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+s+")":1===o?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},Ji=function(t,e,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Zi=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i=e,a=t[3]-1;this.outputShape=t;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+a+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===o?"inversesqrt("+s+")":1===o?"1.0/("+s+")":"exp(log("+s+") * float(-"+o+"));")+";\n        setOutput(result);\n      }\n    "},ta=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(e-1-t.padInfo.top)+", "+(n-1-t.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+";\n          wR += "+t.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(e*n-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ea=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.effectiveFilterDepth,n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(e-1-t.padInfo.front)+", "+(n-1-t.padInfo.top)+", "+(r-1-t.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+e+";\n           wD += "+t.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+t.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+n+";\n              wR += "+t.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+t.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+r+";\n                wC += "+t.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+t.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(e*n*r-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+n+" * "+r+" +\n                  wR * "+r+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},na=function(t,e,n,r,o,i,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=Math.ceil((n?t[1]:t[2])/2),u=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",l=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",d="";i&&(h=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",d="result = activation(result);");var p=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+l[0]+" * "+f[0]+");\n          result += ("+l[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+p+"\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "},ra=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),oa=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},ia=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Ao("rc",e),r=Lo(e),o=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",o=t-2;o<t;o++)r+=n[o]+" >= "+e[o],o<t-1&&(r+="||");return r}(e,t,n),i=function(t,e,n,r){if(1===t)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(e,t[t.length-1],t[t.length-2],n),a=function(t,e){var n=t.length,r=function(t,e){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),a=2;a<t;a++)i=e[e.length-1-a]+","+i;n.push(i)}return n}(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(t,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},aa=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map((function(e,n){return e[0]+t[n]+e[1]}));var r=t.length,o=Lo(r),i=e.map((function(t){return t[0]})).join(","),a=e.map((function(e,n){return e[0]+t[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},sa=function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(e,n){return e[0]+t[n]+e[1]}));for(var r=t.length,o=Lo(r),i=e.map((function(t){return t[0]})).join(","),a=e.map((function(e,n){return e[0]+t[n]})).join(","),s=Ao("rc",r),u=Ao("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=1===r?2:4;p<v;p++)d+="\n        "+f[p]+"\n        if ("+h+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(d+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},ua=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;var h="avg"===e,d="0.0";if(h||(d="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(p="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+f+");\n      const float initializationValue = "+d+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+d+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},ca=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,f=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,v=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===e,g="0.0";if(m||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+i+", "+a+");\n        const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+f+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+h+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+f+" * "+h+" +\n                      wR * "+h+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(y="avgValue / count");var b=4*Math.floor(r/4),x=r%4,w="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},la=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",s="min"):"max"===e&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,f="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===e?(a="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===e&&(a="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var d="";o%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+f+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(2===l)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+f+"\n        } else if ("+(3===l)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+f+"\n        }\n        setOutput("+u+");\n      }\n    "},fa=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+No(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Fo(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},ha=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[n&&s>1?o-1:o,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],h=c[1]/l[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},da=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},pa=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=t[1],i=t[2],a=t[3];this.outputShape=[t[0],e,n,a];var s=[r&&e>1?o-1:o,r&&n>1?i-1:i],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/u[0]+",\n          "+s[1]/u[1]+",\n          "+s[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},va=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[n&&s>1?o-1:o,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],f=c[0]/l[0],h=c[1]/l[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+f+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},ma=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[1],i=t[2];this.outputShape=[t[0],e,n,t[3]];var a=[r&&e>1?o-1:o,r&&n>1?i-1:i],s=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},ga=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map((function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),o=Lo(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},ya=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=Ao("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],a=Lo(n);function s(n){var r=t.map((function(r,o){return function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(t){return s(t)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",s(t)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(t){return t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},ba=function(t,e,n,r,o,i,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Lo(o.length),u=Lo(i.length),c="";1===n?c="i":2===n&&(c="i, j");var l="";1===r?l="i":2===r&&(l="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(e>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+l+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},xa=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},wa=function(t,e,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=Lo(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},_a=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=Lo(this.rank),r="uniform int start["+this.rank+"];",o=function(t){if(1===t)return"sourceLoc";if(t<=6)return Ca.slice(0,t).map((function(t){return"sourceLoc."+t})).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+t.map((function(t,e){return"sourceLoc."+Ca[e]+" = start["+e+"] + coords."+Ca[e]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),Ca=["x","y","z","w","u","v"],Ea=function(){function t(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=Lo(this.rank),n=Ao("coords",this.rank),r=Ao("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+o+")",a="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map((function(t,e){return"start["+e+"]"})).join()+");":t.map((function(t,e){return r[e]+" = "+n[e]+" + start["+e+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),Sa=function(t,e,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=Lo(n.length),i=Lo(n.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=n.map((function(t,e){return s++,1===n.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(s-1)+"] * strides["+e+"] + begin["+e+"]"})).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+t+");\n      "+o+" strides = "+o+"("+e+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},Ia=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,o=Ta(e,n),i=ka(t,o,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[i].shift();return this.usedTextures[i].push(a),a}return this.numUsedTextures++,this.log(),o===Pt.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===Pt.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===Pt.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===Pt.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===Pt.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var o=ka(e,Ta(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[o],a=i.indexOf(t);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(a,1),this.log()}},t.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach((function(e){t.gpgpu.deleteMatrixTexture(e)}));for(var e in this.usedTextures)this.usedTextures[e].forEach((function(e){t.gpgpu.deleteMatrixTexture(e)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function Ta(t,e){if(t===Mt.UPLOAD)return Pt.PACKED_2X2_FLOAT32;if(t===Mt.RENDER||null==t)return function(t){return s().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Pt.PACKED_2X2_FLOAT32:Pt.UNPACKED_FLOAT32:t?Pt.PACKED_2X2_FLOAT16:Pt.UNPACKED_FLOAT16}(e);if(t===Mt.DOWNLOAD||t===Mt.PIXELS)return Pt.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function ka(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var Da=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var o=Lo(this.rank),i=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<t.length;o++)r.push("imod("+n[o]+", "+t[o]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Aa=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var o=Lo(this.rank),i=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),o=0;o<t.length;o++)r[t[o]]=n[o];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},Ra=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Lo(this.rank),i=Do("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Na=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Fa="if (isnan(x)) return x;",Oa="return abs(x);",Ma=Fa+"\n  return (x < 0.0) ? 0.0 : x;\n",Pa=Fa+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",La="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ba="return -x;",Wa="return ceil(x);",za="return floor(x);",Ua="return exp(x);",ja="return exp(x) - 1.0;",Ha="return x;",Va="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",qa="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ga="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Ka=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Xa=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,n=Ao("rc",e),r=Lo(e),o=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),i=n.slice(-2),a=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},$a={};function Ya(t,e){if(void 0===e&&(e=!1),"linear"===t)return"return x;";if("relu"===t)return e?Va:Ma;if("elu"===t)return e?Ga:La;if("relu6"===t)return e?qa:Pa;if("prelu"===t)return e?Qo:$o;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var Qa=function(t){function e(e){var n,r=t.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!s().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var o=zt(s().getNumber("WEBGL_VERSION"));r.binaryCache=((n=s().getNumber("WEBGL_VERSION"))in $a||($a[n]={}),$a[n]),r.gpgpu=new Xi(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=e,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=e.gl.canvas;return r.textureManager=new Ia(r.gpgpu),r.numMBBeforeWarning=null==s().global.screen?1024:s().global.screen.height*s().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new Ur(r,Rt),r}return n(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,e,n){if(s().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:Mt.UPLOAD}),r},e.prototype.move=function(t,e,n,r){if(s().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:Mt.UPLOAD})},e.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,o=e.complexTensors,i=e.shape;if(null!=e.slice){var a;a=e.isPacked?new Ka(i,Ha):new Na(i,Ha);var s=this.runWebGLProgram(a,[{dataId:t,shape:i,dtype:r}],r),u=this.readSync(s.dataId);return this.disposeData(s.dataId),u}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var c,l,f=null!=this.activeTimers;return f&&(c=tt()),l="complex64"===r?co(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(t),f&&(this.downloadWaitMs+=tt()-c),this.convertAndCacheOnCPU(t,l)},e.prototype.read=function(t){return r(this,void 0,void 0,(function(){var e,n,r,i,a,u,c,l,f,h,d,p,v,m,g,y,b,x,w;return o(this,(function(o){switch(o.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise((function(t){return e.push(t)}))];if(n=this.texData.get(t),r=n.values,i=n.shape,a=n.dtype,u=n.complexTensors,c=n.isPacked,null!=n.slice)return l=c?new Ka(i,Ha):new Na(i,Ha),f=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:a}],a),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(null!=r)return[2,this.convertAndCacheOnCPU(t)];if(!s().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===s().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==a&&s().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(t),v=this.texData.get(p.dataId),d=(w=this.gpgpu).createBufferFromTexture.apply(w,[v.texture].concat(jt(i)))),this.pendingRead.set(t,[]),"complex64"===a?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:o.sent(),o.label=2;case 2:return"complex64"!==a?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return g=o.sent(),m=co(g[0],g[1]),[3,5];case 4:null==d?m=this.getValuesFromTexture(t):(y=S(i),m=this.gpgpu.downloadFloat32MatrixFromBuffer(d,y)),o.label=5;case 5:return null!=p&&this.disposeData(p.dataId),b=this.convertAndCacheOnCPU(t,m),x=this.pendingRead.get(t),this.pendingRead.delete(t),x.forEach((function(t){return t(b)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,b]}}))}))},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var e=0;e<t.length;e++){var n=t[e];if(!Gt(n)){if(s().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},e.prototype.getValuesFromTexture=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,i=n.isPacked,a=S(r);if(s().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),c=this.texData.get(u.dataId),l=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[c.texture].concat(jt(r))).subarray(0,a);return this.disposeData(u.dataId),l}var f=s().getBool("WEBGL_PACK")&&!0===i,h=f?we(r):r,d=f?new Ci(h):new _i(h),p=this.runWebGLProgram(d,[{shape:h,dtype:o,dataId:t}],"float32"),v=this.texData.get(p.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,a);return this.disposeData(p.dataId),m},e.prototype.time=function(t){return r(this,void 0,void 0,(function(){var e,n,r,i,a,s,u;return o(this,(function(o){switch(o.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),i=E(this.activeTimers.map((function(t){return t.query}))).filter((function(t){return null!=t})),a=E(this.activeTimers.map((function(t){return t.name}))).filter((function(t){return null!=t})),this.activeTimers=e,r&&(this.programTimersStack=null),[4,Promise.all(i)];case 1:return s=o.sent(),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:x(s),getExtraProfileInfo:function(){return s.map((function(t,e){return{name:a[e],ms:t}})).map((function(t){return t.name+": "+t.ms})).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:tt(),endMs:null}},e.prototype.endTimer=function(t){return s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=tt(),t)},e.prototype.getQueryTime=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){return s().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var e=this.texData.get(t),n=e.texture,r=e.dtype,o=e.texShape,i=e.usage,a=e.isPacked,s=e.slice,u=s&&s.origDataId||t,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,i,a)));var l=this.texData.get(t);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return s().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Rt.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every((function(t){return null==n.texData.get(t.dataId).texture&&t.size<e}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,e){var n=this.makeOutput(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Rt.keep(t.clone()),imag:Rt.keep(e.clone())},n},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);if(0===S(n))return an([],n,t.dtype);var r=this.texData.get(t.dataId).isPacked,o=Fr(t.shape,e,n);if(r||!o){var i=s().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ea(n):new _a(n),a=i.getCustomSetupFunc(e);return this.compileAndRun(i,[t],null,a)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},e.prototype.shallowSlice=function(t,e,n){var r=this.texData.get(t.dataId),o=this.makeOutput(n,t.dtype),i=this.texData.get(o.dataId);Object.assign(i,r),i.shape=n,i.dtype=t.dtype;var a=Or(e,t.strides);r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),o},e.prototype.stridedSlice=function(t,e,n,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r);var o=Ar(e,n,r);if(o.some((function(t){return 0===t})))return an([],o);var i=new Sa(e,r,o);return this.compileAndRun(i,[t])},e.prototype.reverse=function(t,e){var n=s().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ya(t.shape,e):new ga(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.concat=function(t,e){if("complex64"===t[0].dtype){var n=t.map((function(t){return rn(t)})),r=t.map((function(t){return on(t)}));return nn(this.concat(n,e),this.concat(r,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>s().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),i=this.concat(t.slice(0,o),e),a=this.concat(t.slice(o),e);return this.concat([i,a],e)}if(s().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var u=new ri(t.map((function(t){return t.shape})),e);return this.compileAndRun(u,t)}var c=tn(t.map((function(t){return t.shape})),e),l=t.map((function(t){return t.as2D(-1,S(t.shape.slice(e)))})),f=new ni(l.map((function(t){return t.shape})));return this.compileAndRun(f,l).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(s().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ba,t.dtype);var e=new Na(t.shape,Ba);return this.compileAndRun(e,[t])},e.prototype.batchMatMul=function(t,e,n,r){var o=n?t.shape[2]:t.shape[1],i=r?e.shape[1]:e.shape[2],a=n?t.shape[1]:t.shape[2],s=t.shape[0];if((1===o||1===i)&&a>1e3){n&&(t=t.transpose([0,2,1])),r&&(e=e.transpose([0,2,1]));var u=1===i?t:t.as3D(s,a,1),c=1===i?2:1,l=1===i?e.as3D(s,1,a):e;return this.multiply(u,l).sum(c,!0)}var f=_t(t.dtype,e.dtype),h=new na(t.shape,[s,o,i],n,r);return this.compileAndRun(h,[t,e],f)},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,o=t.transposeB,i=t.bias,a=t.activation,s=t.preluActivationWeights,u=r?e.shape[2]:e.shape[1],c=o?n.shape[1]:n.shape[2],l=e.shape[0],f=_t(e.dtype,n.dtype),h=null!=i,d=null!=s,p=a?Ya(a,!0):null,v=new na(e.shape,[l,u,c],r,o,h,p,d),m=[e,n];return i&&m.push(i),s&&m.push(s),this.compileAndRun(v,m,f)},e.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),o=new qo("return areal * breal - aimag * bimag;",t.shape,e.shape),i=new qo("return areal * bimag + aimag * breal;",t.shape,e.shape),a=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag),this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)],u=this.compileAndRun(o,a),c=this.compileAndRun(i,a),l=this.complex(u,c);return u.dispose(),c.dispose(),l}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Xo,t.dtype);var f=new Yo(Xo,t.shape,e.shape);return this.compileAndRun(f,[t,e],t.dtype)},e.prototype.batchNormalization=function(t,e,n,r,o,i){var a=[t,e,n],u=null;null!=i&&(u=i.shape,a.push(i));var c=null;if(null!=o&&(c=o.shape,a.push(o)),s().getBool("WEBGL_PACK_NORMALIZATION")){var l=new Vo(t.shape,e.shape,n.shape,u,c,r);return this.compileAndRun(l,a)}var f=new Ho(t.shape,e.shape,n.shape,u,c,r);return this.compileAndRun(f,a)},e.prototype.localResponseNormalization4D=function(t,e,n,r,o){var i=s().getBool("WEBGL_PACK_NORMALIZATION")?new Zi(t.shape,e,n,r,o):new Qi(t.shape,e,n,r,o);return this.compileAndRun(i,[t])},e.prototype.LRNGrad=function(t,e,n,r,o,i,a){var s=new Ji(e.shape,r,o,i,a);return this.compileAndRun(s,[e,n,t])},e.prototype.tile=function(t,e){if("string"===t.dtype){var n=this.readSync(t.dataId).map((function(t){return rt(t)}));return Co(Un(t.shape,t.dtype,n),e)}var r=new Da(t.shape,e);return this.compileAndRun(r,[t])},e.prototype.pad=function(t,e,n){var r=s().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sa(t.shape,e,n):new aa(t.shape,e,n);return this.compileAndRun(r,[t])},e.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var n=s().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ra(t.shape,e):new Aa(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var r=new ki(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},e.prototype.batchToSpaceND=function(t,e,n){w(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=e.reduce((function(t,e){return t*e})),o=mr(t.shape,e,r),i=gr(o.length,e.length),a=yr(t.shape,e,r),s=br(n,e.length),u=xr(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){w(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=e.reduce((function(t,e){return t*e})),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=mr(a.shape,e,r,!1),u=gr(s.length,e.length,!1),c=yr(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(c)},e.prototype.reduce=function(t,e,n){var r=t.shape[0],o=t.shape[1],i=Cr(o),a=new la({windowSize:i,inSize:o,batchSize:r},e),s=this.compileAndRun(a,[t],n);return 1===s.shape[1]?s:this.reduce(s,e,n)},e.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],o=t.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var i=Cr(o),a=new ko({windowSize:i,inSize:o,batchSize:r},e,null==n),s=[t];null!=n&&s.push(n);var u=this.compileAndRun(a,s,"int32");return 1===u.shape[1]?u:this.argReduce(t,e,u)},e.prototype.argReducePacked=function(t,e,n){void 0===n&&(n=null);var r=null!=n?n.shape:t.shape,o=Cr(r[r.length-1]),i=new zo(r,o,e,null==n),a=this.compileAndRun(i,null==n?[t]:[t,n],"int32");return a.rank===t.rank?this.argReducePacked(t,e,a):a},e.prototype.sum=function(t,e){$e("sum",e,t.rank);var n=Ke(t.shape,e),r=n[0],o=S(n[1]),i=t.as2D(-1,o),a=Ct(t.dtype);return this.reduce(i,"sum",a).reshape(r)},e.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=Ke(t.shape,e),r=n[0],o=S(n[1]),i=t.as2D(-1,o),a=Ct(t.dtype);return this.reduce(i,"prod",a).reshape(r)},e.prototype.unsortedSegmentSum=function(t,e,n){var r=0,o=Ye([r],t.rank),i=t;null!=o&&(i=t.transpose(o),r=Je(1,t.rank)[0]);var a=function(t,e,n){for(var r=[],o=t.length,i=0;i<o;i++)r.push(i!==e?t[i]:n);return r}(i.shape,r,n),s=S([i.shape[r]]),u=i.as2D(-1,s),c=Ct(t.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",e,c,n).reshape(a);return null!=o&&(l=l.transpose(Qe(o))),l},e.prototype.segOpCompute=function(t,e,n,r,o){var i=t.shape[0],a=t.shape[1],s=function(t,e){var n,r=!1;for(t<=30?(n=t,r=!0):n=X(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=X(t,n+1);return n}(a,o),u=new xa({windowSize:s,inSize:a,batchSize:i,numSegments:o},e),c=this.compileAndRun(u,[t,n],r);return c.shape[1]===o?c:(n=xn(0,o).tile([a/s]),this.segOpCompute(c,e,n,r,o))},e.prototype.argMinMaxReduce=function(t,e,n){var r=[e];if($e("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,t.rank),!s().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=Ke(t.shape,r),i=o[0],a=S(o[1]),u=t.as2D(-1,a);return this.argReduce(u,n).reshape(i)}return this.argReducePacked(t,n)},e.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},e.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},e.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var o=new mi(t.shape,n,r);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,e){if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var n=new Yo("return float(a == b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.notEqual=function(t,e){if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Yo("return float(a != b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Yo("return float(a < b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.lessEqual=function(t,e){if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Yo("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Yo("return float(a > b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greaterEqual=function(t,e){if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Yo("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalNot=function(t){var e=new Na(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},e.prototype.logicalAnd=function(t,e){if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Yo("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalOr=function(t,e){if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Yo("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.select=function(t,e,n){var r=new wa(t.rank,e.shape,e.rank);return this.compileAndRun(r,[t,e,n],_t(e.dtype,n.dtype))},e.prototype.where=function(t){ze("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return So(t.shape,e)},e.prototype.topk=function(t,e,n){return Eo(t.dataSync(),t.shape,t.dtype,e)},e.prototype.min=function(t,e){$e("min",e,t.rank);var n=Ke(t.shape,e),r=n[0],o=S(n[1]),i=t.as2D(-1,o);return this.reduce(i,"min",i.dtype).reshape(r)},e.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=s().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Yo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.mod=function(t,e){var n=s().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Yo("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);$e("max",e,t.rank);var n=Ke(t.shape,e),r=n[0],o=S(n[1]),i=t.as2D(-1,o);return this.reduce(i,"max",i.dtype).reshape(r)},e.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=s().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Yo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.all=function(t,e){$e("all",e,t.rank);var n=Ke(t.shape,e),r=n[0],o=S(n[1]),i=t.as2D(-1,o);return this.reduce(i,"all",i.dtype).reshape(r)},e.prototype.any=function(t,e){$e("any",e,t.rank);var n=Ke(t.shape,e),r=n[0],o=S(n[1]),i=t.as2D(-1,o);return this.reduce(i,"any",i.dtype).reshape(r)},e.prototype.squaredDifference=function(t,e){var n=s().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("return (a - b) * (a - b);",t.shape,e.shape):new Yo("return (a - b) * (a - b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.realDivide=function(t,e){if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new Yo("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape);return this.compileAndRun(n,[t,e],"float32")},e.prototype.floorDiv=function(t,e){if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Yo("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape);return this.compileAndRun(n,[t,e],"int32")},e.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Go);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=_t(t.dtype,e.dtype);if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Go,n);var r=new Yo(Go,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.packedUnaryOp=function(t,e,n){var r=new Ka(t.shape,e);return this.compileAndRun(r,[t],n)},e.prototype.packedBinaryOp=function(t,e,n,r,o){void 0===o&&(o=!1);var i=new Jo(n,t.shape,e.shape,o);return this.compileAndRun(i,[t,e],r)},e.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,o=this.texData.get(t.dataId),i=this.texData.get(e.dataId),a=[[o.complexTensors.real,i.complexTensors.real],[o.complexTensors.imag,i.complexTensors.imag]].map((function(o){var i=o[0],a=o[1],s=r.makeComplexComponentTensorInfo(t,i),u=r.makeComplexComponentTensorInfo(e,a),c=new Yo(n,t.shape,e.shape);return r.compileAndRun(c,[s,u],_t(i.dtype,a.dtype))})),s=a[0],u=a[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},e.prototype.makeComplexComponentTensorInfo=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>s().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),n=this.addN(t.slice(0,e)),r=this.addN(t.slice(e));return this.addN([n,r])}var o=t.map((function(t){return t.dtype})).reduce((function(t,e){return _t(t,e)})),i=t.map((function(t){return t.shape})),a=s().getBool("WEBGL_PACK")?new To(t[0].shape,i):new Io(t[0].shape,i);return this.compileAndRun(a,t,o)},e.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Ko);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=_t(t.dtype,e.dtype);if(s().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Ko,t.dtype);var r=new Yo(Ko,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.pow=function(t,e){var n=s().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Yo("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),r=_t(t.dtype,e.dtype);return this.compileAndRun(n,[t,e],r)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(s().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Wa,t.dtype);var e=new Na(t.shape,Wa);return this.compileAndRun(e,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(s().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,za,t.dtype);var e=new Na(t.shape,za);return this.compileAndRun(e,[t])},e.prototype.sign=function(t){var e=new Na(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},e.prototype.isNaN=function(t){var e=new Na(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isInf=function(t){var e=new Na(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isFinite=function(t){var e=new Na(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.round=function(t){var e=new Na(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(s().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ua,t.dtype);var e=new Na(t.shape,Ua);return this.compileAndRun(e,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(s().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ja,t.dtype);var e=new Na(t.shape,ja);return this.compileAndRun(e,[t])},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(s().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var e=new Na(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(e,[t])},e.prototype.log1p=function(t){var e=new Na(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},e.prototype.sqrt=function(t){var e=new Na(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new Na(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},e.prototype.reciprocal=function(t){var e=new Na(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},e.prototype.relu=function(t){var e;return e=s().getBool("WEBGL_PACK")?new Ka(t.shape,Va):new Na(t.shape,Ma),this.compileAndRun(e,[t])},e.prototype.relu6=function(t){var e;return e=s().getBool("WEBGL_PACK")?new Ka(t.shape,qa):new Na(t.shape,Pa),this.compileAndRun(e,[t])},e.prototype.prelu=function(t,e){var n=s().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo(Qo,t.shape,e.shape):new Yo($o,t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.elu=function(t){if(s().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ga,t.dtype);var e=new Na(t.shape,La);return this.compileAndRun(e,[t])},e.prototype.eluDer=function(t,e){var n=s().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new Yo("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.selu=function(t){var e=new Na(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},e.prototype.int=function(t){var e=new Na(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")},e.prototype.clip=function(t,e,n){var r,o=(r=s().getBool("WEBGL_PACK_CLIP")?new ti(t.shape):new Zo(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(s().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Oa,t.dtype);var e=new Na(t.shape,Oa);return this.compileAndRun(e,[t])},e.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new ei(t.shape),r=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(t){var e=new Na(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},e.prototype.softplus=function(t){var e=new Na(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},e.prototype.sin=function(t){var e=new Na(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])},e.prototype.cos=function(t){var e=new Na(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])},e.prototype.tan=function(t){var e=new Na(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},e.prototype.asin=function(t){var e=new Na(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(e,[t])},e.prototype.acos=function(t){var e=new Na(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan=function(t){var e=new Na(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan2=function(t,e){var n=s().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Yo("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.sinh=function(t){var e=new Na(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.cosh=function(t){var e=new Na(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.tanh=function(t){var e=new Na(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},e.prototype.asinh=function(t){var e=new Na(t.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},e.prototype.acosh=function(t){var e=new Na(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[t])},e.prototype.atanh=function(t){var e=new Na(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[t])},e.prototype.erf=function(t){var e=new Na(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(e,[t])},e.prototype.step=function(t,e){var n=new Na(t.shape,function(t){return void 0===t&&(t=0),Fa+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},e.prototype.conv2dByMatMul=function(t,e,n,r,o,i){var a=t.shape,u=this.texData.get(t.dataId),c="channelsLast"===n.dataFormat,l=a[2]%2!=0&&!!u.isPacked;if((1==a[0]*a[1]*a[2]||1===n.outChannels)&&n.inChannels>1e3||!s().getBool("WEBGL_LAZILY_UNPACK")||!s().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!l){var f=this.reshape(t,[1,c?a[0]*a[1]*a[2]:a[0]*a[2]*a[3],n.inChannels]),h=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:f,b:h,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:i}),n.outShape)}var d={dataId:t.dataId,shape:[1,c?a[0]*a[1]*(a[2]+1):a[0]*a[2]*(a[3]+1),n.inChannels],dtype:t.dtype},p=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,w(Ee(u.shape,d.shape),(function(){return"packed reshape "+u.shape+" to "+d.shape+" isn't free"}));var v=this.reshape(e,[1,n.inChannels,n.outChannels]),m=this.fusedBatchMatMul({a:d,b:v,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:i}),g=this.texData.get(m.dataId);return w(g.isPacked,(function(){return"batchMatMul result is expected to be packed"})),u.shape=p,g.shape=n.outShape,Rt.makeTensorFromDataId(m.dataId,n.outShape,m.dtype)},e.prototype.conv2dWithIm2Row=function(t,e,n,r,o,i){var a=n.outWidth,s=n.outHeight,u="channelsLast"===n.dataFormat,c=n.filterWidth*n.filterHeight*n.inChannels,l=s*a,f=[c,l],h=t.squeeze([0]),d=e.reshape([1,c,-1]),p=new Yi(f,h.shape,n),v=this.compileAndRun(p,[h]).reshape([1,f[0],f[1]]),m=null!=r,g=null!=i,y=o?Ya(o,!0):null,b=new na(v.shape,[1,l,n.outChannels],!0,!1,m,y,g),x=[v,d];return r&&x.push(r),g&&x.push(i),this.compileAndRun(b,x).reshape(u?[1,s,a,n.outChannels]:[1,n.outChannels,s,a])},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,i=t.activation,a=t.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(e,n,r,o,i,a);if(s().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,n,r,o,i,a);var u=null!=o,c=null!=a,l=i?Ya(i,!1):null,f=new fi(r,u,l,c),h=[e,n];return o&&h.push(o),a&&h.push(a),this.compileAndRun(f,h)},e.prototype.conv2d=function(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(s().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new fi(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerInput=function(t,e,n){var r=new ai(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerFilter=function(t,e,n){var r=new ii(n);return this.compileAndRun(r,[t,e])},e.prototype.fusedDepthwiseConv2D=function(t){var e,n=t.input,r=t.filter,o=t.convInfo,i=t.bias,a=t.activation,u=t.preluActivationWeights,c=s().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,l=a?Ya(a,c):null,f=[n,r],h=null!=i,d=null!=u;return h&&f.push(i),d&&f.push(u),c?(e=new pi(o,h,l,d),this.compileAndRun(e,f)):(e=new di(o,h,l,d),this.compileAndRun(e,f))},e.prototype.depthwiseConv2D=function(t,e,n){var r;return s().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new pi(n),this.compileAndRun(r,[t,e])):(r=new di(n),this.compileAndRun(r,[t,e]))},e.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new li(n);return this.compileAndRun(r,[t,e])},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new ci(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3d=function(t,e,n){var r=new hi(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerInput=function(t,e,n){var r=new ui(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerFilter=function(t,e,n){var r=new si(n);return this.compileAndRun(r,[t,e])},e.prototype.maxPool=function(t,e){var n=new ua(e,"max",!1);return this.compileAndRun(n,[t])},e.prototype.avgPool=function(t,e){var n=new ua(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPoolBackprop=function(t,e,n,r){var o=new ua(r,"max",!0),i=this.compileAndRun(o,[e]),a=new ta(r),s=this.compileAndRun(a,[t,i],e.dtype);return i.dispose(),s},e.prototype.avgPoolBackprop=function(t,e,n){var r=new Uo(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.cast=function(t,e){return io(t,e,this)},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},e.prototype.avgPool3d=function(t,e){var n=new ca(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,e,n){var r=new jo(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.maxPool3d=function(t,e){var n=new ca(e,"max",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,e,n,r){var o=new ca(r,"max",!0),i=this.compileAndRun(o,[e]),a=new ea(r),s=this.compileAndRun(a,[t,i],e.dtype);return i.dispose(),s},e.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);if(n.isPacked&&!Ee(t.shape,e)&&(null===n.texture||!Ee(n.shape,e))){var r=this.packedReshape(t,e);return Rt.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return ao(t,e)},e.prototype.resizeBilinear=function(t,e,n,r){var o=s().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new pa(t.shape,e,n,r):new da(t.shape,e,n,r);return this.compileAndRun(o,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,e,n){var r=new ha(t,e,n);return this.compileAndRun(r,[t])},e.prototype.resizeNearestNeighbor=function(t,e,n,r){var o=new ma(t.shape,e,n,r);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new va(t,e,n);return this.compileAndRun(r,[t])},e.prototype.multinomial=function(t,e,n,r){var o=e?t:Wr(t),i=new ra(o.shape[0],o.shape[1],n),a=i.getCustomSetupFunc(r);return this.compileAndRun(i,[o],"int32",a)},e.prototype.oneHot=function(t,e,n,r){var o=new oa(t.size,e,n,r);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var e=new wi(t.size);return this.compileAndRun(e,[t])},e.prototype.nonMaxSuppression=function(t,e,n,r,o){return ze("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),mo(t.dataSync(),e.dataSync(),n,r,o)},e.prototype.cropAndResize=function(t,e,n,r,o,i){var a=new vi(t.shape,e.shape,r,o,i);return this.compileAndRun(a,[t,e,n],"float32")},e.prototype.depthToSpace=function(t,e,n){w(e>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}));var r=t.shape[0],o=("NHWC"===n?t.shape[1]:t.shape[2])*e,i=("NHWC"===n?t.shape[2]:t.shape[3])*e,a=("NHWC"===n?t.shape[3]:t.shape[1])/(e*e),s=new xi("NHWC"===n?[r,o,i,a]:[r,a,o,i],e,n);return this.compileAndRun(s,[t])},e.prototype.split=function(t,e,n){return _o(t,e,n)},e.prototype.scatterND=function(t,e,n){var r=Ir(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/a,a],l=t.reshape([i,o]),f=e.reshape([i,a]);if(0===u)return ao(an([]),n);var h=un(0),d=new ba(i,o,l.rank,f.rank,s,c);return this.compileAndRun(d,[f,l,h]).reshape(n)},e.prototype.sparseToDense=function(t,e,n,r){var o=Ir(0,t,n),i=new ba(o.numUpdates,o.sliceRank,t.rank,e.rank,o.strides,[o.outputSize,1],!1);return this.compileAndRun(i,[e,t,r]).reshape(n)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new Ii("return real * expR - imag * expI;",t.shape,e),o=new Ii("return real * expI + imag * expR;",t.shape,e),i=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)],a=this.compileAndRun(r,i),s=this.compileAndRun(o,i),u=this.complex(a,s).as2D(t.shape[0],t.shape[1]);return a.dispose(),s.dispose(),u},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=wr(t,e),i=o[0],a=o[1],s=o[2],u=o[3],c=e.reshape([a,r]),l=t.reshape([t.size/s,s]),f=new Di(r,u,[a,s]);return this.compileAndRun(f,[l,c]).reshape(i)},e.prototype.fill=function(t,e,n){if("string"===(n=n||G(e))){var r=P(n,S(t));return r.fill(e),Rt.makeTensor(r,t,n,this)}var o=new Ti(t,e),i=o.getCustomSetupFunc(e);return this.compileAndRun(o,[],n,i)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,e,n){return so(t,e,n)},e.prototype.makeTensorInfo=function(t,e){var n=this.write(null,t,e);return this.texData.get(n).usage=null,{dataId:n,shape:t,dtype:e}},e.prototype.makeOutput=function(t,e){var n=this.makeTensorInfo(t,e).dataId;return Rt.makeTensorFromDataId(n,t,e,this)},e.prototype.unpackTensor=function(t){var e=new Xa(t.shape);return this.runWebGLProgram(e,[t],t.dtype)},e.prototype.packTensor=function(t){var e=new ia(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,e){var n=[be(t.shape)].concat(xe(t.shape)),r={dtype:t.dtype,shape:n,dataId:t.dataId},o=[be(e)].concat(xe(e)),i=new fa(o,n),a=this.runWebGLProgram(i,[r],t.dtype,null,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}},e.prototype.decode=function(t){var e,n=this.texData.get(t),r=n.isPacked,o=n.shape,i=n.dtype,a=we(o);return e=r?new bi(a):new yi(a),{dtype:i,shape:o,dataId:this.runWebGLProgram(e,[{shape:a,dtype:i,dataId:t}],i,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,e,n,r,o){var i=this;void 0===o&&(o=!1);var a=this.makeTensorInfo(t.outputShape,n),u=this.texData.get(a.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===Ot.DENSE){var c=jt(t.outputShape);u.texShape=c.map((function(t){return 2*t}))}if(null!=t.outTexUsage&&(u.usage=t.outTexUsage),0===S(a.shape))return u.values=M(a.dtype,0),a;var l=[],f=e.map((function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&S(e.shape)<=s().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.packedInputs)e=n.isPacked?i.unpackTensor(e):i.packTensor(e),l.push(e),n=i.texData.get(e.dataId);else if(n.isPacked&&!Ee(n.shape,e.shape)){var r=e,o=e.shape;e.shape=n.shape,e=i.packedReshape(e,o),l.push(e),n=i.texData.get(e.dataId),r.shape=o}return i.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(a.dataId);var h,d={shape:a.shape,texData:u,isUniform:!1},p=function(t,e,n){var r="";return e.concat(n).forEach((function(t){r+=t.shape+"_"+(t.isUniform?"uniform":t.texData.texShape)+"_"+(null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0)})),t.constructor.name+"_"+r+"_"+t.userCode}(t,f,d),v=this.getAndSaveBinary(p,(function(){return function(t,e,n,r){var o=e.userCode,i=n.map((function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),a=i.map((function(t){return t.shapeInfo})),u={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=function(t,e,n,r){var o=[];t.forEach((function(t){var e=S(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?o.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(o.push("uniform sampler2D "+t.name+";"),o.push("uniform int offset"+t.name+";"))}));var i,a,s=o.join("\n"),u=t.map((function(t){return function(t,e,n){void 0===n&&(n=!1);var r="";return r+=n?function t(e){var n;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=e.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+Ro().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=Ro();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+i.texture2D+"("+e+", uv);\n    }\n  "}(e);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],s=Ro();if(null!=o&&I(e,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+i+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=Bo(e,n.slice(1));return"\n        "+t(s)+"\n        vec4 "+o+"(int b, int row, int col) {\n          return "+o+"("+Wo(["b","row","col"],[1,2])+");\n        }\n      "}var u=a[0],c=a[1],l=Math.ceil(n[2]/2);return"\n    vec4 "+o+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+u+", "+c+", "+l*Math.ceil(n[1]/2)+", "+l+", b, row, col);\n      return "+Ro().texture2D+"("+r+", uv);\n    }\n  "}(e);default:return function(t){for(var e=t.shapeInfo.logicalShape,n=e.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=a[0],u=a[1],c=Math.ceil(e[n-1]/2),l=c*Math.ceil(e[n-2]/2),f="int b, int row, int col",h="b * "+l+" + (row / 2) * "+c+" + (col / 2)",d=2;d<n-1;d++)f="int b"+d+", "+f,h="b"+d+" * "+(l*=e[n-d-1])+" + "+h;return"\n    vec4 "+o+"("+f+") {\n      int index = "+h+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Ro().texture2D+"("+r+", uv);\n    }\n  "}(e)}}(t):function t(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+n+"() {return "+e+";}";var r=t.shapeInfo.texShape;if(1===r[0]&&1===r[1])return"\n      float "+n+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var o=t.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+Mo(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Po(t)+"\n      }\n    ";var r=t.shapeInfo.texShape,o=r[0],i=r[1];if(1===i&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=Mo(e);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+i+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 2:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&I(n,i))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+i[0]+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ";var a=O(n),s=a.newShape,u=a.keptDims;if(s.length<n.length){var c=Bo(e,s);return"\n      "+t(c)+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+Wo(["row","col"],u)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+Po(e)+"\n      }\n    ";var l=i[0],f=i[1],h=Mo(r);return 1===f?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===l?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+h+";\n    vec2 uv = uvFromFlat("+l+", "+f+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],a=n[2],s=O(n),u=s.newShape,c=s.keptDims;if(u.length<n.length){var l=Bo(e,u);return"\n        "+t(l)+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+Wo(["row","col","depth"],c)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+a+", 1)));\n        "+Po(e)+"\n      }\n    ";var f=e.shapeInfo.texShape,h=f[0],d=f[1],p=e.shapeInfo.flatOffset;return d===i&&null==p?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+h+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":d===a&&null==p?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+h+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+a+" + depth + "+Mo(r)+";\n        vec2 uv = uvFromFlat("+h+", "+d+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(e);case 4:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],a=n[2]*i,s=n[1]*a,u=O(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var f=Bo(e,c);return"\n      "+t(f)+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+Wo(["row","col","depth","depth2"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+a+", "+i+", 1)));\n        "+Po(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],v=d[1];return v===s&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":v===i&&null==h?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+a+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+v+", index + "+Mo(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 5:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[4],a=n[3]*i,s=n[2]*a,u=n[1]*s,c=O(n),l=c.newShape,f=c.keptDims;if(l.length<n.length){var h=Bo(e,l);return"\n      "+t(h)+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+Wo(["row","col","depth","depth2","depth3"],f)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+a+", "+i+")) +\n          depth3;\n        "+Po(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],m=p[1];return m===u&&null==d?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":m===i&&null==d?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" + depth * "+a+" +\n          depth2 * "+i+" + depth3 + "+Mo(r)+";\n      vec2 uv = uvFromFlat("+v+", "+m+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 6:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=O(n),a=i.newShape,s=i.keptDims;if(a.length<n.length){var u=Bo(e,a);return"\n      "+t(u)+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+Wo(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    "}var c=n[5],l=n[4]*c,f=n[3]*l,h=n[2]*f,d=n[1]*h;if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+d+", "+h+", "+f+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+c+", 1)));\n        "+Po(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,m=v[0],g=v[1];return g===d&&null==p?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+f+", "+l+", "+c+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":g===c&&null==p?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+d+" + col * "+h+" + depth * "+f+" +\n          depth2 * "+l+" + depth3 * "+c+" + depth4 + "+Mo(r)+";\n      vec2 uv = uvFromFlat("+m+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(t),t.shapeInfo.logicalShape.length<=e.logicalShape.length&&(r+=n?function(t,e){var n,r,o=t.name,i=o.charAt(0).toUpperCase()+o.slice(1),a="get"+i+"AtOutCoords",s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length,c=Vr(t.shapeInfo.logicalShape,e.logicalShape),l=Lo(u),f=u-s,h=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(t){return"coords."+h[t+f]+" = 0;"})).join("\n"),r=u<2&&s>0?"coords":t.shapeInfo.logicalShape.map((function(t,e){return"coords."+h[e+f]})).join(", ");var d="return outputValue;",p=1===S(t.shapeInfo.logicalShape),v=1===S(e.logicalShape);if(1!==s||p||v){if(p&&!v)d=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var m=s-2,g=s-1;c.indexOf(m)>-1&&c.indexOf(g)>-1?d="return vec4(outputValue.x);":c.indexOf(m)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+i+"("+r+");\n      "+d+"\n    }\n  "}(t,e):function(t,e){var n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,a=e.logicalShape.length;if(!t.shapeInfo.isUniform&&i===a&&null==t.shapeInfo.flatOffset&&I(t.shapeInfo.texShape,e.texShape))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var s=Lo(a),u=Vr(t.shapeInfo.logicalShape,e.logicalShape),c=a-i,l=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+s+" coords = getOutputCoords();\n      "+(0===i?"":a<2&&u.length>=1?"coords = 0;":u.map((function(t){return"coords."+l[t+c]+" = 0;"})).join("\n"))+"\n      return get"+r+"("+(a<2&&i>0?"coords":t.shapeInfo.logicalShape.map((function(t,e){return"coords."+l[e+c]})).join(", "))+");\n    }\n  "}(t,e)),r}(t,e,r)})).join("\n"),c=e.texShape,l=Ro(),f=function(t){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+t.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),h=function(t){return t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+t.defineSpecialNaN+"\n    "+t.defineSpecialInf+"\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    \nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  "}(l);return e.isPacked?(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,e);case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(I(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=t,r=e,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=(i=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+i+");\n      int c = imod(index, "+i+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(t,e){for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,a="",s="b, r, c",u=2;u<t.length-1;u++)a="\n      int b"+u+" = index / "+(i*=t[t.length-u-1])+";\n      index -= b"+u+" * "+i+";\n    "+a,s="b"+u+", "+s;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+t.length+"("+s+");\n    }\n  "}(t,e)}var n,r,o,i,a}(e.logicalShape,c),a=function(t){return"\n    void setOutput(vec4 val) {\n      "+t.output+" = val;\n    }\n  "}(l)):(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return I(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=e,r=No(["r","c","d"],t),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var n=No(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=No(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=No(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n,r}(e.logicalShape,c),a=function(t){return"\n    void setOutput(float val) {\n      "+t.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(h+="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n"),[h,f,a,s,i,u,n].join("\n")}(i,u,o,e.packedInputs),l=t.createProgram(c),f=null,h=t.getUniformLocation(l,"NAN",!1);1===s().getNumber("WEBGL_VERSION")&&(f=t.getUniformLocation(l,"INFINITY",!1));for(var d={},p=0;p<e.variableNames.length;p++){var v=e.variableNames[p];d[v]=t.getUniformLocation(l,v,!1),d["offset"+v]=t.getUniformLocation(l,"offset"+v,!1)}return{program:e,source:c,webGLProgram:l,uniformLocations:d,inShapeInfos:a,outShapeInfo:u,infLoc:f,nanLoc:h}}(i.gpgpu,t,f,d)})),m=null!=this.activeTimers;if(m&&(h=this.startTimer()),function(t,e,n,r,o){$i(e.inShapeInfos,n),$i([e.outShapeInfo],[r]);var i=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i,a[0],a[1]):t.setOutputMatrixTexture(i,a[0],a[1]),t.setProgram(e.webGLProgram),1===s().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach((function(n,r){var o=e.program.variableNames[r],i=e.uniformLocations[o],a=e.uniformLocations["offset"+o];if(null!=i)if(n.isUniform)if(S(n.shape)<2)t.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),t.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=a&&t.gl.uniform1i(a,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,i,r)})),null!=o&&o(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,v,f,d,r),l.forEach((function(t){return i.disposeData(t.dataId)})),m&&(h=this.endTimer(h),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(h)})),!s().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===o){var g=this.unpackTensor(a);return this.disposeData(a.dataId),g}return a},e.prototype.compileAndRun=function(t,e,n,r,o){void 0===o&&(o=!1);var i=this.runWebGLProgram(t,e,n=n||e[0].dtype,r,o);return Rt.makeTensorFromDataId(i.dataId,i.shape,i.dtype)},e.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(s().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(e){t.gpgpu.deleteProgram(t.binaryCache[e].webGLProgram),delete t.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Le((function(){if(!s().get("WEBGL_RENDER_FLOAT32_ENABLED")){var e=s().getBool("DEBUG");s().set("DEBUG",!1);var n=t.abs(un(1e-8)).dataSync()[0];if(s().set("DEBUG",e),n>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,i=n.values,a=n.usage,s=n.isPacked;if(null==n.texture){var u,c=null!=this.activeTimers;c&&(u=tt());var l=n.texShape;if(null==l&&(l=_e(r,s),n.texShape=l),null!=i){var f=we(r),h=void 0,d=l[1],p=l[0],v=i instanceof Uint8Array;s?(d=(e=Ht(l[0],l[1]))[0],h=new Si(f,[p=e[1],d],v)):h=new Ei(f,[p,d],v);var m=this.makeTensorInfo([p,d],o);this.texData.get(m.dataId).usage=v?Mt.PIXELS:Mt.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(m.dataId),d,p,i);var g=this.runWebGLProgram(h,[m],o,null,!0),y=this.texData.get(g.dataId);n.texture=y.texture,n.texShape=y.texShape,n.isPacked=y.isPacked,n.usage=y.usage,this.disposeData(m.dataId),this.texData.delete(g.dataId),n.values=null,c&&(this.uploadWaitMs+=tt()-u)}else{var b=this.acquireTexture(l,a,o,s);n.texture=b}}},e.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),r=n.dtype;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,r)),n.values},e.prototype.acquireTexture=function(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,r)},e.prototype.computeBytes=function(t,e){return t[0]*t[1]*U(e)},e}(jr);Nt()&&Rt.registerBackend("webgl",(function(){return new Qa}),2),v({kernelName:"Square",gradFunc:function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().mul(2))}}}});var Ja=en({square_:function(t){var e=He(t,"x","square");return Rt.runKernelFunc((function(t,n){return n([e]),t.square(e)}),{x:e},null,"Square",{},[e],[])}}),Za=en({abs_:function(t){var e=He(t,"x","abs");return"complex64"===e.dtype?Rt.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):Rt.runKernelFunc((function(t,n){var r=t.abs(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().step(-1))}}}),"Abs")}}),ts=en({acos_:function(t){var e=He(t,"x","acos");return Rt.runKernelFunc((function(t,n){var r=t.acos(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(un(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),es=en({acosh_:function(t){var e=He(t,"x","acosh");return Rt.runKernelFunc((function(t,n){var r=t.acosh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),ns=en({asin_:function(t){var e=He(t,"x","asin");return Rt.runKernelFunc((function(t,n){var r=t.asin(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(un(1).sub(n.toFloat().square()).sqrt())}}}))}}),rs=en({asinh_:function(t){var e=He(t,"x","asinh");return Rt.runKernelFunc((function(t,n){var r=t.asinh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(un(1).add(n.toFloat().square()).sqrt())}}}))}}),os=en({atan_:function(t){var e=He(t,"x","atan");return Rt.runKernelFunc((function(t,n){var r=t.atan(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().square().add(1))}}}))}}),is=en({atanh_:function(t){var e=He(t,"x","atanh");return Rt.runKernelFunc((function(t,n){var r=t.atanh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(un(1).sub(n.toFloat().square()))}}}))}}),as=en({ceil_:function(t){var e=He(t,"x","ceil");return Rt.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),ss=en({clipByValue_:function(t,e,n){var r=He(t,"x","clipByValue");return w(e<=n,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."})),Rt.runKernelFunc((function(t,o){var i=t.clip(r,e,n);return o([r]),i}),{x:r},(function(t,r){var o=r[0];return{x:function(){return t.where(o.greaterEqual(e).logicalAnd(o.lessEqual(n)),_n(t))}}}),"ClipByValue",{min:e,max:n},[r])}}),us=en({cos_:function(t){var e=He(t,"x","cos");return Rt.runKernelFunc((function(t,n){var r=t.cos(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return n.toFloat().sin().neg().mul(t)}}}),"Cos",{},[e])}}),cs=en({cosh_:function(t){var e=He(t,"x","cosh");return Rt.runKernelFunc((function(t,n){var r=t.cosh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sinh().mulStrict(t)}}}))}}),ls=en({erf_:function(t){var e=He(t,"x","erf");return w("int32"===e.dtype||"float32"===e.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===e.dtype&&(e=e.toFloat()),Rt.runKernelFunc((function(t,n){var r=t.erf(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),fs=en({exp_:function(t){var e=He(t,"x","exp");return Rt.runKernelFunc((function(t,n){var r=t.exp(e);return n([r]),r}),{x:e},(function(t,e){return{x:function(){return t.mulStrict(e[0])}}}),"Exp",{},[],[!0])}}),hs=en({expm1_:function(t){var e=He(t,"x","expm1");return Rt.runKernelFunc((function(t,n){var r=t.expm1(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.exp())}}}))}}),ds=en({floor_:function(t){var e=He(t,"x","floor");return Rt.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),ps=en({log_:function(t){var e=He(t,"x","log");return Rt.runKernelFunc((function(t,n){var r=t.log(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.div(n.toFloat())}}}),"Log",{},[e])}}),vs=en({log1p_:function(t){var e=He(t,"x","log1p");return Rt.runKernelFunc((function(t,n){var r=t.log1p(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.add(1))}}}))}}),ms=en({logSigmoid_:function(t){var e=He(t,"x","logSigmoid");return Rt.runKernelFunc((function(t,n){var r=t.softplus(e.neg()).neg();return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.neg().sigmoid())}}}))}}),gs=en({neg_:function(t){var e=He(t,"x","neg");return Rt.runKernelFunc((function(t){return t.neg(e)}),{$x:e},(function(t){return{$x:function(){return t.neg()}}}))}}),ys=en({reciprocal_:function(t){var e=He(t,"x","reciprocal");return Rt.runKernelFunc((function(t,n){var r=t.reciprocal(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.square().neg())}}}))}}),bs=en({round_:function(t){var e=He(t,"x","round");return Rt.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),xs=en({rsqrt_:function(t){var e=He(t,"x","rsqrt");return Rt.runKernelFunc((function(t,n){var r=t.rsqrt(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},[e])}}),ws=en({sigmoid_:function(t){var e=He(t,"x","sigmoid");return Rt.runKernelFunc((function(t,n){var r=t.sigmoid(e);return n([r]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.mul(n.mul(un(1).sub(n)))}}}),"Sigmoid")}}),_s=en({sign_:function(t){var e=He(t,"x","sign");return Rt.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),Cs=en({isNaN_:function(t){var e=He(t,"x","isNaN");return Rt.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),Es=en({isInf_:function(t){var e=He(t,"x","isInf");return Rt.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),Ss=en({isFinite_:function(t){var e=He(t,"x","isFinite");return Rt.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return _n(t)}}}))}}),Is=en({sin_:function(t){var e=He(t,"x","sin");return Rt.runKernelFunc((function(t,n){var r=t.sin(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return n.toFloat().cos().mul(t)}}}),"Sin",{},[e])}}),Ts=en({sinh_:function(t){var e=He(t,"x","sinh");return Rt.runKernelFunc((function(t,n){var r=t.sinh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cosh().mulStrict(t)}}}))}}),ks=en({softplus_:function(t){var e=He(t,"x","softplus");return Rt.runKernelFunc((function(t,n){var r=t.softplus(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.sigmoid())}}}))}}),Ds=en({sqrt_:function(t){var e=He(t,"x","sqrt");return Rt.runKernelFunc((function(t,n){var r=t.sqrt(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().sqrt().mul(2))}}}))}}),As=en({step_:function(t,e){void 0===e&&(e=0);var n=He(t,"x","step");return Rt.runKernelFunc((function(t){return t.step(n,e)}),{$x:n},(function(t){return{$x:function(){return _n(t)}}}))}}),Rs=en({tan_:function(t){var e=He(t,"x","tan");return Rt.runKernelFunc((function(t,n){var r=t.tan(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.cos().square())}}}))}}),Ns=en({tanh_:function(t){var e=He(t,"x","tanh");return Rt.runKernelFunc((function(t,n){var r=t.tanh(e);return n([r]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return un(1).sub(n.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function Fs(t,e,n,r,o,i){var a,s,u=He(t,"x","batchNorm"),c=He(e,"mean","batchNorm"),l=He(n,"variance","batchNorm");return null!=o&&(a=He(o,"scale","batchNorm")),null!=r&&(s=He(r,"offset","batchNorm")),w(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),w(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),w(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=a&&w(2===a.rank||1===a.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."})),null!=s&&w(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),Ps(u,c,l,s,a,i)}function Os(t,e,n,r,o,i){var a,s,u=He(t,"x","batchNorm"),c=He(e,"mean","batchNorm"),l=He(n,"variance","batchNorm");return null!=o&&(a=He(o,"scale","batchNorm")),null!=r&&(s=He(r,"offset","batchNorm")),w(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),w(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),w(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=a&&w(3===a.rank||1===a.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."})),null!=s&&w(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),Ps(u,c,l,s,a,i)}function Ms(t,e,n,r,o,i){var a,s,u=He(t,"x","batchNorm"),c=He(e,"mean","batchNorm"),l=He(n,"variance","batchNorm");return null!=o&&(a=He(o,"scale","batchNorm")),null!=r&&(s=He(r,"offset","batchNorm")),w(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),w(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),w(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=a&&w(4===a.rank||1===a.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."})),null!=s&&w(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),Ps(u,c,l,s,a,i)}function Ps(t,e,n,r,o,i){null==i&&(i=.001);var a,s,u,c=He(t,"x","batchNorm"),l=He(e,"mean","batchNorm"),f=He(n,"variance","batchNorm");return null!=o&&(a=He(o,"scale","batchNorm")),null!=r&&(s=He(r,"offset","batchNorm")),w(l.rank===f.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),w(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),w(null==a||l.rank===a.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,Rt.runKernelFunc((function(t,e){var n=t.batchNormalization(u,Ls(l),Ls(f),i,Ls(a),Ls(s));return e([c,l,f,a]),n}),{x:c,mean:l,variance:f,scale:a,offset:s},(function(t,e){var n=e[0],r=e[1],o=e[2],a=e[3],s=null==a?un(1):a,c=qr(r.shape,u.shape),l=[];if(1===r.rank){for(var f=0;f<u.shape.length-1;++f)l.push(u.shape[f]);l.push(1)}var h=n.sub(r),d=t.mul(s),p=xs(o.add(un(i))),v=p.mul(p).mul(p).mul(un(-.5));return{x:function(){return 1===r.rank?t.mul(hr(p.as4D(1,1,1,r.shape[0]),l)).mul(s).reshape(n.shape):t.mul(p).mul(s).reshape(n.shape)},mean:function(){var t=p.mul(un(-1)).mul(d);return 1===r.rank&&(t=t.sum(c)),t.reshape(r.shape)},variance:function(){var t=v.mul(h).mul(d);return 1===r.rank&&(t=t.sum(c)),t.reshape(r.shape)},scale:function(){var e=h.mul(p),n=t.mul(e);return 1===r.rank&&(n=n.sum(c)),n.reshape(r.shape)},offset:function(){var e=t;return 1===r.rank&&(e=e.sum(c)),e.reshape(r.shape)}}}),"BatchNormalization",{varianceEpsilon:i},[c,l,f,a]).reshape(c.shape)}function Ls(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Bs(){Pe("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Ws=en({batchNormalization2d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),Bs(),Fs(t,e,n,i,o,r)}}),zs=en({batchNormalization3d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),Bs(),Os(t,e,n,i,o,r)}}),Us=en({batchNormalization4d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),Bs(),Ms(t,e,n,i,o,r)}}),js=en({batchNormalization_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),Bs(),Ps(t,e,n,i,o,r)}}),Hs=en({batchNorm_:Ps}),Vs=en({batchNorm2d_:Fs}),qs=en({batchNorm3d_:Os}),Gs=en({batchNorm4d_:Ms}),Ks=en({logicalAnd_:function(t,e){var n=He(t,"a","logicalAnd","bool"),r=He(e,"b","logicalAnd","bool");return Gr(n.shape,r.shape),Rt.runKernelFunc((function(t){return t.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),Xs=en({logicalNot_:function(t){var e=He(t,"x","logicalNot","bool");return Rt.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),$s=en({logicalOr_:function(t,e){var n=He(t,"a","logicalOr","bool"),r=He(e,"b","logicalOr","bool");return Gr(n.shape,r.shape),Rt.runKernelFunc((function(t){return t.logicalOr(n,r)}),{$a:n,$b:r})}}),Ys=en({logicalXor_:function(t,e){var n=He(t,"a","logicalXor","bool"),r=He(e,"b","logicalXor","bool");return Gr(n.shape,r.shape),$s(t,e).logicalAnd(Ks(t,e).logicalNot())}}),Qs=en({where_:function(t,e,n){var r=He(e,"a","where"),o=He(n,"b","where"),i=He(t,"condition","where","bool");return _(r.shape,o.shape,"Error in where: "),1===i.rank?w(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):_(i.shape,o.shape,"Error in where: "),Rt.runKernelFunc((function(t,e){var n=t.select(i,r,o);return e([i]),n}),{$condition:i,$a:r,$b:o},(function(t,e){var n=e[0];return{$condition:function(){return _n(n).toFloat()},$a:function(){return t.mul(n.cast(t.dtype))},$b:function(){return t.mul(n.logicalNot().cast(t.dtype))}}}))}}),Js=function(t){return r(this,void 0,void 0,(function(){var e,n,r;return o(this,(function(o){switch(o.label){case 0:return[4,(e=He(t,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=So(e.shape,n),t!==e&&e.dispose(),[2,r]}}))}))},Zs=en({add_:function(t,e){var n,r=He(t,"a","add"),o=He(e,"b","add");n=Et(r,o);var i=Gr((r=n[0]).shape,(o=n[1]).shape);return Rt.runKernelFunc((function(t){return t.add(r,o)}),{a:r,b:o},(function(t){return{a:function(){var e=t,n=qr(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=qr(o.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(o.shape)}}}),"Add")}}),tu=en({addN_:function(t){w(Array.isArray(t),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),w(t.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length}));var e=t.map((function(t,e){return He(t,"tensors"+e,"addN")})),n=e[0];return e.forEach((function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(t){if(!I(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")})),Rt.runKernelFunc((function(t){return t.addN(e)}),e,(function(t){var n={};return e.forEach((function(e,r){n[r]=function(){return t.clone()}})),n}),"AddN")}}),eu=en({addStrict_:function(t,e){var n=He(t,"a","addStrict"),r=He(e,"b","addStrict");return _(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),nu=en({atan2_:function(t,e){var n,r=He(t,"a","atan2"),o=He(e,"b","atan2");n=Et(r,o);var i=Gr((r=n[0]).shape,(o=n[1]).shape);return Rt.runKernelFunc((function(t,e){var n=t.atan2(r,o);return e([r,o]),n}),{$a:r,$b:o},(function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=Zs(n.square(),r.square()),o=t.mul(r.div(e)),a=qr(n.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(n.shape)},$b:function(){var e=Zs(n.square(),r.square()),o=gs(t.mul(n.div(e))),a=qr(r.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(r.shape)}}}))}}),ru=en({div_:function(t,e){var n,r=He(t,"a","div"),o=He(e,"b","div");if(n=Et(r,o),o=n[1],"int32"===(r=n[0]).dtype&&"int32"===o.dtype)return au(r,o);var i=Gr(r.shape,o.shape);return Rt.runKernelFunc((function(t,e){var n=t.realDivide(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),o=qr(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=qr(r.shape,i);o.length>0&&(e=e.sum(o).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}}),"Div")}}),ou=en({divNoNan_:function(t,e){var n,r=He(t,"a","div"),o=He(e,"b","div");r=(n=Et(r,o))[0];var i=ru(r,o=n[1]),a=_n(i),s=o.equal(a);return Qs(s,a,i)}}),iu=en({divStrict_:function(t,e){var n=He(t,"a","div"),r=He(e,"b","div");return _(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),au=en({floorDiv_:function(t,e){var n,r=He(t,"a","floorDiv"),o=He(e,"b","floorDiv");n=Et(r,o);var i=Gr((r=n[0]).shape,(o=n[1]).shape);return Rt.runKernelFunc((function(t,e){var n=t.floorDiv(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),o=qr(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=qr(r.shape,i);o.length>0&&(e=e.sum(o).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}}),"FloorDiv")}}),su=en({maximum_:function(t,e){var n,r=He(t,"a","maximum"),o=He(e,"b","maximum");return n=Et(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),Gr(r.shape,o.shape),Rt.runKernelFunc((function(t,e){var n=t.maximum(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.greaterEqual(r).toFloat())},b:function(){return t.mul(n.less(r).toFloat())}}}),"Maximum")}}),uu=en({maximumStrict_:function(t,e){var n=He(t,"a","maximumStrict"),r=He(e,"b","maximumStrict");return _(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),cu=en({minimum_:function(t,e){var n,r=He(t,"a","minimum"),o=He(e,"b","minimum");return n=Et(r,o),o=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),o=o.toInt()),Gr(r.shape,o.shape),Rt.runKernelFunc((function(t,e){var n=t.minimum(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.lessEqual(r).toFloat())},b:function(){return t.mul(n.greater(r).toFloat())}}}),"Minimum")}}),lu=en({minimumStrict_:function(t,e){var n=He(t,"a","minimumStrict"),r=He(e,"b","minimumStrict");return _(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),fu=en({mod_:function(t,e){var n,r=He(t,"a","mod"),o=He(e,"b","mod");n=Et(r,o);var i=Gr((r=n[0]).shape,(o=n[1]).shape);return Rt.runKernelFunc((function(t,e){var n=t.mod(r,o);return e([r,o]),n}),{$a:r,$b:o},(function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=qr(n.shape,i);return e.length>0?t.sum(e).reshape(n.shape):t},$b:function(){var e=t.mul(n.div(r).floor().neg()),o=qr(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}}))}}),hu=en({modStrict_:function(t,e){var n=He(t,"a","modStrict"),r=He(e,"b","modStrict");return _(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),du=en({mul_:function(t,e){var n,r=He(t,"a","mul"),o=He(e,"b","mul");n=Et(r,o);var i=Gr((r=n[0]).shape,(o=n[1]).shape);return Rt.runKernelFunc((function(t,e){var n=t.multiply(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.mul(r.toFloat()),o=qr(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=qr(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}}),"Mul")}}),pu=en({mulStrict_:function(t,e){var n=He(t,"a","mul"),r=He(e,"b","mul");return _(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),vu=en({pow_:function(t,e){var n=He(t,"base","pow"),r=He(e,"exp","pow"),o=Gr(n.shape,r.shape);return t=n.cast(_t(n.dtype,r.dtype)),e=r.cast(_t(n.dtype,r.dtype)),Rt.runKernelFunc((function(t,e){var o=t.pow(n,r);return e([n,r,o]),o}),{$base:n,$exp:r},(function(t,e){var n=e[0],r=e[1],i=e[2];return{$base:function(){var e=r.toFloat(),i=t.mul(e.mul(n.pow(e.sub(un(1))))),a=qr(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$exp:function(){var e=n.greater(0),a=n.log().where(e,_n(n)),s=t.mul(i.mul(a)),u=qr(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}))}}),mu=en({powStrict_:function(t,e){return _(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),gu=en({squaredDifference_:function(t,e){var n,r=He(t,"a","squaredDifference"),o=He(e,"b","squaredDifference");return n=Et(r,o),Gr((r=n[0]).shape,(o=n[1]).shape),Rt.runKernelFunc((function(t,e){var n=t.squaredDifference(r,o);return e([r,o]),n}),{$a:r,$b:o},(function(t,e){var n=e[0],r=e[1],o=un(2);return{$a:function(){return t.mul(n.sub(r).mul(o))},$b:function(){return t.mul(r.sub(n).mul(o))}}}))}}),yu=en({squaredDifferenceStrict_:function(t,e){var n=He(t,"a","squaredDifferenceStrict"),r=He(e,"b","squaredDifferenceStrict");return _(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),bu=en({sub_:function(t,e){var n,r=He(t,"a","sub"),o=He(e,"b","sub");n=Et(r,o);var i=Gr((r=n[0]).shape,(o=n[1]).shape);return Rt.runKernelFunc((function(t){return t.subtract(r,o)}),{a:r,b:o},(function(t){return{a:function(){var e=t,n=qr(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=qr(o.shape,i);return n.length>0&&(e=e.sum(n)),e.neg().reshape(o.shape)}}}),"Sub")}}),xu=en({subStrict_:function(t,e){var n=He(t,"a","subStrict"),r=He(e,"b","subStrict");return _(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),wu=en({equal_:function(t,e){var n,r=He(t,"a","equal"),o=He(e,"b","equal");return n=Et(r,o),Gr((r=n[0]).shape,(o=n[1]).shape),Rt.runKernelFunc((function(t){return t.equal(r,o)}),{$a:r,$b:o})}}),_u=en({equalStrict_:function(t,e){var n=He(t,"a","equalStrict"),r=He(e,"b","equalStrict");return _(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Cu=en({greater_:function(t,e){var n,r=He(t,"a","greater"),o=He(e,"b","greater");return n=Et(r,o),Gr((r=n[0]).shape,(o=n[1]).shape),Rt.runKernelFunc((function(t){return t.greater(r,o)}),{a:r,b:o},null,"Greater")}}),Eu=en({greaterEqual_:function(t,e){var n,r=He(t,"a","greaterEqual"),o=He(e,"b","greaterEqual");return n=Et(r,o),Gr((r=n[0]).shape,(o=n[1]).shape),Rt.runKernelFunc((function(t,e){var n=t.greaterEqual(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){return _n(n)},b:function(){return _n(r)}}}),"GreaterEqual")}}),Su=en({greaterEqualStrict_:function(t,e){var n=He(t,"a","greaterEqualStrict"),r=He(e,"b","greaterEqualStrict");return _(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Iu=en({greaterStrict_:function(t,e){var n=He(t,"a","greaterStrict"),r=He(e,"b","greaterStrict");return _(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Tu=en({less_:function(t,e){var n,r=He(t,"a","less"),o=He(e,"b","less");return n=Et(r,o),Gr((r=n[0]).shape,(o=n[1]).shape),Rt.runKernelFunc((function(t){return t.less(r,o)}),{a:r,b:o},null,"Less")}}),ku=en({lessEqual_:function(t,e){var n,r=He(t,"a","lessEqual"),o=He(e,"b","lessEqual");return n=Et(r,o),Gr((r=n[0]).shape,(o=n[1]).shape),Rt.runKernelFunc((function(t,e){var n=t.lessEqual(r,o);return e([r,o]),n}),{a:r,b:o},null,"LessEqual")}}),Du=en({lessEqualStrict_:function(t,e){var n=He(t,"a","lessEqualStrict"),r=He(e,"b","lessEqualStrict");return _(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Au=en({lessStrict_:function(t,e){var n=He(t,"a","lessStrict"),r=He(e,"b","lessStrict");return _(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Ru=en({notEqual_:function(t,e){var n,r=He(t,"a","notEqual"),o=He(e,"b","notEqual");return n=Et(r,o),Gr((r=n[0]).shape,(o=n[1]).shape),Rt.runKernelFunc((function(t){return t.notEqual(r,o)}),{$a:r,$b:o})}}),Nu=en({notEqualStrict_:function(t,e){var n=He(t,"a","notEqualStrict"),r=He(e,"b","notEqualStrict");return _(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Fu(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function Ou(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var Mu=en({gather_:function(t,e,n){void 0===n&&(n=0);var r=He(t,"x","gather"),o=He(e,"indices","gather","int32");n=F(n,r.shape)[0];var i=function(t,e,n){for(var r=t.shape[n],o=[],i=1,a=1,s=0;s<n;s++)o.push(t.shape[s]),i*=t.shape[s];for(s=0;s<e.rank;s++)o.push(e.shape[s]);for(s=n+1;s<t.rank;s++)o.push(t.shape[s]),a*=t.shape[s];return{batchSize:i,sliceSize:a,dimSize:r,outputShape:o}}(r,o,n);return Rt.runKernelFunc((function(t,e){var i=t.gather(r,o.flatten(),n);return e([o]),i}),{x:r,indices:o},(function(t,e){var o=e[0];return{x:function(){var e=r.shape,i=o.size,a=e.slice(0,n),s=a.length,u=e.slice(n,e.length).slice(1),c=u.length,l=Fu(0,s),f=Fu(s+1,s+1+c),h=Ou([a,[i],u]),d=t.reshape(h),p=o.reshape([i]),v=Ou([[s],l,f]),m=d.transpose(v),g=Pu(m,p,r.shape[n]),y=Qe(v);return g.transpose(y)},indices:function(){return o}}}),"Gather",{axis:n}).reshape(i.outputShape)}}),Pu=en({unsortedSegmentSum_:function(t,e,n){var r=He(t,"x","unsortedSegmentSum"),o=He(e,"segmentIds","unsortedSegmentSum","int32");return w(T(n),(function(){return"numSegments must be of dtype int"})),Rt.runKernelFunc((function(t,e){var i=t.unsortedSegmentSum(r,o,n);return e([o]),i}),{$x:r},(function(t,e){var n=e[0];return{$x:function(){return function(t,e){for(var n=su(e,_n(e)),r=Mu(t,n),o=Eu(e,un(0,"int32")),i=r.rank-o.rank,a=0;a<i;++a)o=$n(o,a+1);o=Ks(o,mn(r.shape,"bool"));var s=_n(r);return Qs(o,r,s)}(t,n)}}}))}}),Lu=function(t,e,n){return r(this,void 0,void 0,(function(){var r,i,a,s,u,c,l,f,h,d,p,v,m;return o(this,(function(o){switch(o.label){case 0:for(r=He(t,"tensor","boolMask"),i=He(e,"mask","boolMask","bool"),a=null==n?0:n,u=r.shape,w((s=i.rank)>0,(function(){return"mask cannot be scalar"})),_(u.slice(a,a+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=a;l<a+s;l++)c*=u[l];return f=u.slice(0,a).concat([c],u.slice(a+s)),h=r.reshape(f),d=i.reshape([-1]),[4,Js(d)];case 1:return p=o.sent(),v=p.squeeze([1]),m=Mu(h,v,a),t!==r&&r.dispose(),e!==i&&i.dispose(),v.dispose(),h.dispose(),d.dispose(),p.dispose(),[2,m]}}))}))};function Bu(t,e,n,r,o,i,a){void 0===i&&(i="NHWC"),w(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var s=t,u=e,c=!1;3===e.rank&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,t[0],t[1],t[2]]),w(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),w(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),w(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===i?s[3]:s[1],f="NHWC"===i?u.shape[3]:u.shape[1];w(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),w(f===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+n.shape[3]+"."})),null!=a&&w(T(o),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var h=oo(i),d=$r(s,n.shape,r,1,o,a,!1,h),p=Rt.runKernelFunc((function(t,e){var r=t.conv2dDerInput(u,n,d);return e([n,u]),r}),{dy4D:u,filter:n},(function(t,e){var n=e[0],s=e[1];return{dy4D:function(){return ju(t,n,r,o,i,1,a)},filter:function(){return Vu(t,s,n.shape,r,o,i,a)}}}));return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Wu(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t);return 1===e[0]&&1===e[1]&&1===e[2]}function zu(t,e,n,r,o){w(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var i=t,a=e,s=!1;4===e.rank&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],c=a.shape[4];w(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."})),w(5===a.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank})),w(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),w(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),w(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."}));var l=Yr(i,n.shape,r,1,o),f=Rt.runKernelFunc((function(t){return t.conv3dDerInput(a,n,l)}),{dy5D:a});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var Uu=en({conv1d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=He(t,"x","conv1d"),u=He(e,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),w(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),w(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=a&&w(T(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."})),w(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),w(ro(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"})),w("NWC"===o,(function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."}));var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),d=ju(h,f,[1,n],r,"NHWC",[1,i],a);return l?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),ju=en({conv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=He(t,"x","conv2d"),u=He(e,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),w(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),w(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=a&&w(T(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var f="NHWC"===o?c.shape[3]:c.shape[1];w(f===u.shape[2],(function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."})),w(ro(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}));var h=oo(o),d=$r(c.shape,u.shape,n,i,r,a,!1,h),p=Rt.runKernelFunc((function(t,e){var n=t.conv2d(c,u,d);return e([u,c]),n}),{x:c,filter:u},(function(t,e){var a=e[0],s=e[1];return w(no(i),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"})),{x:function(){return qu(s.shape,t,a,n,r,o)},filter:function(){return Vu(s,t,a.shape,n,r,o)}}}),"Conv2D",d,[u,c]);return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),Hu=en({conv3d_:function(t,e,n,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var a=He(t,"x","conv3d"),s=He(e,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),w(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),w(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),w(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),w(function(t,e){return Wu(t)||Wu(e)}(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),w("NDHWC"===o,(function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."}));var l=Yr(u.shape,s.shape,n,i,r),f=Rt.runKernelFunc((function(t,e){var n=t.conv3d(u,s,l);return e([u,s]),n}),{x:u,$filter:s},(function(t,e){w(Wu(i),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}));var o=e[0],a=e[1];return{x:function(){return zu(o.shape,t,a,n,r)},$filter:function(){return function(t,e,n,r,o){var i=t;4===t.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]));var a=e;4===a.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),w(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."})),w(5===a.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."})),w(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),w(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."})),w(a.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=Yr(i.shape,n,r,1,o);return Rt.runKernelFunc((function(t){return t.conv3dDerFilter(i,a,s)}),{x5D:i,dy5D:a})}(o,t,a.shape,n,r)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Vu=en({conv2dDerFilter_:function(t,e,n,r,o,i,a){void 0===i&&(i="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),w(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),w(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),w(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];w(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."})),w(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=a&&w(T(o),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var f=oo(i),h=$r(s.shape,n,r,1,o,a,!1,f);return Rt.runKernelFunc((function(t){return t.conv2dDerFilter(s,u,h)}),{x4D:s,dy4D:u})}}),qu=en({conv2dDerInput_:Bu}),Gu=en({depthwiseConv2d_:function(t,e,n,r,o,i,a){void 0===i&&(i=[1,1]);var s=He(t,"x","depthwiseConv2d"),u=He(e,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),w(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),w(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),w(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==i&&(i=[1,1]),w(ro(n,i),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),null!=a&&w(T(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var f=$r(c.shape,u.shape,n,i,r,a,!0),h=Rt.runKernelFunc((function(t,e){var n=t.depthwiseConv2D(c,u,f);return e([c,u]),n}),{x:c,filter:u},(function(t,e){w(no(i),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"}));var n=e[0],r=e[1];return{x:function(){return Ku(n.shape,t,r,f)},filter:function(){return Xu(n,t,r.shape,f)}}}),"DepthwiseConv2dNative",f,[c,u]);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Ku=en({depthwiseConv2dDerInput_:function(t,e,n,r){var o=e,i=!1;3===e.rank&&(i=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=Rt.runKernelFunc((function(t){return t.depthwiseConv2DDerInput(o,n,r)}),{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),Xu=en({depthwiseConv2dDerFilter_:function(t,e,n,r){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Rt.runKernelFunc((function(t){return t.depthwiseConv2DDerFilter(o,i,r)}),{x4D:o,dy4D:i})}}),$u=en({separableConv2d_:function(t,e,n,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=He(t,"x","separableConv2d"),u=He(e,"depthwiseFilter","separableConv2d"),c=He(n,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(3===s.rank&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");w(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),w(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),w(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),w(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),w(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var h=u.shape[2],d=u.shape[3];w(c.shape[2]===h*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*d+", but got "+c.shape[2]+"."}));var p=Gu(l,u,r,o,a,i),v=ju(p,c,1,"valid",a);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Yu=en({conv2dTranspose_:function(t,e,n,r,o,i){return Bu(n,He(t,"x","conv2dTranspose"),He(e,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),Qu=en({conv3dTranspose_:function(t,e,n,r,o){return zu(n,He(t,"x","conv3dTranspose"),He(e,"filter","conv3dTranspose"),r,o)}}),Ju=en({matMul_:function(t,e,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=He(t,"a","matMul"),a=He(e,"b","matMul");o=Et(i,a),i=o[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=n?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],f=i.shape.slice(0,-2),h=a.shape.slice(0,-2),d=S(f),p=S(h);w(i.rank>=2&&a.rank>=2&&i.rank===a.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."})),w(I(f,h),(function(){return"Error in matMul: outer dimensions ("+f+") and ("+h+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."})),w(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var v=i.shape.slice(0,-2).concat([c,l]),m=n?i.as3D(d,s,c):i.as3D(d,c,s),g=r?a.as3D(p,l,u):a.as3D(p,u,l);return Rt.runKernelFunc((function(t,e){var o=t.batchMatMul(m,g,n,r);return e([m,g]),o}),{a:m,b:g},(function(t,e){var o=e[0],i=e[1];return n||r?!n&&r?{a:function(){return t.matMul(i,!1,!1)},b:function(){return t.matMul(o,!0,!1)}}:n&&!r?{a:function(){return i.matMul(t,!1,!0)},b:function(){return o.matMul(t,!1,!1)}}:{a:function(){return i.matMul(t,!0,!0)},b:function(){return t.matMul(o,!0,!0)}}:{a:function(){return t.matMul(i,!1,!0)},b:function(){return o.matMul(t,!0,!1)}}}),"BatchMatMul",{transposeA:n,transposeB:r}).reshape(v)}}),Zu=en({dot_:function(t,e){var n=He(t,"t1","dot"),r=He(e,"t2","dot");w(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var o=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return w(o===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),tc=en({outerProduct_:function(t,e){var n=He(t,"v1","outerProduct"),r=He(e,"v2","outerProduct");return w(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),ec=en({reverse_:function(t,e){var n=He(t,"x","reverse");if(0===n.rank)return n.clone();var r=F(e,n.shape);return Rt.runKernelFunc((function(t){return t.reverse(n,r)}),{$x:n},(function(t){return{$x:function(){return t.reverse(r)}}})).reshapeAs(n)}}),nc=en({reverse1d_:function(t){var e=He(t,"x","reverse");return w(1===e.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),ec(e,0)}}),rc=en({reverse2d_:function(t,e){var n=He(t,"x","reverse");return w(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),ec(n,e)}}),oc=en({reverse3d_:function(t,e){var n=He(t,"x","reverse");return w(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),ec(n,e)}}),ic=en({reverse4d_:function(t,e){var n=He(t,"x","reverse");return w(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),ec(n,e)}});function ac(t,e,n,r,o,i){var a=He(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),w(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),w(ro(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=i&&w(T(o),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var c=Kr(s.shape,e,n,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&I(c.inShape,c.outShape))return a.clone();var l=Rt.runKernelFunc((function(t,e){var n=t.maxPool(s,c);return e([s,n]),n}),{x:s},(function(t,i){var a=i[0],s=i[1];return{x:function(){return function(t,e,n,r,o,i,a,s){var u=He(t,"dy","maxPoolBackprop"),c=He(e,"input","maxPoolBackprop"),l=He(n,"output","maxPoolBackprop");w(c.rank===u.rank,(function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"})),null==i&&(i=[1,1]),w(ro(o,i),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"})),w(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),w(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var f=Kr(c.shape,r,o,i,a,void 0);return Rt.runKernelFunc((function(t){return t.maxPoolBackprop(u,c,l,f)}),{$dy:u,$input:c})}(t,a,s,e,n,r,o)}}}),"MaxPool",c,[s]);return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function sc(t,e,n,r,o,i){var a=He(t,"x","avgPool","float32");null==r&&(r=[1,1]),w(ro(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),w(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=i&&w(T(o),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var c=Kr(s.shape,e,n,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&I(c.inShape,c.outShape))return a.clone();var l=Rt.runKernelFunc((function(t){return t.avgPool(s,c)}),{x:s},(function(t){return{x:function(){return function(t,e,n,r,o,i){var a=He(t,"dy","avgPoolBackprop"),s=He(e,"input","avgPoolBackprop");w(s.rank===a.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"})),null==o&&(o=[1,1]),w(ro(r,o),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}));var u=s,c=a,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),w(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),w(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var f=Kr(u.shape,n,r,o,i),h=Rt.runKernelFunc((function(t){return t.avgPoolBackprop(c,u,f)}),{dy4D:c,input4D:u});return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}(t,s,e,n,r,o)}}}),"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var uc=en({maxPool_:function(t,e,n,r,o){return ac(t,e,n,1,r,o)}}),cc=en({avgPool_:function(t,e,n,r,o){return sc(t,e,n,1,r,o)}}),lc=en({pool_:function(t,e,n,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=He(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),w(ro(i,o),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"}));var c,l=Kr(s.shape,e,i,o,r),f=[l.dilationHeight,l.dilationWidth];c="same"===r?function(t,e){var n=t.map((function(t,n){return t+(t-1)*(e[n]-1)})).map((function(t){return t-1})),r=n.map((function(t){return Math.floor(t/2)})),o=n.map((function(t,e){return t-r[e]}));return n.map((function(t,e){return[r[e],o[e]]}))}([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var h=1===f[0]&&1===f[1],d=function(t,e,n){var r=n.map((function(t){return t[0]})),o=n.map((function(t){return t[1]})),i=t.concat(r,o),a=e.map((function(t,e){return(t-i[e]%t)%t})),s=o.map((function(t,e){return t+a[e]}));return[e.map((function(t,e){return[r[e],s[e]]})),e.map((function(t,e){return[0,a[e]]}))]}([l.inHeight,l.inWidth],f,c),p=d[1],v=h?r:"valid",m=h?s:cr(s,f,d[0]),g=("avg"===n?function(){return sc(m,e,i,1,v)}:function(){return ac(m,e,i,1,v)})(),y=h?g:Hn(g,f,p);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),fc=en({maxPool3d_:function(t,e,n,r,o,i,a){void 0===i&&(i="NDHWC");var s=He(t,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),w(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),w("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),w(ro(n,a),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=o&&w(T(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=Xr(u.shape,e,n,a,r,o,i),f=Rt.runKernelFunc((function(t,e){var n=t.maxPool3d(u,l);return e([u,n]),n}),{x:u},(function(t,i){var s=i[0],u=i[1];return{x:function(){return function(t,e,n,r,o,i,a,s){var u=He(t,"dy","maxPool3dBackprop"),c=He(e,"input","maxPool3dBackprop"),l=He(n,"output","maxPool3dBackprop"),f=u,h=c,d=l,p=!1;4===c.rank&&(p=!0,f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),h=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),w(5===f.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."})),w(5===h.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+h.rank+"."})),w(5===d.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+d.rank+"."})),null==i&&(i=[1,1,1]),w(ro(o,i),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"})),null!=s&&w(T(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."}));var v=Xr(h.shape,r,o,i,a,s),m=Rt.runKernelFunc((function(t){return t.maxPool3dBackprop(f,h,d,v)}),{dy5D:f,input5D:h});return p?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(t,s,u,e,n,a,r,o)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),hc=en({avgPool3d_:function(t,e,n,r,o,i,a){void 0===i&&(i="NDHWC");var s=He(t,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),w(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),w("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),w(ro(n,a),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=o&&w(T(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=Xr(u.shape,e,n,a,r,o,i),f=Rt.runKernelFunc((function(t){return t.avgPool3d(u,l)}),{x:u},(function(t){return{x:function(){return function(t,e,n,r,o,i,a){var s=He(t,"dy","avgPool3dBackprop"),u=He(e,"input","avgPool3dBackprop"),c=s,l=u,f=!1;4===u.rank&&(f=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),w(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),w(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==o&&(o=[1,1,1]),w(ro(r,o),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"})),null!=a&&w(T(i),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var h=Xr(l.shape,n,r,o,i,a),d=Rt.runKernelFunc((function(t){return t.avgPool3dBackprop(c,l,h)}),{dy5D:c,input5D:l});return f?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}(t,u,e,n,a,r,o)}}}));return f=f.cast(u.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),dc=en({slice_:function(t,e,n){var r,o,i=He(t,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof e?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice()).forEach((function(t){w(-1!==t,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map((function(t,e){return t>=0?t:(w(-1===t,(function(){return"Negative size values should be exactly -1 but got "+t+" for the slice() size at index "+e+"."})),i.shape[e]-r[e])})),kr(i,r,o);var a=i.shape;return Rt.runKernelFunc((function(t){return t.slice(i,r,o)}),{x:i},(function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],a[n]-r[n]-o[n]]);return{x:function(){return t.pad(e)}}}),"Slice",{begin:r,size:o})}}),pc=en({slice1d_:function(t,e,n){var r=He(t,"x","slice1d");return w(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),dc(r,[e],[n])}}),vc=en({slice2d_:function(t,e,n){var r=He(t,"x","slice2d");return w(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),dc(r,e,n)}}),mc=en({slice3d_:function(t,e,n){var r=He(t,"x","slice3d");return w(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),dc(r,e,n)}}),gc=en({slice4d_:function(t,e,n){var r=He(t,"x","slice4d");return w(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),dc(r,e,n)}});function yc(t,e,n,r,o){return e.rank<n.rank&&(e=e.reshape(Xe(e.shape,r))),t.rank<n.rank&&(t=t.reshape(Xe(t.shape,r))),{x:function(){var r=t.mul(n.equal(e).cast(t.dtype));return null==o?r:r.transpose(o)}}}var bc=en({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=He(t,"x","all","bool"),o=F(e,r.shape),i=o,a=Ye(i,r.rank);null!=a&&(r=r.transpose(a),i=Je(i.length,r.rank));var s=Rt.runKernelFunc((function(t){return t.all(r,i)}),{$x:r});if(n){var u=Xe(s.shape,o);return s.reshape(u)}return s}}),xc=en({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=He(t,"x","any","bool"),o=F(e,r.shape),i=o,a=Ye(i,r.rank);null!=a&&(r=r.transpose(a),i=Je(i.length,r.rank));var s=Rt.runKernelFunc((function(t){return t.any(r,i)}),{$x:r});if(n){var u=Xe(s.shape,o);return s.reshape(u)}return s}}),wc=en({argMax_:function(t,e){void 0===e&&(e=0);var n=He(t,"x","argMax");null==e&&(e=0);var r=F(e,n.shape),o=Ye(r,n.rank);return null!=o&&(n=n.transpose(o),r=Je(r.length,n.rank)),Rt.runKernelFunc((function(t,e){var o=t.argMax(n,r[0]);return e([n]),o}),{x:n},(function(t,e){var n=e[0];return{x:function(){return _n(n)}}}),"ArgMax",{axis:r[0]},[n])}}),_c=en({argMin_:function(t,e){void 0===e&&(e=0);var n=He(t,"x","argMin");null==e&&(e=0);var r=F(e,n.shape),o=Ye(r,n.rank);return null!=o&&(n=n.transpose(o),r=Je(r.length,n.rank)),Rt.runKernelFunc((function(t,e){var o=t.argMin(n,r[0]);return e([n]),o}),{$x:n},(function(t,e){var n=e[0];return{$x:function(){return _n(n)}}}))}}),Cc=en({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=He(t,"x","logSumExp"),o=F(e,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=Xe(s.shape,o);return s.reshape(u)}return s}}),Ec=en({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=He(t,"x","max"),o=r,i=F(e,r.shape),a=i,s=Ye(a,r.rank);null!=s&&(r=r.transpose(s),a=Je(a.length,r.rank));var u=Rt.runKernelFunc((function(t,e){var n=t.max(r,a);return e([o,n]),n}),{x:r},(function(t,e){return yc(t,e[1],e[0],i,s)}),"Max",{axes:a},[r],[!0]);if(n){var c=Xe(u.shape,i);u=u.reshape(c)}return u}}),Sc=en({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=He(t,"x","mean"),o=F(e,r.shape),i=S(Ke(r.shape,o)[1]);return Lr((function(t){var r=un(i);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return o.forEach((function(t){n[t]=1})),e.reshape(n).mul(mn(t.shape,"float32")).div(i)}}}))(r)}}),Ic=en({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=He(t,"x","min"),o=r,i=F(e,r.shape),a=i,s=Ye(a,r.rank);null!=s&&(r=r.transpose(s),a=Je(a.length,r.rank));var u=Rt.runKernelFunc((function(t,e){var n=t.min(r,a);return e([o,n]),n}),{x:r},(function(t,e){return yc(t,e[1],e[0],i,s)}),"Min",{axes:a},[r],[!0]);if(n){var c=Xe(u.shape,i);u=u.reshape(c)}return u}}),Tc=en({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=F(e,(t=He(t,"x","moments")).shape),o=t.mean(r,n),i=o.shape;n||(i=Xe(o.shape,r));var a=t.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,n)}}}),kc=en({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=He(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=F(e,r.shape);return Lr((function(t){var e=Ye(o,t.rank),r=o,i=t;null!=e&&(i=t.transpose(e),r=Je(r.length,t.rank));var a=function(e){var n=t.shape.slice();return o.forEach((function(t){n[t]=1})),e.reshape(n).mul(mn(t.shape,"float32"))},s=Rt.runKernelFunc((function(t){return t.sum(i,r)}),{x:i},(function(t){return{x:function(){return a(t)}}}),"Sum",{axes:r});if(n){var u=Xe(s.shape,o);s=s.reshape(u)}return{value:s,gradFunc:a}}))(r)}}),Dc=en({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=He(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=F(e,r.shape),i=Ye(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=Je(a.length,r.rank));var u=Rt.runKernelFunc((function(t){return t.prod(s,a)}),{permutedX:s});if(n){var c=Xe(u.shape,o);u=u.reshape(c)}return u}}),Ac=en({elu_:function(t){var e=He(t,"x","elu");return Rt.runKernelFunc((function(t,n){var r=t.elu(e);return n([r]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return Rt.runKernelFunc((function(e){return e.eluDer(t,n)}),{dy:t,y:n})}}}))}}),Rc=en({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=He(t,"x","leakyRelu");return su(un(e).mul(n),n)}}),Nc=en({prelu_:function(t,e){var n=He(t,"x","prelu"),r=He(e,"alpha","prelu");return Rt.runKernelFunc((function(t,e){var o=t.prelu(n,r);return e([n,r]),o}),{x:n,alpha:r},(function(t,e){var n=e[0],r=e[1],o=n.greater(0);return{x:function(){return Qs(o,t,t.mul(r))},alpha:function(){var e=Qs(o,_n(t),t.mul(n)),i=qr(r.shape,t.shape);return i.length>0&&(e=e.sum(i)),e.reshape(r.shape)}}}),"Prelu")}}),Fc=en({relu_:function(t){var e=He(t,"x","relu");return"bool"===e.dtype?e.toInt():Rt.runKernelFunc((function(t,n){var r=t.relu(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.mulStrict(n.step().toFloat())}}}),"Relu")}}),Oc=en({relu6_:function(t){var e=He(t,"x","relu6");return"bool"===e.dtype?e.toInt():Rt.runKernelFunc((function(t,n){var r=t.relu6(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return t.mulStrict(r.toFloat())}}}),"Relu6")}}),Mc=en({selu_:function(t){var e=He(t,"x","selu");return Rt.runKernelFunc((function(t,n){var r=t.selu(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){var e=n.greater(un(0)),r=un(1.7580993408473768),o=un(1.0507009873554805),i=t.mul(o),a=t.mul(r).mul(n.toFloat().exp());return Qs(e,i,a)}}}))}}),Pc=en({transpose_:function(t,e){var n=He(t,"x","transpose");return null==e&&(e=n.shape.map((function(t,e){return e})).reverse()),w(n.rank===e.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."})),e.forEach((function(t){w(t>=0&&t<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e}))})),n.rank<=1?n.clone():Rt.runKernelFunc((function(t){return t.transpose(n,e)}),{x:n},(function(t){var n=Qe(e);return{x:function(){return t.transpose(n)}}}),"Transpose",{perm:e})}}),Lc=en({localResponseNormalization_:function(t,e,n,r,o){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=He(t,"x","localResponseNormalization");w(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."})),w(T(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=Rt.runKernelFunc((function(t,i){var s=t.localResponseNormalization4D(a,e,n,r,o);return i([a,s]),s}),{x4D:a},(function(t,i){var a=i[0],s=i[1];return{x4D:function(){return Rt.runKernelFunc((function(i){return i.LRNGrad(t,a,s,e,n,r,o)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Bc=en({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(un(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=He(t,"x","norm"),e,n),i=o.shape;if(r){var a=F(n,t.shape);i=Xe(o.shape,a)}return o.reshape(i)}}),Wc=en({basicLSTMCell_:function(t,e,n,r,o,i){var a=He(t,"forgetBias","basicLSTMCell"),s=He(e,"lstmKernel","basicLSTMCell"),u=He(n,"lstmBias","basicLSTMCell"),c=He(r,"data","basicLSTMCell"),l=He(o,"c","basicLSTMCell"),f=He(i,"h","basicLSTMCell"),h=c.concat(f,1).matMul(s).add(u),d=h.shape[1]/4,p=[h.shape[0],d],v=h.slice([0,0],p),m=h.slice([0,d],p),g=h.slice([0,2*d],p),y=h.slice([0,3*d],p),b=v.sigmoid().mulStrict(m.tanh()).addStrict(l.mulStrict(a.add(g).sigmoid())),x=b.tanh().mulStrict(y.sigmoid());return[b,x]}}),zc=en({multiRNNCell_:function(t,e,n,r){for(var o=He(e,"data","multiRNNCell"),i=Ve(n,"c","multiRNNCell"),a=Ve(r,"h","multiRNNCell"),s=o,u=[],c=0;c<t.length;c++){var l=t[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],h=[];for(c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}}),Uc=en({movingAverage_:function(t,e,n,r,o){void 0===o&&(o=!0);var i=He(t,"v","movingAverage"),a=He(e,"x","movingAverage"),s=He(n,"decay","movingAverage");St(i,a),w(I(i.shape,a.shape),(function(){return"Shape mismatch in v and x"}));var u=un(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){w(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var f=He(r,"step","movingAverage");l=l.div(u.sub(vu(s,f)))}return i.add(l)}}),jc=en({stridedSlice_:function(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(e.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=He(t,"x","stridedSlice"),l=Dr(s),f=c.shape.slice();l.forEach((function(t){e[t]=0,n[t]=1,f.splice(t,0,1)})),c=c.reshape(f);for(var h=0;h<c.rank;h++)e[h]=Rr(o,e,r,c.shape,h),n[h]=Nr(i,n,r,c.shape,h),r[h]=r[h]||1;var d=Dr(u);d.forEach((function(t){n[t]=e[t]+1,r[t]=1}));var p=Ar(e,n,r),v=p.filter((function(t,e){return-1===d.indexOf(e)}));return r.every((function(t){return 1===t}))?dc(c,e,p).reshape(v):Rt.runKernelFunc((function(t){return t.stridedSlice(c,e,n,r)}),{$x:c}).reshape(v)}}),Hc=en({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=He(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var i=Rt.runKernelFunc((function(t){return t.topk(r,e,n)}),{$x:r});return{values:i[0],indices:i[1]}}}),Vc=en({scatterND_:function(t,e,n){var r=He(t,"indices","scatterND","int32"),o=He(e,"updates","scatterND");return Sr(o,r,n),Rt.runKernelFunc((function(t){return t.scatterND(r,o,n)}),{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),qc=en({fft_:function(t){w("complex64"===t.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."}));var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return Rt.runKernelFunc((function(t){return t.fft(n)}),{input:t}).reshape(t.shape)}}),Gc=en({ifft_:function(t){w("complex64"===t.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."}));var e=t.shape[t.shape.length-1],n=t.as2D(t.size/e,e);return Rt.runKernelFunc((function(t){return t.ifft(n)}),{input:t}).reshape(t.shape)}}),Kc=en({rfft_:function(t,e){w("float32"===t.dtype,(function(){return"The dtype for rfft() must be real value but got "+t.dtype}));var n,r=t.shape[t.shape.length-1],o=t.size/r;if(null!=e&&e<r){var i=t.shape.map((function(t){return 0})),a=t.shape.map((function(t){return t}));a[t.shape.length-1]=e,n=t.slice(i,a),r=e}else if(null!=e&&e>r){var s=t.shape.map((function(t){return t}));s[t.shape.length-1]=e-r,n=t.concat(gn(s),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),c=nn(n,u).as2D(o,r),l=qc(c),f=Math.floor(r/2)+1,h=rn(l),d=on(l),p=h.split([f,r-f],h.shape.length-1),v=d.split([f,r-f],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=f,nn(p[0],v[0]).reshape(m)}}),Xc=en({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),o=Gc(r);return rn(o)}var i=[n,2*(e-1)],a=rn(t).as2D(n,e),s=on(t).as2D(n,e),u=a.slice([0,1],[n,e-2]).reverse(1),c=s.slice([0,1],[n,e-2]).reverse(1).mul(un(-1)),l=a.concat(u,1),f=s.concat(c,1);return r=nn(l,f).as2D(i[0],i[1]),o=Gc(r),rn(o)}}),$c=Object.freeze({fft:qc,ifft:Gc,rfft:Kc,irfft:Xc}),Yc=en({sparseToDense_:function(t,e,n,r){void 0===r&&(r=0);var o=He(t,"sparseIndices","sparseToDense","int32"),i=He(e,"sparseValues","sparseToDense"),a=He(r,"defaultValue","sparseToDense",i.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var o=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");if(0!==e.rank&&(1!==e.rank||e.size!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),Rt.runKernelFunc((function(t){return t.sparseToDense(o,i,n,a)}),{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),Qc=en({gatherND_:function(t,e){var n=He(e,"indices","gatherND","int32"),r=He(t,"x","gatherND");return Rt.runKernelFunc((function(t){return t.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),Jc=en({diag_:function(t){var e=He(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return Rt.runKernelFunc((function(t){return t.diag(e)}),{$x:e}).reshape(n)}}),Zc=en({dropout_:function(t,e,n,r){var o=He(t,"x","dropout");if(w("float32"===o.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."})),w(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),0===e)return t instanceof pt?o.clone():o;var i=function(t,e){if(null==e)return t.shape.slice();if(I(t.shape,e))return e;if(t.shape.length===e.length){for(var n=[],r=0;r<t.shape.length;r++)n.push(null==e[r]&&null!=t.shape[r]?t.shape[r]:e[r]);return n}return e}(o,n),a=1-e,s=sr(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function tl(t,e,n){for(var r=1-t%2,o=new Float32Array(t),i=0;i<t;++i){var a=2*Math.PI*i/(t+r-1);o[i]=e-n*Math.cos(a)}return cn(o,"float32")}var el,nl=en({hannWindow_:function(t){return tl(t,.5,.5)}}),rl=en({hammingWindow_:function(t){return tl(t,.54,.46)}}),ol=en({frame_:function(t,e,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+e<=t.size;)a.push(dc(t,i,e)),i+=n;if(r)for(;i<t.size;){var s=i+e-t.size,u=Cn([dc(t,i,e-s),yn([s],o)]);a.push(u),i+=n}return 0===a.length?ln([],[0,e]):Cn(a).as2D(a.length,e)}}),il=en({stft_:function(t,e,n,r,o){void 0===o&&(o=nl),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))));for(var i=ol(t,e,n),a=du(i,o(e)),s=[],u=0;u<i.shape[0];u++)s.push(Kc(a.slice([u,0],[1,e]),r));return Cn(s)}}),al=Object.freeze({hannWindow:nl,hammingWindow:rl,frame:ol,stft:il}),sl=function(t,e,n){return void 0===n&&(n=1),r(this,void 0,void 0,(function(){var r,i,a,s,u,c,l,f,h,d,p,v,m,g;return o(this,(function(o){switch(o.label){case 0:return r=He(t,"predictions","inTopK"),i=He(e,"targets","inTopK"),w(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),w(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),_(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],w(n>0&&n<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n})),[4,r.data()];case 1:return s=o.sent(),[4,i.data()];case 2:for(u=o.sent(),f=(c=[s.length/a,a])[1],h=M("bool",l=c[0]),d=0;d<l;d++){for(v=s.subarray(p=d*f,p+f),m=[],g=0;g<v.length;g++)m.push({value:v[g],index:g});for(m.sort((function(t,e){return e.value-t.value})),h[d]=0,g=0;g<n;g++)if(m[g].index===u[d]){h[d]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),[2,an(h,i.shape,"bool")]}}))}))};!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(el||(el={}));var ul=en({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=el.SUM_BY_NONZERO_WEIGHTS);var o=He(t,"labels","absoluteDifference"),i=He(e,"predictions","absoluteDifference"),a=null;null!=n&&(a=He(n,"weights","absoluteDifference")),_(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return cl(s,a,r)}}),cl=en({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=el.SUM_BY_NONZERO_WEIGHTS);var r=He(t,"losses","computeWeightedLoss"),o=null;null!=e&&(o=He(e,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(n===el.NONE)return i;if(n===el.SUM)return i.sum();if(n===el.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(un(a)):s}if(n===el.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(un(r.size));var u=o.mul(mn(r.shape)).notEqual(un(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),ll=en({cosineDistance_:function(t,e,n,r,o){void 0===o&&(o=el.SUM_BY_NONZERO_WEIGHTS);var i=He(t,"labels","cosineDistance"),a=He(e,"predictions","cosineDistance"),s=null;null!=r&&(s=He(r,"weights","cosineDistance")),_(i.shape,a.shape,"Error in cosineDistance: ");var u=un(1).sub(i.mul(a).sum(n,!0));return cl(u,s,o)}}),fl=en({hingeLoss_:function(t,e,n,r){void 0===r&&(r=el.SUM_BY_NONZERO_WEIGHTS);var o=He(t,"labels","hingeLoss"),i=He(e,"predictions","hingeLoss"),a=null;null!=n&&(a=He(n,"weights","hingeLoss")),_(o.shape,i.shape,"Error in hingeLoss: ");var s=un(1);o=un(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return cl(u,a,r)}}),hl=en({huberLoss_:function(t,e,n,r,o){void 0===r&&(r=1),void 0===o&&(o=el.SUM_BY_NONZERO_WEIGHTS);var i=He(t,"labels","huberLoss"),a=He(e,"predictions","huberLoss"),s=null;null!=n&&(s=He(n,"weights","huberLoss")),_(i.shape,a.shape,"Error in huberLoss: ");var u=un(r),c=a.sub(i).abs(),l=cu(c,u),f=c.sub(l),h=un(.5).mul(l.square()).add(u.mul(f));return cl(h,s,o)}}),dl=en({logLoss_:function(t,e,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=el.SUM_BY_NONZERO_WEIGHTS);var i=He(t,"labels","logLoss"),a=He(e,"predictions","logLoss"),s=null;null!=n&&(s=He(n,"weights","logLoss")),_(i.shape,a.shape,"Error in logLoss: ");var u=un(1),c=un(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return cl(l,s,o)}}),pl=en({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=el.SUM_BY_NONZERO_WEIGHTS);var o=He(t,"labels","meanSquaredError"),i=He(e,"predictions","meanSquaredError"),a=null;null!=n&&(a=He(n,"weights","meanSquaredError")),_(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return cl(s,a,r)}}),vl=en({sigmoidCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=el.SUM_BY_NONZERO_WEIGHTS);var i=He(t,"multiClassLabels","sigmoidCrossEntropy"),a=He(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=He(n,"weights","sigmoidCrossEntropy")),_(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=un(r),c=un(1),l=un(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var f=function(t,e){var n=He(t,"labels","sigmoidCrossEntropyWithLogits"),r=He(e,"logits","sigmoidCrossEntropyWithLogits");_(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(n),a=r.abs().neg().exp().log1p();return o.sub(i).add(a)}(i,a);return cl(f,s,o)}}),ml=en({softmaxCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=el.SUM_BY_NONZERO_WEIGHTS);var i=He(t,"onehotLabels","softmaxCrossEntropy"),a=He(e,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=He(n,"weights","softmaxCrossEntropy")),_(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=un(r),c=un(1),l=un(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var f=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return Lr((function(t,e,r){var o=e.logSumExp([n],!0),i=e.toFloat().sub(o);return r([t,i]),{value:i.mul(t).neg().sum([n]),gradFunc:function(t,e){var r=e[0],o=e[1],i=Xe(t.shape,[n]);return[t.reshape(i).mul(r.toFloat().sub(o.exp())),t.reshape(i).mul(o.exp().sub(r.toFloat()))]}}}))(t,e)}(i,a);return cl(f,s,o)}}),gl=Object.freeze({get Reduction(){return el},absoluteDifference:ul,computeWeightedLoss:cl,cosineDistance:ll,hingeLoss:fl,huberLoss:hl,logLoss:dl,meanSquaredError:pl,sigmoidCrossEntropy:vl,softmaxCrossEntropy:ml});function yl(t,e){return void 0===e&&(e=!1),Rt.tidy((function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],o=Yn(n),i=t.clone(),a=ln([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,c=function(t){var e,u=i,c=s,l=o;e=Rt.tidy((function(){var e=i.slice([t,t],[n-t,1]),u=e.norm(),c=i.slice([t,t],[1,1]),l=ln([[-1]]).where(c.greater(0),ln([[1]])),f=c.sub(l.mul(u)),h=e.div(f);s=1===h.shape[0]?a.clone():a.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var d=l.matMul(f).div(u).neg(),p=i.slice([t,0],[n-t,r]),v=d.mul(s);if(0===t)i=p.sub(v.matMul(s.transpose().matMul(p)));else{var m=p.sub(v.matMul(s.transpose().matMul(p)));i=i.slice([0,0],[t,r]).concat(m,0)}var g=o.slice([0,t],[n,o.shape[1]-t]);if(0===t)o=g.sub(g.matMul(s).matMul(v.transpose()));else{var y=g.sub(g.matMul(s).matMul(v.transpose()));o=o.slice([0,0],[n,t]).concat(y,1)}return[s,i,o]})),s=e[0],i=e[1],o=e[2],Be([u,c,l])},l=0;l<u;++l)c(l);return!e&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]}))}var bl=en({bandPart_:function(t,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=He(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),n<0&&(n=s);var u=xn(0,a,1,"int32").reshape([-1,1]),c=xn(0,s,1,"int32"),l=bu(u,c),f=Ks(l.lessEqual(un(+e,"int32")),l.greaterEqual(un(-n,"int32"))),h=gn([a,s],r.dtype);return fr(pr(r.reshape([-1,a,s])).map((function(t){return Qs(f,t,h)}))).reshape(o)}}),xl=en({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,w(null!=t&&t.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=t[0].shape[0],r=function(e){w(t[e].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+n+")"}))},o=1;o<t.length;++o)r(o)}else e=!0,t=kn(t,t.shape[0],0).map((function(t){return lr(t,[0])}));w(t.length<=t[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."}));var i=[],a=t,s=function(t){i.push(Rt.tidy((function(){var e=a[t];if(t>0)for(var n=0;n<t;++n){var r=kc(i[n].mulStrict(e)).mul(i[n]);e=e.sub(r)}return e.div(Bc(e,"euclidean"))})))};for(o=0;o<t.length;++o)s(o);return e?fr(i,0):i}}),wl=en({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return yl(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce((function(t,e){return t*e})),r=pr(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];return r.forEach((function(t){var n=yl(t,e),r=n[1];o.push(n[0]),i.push(r)})),[fr(o,0).reshape(t.shape),fr(i,0).reshape(t.shape)]}}),_l=Object.freeze({bandPart:bl,gramSchmidt:xl,qr:wl});function Cl(t,e,n,r,o,i){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==i&&(i=0);var a=t.shape[0];return n=Math.min(n,a),w(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),w(2===t.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"})),w(4===t.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]})),w(1===e.rank,(function(){return"scores must be a 1D tensor"})),w(e.shape[0]===a,(function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]})),w(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var El=en({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=He(t,"images","resizeBilinear");w(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),w(2===e.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=Rt.runKernelFunc((function(t,e){return e([o]),t.resizeBilinear(o,a,s,n)}),{x:o},(function(t,e){return{x:function(){return Rt.runKernelFunc((function(r){return r.resizeBilinearBackprop(t,e[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Sl=en({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=He(t,"images","resizeNearestNeighbor");w(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),w(2===e.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),w("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=Rt.runKernelFunc((function(t,e){return e([o]),t.resizeNearestNeighbor(o,a,s,n)}),{batchImages:o},(function(t,e){return{batchImages:function(){return Rt.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(t,e[0],n)}),{})}}}));return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Il=en({nonMaxSuppression_:function(t,e,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=He(t,"boxes","nonMaxSuppression"),a=He(e,"scores","nonMaxSuppression"),s=Cl(i,a,n,r,o);return Rt.runKernelFunc((function(t){return t.nonMaxSuppression(i,a,n,r,o)}),{boxes:i,scores:a},null,"NonMaxSuppressionV3",{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:o=s.scoreThreshold})}}),Tl=en({nonMaxSuppressionWithScore_:function(t,e,n,r,o,i){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var a=He(t,"boxes","nonMaxSuppression"),s=He(e,"scores","nonMaxSuppression"),u=Cl(a,s,n,r,o,i),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=Rt.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),kl=en({cropAndResize_:function(t,e,n,r,o,i){var a=He(t,"image","cropAndResize"),s=He(e,"boxes","cropAndResize","float32"),u=He(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return w(4===a.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."})),w(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),w(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),w(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),w(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),w("bilinear"===o||"nearest"===o,(function(){return"method must be bilinear or nearest, but was "+o})),Rt.runKernelFunc((function(t,e){return t.cropAndResize(a,s,u,r,o,i)}),{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),Dl=Object.freeze({resizeBilinear:El,resizeNearestNeighbor:Sl,nonMaxSuppression:Il,nonMaxSuppressionAsync:function(t,e,n,i,a){return void 0===i&&(i=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),r(this,void 0,void 0,(function(){var r,s,u,c,l;return o(this,(function(o){switch(o.label){case 0:return r=He(t,"boxes","nonMaxSuppressionAsync"),s=He(e,"scores","nonMaxSuppressionAsync"),u=Cl(r,s,n,i,a),n=u.maxOutputSize,i=u.iouThreshold,a=u.scoreThreshold,[4,Promise.all([r.data(),s.data()])];case 1:return c=o.sent(),l=mo(c[0],c[1],n,i,a),r!==t&&r.dispose(),s!==e&&s.dispose(),[2,l]}}))}))},nonMaxSuppressionWithScore:Tl,nonMaxSuppressionWithScoreAsync:function(t,e,n,i,a,s){return void 0===i&&(i=.5),void 0===a&&(a=Number.NEGATIVE_INFINITY),void 0===s&&(s=0),r(this,void 0,void 0,(function(){var r,u,c,l,f;return o(this,(function(o){switch(o.label){case 0:return r=He(t,"boxes","nonMaxSuppressionAsync"),u=He(e,"scores","nonMaxSuppressionAsync"),c=Cl(r,u,n,i,a,s),n=c.maxOutputSize,i=c.iouThreshold,a=c.scoreThreshold,s=c.softNmsSigma,[4,Promise.all([r.data(),u.data()])];case 1:return l=o.sent(),f=go(l[0],l[1],n,i,a,s),r!==t&&r.dispose(),u!==e&&u.dispose(),[2,f]}}))}))},cropAndResize:kl}),Al=function(t,e){return!(t>0)||"linear"===e},Rl=function(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return t.mul(e.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Nl=function(t,e){var n=e,r=qr(t.shape,e.shape);return r.length>0&&(n=n.sum(r)),n.reshape(t.shape)},Fl=function(t,e,n){if("linear"===e)return t;if("relu"===e)return Fc(t);if("elu"===e)return Ac(t);if("relu6"===e)return Oc(t);if("prelu"===e)return Nc(t,n);throw new Error("Unknown fused activation "+e+".")},Ol=en({fusedMatMul_:function(t){var e,n=t.a,r=t.b,o=t.transposeA,i=void 0!==o&&o,a=t.transposeB,s=void 0!==a&&a,u=t.bias,c=t.activation,l=void 0===c?"linear":c,f=t.preluActivationWeights;if(!1===Al(Rt.state.gradientDepth,l)){var h=Ju(n,r,i,s);return null!=u&&(h=Zs(h,u)),Fl(h,l,f)}var d=He(n,"a","fused matMul"),p=He(r,"b","fused matMul");e=Et(d,p),d=e[0],p=e[1];var v=i?d.shape[d.rank-2]:d.shape[d.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=i?d.shape[d.rank-1]:d.shape[d.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=d.shape.slice(0,-2),x=p.shape.slice(0,-2),_=S(b),C=S(x);w(d.rank>=2&&p.rank>=2&&d.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+p.rank+"."})),w(I(b,x),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+d.shape+" and "+p.shape+" must match."})),w(v===m,(function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+d.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."}));var E,T,k=d.shape.slice(0,-2).concat([g,y]),D=i?d.as3D(_,v,g):d.as3D(_,g,v),A=s?p.as3D(C,y,m):p.as3D(C,m,y);null!=u&&Gr(k,(E=Et(E=He(u,"bias","fused matMul"),d)[0]).shape),null!=f&&(T=He(f,"prelu weights","fused matMul"));var R={$a:D,$b:A};return null!=u&&(R.$bias=E),null!=f&&(R.$preluActivationWeights=T),Rt.runKernelFunc((function(t,e){var n=t.fusedBatchMatMul({a:D,b:A,transposeA:i,transposeB:s,bias:E,activation:l,preluActivationWeights:T});return e([D,A,n]),n}),R,(function(t,e){var n=e[0],r=e[1],o=Rl(t,e[2],l),a={};return null!=u&&(a={$bias:function(){return Nl(E,o)}}),Object.assign(i||s?!i&&s?{$a:function(){return o.matMul(r,!1,!1)},$b:function(){return o.matMul(n,!0,!1)}}:i&&!s?{$a:function(){return r.matMul(o,!1,!0)},$b:function(){return n.matMul(o,!1,!1)}}:{$a:function(){return r.matMul(o,!0,!0)},$b:function(){return o.matMul(n,!0,!0)}}:{$a:function(){return o.matMul(r,!1,!0)},$b:function(){return n.matMul(o,!0,!1)}},a)})).reshape(k)}}),Ml=en({fusedConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,f=t.activation,h=void 0===f?"linear":f,d=t.preluActivationWeights;if(!1===Al(Rt.state.gradientDepth,h=h||"linear")){var p=ju(e,n,r,o,a,u,c);return null!=l&&(p=Zs(p,l)),Fl(p,h,d)}var v=He(e,"x","conv2d"),m=He(n,"filter","conv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),w(4===g.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."})),w(4===m.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."})),null!=c&&w(T(o),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."})),w(g.shape[3]===m.shape[2],(function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."})),w(ro(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),w("NHWC"===a,(function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."}));var b,x,_=$r(g.shape,m.shape,r,u,o,c);null!=l&&(b=Et(b=He(l,"bias","fused conv2d"),v)[0],Gr(_.outShape,b.shape)),null!=d&&(x=He(d,"prelu weights","fused conv2d"));var C={x:g,filter:m};null!=l&&(C.bias=b),null!=d&&(C.preluActivationWeights=x);var E=Rt.runKernelFunc((function(t,e){var n=t.fusedConv2d({input:g,filter:m,convInfo:_,bias:b,activation:h,preluActivationWeights:x});return e([m,g,n]),n}),C,(function(t,e){var n=e[0],i=e[1],a=Rl(t,e[2],h);w(no(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var s={};return null!=l&&(s={bias:function(){return Nl(b,a)}}),Object.assign({x:function(){return qu(i.shape,a,n,r,o)},filter:function(){return Vu(i,a,n.shape,r,o)}},s)}),"FusedConv2D",{convInfo:_,activation:h},[m,g],[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Pl=en({fusedDepthwiseConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,f=t.activation,h=void 0===f?"linear":f,d=t.preluActivationWeights;if(!1===Al(Rt.state.gradientDepth,h)){var p=Gu(e,n,r,o,a,u,c);return null!=l&&(p=Zs(p,l)),Fl(p,h,d)}var v=He(e,"x","depthwiseConv2d"),m=He(n,"filter","depthwiseConv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),w(4===g.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."})),w(4===m.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."})),w(g.shape[3]===m.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."})),null==u&&(u=[1,1]),w(ro(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=c&&w(T(o),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."}));var b,x,_=$r(g.shape,m.shape,r,u,o,c,!0);null!=l&&(b=Et(b=He(l,"bias","fused conv2d"),v)[0],Gr(_.outShape,b.shape)),null!=d&&(x=He(d,"prelu weights","fused depthwiseConv2d"));var C={x:g,filter:m};null!=l&&(C.bias=b),null!=d&&(C.preluActivationWeights=x);var E=Rt.runKernelFunc((function(t,e){var n=t.fusedDepthwiseConv2D({input:g,filter:m,convInfo:_,bias:b,activation:h,preluActivationWeights:x});return e([m,g,n]),n}),C,(function(t,e){w(no(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=e[0],r=e[1],o=Rl(t,e[2],h),i={};return null!=l&&(i={bias:function(){return Nl(b,o)}}),Object.assign({x:function(){return Ku(r.shape,o,n,_)},filter:function(){return Xu(r,o,n.shape,_)}},i)}),"FusedDepthwiseConv2D",{convInfo:_,activation:h},[m,g],[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Ll=Object.freeze({matMul:Ol,conv2d:Ml,depthwiseConv2d:Pl}),Bl=Object.freeze({image:Dl,linalg:_l,losses:gl,spectral:$c,fused:Ll,signal:al,square:Ja,conv1d:Uu,conv2d:ju,conv3d:Hu,depthwiseConv2d:Gu,separableConv2d:$u,conv2dTranspose:Yu,conv3dTranspose:Qu,op:en,batchNormalization2d:Ws,batchNormalization3d:zs,batchNormalization4d:Us,batchNormalization:js,batchNorm:Hs,batchNorm2d:Vs,batchNorm3d:qs,batchNorm4d:Gs,booleanMaskAsync:Lu,complex:nn,real:rn,imag:on,concat:Cn,concat1d:En,concat2d:Sn,concat3d:In,concat4d:Tn,split:kn,matMul:Ju,dot:Zu,outerProduct:tc,reverse:ec,reverse1d:nc,reverse2d:rc,reverse3d:oc,reverse4d:ic,maxPool:uc,avgPool:cc,pool:lc,maxPool3d:fc,avgPool3d:hc,slice:dc,slice1d:pc,slice2d:vc,slice3d:mc,slice4d:gc,abs:Za,acos:ts,acosh:es,asin:ns,asinh:rs,atan:os,atanh:is,ceil:as,clipByValue:ss,cos:us,cosh:cs,erf:ls,exp:fs,expm1:hs,floor:ds,log:ps,log1p:vs,logSigmoid:ms,neg:gs,reciprocal:ys,round:bs,rsqrt:xs,sigmoid:ws,sign:_s,isNaN:Cs,isInf:Es,isFinite:Ss,sin:Is,sinh:Ts,softplus:ks,sqrt:Ds,step:As,tan:Rs,tanh:Ns,all:bc,any:xc,argMax:wc,argMin:_c,logSumExp:Cc,max:Ec,mean:Sc,min:Ic,moments:Tc,sum:kc,prod:Dc,equal:wu,equalStrict:_u,greater:Cu,greaterEqual:Eu,greaterEqualStrict:Su,greaterStrict:Iu,less:Tu,lessEqual:ku,lessEqualStrict:Du,lessStrict:Au,notEqual:Ru,notEqualStrict:Nu,add:Zs,addN:tu,addStrict:eu,atan2:nu,div:ru,divNoNan:ou,divStrict:iu,floorDiv:au,maximum:su,maximumStrict:uu,minimum:cu,minimumStrict:lu,mod:fu,modStrict:hu,mul:du,mulStrict:pu,pow:vu,powStrict:mu,squaredDifference:gu,squaredDifferenceStrict:yu,sub:bu,subStrict:xu,elu:Ac,leakyRelu:Rc,prelu:Nc,relu:Fc,relu6:Oc,selu:Mc,logicalAnd:Ks,logicalNot:Xs,logicalOr:$s,logicalXor:Ys,where:Qs,whereAsync:Js,buffer:Un,print:jn,batchToSpaceND:Hn,broadcastTo:Vn,cast:qn,clone:Gn,cumsum:Kn,depthToSpace:Xn,expandDims:$n,eye:Yn,multinomial:Qn,oneHot:Jn,pad:Zn,pad1d:tr,pad2d:er,pad3d:nr,pad4d:rr,rand:or,randomNormal:ir,randomGamma:ar,randomUniform:sr,reshape:ur,spaceToBatchND:cr,squeeze:lr,stack:fr,tile:hr,truncatedNormal:dr,unstack:pr,setdiff1dAsync:vr,fill:yn,linspace:bn,ones:mn,range:xn,scalar:un,tensor:an,tensor1d:cn,tensor2d:ln,tensor3d:fn,tensor4d:hn,tensor5d:dn,tensor6d:pn,variable:vn,zeros:gn,onesLike:wn,zerosLike:_n,transpose:Pc,softmax:Wr,logSoftmax:zr,localResponseNormalization:Lc,norm:Bc,gather:Mu,unsortedSegmentSum:Pu,basicLSTMCell:Wc,multiRNNCell:zc,movingAverage:Uc,stridedSlice:jc,topk:Hc,scatterND:Vc,fft:qc,ifft:Gc,rfft:Kc,irfft:Xc,sparseToDense:Yc,gatherND:Qc,diag:Jc,dropout:Zc,hannWindow:nl,hammingWindow:rl,frame:ol,stft:il,inTopKAsync:sl});function Wl(t,e){Array.isArray(t)||(t=[t]),t.forEach((function(t){null!=t&&w("complex64"!==t.dtype,(function(){return e+" does not support complex64 tensors."}))}))}function zl(t,e,n,r){if("linear"===n)return t.linear(e);if("relu"===n)return t.relu(e);if("elu"===n)return t.elu(e);if("relu6"===n)return t.relu6(e);if("prelu"===n)return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var Ul=function(t){function e(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new Ur(e,Rt),e}return n(e,t),e.prototype.write=function(t,e,n){this.firstUse&&(this.firstUse=!1,s().get("IS_NODE")&&ze("\n============================\nHi there ð. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:t,dtype:n}),r},e.prototype.move=function(t,e,n,r){this.data.set(t,{values:e,dtype:r})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var e=this.data.get(t),n=e.complexTensors;return"complex64"===e.dtype?co(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),n=e;if("string"===t.dtype)try{n=e.map((function(t){return rt(t)}))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return Un(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,e,n){var r=this.write(t,e,n);return Rt.makeTensorFromDataId(r,e,n,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){return e=tt(),t(),[2,{kernelMs:tt()-e}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,e){var n=this.makeOutput(null,t.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:Rt.keep(t.clone()),imag:Rt.keep(e.clone())},n},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(Wl(t,"slice"),Fr(t.shape,e,n)){var r=Or(e,t.strides),o=S(n);return an(this.readSync(t.dataId).subarray(r,r+o),n,t.dtype)}for(var i=Un(n,t.dtype),a=this.bufferSync(t),s=0;s<i.size;++s){var u=i.indexToLoc(s).map((function(t,n){return t+e[n]}));i.values[s]=a.get.apply(a,u)}return i.toTensor()},e.prototype.stridedSlice=function(t,e,n,r){Wl(t,"stridedSlice");var o=Ar(e,n,r);if(o.some((function(t){return 0===t})))return an([],o);for(var i=Un(o,t.dtype),a=this.bufferSync(t),s=0;s<i.size;s++){for(var u=i.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+e[l];i.set.apply(i,[a.get.apply(a,c)].concat(u))}return i.toTensor()},e.prototype.diag=function(t){for(var e=this.readSync(t.dataId),n=Un([t.size,t.size],t.dtype),r=n.values,o=0;o<e.length;o++)r[o*t.size+o]=e[o];return n.toTensor()},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},e.prototype.reverse=function(t,e){Wl(t,"reverse");for(var n=Un(t.shape,t.dtype),r=this.bufferSync(t),o=function(o){var i=n.indexToLoc(o),a=i.slice();e.forEach((function(e){return a[e]=t.shape[e]-1-a[e]})),n.set.apply(n,[r.get.apply(r,a)].concat(i))},i=0;i<n.size;i++)o(i);return n.toTensor()},e.prototype.concat=function(t,e){var n=this;if("complex64"===t[0].dtype){var r=t.map((function(t){return rn(t)})),o=t.map((function(t){return on(t)}));return nn(this.concat(r,e),this.concat(o,e))}var i=t.map((function(t){var n=S(t.shape.slice(e));return t.as2D(-1,n)})),a=tn(i.map((function(t){return t.shape})),1),s=Un(a,t[0].dtype).values;if(1===i[0].shape[0]){var u=0;i.forEach((function(t){s.set(n.readSync(t.dataId),u),u+=t.size}))}else{var c=0;i.forEach((function(t){for(var e=n.readSync(t.dataId),r=0,o=0;o<t.shape[0];++o)for(var i=o*a[1]+c,u=0;u<t.shape[1];++u)s[i+u]=e[r++];c+=t.shape[1]}))}var l=tn(t.map((function(t){return t.shape})),e);return an(s,l,t[0].dtype)},e.prototype.neg=function(t){return Wl(t,"neg"),this.multiply(un(-1),t)},e.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(t,e,n,r){return{real:t+n,imag:e+r}})):this.broadcastedBinaryOp(t,e,_t(t.dtype,e.dtype),(function(t,e){return t+e}))},e.prototype.addN=function(t){var e=this;Wl(t,"addN");for(var n=t.map((function(t){return e.readSync(t.dataId)})),r=Un(t[0].shape,t[0].dtype),o=r.values,i=0;i<t.length;i++)for(var a=n[i],s=0;s<o.length;s++)o[s]+=a[s];return r.toTensor()},e.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(t,e,n,r){return{real:t-n,imag:e-r}})):this.broadcastedBinaryOp(t,e,_t(t.dtype,e.dtype),(function(t,e){return t-e}))},e.prototype.pow=function(t,e){return Wl([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.pow(t,e)}))},e.prototype.batchMatMul=function(t,e,n,r){Wl([t,e],"matMul");for(var o=n?t.shape[1]:t.shape[2],i=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],s=t.shape[0],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],f=l[0],h=l[1],d=l[2],p=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],v=p[0],m=p[1],g=p[2],y=i*a,b=Un([s,i,a],t.dtype),x=b.values,w=this.blockSize,_=0;_<s;_++)for(var C=0;C<i;C+=w)for(var E=0;E<a;E+=w)for(var S=0;S<o;S+=w)for(var I=Math.min(C+w,i),T=Math.min(E+w,a),k=Math.min(S+w,o),D=C;D<I;D++)for(var A=E;A<T;A++){for(var R=0,N=S;N<k;N++)R+=u[_*f+D*h+N*d]*c[N*v+A*m+_*g];x[_*y+(D*a+A)]+=R}return b.toTensor()},e.prototype.fusedBatchMatMul=function(t){var e=t.bias,n=t.activation,r=t.preluActivationWeights,o=this.batchMatMul(t.a,t.b,t.transposeA,t.transposeB);return e&&(o=this.add(o,e)),n&&(o=zl(this,o,n,r)),o},e.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}})):this.broadcastedBinaryOp(t,e,_t(t.dtype,e.dtype),(function(t,e){return t*e}))},e.prototype.realDivide=function(t,e){return Wl([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",(function(t,e){return t/e}))},e.prototype.floorDiv=function(t,e){return Wl([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",(function(t,e){return Math.floor(t/e)}))},e.prototype.sum=function(t,e){Wl(t,"sum"),$e("sum",e,t.rank);for(var n=Ke(t.shape,e),r=n[1],o=gn(n[0],_t(t.dtype,"int32")),i=S(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var c=u*i,l=0,f=0;f<i;++f)l+=s[c+f];a[u]=l}return o},e.prototype.prod=function(t,e){Wl(t,"sum");for(var n=Ke(t.shape,e),r=n[1],o=gn(n[0],_t(t.dtype,"int32")),i=S(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var c=u*i,l=1,f=0;f<i;++f)l*=s[c+f];a[u]=l}return o},e.prototype.unsortedSegmentSum=function(t,e,n){Wl(t,"unsortedSegmentSum");for(var r=[],o=t.rank-e.rank,i=0;i<o;++i)e=e.expandDims(i+1);for(i=0;i<n;++i){var a=un(i,"int32"),s=wu(a,e).asType("float32").mul(t).sum(0);r.push(s)}return fr(r)},e.prototype.argMin=function(t,e){Wl(t,"argMin");var n=[e];$e("argMin",n,t.rank);for(var r=Ke(t.shape,n),o=r[1],i=gn(r[0],"int32"),a=S(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,f=u[l],h=0,d=0;d<a;++d){var p=u[l+d];p<f&&(f=p,h=d)}s[c]=h}return i},e.prototype.argMax=function(t,e){Wl(t,"argMax");var n=[e];$e("argMax",n,t.rank);for(var r=Ke(t.shape,n),o=r[1],i=gn(r[0],"int32"),a=S(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,f=u[l],h=0,d=0;d<a;++d){var p=u[l+d];p>f&&(f=p,h=d)}s[c]=h}return i},e.prototype.cumsum=function(t,e,n,r){if(Wl(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=_t(t.dtype,"int32"),i=gn(t.shape,o),a=this.readSync(i.dataId),s=this.readSync(t.dataId),u=t.shape[t.rank-1],c=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},l=0;l<s.length;l+=u)for(var f=0;f<u;f++){var h=c(l,f);if(0===f)a[h]=n?0:s[h];else{var d=c(l,f-1);a[h]=n?s[d]+a[d]:s[h]+a[d]}}return i},e.prototype.equal=function(t,e){return Wl([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t===e?1:0}))},e.prototype.notEqual=function(t,e){return Wl([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t!==e?1:0}))},e.prototype.less=function(t,e){return Wl([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t<e?1:0}))},e.prototype.lessEqual=function(t,e){return Wl([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t<=e?1:0}))},e.prototype.greater=function(t,e){return Wl([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t>e?1:0}))},e.prototype.greaterEqual=function(t,e){return Wl([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t>=e?1:0}))},e.prototype.logicalNot=function(t){Wl(t,"logicalNot");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return this.makeOutput(n,t.shape,"bool")},e.prototype.logicalAnd=function(t,e){return Wl([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t&&e}))},e.prototype.logicalOr=function(t,e){return Wl([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t||e}))},e.prototype.select=function(t,e,n){Wl([t,e,n],"select");for(var r=this.readSync(t.dataId),o=this.readSync(e.dataId),i=this.readSync(n.dataId),a=gn(e.shape,_t(e.dtype,n.dtype)),s=this.readSync(a.dataId),u=0,c=0===t.rank||t.rank>1||1===e.rank?1:S(e.shape.slice(1)),l=0;l<r.length;l++)for(var f=0;f<c;f++)s[u++]=1===r[l]?o[l]:i[l];return a},e.prototype.where=function(t){Wl([t],"where");var e=this.readSync(t.dataId);return So(t.shape,e)},e.prototype.topk=function(t,e,n){return Wl(t,"topk"),Eo(this.readSync(t.dataId),t.shape,t.dtype,e)},e.prototype.min=function(t,e){Wl(t,"min"),$e("min",e,t.rank);for(var n=Ke(t.shape,e),r=n[1],o=gn(n[0],t.dtype),i=S(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var c=u*i,l=s[c],f=0;f<i;++f){var h=s[c+f];h<l&&(l=h)}a[u]=l}return o},e.prototype.minimum=function(t,e){return Wl([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.min(t,e)}))},e.prototype.mod=function(t,e){return Wl([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}))},e.prototype.max=function(t,e){Wl(t,"max"),$e("max",e,t.rank);for(var n=Ke(t.shape,e),r=n[1],o=gn(n[0],t.dtype),i=S(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var c=u*i,l=s[c],f=0;f<i;++f){var h=s[c+f];h>l&&(l=h)}a[u]=l}return o},e.prototype.maximum=function(t,e){return Wl([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.max(t,e)}))},e.prototype.all=function(t,e){Wl(t,"all"),$e("all",e,t.rank);for(var n=Ke(t.shape,e),r=n[1],o=gn(n[0],t.dtype),i=S(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var c=u*i,l=s[c],f=0;f<i;++f)l=l&&s[c+f];a[u]=l}return o},e.prototype.any=function(t,e){Wl(t,"any"),$e("any",e,t.rank);for(var n=Ke(t.shape,e),r=n[1],o=gn(n[0],t.dtype),i=S(r),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=0;u<a.length;++u){for(var c=u*i,l=s[c],f=0;f<i;++f)l=l||s[c+f];a[u]=l}return o},e.prototype.squaredDifference=function(t,e){return Wl([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){var n=t-e;return n*n}))},e.prototype.ceil=function(t){Wl(t,"ceil");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.floor=function(t){Wl(t,"floor");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.sign=function(t){Wl(t,"x");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=e[r]<0?-1:e[r]>0?1:0;return this.makeOutput(n,t.shape,"float32")},e.prototype.isNaN=function(t){Wl(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isNaN(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isInf=function(t){Wl(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Math.abs(e[r])===1/0&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isFinite=function(t){Wl(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isFinite(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.round=function(t){Wl(t,"round");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=Math.floor(e[r]);n[r]=e[r]-o<.5?Math.floor(e[r]):e[r]-o>.5?Math.ceil(e[r]):o%2==0?o:o+1}return this.makeOutput(n,t.shape,"float32")},e.prototype.exp=function(t){Wl(t,"exp");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.expm1=function(t){Wl(t,"expm1");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.log=function(t){Wl(t,"log");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.log1p=function(t){Wl(t,"log1p");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.log1p(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.sqrt=function(t){Wl(t,"sqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.sqrt(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.rsqrt=function(t){Wl(t,"rsqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/Math.sqrt(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.reciprocal=function(t){Wl(t,"reciprocal");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return this.makeOutput(n,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Wl(t,"relu");for(var e=gn(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return e},e.prototype.relu6=function(t){Wl(t,"relu");for(var e=gn(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return e},e.prototype.prelu=function(t,e){return Wl([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return t<0?e*t:t}))},e.prototype.elu=function(t){Wl(t,"elu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(e,t.shape,"float32")},e.prototype.eluDer=function(t,e){Wl([t,e],"eluDer");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=this.readSync(t.dataId),i=0;i<r.length;++i){var a=r[i];n[i]=a>=1?o[i]:o[i]*(a+1)}return this.makeOutput(n,e.shape,"float32")},e.prototype.selu=function(t){Wl(t,"selu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?1.0507009873554805*o:1.7580993408473768*(Math.exp(o)-1)}return this.makeOutput(e,t.shape,"float32")},e.prototype.clip=function(t,e,n){Wl(t,"clip");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>n?n:a<e?e:a}return this.makeOutput(r,t.shape,"float32")},e.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<t.size;++r)e[r]=Math.hypot(n[2*r],n[2*r+1]);return this.makeOutput(e,t.shape,"float32")},e.prototype.int=function(t){Wl(t,"int");for(var e=new Int32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=n[r];return this.makeOutput(e,t.shape,"int32")},e.prototype.sigmoid=function(t){Wl(t,"sigmoid");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(e,t.shape,"float32")},e.prototype.softplus=function(t){Wl(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var i,a=r[o]>-e,s=r[o]<e,u=Math.exp(r[o]);i=s?u:a?r[o]:Math.log(1+u),n[o]=i}return this.makeOutput(n,t.shape,"float32")},e.prototype.sin=function(t){Wl(t,"sin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cos=function(t){Wl(t,"cos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tan=function(t){Wl(t,"tan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asin=function(t){Wl(t,"asin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acos=function(t){Wl(t,"acos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan=function(t){Wl(t,"atan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan2=function(t,e){return Wl([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.atan2(t,e)}))},e.prototype.sinh=function(t){Wl(t,"sinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cosh=function(t){Wl(t,"cosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tanh=function(t){Wl(t,"tanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=k(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asinh=function(t){Wl(t,"asinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acosh=function(t){Wl(t,"acosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atanh=function(t){Wl(t,"atanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.erf=function(t){Wl(t,"erf");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),i=Math.abs(n[r]),a=1/(1+.3275911*i);e[r]=o*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-i*i))}return this.makeOutput(e,t.shape,"float32")},e.prototype.step=function(t,e){void 0===e&&(e=0),Wl(t,"step");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var i=r[o];n[o]=isNaN(i)?NaN:i>0?1:e}return this.makeOutput(n,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var e=t.bias,n=t.activation,r=t.preluActivationWeights,o=this.conv2d(t.input,t.filter,t.convInfo);return e&&(o=this.add(o,e)),n&&(o=zl(this,o,n,r)),o},e.prototype.conv2d=function(t,e,n){Wl([t,e],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=Un(n.outShape,t.dtype),f=t.strides[0],h=c?t.strides[1]:t.strides[2],d=c?t.strides[2]:1,p=c?1:t.strides[1],v=l.strides[0],m=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(t.dataId),x=this.readSync(e.dataId),w=l.values,_=0;_<n.batchSize;++_)for(var C=_*f,E=_*v,S=0;S<n.outHeight;++S)for(var I=E+S*m,T=S*n.strideHeight-u,k=0;k<r;k++){var D=T+k*i;if(!(D<0||D>=n.inHeight))for(var A=k*e.strides[0],R=C+D*h,N=0;N<n.outWidth;++N)for(var F=I+N*g,O=N*n.strideWidth-s,M=0;M<o;M++){var P=O+M*a;if(!(P<0||P>=n.inWidth))for(var L=R+P*d,B=A+M*e.strides[1],W=0;W<n.inChannels;++W){for(var z=b[L+W*p],U=0;U<n.outChannels;++U)w[F+U*y]+=z*x[B+U];B+=n.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,o=n.filterHeight,i=n.filterWidth,a=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,f=n.padInfo.top,h=Un(n.outShape,t.dtype),d=this.readSync(t.dataId),p=this.readSync(e.dataId),v=h.values,m=0;m<n.batchSize;++m)for(var g=m*t.strides[0],y=m*h.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*h.strides[1],w=b*n.strideDepth-c,_=0;_<r;_++){var C=w+_*a;if(!(C<0||C>=n.inDepth))for(var E=_*e.strides[0],S=g+C*t.strides[1],I=0;I<n.outHeight;++I)for(var T=x+I*h.strides[2],k=I*n.strideHeight-f,D=0;D<o;D++){var A=k+D*s;if(!(A<0||A>=n.inHeight))for(var R=E+D*e.strides[1],N=S+A*t.strides[2],F=0;F<n.outWidth;++F)for(var O=T+F*n.outChannels,M=F*n.strideWidth-l,P=0;P<i;P++){var L=M+P*u;if(!(L<0||L>=n.inWidth))for(var B=N+L*n.inChannels,W=R+P*e.strides[2],z=0;z<n.inChannels;++z){for(var U=d[B+z],j=0;j<n.outChannels;++j)v[O+j]+=U*p[W+j];W+=n.outChannels}}}}return h.toTensor()},e.prototype.conv2dDerInput=function(t,e,n){Wl([t,e],"conv2dDerInput");for(var r=Un(n.inShape,"float32"),o=r.values,i=this.readSync(t.dataId),a=this.readSync(e.dataId),s=e.strides,u=s[0],c=s[1],l=s[2],f=n.batchSize,h=n.filterHeight,d=n.filterWidth,p=n.inChannels,v=n.inHeight,m=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,x=n.strideHeight,w=n.strideWidth,_=h-1-n.padInfo.top,C=d-1-n.padInfo.left,E="channelsLast"===n.dataFormat,S=r.strides[0],I=E?r.strides[1]:r.strides[2],T=E?r.strides[2]:1,k=E?1:r.strides[1],D=t.strides[0],A=E?t.strides[1]:t.strides[2],R=E?t.strides[2]:1,N=E?1:t.strides[1],F=0;F<f;++F)for(var O=0;O<p;++O)for(var M=0;M<v;++M)for(var P=M-_,L=Math.max(0,Math.ceil(P/x)),B=Math.min(y,(h+P)/x),W=0;W<m;++W){for(var z=W-C,U=Math.max(0,Math.ceil(z/w)),j=Math.min(b,(d+z)/w),H=0,V=L;V<B;++V)for(var q=V*x-P,G=U;G<j;++G)for(var K=D*F+A*V+R*G,X=u*(h-1-q)+c*(d-1-(G*w-z))+l*O,$=0;$<g;++$)H+=i[K+N*$]*a[X+$];o[S*F+I*M+T*W+k*O]=H}return r.toTensor()},e.prototype.conv3dDerInput=function(t,e,n){for(var r=Un(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],c=i[3],l=this.readSync(t.dataId),f=t.strides,h=f[0],d=f[1],p=f[2],v=f[3],m=this.readSync(e.dataId),g=e.strides,y=g[0],b=g[1],x=g[2],w=g[3],_=n.batchSize,C=n.filterDepth,E=n.filterHeight,S=n.filterWidth,I=n.inChannels,T=n.inDepth,k=n.inHeight,D=n.inWidth,A=n.outChannels,R=n.outDepth,N=n.outHeight,F=n.outWidth,O=n.strideDepth,M=n.strideHeight,P=n.strideWidth,L=C-1-n.padInfo.front,B=E-1-n.padInfo.top,W=S-1-n.padInfo.left,z=0;z<_;++z)for(var U=0;U<I;++U)for(var j=0;j<T;++j)for(var H=j-L,V=Math.max(0,Math.ceil(H/O)),q=Math.min(R,(C+H)/O),G=0;G<k;++G)for(var K=G-B,X=Math.max(0,Math.ceil(K/M)),$=Math.min(N,(E+K)/M),Y=0;Y<D;++Y){for(var Q=Y-W,J=Math.max(0,Math.ceil(Q/P)),Z=Math.min(F,(S+Q)/P),tt=0,et=V;et<q;++et)for(var nt=et*O-H,rt=X;rt<$;++rt)for(var ot=rt*M-K,it=J;it<Z;++it)for(var at=h*z+d*et+p*rt+v*it,st=y*(C-1-nt)+b*(E-1-ot)+x*(S-1-(it*P-Q))+w*U,ut=0;ut<A;++ut)tt+=l[at+ut]*m[st+ut];o[a*z+s*j+u*G+c*Y+U]=tt}return r.toTensor()},e.prototype.conv2dDerFilter=function(t,e,n){Wl([t,e],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s="channelsLast"===n.dataFormat,u=Un(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,f=this.bufferSync(t),h=this.bufferSync(e),d=0;d<i;++d)for(var p=Math.max(0,Math.ceil((l-d)/r)),v=Math.min(n.outHeight,(n.inHeight+l-d)/r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((c-m)/o)),y=Math.min(n.outWidth,(n.inWidth+c-m)/o),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var w=0,_=0;_<n.batchSize;++_)for(var C=p;C<v;++C)for(var E=d+C*r-l,S=g;S<y;++S){var I=m+S*o-c;w+=s?f.get(_,E,I,b)*h.get(_,C,S,x):f.get(_,b,E,I)*h.get(_,x,C,S)}u.set(w,d,m,b,x)}return u.toTensor()},e.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=Un(n.filterShape,"float32"),l=c.values,f=c.strides,h=f[0],d=f[1],p=f[2],v=f[3],m=this.readSync(e.dataId),g=e.strides,y=g[0],b=g[1],x=g[2],w=g[3],_=this.readSync(t.dataId),C=t.strides,E=C[0],S=C[1],I=C[2],T=C[3],k=n.padInfo.front,D=n.padInfo.left,A=n.padInfo.top,R=0;R<a;++R)for(var N=Math.max(0,Math.ceil((k-R)/r)),F=Math.min(n.outDepth,(n.inDepth+k-R)/r),O=R*h,M=0;M<s;++M)for(var P=Math.max(0,Math.ceil((A-M)/o)),L=Math.min(n.outHeight,(n.inHeight+A-M)/o),B=M*d+O,W=0;W<u;++W)for(var z=Math.max(0,Math.ceil((D-W)/i)),U=Math.min(n.outWidth,(n.inWidth+D-W)/i),j=W*p+B,H=0;H<n.inChannels;++H)for(var V=H*v+j,q=0;q<n.outChannels;++q){for(var G=0,K=0;K<n.batchSize;++K)for(var X=K*E,$=K*y,Y=N;Y<F;++Y)for(var Q=(R+Y*r-k)*S+X,J=Y*b+$,Z=P;Z<L;++Z)for(var tt=(M+Z*o-A)*I+Q,et=Z*x+J,nt=z;nt<U;++nt)G+=_[(W+nt*i-D)*T+tt+H]*m[nt*w+et+q];l[V+q]=G}return c.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var e=t.bias,n=t.activation,r=t.preluActivationWeights,o=this.depthwiseConv2D(t.input,t.filter,t.convInfo);return e&&(o=this.add(o,e)),n&&(o=zl(this,o,n,r)),o},e.prototype.depthwiseConv2D=function(t,e,n){Wl([t,e],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=Un(n.outShape,t.dtype),f=this.readSync(t.dataId),h=this.readSync(e.dataId),d=l.values,p=0;p<n.batchSize;++p)for(var v=p*t.strides[0],m=p*l.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*l.strides[1],b=g*n.strideHeight-s,x=0;x<r;++x){var w=b+x*i;if(!(w<0||w>=n.inHeight))for(var _=x*e.strides[0],C=v+w*t.strides[1],E=0;E<n.outWidth;++E)for(var S=y+E*l.strides[2],I=E*n.strideWidth-u,T=0;T<o;++T){var k=I+T*a;if(!(k<0||k>=n.inWidth))for(var D=C+k*n.inChannels,A=S,R=_+T*e.strides[1],N=0;N<n.inChannels;++N){for(var F=f[D+N],O=0;O<c;++O)d[A+O]+=F*h[R+O];A+=c,R+=c}}}return l.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,e,n){Wl([t,e],"depthwiseConv2DDerInput");for(var r=Un(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],c=this.readSync(t.dataId),l=t.strides,f=l[0],h=l[1],d=l[2],p=this.readSync(e.dataId),v=e.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,_=n.inChannels,C=n.inHeight,E=n.inWidth,S=n.outHeight,I=n.outWidth,T=n.strideHeight,k=n.strideWidth,D=x-1-n.padInfo.top,A=w-1-n.padInfo.left,R=n.outChannels/_,N=0;N<b;++N)for(var F=0;F<_;++F)for(var O=0;O<C;++O)for(var M=O-D,P=Math.max(0,Math.ceil(M/T)),L=Math.min(S,(x+M)/T),B=0;B<E;++B){for(var W=B-A,z=Math.max(0,Math.ceil(W/k)),U=Math.min(I,(w+W)/k),j=0,H=P;H<L;++H)for(var V=H*T-M,q=z;q<U;++q)for(var G=f*N+h*H+d*q,K=m*(x-1-V)+g*(w-1-(q*k-W))+y*F,X=0;X<R;++X)j+=c[G+(F*R+X)]*p[K+X];o[a*N+s*O+u*B+F]=j}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){Wl([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=Un(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,f=this.bufferSync(t),h=this.bufferSync(e),d=0;d<i;++d)for(var p=Math.max(0,Math.ceil((c-d)/r)),v=Math.min(n.outHeight,(n.inHeight+c-d)/r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/l),w=b%l,_=0,C=0;C<n.batchSize;++C)for(var E=p;E<v;++E)for(var S=d+E*r-c,I=g;I<y;++I)_+=f.get(C,S,m+I*o-u,x)*h.get(C,E,I,b);s.set(_,d,m,x,w)}return s.toTensor()},e.prototype.tile=function(t,e){return Wl(t,"tile"),Co(this.bufferSync(t),e)},e.prototype.pad=function(t,e,n){Wl(t,"pad");var r=e.map((function(e,n){return e[0]+t.shape[n]+e[1]})),o=e.map((function(t){return t[0]})),i=this.bufferSync(t),a=Un(r,t.dtype);0!==n&&a.values.fill(n);for(var s=0;s<t.size;s++){var u=i.indexToLoc(s),c=u.map((function(t,e){return t+o[e]}));a.set.apply(a,[i.get.apply(i,u)].concat(c))}return a.toTensor()},e.prototype.transpose=function(t,e){Wl(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var o=this.readSync(t.dataId),i=Un(n,t.dtype),a=this.bufferSync(t);for(r=0;r<t.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[e[c]];var l=i.locToIndex(u);i.values[l]=o[r]}return i.toTensor()},e.prototype.gather=function(t,e,n){Wl([t,e],"gather");var r=t.shape.slice(),o=this.readSync(e.dataId);r[n]=o.length;for(var i=Un(r,t.dtype),a=this.bufferSync(t),s=0;s<i.size;++s){var u=i.indexToLoc(s),c=u.slice();c[n]=o[u[n]];var l=a.locToIndex(c);i.values[s]=a.values[l]}return i.toTensor()},e.prototype.batchToSpaceND=function(t,e,n){Wl([t],"batchToSpaceND");var r=e.reduce((function(t,e){return t*e})),o=mr(t.shape,e,r),i=gr(o.length,e.length),a=yr(t.shape,e,r),s=br(n,e.length),u=xr(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){Wl([t],"spaceToBatchND");var r=e.reduce((function(t,e){return t*e})),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=mr(a.shape,e,r,!1),u=gr(s.length,e.length,!1),c=yr(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(c)},e.prototype.pool=function(t,e,n){Wl(t,"pool");for(var r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,f="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=this.readSync(t.dataId),d=Un(e.outShape,t.dtype),p=d.values,v=e.outShape[1]*e.outShape[2]*e.outShape[3],m=e.outShape[2]*e.outShape[3],g=e.outShape[3],y=0;y<e.batchSize;++y)for(var b=y*v,x=y*t.strides[0],w=0;w<e.inChannels;++w)for(var _=0;_<e.outHeight;++_)for(var C=_*r-c,E=Math.max(0,C),S=Math.min(e.inHeight,s+C),I=b+_*m,T=0;T<e.outWidth;++T){for(var k=T*o-l,D=Math.max(0,k),A=Math.min(e.inWidth,u+k),R=f,N=0,F=0,O=E;O<S;O+=i){for(var M=x+O*t.strides[1],P=D;P<A;P+=a){var L=h[M+P*t.strides[2]+w];"max"===n&&L>R?R=L:"avg"===n&&(N+=L,F++)}if(isNaN(R))break}p[I+T*g+w]="avg"===n?N/F:R}return d.toTensor()},e.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},e.prototype.maxPoolPositions=function(t,e){for(var n=Un(e.outShape,"int32"),r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,f=this.bufferSync(t),h=0;h<e.batchSize;++h)for(var d=0;d<e.inChannels;++d)for(var p=0;p<e.outHeight;++p){for(var v=p*r-c,m=v;m<0;)m+=i;for(var g=Math.min(e.inHeight,s+v),y=0;y<e.outWidth;++y){for(var b=y*o-l,x=b;x<0;)x+=a;for(var w=Math.min(e.inWidth,u+b),_=Number.NEGATIVE_INFINITY,C=-1,E=m;E<g;E+=i)for(var S=E-v,I=x;I<w;I+=a){var T=I-b,k=f.get(h,E,I,d);k>_&&(_=k,C=S*u+T)}n.set(C,h,p,y,d)}}return n.toTensor()},e.prototype.maxPoolBackprop=function(t,e,n,r){Wl([e,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(e,r),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=l-1-r.padInfo.left,h=c-1-r.padInfo.top,d=Un(e.shape,"float32"),p=this.bufferSync(o),v=this.bufferSync(t),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-h,w=b-f,_=0,C=0;C<c;C+=s){var E=(x+C)/i;if(!(E<0||E>=r.outHeight||Math.floor(E)!==E))for(var S=0;S<l;S+=u){var I=(w+S)/a;if(!(I<0||I>=r.outWidth||Math.floor(I)!==I)){var T=c*l-1-p.get(m,E,I,g)===C*l+S?1:0;0!==T&&(_+=v.get(m,E,I,g)*T)}}}d.set(_,m,y,b,g)}return d.toTensor()},e.prototype.avgPoolBackprop=function(t,e,n){Wl([t,e],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,f=l-1-n.padInfo.left,h=c-1-n.padInfo.top,d=Un(e.shape,"float32"),p=1/(i*a),v=this.bufferSync(t),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-h,w=b-f,_=0,C=0;C<c;C+=s){var E=(x+C)/r;if(!(E<0||E>=n.outHeight||Math.floor(E)!==E))for(var S=0;S<l;S+=u){var I=(w+S)/o;I<0||I>=n.outWidth||Math.floor(I)!==I||(_+=v.get(m,E,I,g))}}d.set(_*p,m,y,b,g)}return d.toTensor()},e.prototype.pool3d=function(t,e,n){Wl(t,"pool3d");for(var r=e.strideDepth,o=e.strideHeight,i=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left,v="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(t.dataId),g=Un(e.outShape,t.dtype),y=g.values,b=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],x=e.outShape[2]*e.outShape[3]*e.outShape[4],w=e.outShape[3]*e.outShape[4],_=e.outShape[4],C=0;C<e.batchSize;++C)for(var E=C*b,S=C*t.strides[0],I=0;I<e.inChannels;++I)for(var T=0;T<e.outDepth;++T){for(var k=T*r-h,D=k;D<0;)D+=a;for(var A=Math.min(e.inDepth,c+k),R=E+T*x,N=0;N<e.outHeight;++N){for(var F=N*o-d,O=F;O<0;)O+=s;for(var M=Math.min(e.inHeight,l+F),P=R+N*w,L=0;L<e.outWidth;++L){for(var B=L*i-p,W=B;W<0;)W+=u;for(var z=Math.min(e.inWidth,f+B),U=P+L*_,j=v,H=0,V=0,q=D;q<A;q+=a){for(var G=S+q*t.strides[1],K=O;K<M;K+=s){for(var X=G+K*t.strides[2],$=W;$<z;$+=u){var Y=m[X+$*t.strides[3]+I];if("max"===n&&Y>j?j=Y:"avg"===n&&(H+=Y,V++),isNaN(j))break}if(isNaN(j))break}if(isNaN(j))break}y[U+I]="avg"===n?H/V:j}}}return g.toTensor()},e.prototype.avgPool3d=function(t,e){return Wl(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,e,n){Wl([t,e],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,f=n.dilationWidth,h=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,v=h-1-n.padInfo.front,m=p-1-n.padInfo.left,g=d-1-n.padInfo.top,y=Un(e.shape,"float32"),b=1/(a*s*u),x=this.bufferSync(t),w=0;w<n.batchSize;++w)for(var _=0;_<n.inChannels;++_)for(var C=0;C<n.inDepth;++C)for(var E=0;E<n.inHeight;++E)for(var S=0;S<n.inWidth;++S){for(var I=C-v,T=E-g,k=S-m,D=0,A=0;A<h;A+=c){var R=(I+A)/r;if(!(R<0||R>=n.outDepth||Math.floor(R)!==R))for(var N=0;N<d;N+=l){var F=(T+N)/o;if(!(F<0||F>=n.outHeight||Math.floor(F)!==F))for(var O=0;O<p;O+=f){var M=(k+O)/i;M<0||M>=n.outWidth||Math.floor(M)!==M||(D+=x.get(w,R,F,M,_))}}}y.set(D*b,w,C,E,S,_)}return y.toTensor()},e.prototype.maxPool3d=function(t,e){return Wl(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,e){for(var n=Un(e.outShape,"int32"),r=e.strideDepth,o=e.strideHeight,i=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left,v=this.bufferSync(t),m=0;m<e.batchSize;++m)for(var g=0;g<e.inChannels;++g)for(var y=0;y<e.outDepth;++y){for(var b=y*r-h,x=b;x<0;)x+=a;for(var w=Math.min(e.inDepth,c+b),_=0;_<e.outHeight;++_){for(var C=_*o-d,E=C;E<0;)E+=s;for(var S=Math.min(e.inHeight,l+C),I=0;I<e.outWidth;++I){for(var T=I*i-p,k=T;k<0;)k+=u;for(var D=Math.min(e.inWidth,f+T),A=Number.NEGATIVE_INFINITY,R=-1,N=x;N<w;N+=a)for(var F=N-b,O=E;O<S;O+=s)for(var M=O-C,P=k;P<D;P+=u){var L=P-T,B=v.get(m,N,O,P,g);B>=A&&(A=B,R=F*l*f+M*l+L)}n.set(R,m,y,_,I,g)}}}return n.toTensor()},e.prototype.maxPool3dBackprop=function(t,e,n,r){Wl([e,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(e,r),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=f-1-r.padInfo.front,v=d-1-r.padInfo.left,m=h-1-r.padInfo.top,g=Un(e.shape,"float32"),y=this.bufferSync(o),b=this.bufferSync(t),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var _=0;_<r.inDepth;++_)for(var C=0;C<r.inHeight;++C)for(var E=0;E<r.inWidth;++E){for(var S=_-p,I=C-m,T=E-v,k=0,D=0;D<f;D+=u){var A=(S+D)/i;if(!(A<0||A>=r.outDepth||Math.floor(A)!==A))for(var R=0;R<h;R+=c){var N=(I+R)/a;if(!(N<0||N>=r.outHeight||Math.floor(N)!==N))for(var F=0;F<d;F+=l){var O=(T+F)/s;if(!(O<0||O>=r.outWidth||Math.floor(O)!==O)){var M=f*h*d-1-y.get(x,A,N,O,w)===D*h*d+R*d+F?1:0;0!==M&&(k+=b.get(x,A,N,O,w)*M)}}}}g.set(k,x,_,C,E,w)}return g.toTensor()},e.prototype.cast=function(t,e){return io(t,e,this)},e.prototype.reshape=function(t,e){return ao(t,e)},e.prototype.avgPool=function(t,e){return Wl(t,"avgPool"),this.pool(t,e,"avg").toFloat()},e.prototype.resizeBilinear=function(t,e,n,r){Wl(t,"resizeBilinear");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=this.readSync(t.dataId),l=new Float32Array(S([i,e,n,u])),f=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],d=0,p=f[0]/h[0],v=f[1]/h[1],m=0;m<i;m++)for(var g=0;g<e;g++)for(var y=p*g,b=Math.floor(y),x=y-b,w=Math.min(a-1,Math.ceil(y)),_=m*t.strides[0]+b*t.strides[1],C=m*t.strides[0]+w*t.strides[1],E=0;E<n;E++)for(var I=v*E,T=Math.floor(I),k=I-T,D=Math.min(s-1,Math.ceil(I)),A=_+T*t.strides[2],R=C+T*t.strides[2],N=_+D*t.strides[2],F=C+D*t.strides[2],O=0;O<u;O++){var M=c[A+O],P=c[R+O],L=M+(c[N+O]-M)*k;l[d++]=L+(P+(c[F+O]-P)*k-L)*x}return an(l,[i,e,n,u])},e.prototype.resizeBilinearBackprop=function(t,e,n){Wl([t,e],"resizeBilinearBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],f=new Float32Array(o*i*a*s),h=[n&&c>1?i-1:i,n&&l>1?a-1:a],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=h[0]/d[0],v=h[1]/d[1],m=this.readSync(t.dataId),g=0,y=0;y<o;y++)for(var b=y*e.strides[0],x=0;x<c;x++)for(var w=x*p,_=Math.floor(w),C=Math.min(Math.ceil(w),i-1),E=b+_*e.strides[1],S=b+C*e.strides[1],I=w-_,T=1-I,k=0;k<l;k++)for(var D=k*v,A=Math.floor(D),R=Math.min(Math.ceil(D),a-1),N=D-A,F=1-N,O=E+A*e.strides[2],M=E+R*e.strides[2],P=S+A*e.strides[2],L=S+R*e.strides[2],B=T*F,W=T*N,z=I*F,U=I*N,j=0;j<s;j++){var H=m[g++];f[O+j]+=H*B,f[M+j]+=H*W,f[P+j]+=H*z,f[L+j]+=H*U}return hn(f,[o,a,i,s],e.dtype)},e.prototype.resizeNearestNeighbor=function(t,e,n,r){Wl(t,"resizeNearestNeighbor");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=this.readSync(t.dataId),l=new Float32Array(i*e*n*u),f=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],d=f[0]/h[0],p=f[1]/h[1],v=0,m=0;m<i;m++)for(var g=m*t.strides[0],y=0;y<e;y++)for(var b=d*y,x=g+Math.min(a-1,r?Math.round(b):Math.floor(b))*t.strides[1],w=0;w<n;w++)for(var _=p*w,C=x+Math.min(s-1,r?Math.round(_):Math.floor(_))*t.strides[2],E=0;E<u;E++)l[v++]=c[C+E];return an(l,[i,e,n,u],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){Wl([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],f=new Float32Array(o*i*a*s),h=this.readSync(t.dataId),d=[n&&c>1?i-1:i,n&&l>1?a-1:a],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],v=d[0]/p[0],m=d[1]/p[1],g=1/v,y=1/m,b=2*Math.ceil(g)+2,x=2*Math.ceil(y)+2,w=0;w<o;w++)for(var _=w*e.strides[0],C=0;C<i;C++)for(var E=_+C*e.strides[1],S=Math.floor(C*g),I=Math.floor(S-b/2),T=0;T<a;T++)for(var k=E+T*e.strides[2],D=Math.floor(T*y),A=Math.floor(D-x/2),R=0;R<s;R++){for(var N=0,F=0;F<b;F++){var O=F+I;if(!(O<0||O>=c)){var M=_+O*t.strides[1],P=O*v;if(C===Math.min(i-1,n?Math.round(P):Math.floor(P)))for(var L=0;L<x;L++){var B=L+A;if(!(B<0||B>=l)){var W=M+B*t.strides[2],z=B*m;T===Math.min(a-1,n?Math.round(z):Math.floor(z))&&(N+=h[W+R])}}}}f[k+R]=N}return hn(f,e.shape,e.dtype)},e.prototype.batchNormalization=function(t,e,n,r,o,i){Wl([t,e,n,o,i],"batchNorm");for(var a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=this.readSync(n.dataId),c=o?this.readSync(o.dataId):new Float32Array([1]),l=i?this.readSync(i.dataId):new Float32Array([0]),f=new Float32Array(a.length),h=l.length,d=c.length,p=u.length,v=s.length,m=0,g=0,y=0,b=0,x=0;x<a.length;++x)f[x]=l[m++]+(a[x]-s[g++])*c[y++]/Math.sqrt(u[b++]+r),m>=h&&(m=0),g>=v&&(g=0),y>=d&&(y=0),b>=p&&(b=0);return hn(f,t.shape)},e.prototype.localResponseNormalization4D=function(t,e,n,r,o){Wl(t,"localResponseNormalization4D");var i=t.shape[3],a=i-1,s=this.readSync(t.dataId),u=t.size,c=new Float32Array(u);function l(t){for(var n=t%i,r=t-n+Math.max(0,n-e),o=t-n+Math.min(n+e,a),u=0;r<=o;r++){var c=s[r];u+=c*c}return u}for(var f=0;f<u;f++){var h=l(f),d=s[f]*Math.pow(n+r*h,-o);c[f]=d}return hn(c,t.shape)},e.prototype.LRNGrad=function(t,e,n,r,o,i,a){Wl(t,"LRNGrad");for(var s=t.shape[3],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=this.readSync(n.dataId),f=new Float32Array(t.size),h=t.size,d=0;d<h;d++){for(var p=d%s,v=d-p+Math.max(0,p-r),m=d-p+Math.min(s,p+r+1),g=0,y=v;y<m;y++)g+=Math.pow(c[y],2);for(g=i*g+o,y=v;y<m;y++){var b=-2*i*a*c[y]*l[d]/g;d===y&&(b+=Math.pow(g,-a)),f[y]+=b*=u[d]}}return hn(f,t.shape)},e.prototype.multinomial=function(t,e,n,r){Wl(t,"multinomial");for(var o=e?t:Wr(t),i=o.shape[0],a=o.shape[1],s=gn([i,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(o.dataId),l=0;l<i;++l){var f=l*a,h=new Float32Array(a-1);h[0]=c[f];for(var d=1;d<h.length;++d)h[d]=h[d-1]+c[f+d];for(var p=Ln(r.toString()),v=l*n,m=0;m<n;++m){var g=p();u[v+m]=h.length;for(var y=0;y<h.length;y++)if(g<h[y]){u[v+m]=y;break}}}return s},e.prototype.oneHot=function(t,e,n,r){Wl(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(r);for(var i=this.readSync(t.dataId),a=0;a<t.size;++a)i[a]>=0&&i[a]<e&&(o[a*e+i[a]]=n);return ln(o,[t.size,e],"int32")},e.prototype.nonMaxSuppression=function(t,e,n,r,o){return Wl(t,"nonMaxSuppression"),mo(this.readSync(t.dataId),this.readSync(e.dataId),n,r,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],o=Un(t.shape,"float32"),i=Un(t.shape,"float32"),a=rn(t).as2D(n,r),s=on(t).as2D(n,r),u=0;u<n;u++)for(var c=a.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),f=nn(c,l),h=this.readSync(this.fftImpl(f,e).dataId),d=0;d<r;d++){var p=lo(h,d);o.values[u*r+d]=p.real,i.values[u*r+d]=p.imag}return nn(o.toTensor(),i.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(o=nn(rn(o).div(un(r)),on(o).div(un(r)))),o}var i=this.readSync(t.dataId),a=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(i,r,e));return nn(a.real,a.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=this.readSync(t.dataId),o=e/2,i=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),a=nn(i.real,i.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),u=nn(s.real,s.imag).as1D();a=this.fftRadix2(a,o,n),u=this.fftRadix2(u,o,n);var c=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),o=0;o<Math.ceil(t/2);o++){var i=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:n,imag:r}}(e,n),l=nn(c.real,c.imag).mul(u),f=a.add(l),h=a.sub(l),d=rn(f).concat(rn(h)),p=on(f).concat(on(h));return nn(d,p).as1D()},e.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),o=0;o<e;o++){for(var i=0,a=0,s=0;s<e;s++){var u=ho(o*s,e,n),c=lo(t,s);i+=c.real*u.real-c.imag*u.imag,a+=c.real*u.imag+c.imag*u.real}n&&(i/=e,a/=e),fo(r,i,a,o)}return r},e.prototype.depthToSpace=function(t,e,n){w("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),w(e>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}));for(var r=t.shape[0],o=t.shape[1],i=t.shape[2],a=t.shape[3],s=o*e,u=i*e,c=a/(e*e),l=this.readSync(t.dataId),f=new Float32Array(r*s*u*c),h=0,d=0;d<r;++d)for(var p=0;p<s;++p)for(var v=Math.floor(p/e),m=p%e,g=0;g<u;++g)for(var y=Math.floor(g/e),b=(m*e+g%e)*c,x=0;x<c;++x)f[h++]=l[x+b+a*(y+i*(v+o*d))];return hn(f,[r,s,u,c])},e.prototype.broadcastedBinaryOp=function(t,e,n,r){var o=Gr(t.shape,e.shape),i=Un(o,n),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=Vr(t.shape,o),c=Vr(e.shape,o),l=i.values;if(u.length+c.length===0)for(var f=0;f<l.length;++f)l[f]=r(a[f%a.length],s[f%s.length]);else{var h=this.bufferSync(t),d=this.bufferSync(e),p=function(n){var o=i.indexToLoc(n),f=o.slice(-t.rank);u.forEach((function(t){return f[t]=0}));var p=h.locToIndex(f),v=o.slice(-e.rank);c.forEach((function(t){return v[t]=0}));var m=d.locToIndex(v);l[n]=r(a[p],s[m])};for(f=0;f<l.length;++f)p(f)}return i.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=Gr(t.shape,e.shape),o=Un(r,"float32"),i=Un(r,"float32"),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=Vr(t.shape,r),c=Vr(e.shape,r),l=o.values,f=i.values;if(u.length+c.length===0)for(var h=0;h<l.length;h++){var d=h%a.length,p=h%s.length,v=n(a[2*d],a[2*d+1],s[2*p],s[2*p+1]);l[h]=v.real,f[h]=v.imag}else{var m=this.bufferSync(this.data.get(t.dataId).complexTensors.real),g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=function(r){var i=o.indexToLoc(r),h=i.slice(-t.rank);u.forEach((function(t){return h[t]=0}));var d=m.locToIndex(h),p=i.slice(-e.rank);c.forEach((function(t){return p[t]=0}));var v=g.locToIndex(p),y=n(a[2*d],a[2*d+1],s[2*v],s[2*v+1]);l[r]=y.real,f[r]=y.imag};for(h=0;h<l.length;h++)y(h)}return this.complex(o.toTensor(),i.toTensor())},e.prototype.split=function(t,e,n){return _o(t,e,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,e,n,r,o,i){for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],f=e.shape[0],h=r[0],d=r[1],p=Un([f,h,d,l],"float32"),v=this.readSync(e.dataId),m=this.readSync(n.dataId),g=this.readSync(t.dataId),y=t.strides,b=p.strides,x=0;x<f;x++){var w=4*x,_=v[w],C=v[w+1],E=v[w+2],S=v[w+3],I=m[x];if(!(I>=s))for(var T=h>1?(E-_)*(u-1)/(h-1):0,k=d>1?(S-C)*(c-1)/(d-1):0,D=0;D<h;D++){var A=h>1?_*(u-1)+D*T:.5*(_+E)*(u-1);if(A<0||A>u-1)for(var R=0;R<d;R++)for(var N=0;N<l;N++){var F=N+R*b[2]+D*b[1]+x*b[0];p.values[F]=i}else if("bilinear"===o){var O=Math.floor(A),M=Math.ceil(A),P=A-O;for(R=0;R<d;R++)if((q=d>1?C*(c-1)+R*k:.5*(C+S)*(c-1))<0||q>c-1)for(N=0;N<l;N++)p.values[F=N+R*b[2]+D*b[1]+x*b[0]]=i;else{var L=Math.floor(q),B=Math.ceil(q),W=q-L;for(N=0;N<l;N++){var z=g[F=N+L*y[2]+O*y[1]+I*y[0]],U=g[F=N+B*y[2]+O*y[1]+I*y[0]],j=g[F=N+L*y[2]+M*y[1]+I*y[0]],H=z+(U-z)*W,V=j+(g[F=N+B*y[2]+M*y[1]+I*y[0]]-j)*W;p.values[F=N+R*b[2]+D*b[1]+x*b[0]]=H+(V-H)*P}}}else for(R=0;R<d;++R){var q;if((q=d>1?C*(c-1)+R*k:.5*(C+S)*(c-1))<0||q>c-1)for(N=0;N<l;N++)p.values[F=N+R*b[2]+D*b[1]+x*b[0]]=i;else{var G=Math.round(q),K=Math.round(A);for(N=0;N<l;N++)p.values[N+R*b[2]+D*b[1]+x*b[0]]=g[N+G*y[2]+K*y[1]+I*y[0]]}}}}return p.toTensor()},e.prototype.sparseToDense=function(t,e,n,r){var o=Ir(0,t,n);return this.scatter(t,e,n,o.outputSize,o.sliceSize,o.numUpdates,o.sliceRank,o.strides,r,!1)},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=wr(t,e),i=o[0],a=o[1],s=o[2],u=o[3];if(0===a)return an([],i,t.dtype);for(var c=new lt([a,s],t.dtype),l=this.readSync(e.dataId),f=this.readSync(t.dataId),h=0;h<a;h++){for(var d=[],p=0,v=0;v<r;v++){var m=l[h*r+v];p+=m*u[v],d.push(m)}if(p<0||p>=t.size/s)throw new Error("Invalid indices: "+d+" does not index into "+t.shape);for(var g=0;g<s;g++)c.values[h*s+g]=f[p*s+g]}return c.toTensor().reshape(i)},e.prototype.scatterND=function(t,e,n){var r=Ir(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=un(0);return this.scatter(t,e,n,u,a,i,o,s,c,!0)},e.prototype.fill=function(t,e,n){var r=P(n=n||G(e),S(t));return r.fill(e),Rt.makeTensor(r,t,n,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var e=P(t.dtype,S(t.shape));return this.makeOutput(e,t.shape,t.dtype)},e.prototype.linspace=function(t,e,n){return so(t,e,n)},e.prototype.scatter=function(t,e,n,r,o,i,a,s,u,c){var l=[r/o,o],f=this.readSync(t.dataId),h=this.readSync(e.dataId);if(0===r)return an([],n,e.dtype);var d=new lt(l,e.dtype);d.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<i;p++){for(var v=[],m=0,g=0;g<a;g++){var y=f[p*a+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var b=0;b<o;b++)c?d.values[m*o+b]+=h[p*o+b]:d.values[m*o+b]=0===e.rank?h[0]:h[p*o+b]}return d.toTensor().reshape(n)},e}(jr);Rt.registerBackend("cpu",(function(){return new Ul}),1),p({kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs.x,n=t.backend;Wl(e,"square");for(var r=n.data.get(e.dataId).values,o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=a*a}return{dataId:n.write(o,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}}),p({kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.attrs,r=e.boxes,o=e.scores,i=n.maxOutputSize,a=n.iouThreshold,s=n.scoreThreshold,u=n.softNmsSigma,c=t.backend;Wl(r,"NonMaxSuppressionWithScore");var l=go(c.data.get(r.dataId).values,c.data.get(o.dataId).values,i,a,s,u);return[l.selectedIndices,l.selectedScores]}}),p({kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs.x,n=t.backend,r=new Na(e.shape,"return x * x;");return n.runWebGLProgram(r,[e],e.dtype)}});var jl,Hl=function(t){this.variableNames=["A"];var e=Ro(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Vl=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Ro(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "};p({kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.backend,n=t.inputs.pixels,r="undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement,o="undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement,i=r?[n.videoWidth,n.videoHeight]:[n.width,n.height],a=i[0],u=i[1],c=[u,a],l=[u,a,t.attrs.numChannels];(o||r)&&(null==jl&&(jl=document.createElement("canvas").getContext("2d")),jl.canvas.width=a,jl.canvas.height=u,jl.drawImage(n,0,0,a,u),n=jl.canvas);var f=e.makeTensorInfo(c,"int32");e.texData.get(f.dataId).usage=Mt.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(f.dataId),n);var h=s().getBool("WEBGL_PACK")?new Vl(l):new Hl(l),d=e.runWebGLProgram(h,[f],"int32");return e.disposeData(f.dataId),d}}),p({kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs;ze("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=e.scores,i=r.maxOutputSize,a=r.iouThreshold,s=r.scoreThreshold,u=r.softNmsSigma,c=n,l=go(c.readSync(e.boxes.dataId),c.readSync(o.dataId),i,a,s,u);return[l.selectedIndices,l.selectedScores]}});var ql=function(){function t(){}return t.prototype.fetch=function(t,e){return fetch(t,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},t}();s().get("IS_BROWSER")&&s().setPlatform("browser",new ql);var Gl,Kl=function(){function t(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(t,e){return null!=s().global.fetch?s().global.fetch(t,e):(null==Gl&&(Gl=require("node-fetch")),Gl(t,e))},t.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},t}();s().get("IS_NODE")&&s().setPlatform("node",new Kl);var Xl={float32:4,int32:4,uint16:2,uint8:1,bool:1};function $l(t,e){for(var n={},r=0,o=function(e){var o=e.name,i=e.dtype,a=e.shape,s=S(a),u=void 0;if("quantization"in e){var c=e.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=Xl[c.dtype],f=t.slice(r,r+s*l),h="uint8"===c.dtype?new Uint8Array(f):new Uint16Array(f);if("float32"===i)u=Float32Array.from(h,(function(t){return t*c.scale+c.min}));else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=Int32Array.from(h,(function(t){return Math.round(t*c.scale+c.min)}))}r+=s*l}else if("string"===i){var d=S(e.shape);u=[];for(var p=0;p<d;p++){var v=new Uint32Array(t.slice(r,r+4))[0];r+=4;var m=new Uint8Array(t.slice(r,r+v));u.push(m),r+=v}}else{var g=Xl[i];if(f=t.slice(r,r+s*g),"float32"===i)u=new Float32Array(f);else if("int32"===i)u=new Int32Array(f);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=new Uint8Array(f)}r+=s*g}n[o]=an(u,a,i)},i=0,a=e;i<a.length;i++)o(a[i]);return n}function Yl(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach((function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)}));var r=new Uint8Array(e),o=0;return n.forEach((function(t){r.set(new Uint8Array(t.buffer),o),o+=t.byteLength})),r.buffer}var Ql="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Jl(t){return Ql?Buffer.byteLength(t):new Blob([t]).size}function Zl(t){var e=0;t.forEach((function(t){e+=t.byteLength}));var n=new Uint8Array(e),r=0;return t.forEach((function(t){n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function tf(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function ef(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:Jl(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:Jl(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var nf=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var o=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach((function(t){var n=t(e,r);null!==n&&o.push(n)})),o},t}(),rf="://",of=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){w(null!=e,(function(){return"scheme must not be undefined or null."})),e.endsWith(rf)&&(e=e.slice(0,e.indexOf(rf))),w(e.length>0,(function(){return"scheme must not be an empty string."}));var r=t.getInstance();w(null==r.managers[e],(function(){return"A model store manager is already registered for scheme '"+e+"'."})),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function af(t){if(-1===t.indexOf(rf))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+of.getSchemes().join(","));return{scheme:t.split(rf)[0],path:t.split(rf)[1]}}function sf(t,e,n){return void 0===n&&(n=!1),r(this,void 0,void 0,(function(){var r,i,a,s,u,c,l,f,h;return o(this,(function(o){switch(o.label){case 0:return w(t!==e,(function(){return"Old path and new path are the same: '"+t+"'"})),w((r=nf.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+t+"."})),w(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."})),i=r[0],w((a=nf.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),w(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."})),s=a[0],u=af(t).scheme,c=af(t).path,l=u===af(t).scheme,[4,i.load()];case 1:return f=o.sent(),n&&l?[4,of.getManager(u).removeModel(c)]:[3,3];case 2:o.sent(),o.label=3;case 3:return[4,s.save(f)];case 4:return h=o.sent(),!n||l?[3,6]:[4,of.getManager(u).removeModel(c)];case 5:o.sent(),o.label=6;case 6:return[2,h.modelArtifactsInfo]}}))}))}var uf="models_store",cf="model_info_store";function lf(){if(!s().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ff(t){var e=t.result;e.createObjectStore(uf,{keyPath:"modelPath"}),e.createObjectStore(cf,{keyPath:"modelPath"})}var hf=function(){function t(t){if(this.indexedDB=lf(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]}))}))},t.prototype.load=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.databaseAction(this.modelPath)]}))}))},t.prototype.databaseAction=function(t,e){var n=this;return new Promise((function(t,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return ff(o)},o.onsuccess=function(){var i=o.result;if(null==e){var a=i.transaction(uf,"readonly"),s=a.objectStore(uf).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return i.close(),r(s.error)},a.oncomplete=function(){return i.close()}}else{var u,c=ef(e),l=i.transaction(cf,"readwrite"),f=l.objectStore(cf),h=f.put({modelPath:n.modelPath,modelArtifactsInfo:c});h.onsuccess=function(){var o=(u=i.transaction(uf,"readwrite")).objectStore(uf).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:c});o.onsuccess=function(){return t({modelArtifactsInfo:c})},o.onerror=function(t){var e=(f=l.objectStore(cf)).delete(n.modelPath);e.onsuccess=function(){return i.close(),r(o.error)},e.onerror=function(t){return i.close(),r(o.error)}}},h.onerror=function(t){return i.close(),r(h.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},o.onerror=function(t){return r(o.error)}}))},t.URL_SCHEME="indexeddb://",t}(),df=function(t){return s().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hf.URL_SCHEME)?(e=t.slice(hf.URL_SCHEME.length),new hf(e)):null;var e};nf.registerSaveRouter(df),nf.registerLoadRouter(df);var pf=function(){function t(){this.indexedDB=lf()}return t.prototype.listModels=function(){return r(this,void 0,void 0,(function(){var t=this;return o(this,(function(e){return[2,new Promise((function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return ff(r)},r.onsuccess=function(){var t=r.result,o=t.transaction(cf,"readonly"),i=o.objectStore(cf).getAll();i.onsuccess=function(){for(var t={},n=0,r=i.result;n<r.length;n++){var o=r[n];t[o.modelPath]=o.modelArtifactsInfo}e(t)},i.onerror=function(e){return t.close(),n(i.error)},o.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}}))]}))}))},t.prototype.removeModel=function(t){return r(this,void 0,void 0,(function(){var e=this;return o(this,(function(n){var r;return t=(r=t).startsWith(hf.URL_SCHEME)?r.slice(hf.URL_SCHEME.length):r,[2,new Promise((function(n,r){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return ff(o)},o.onsuccess=function(){var e,i=o.result,a=i.transaction(cf,"readwrite"),s=a.objectStore(cf),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var o=s.delete(t),a=function(){var o=(e=i.transaction(uf,"readwrite")).objectStore(uf).delete(t);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(t){return r(u.error)}};o.onsuccess=a,o.onerror=function(t){return a(),i.close(),r(u.error)}},u.onerror=function(t){return i.close(),r(u.error)},a.oncomplete=function(){null==e?i.close():e.oncomplete=function(){return i.close()}}},o.onerror=function(t){return r(o.error)}}))]}))}))},t}();if(s().getBool("IS_BROWSER"))try{of.registerManager(hf.URL_SCHEME,new pf)}catch(e){}var vf="/",mf="tensorflowjs_models",gf="info",yf="model_topology",bf="weight_specs",xf="weight_data",wf="model_metadata";function _f(t){return{info:[mf,t,gf].join(vf),topology:[mf,t,yf].join(vf),weightSpecs:[mf,t,bf].join(vf),weightData:[mf,t,xf].join(vf),modelMetadata:[mf,t,wf].join(vf)}}function Cf(t){var e=t.split(vf);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(vf)}var Ef=function(){function t(t){if(!s().getBool("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=_f(this.modelPath)}return t.prototype.save=function(t){return r(this,void 0,void 0,(function(){var e,n,r;return o(this,(function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=ef(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(Ql)return Buffer.from(t).toString("base64");for(var e=new Uint8Array(t),n="",r=0,o=e.length;r<o;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},t.prototype.load=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i,a,s;return o(this,(function(o){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,e.userDefinedMetadata=a.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(Ql){var e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(s),[2,e]}))}))},t.URL_SCHEME="localstorage://",t}(),Sf=function(t){return s().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ef.URL_SCHEME)?(e=t.slice(Ef.URL_SCHEME.length),new Ef(e)):null;var e};nf.registerSaveRouter(Sf),nf.registerLoadRouter(Sf);var If=function(){function t(){w(s().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),w(void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return t.prototype.listModels=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i,a;return o(this,(function(o){for(t={},e=mf+vf,n=vf+gf,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(e)&&i.endsWith(n)&&(a=Cf(i),t[a]=JSON.parse(this.LS.getItem(i)));return[2,t]}))}))},t.prototype.removeModel=function(t){return r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){var o;if(t=(o=t).startsWith(Ef.URL_SCHEME)?o.slice(Ef.URL_SCHEME.length):o,e=_f(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]}))}))},t}();if(s().getBool("IS_BROWSER"))try{of.registerManager(Ef.URL_SCHEME,new If)}catch(e){}function Tf(t){return new Promise((function(t){return setTimeout(t)})).then(t)}var kf=function(){function t(e){if(!s().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return t.prototype.save=function(t){return r(this,void 0,void 0,(function(){var e,n,r,i;return o(this,(function(o){switch(o.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,r.href=n,[4,Tf((function(){return r.dispatchEvent(new MouseEvent("click"))}))];case 2:return o.sent(),null==t.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=e,[4,Tf((function(){return i.dispatchEvent(new MouseEvent("click"))}))]);case 3:o.sent(),o.label=4;case 4:return[2,{modelArtifactsInfo:ef(t)}]}}))}))},t.URL_SCHEME="downloads://",t}(),Df=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return r(this,void 0,void 0,(function(){var t,e,n=this;return o(this,(function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise((function(r,o){var i=new FileReader;i.onload=function(i){var a=JSON.parse(i.target.result),s=a.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,e)}catch(t){return void o(t)}var l=[],f=[],h=[];u.forEach((function(t){t.paths.forEach((function(t){f.push(t),h.push(null)})),l.push.apply(l,t.weights)})),u.forEach((function(t){t.paths.forEach((function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,o=f.indexOf(t);h[o]=n,-1===h.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:Zl(h),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})},e.onerror=function(e){return o("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(c[t])}))}))}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},i.onerror=function(e){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(t)}))]}))}))},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map((function(t){return tf(t.name)})),o={},i=0,a=t;i<a.length;i++)a[i].paths.forEach((function(t){var i=tf(t);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");o[t]=e[r.indexOf(i)]}));if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return o},t}();function Af(t,e,n,r){!function(t){w(null!=t&&Array.isArray(t)&&t.length>0,(function(){return"promises must be a none empty array"}))}(t),function(t,e){w(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t})),w(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e})),w(e>=t,(function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e}))}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(t.map((function(i){return i.then((function(i){var a=n+ ++o/t.length*(r-n);return e(a),i})),i})))}function Rf(t,e){return r(this,void 0,void 0,(function(){var n,r,i,a,u,c,l,f,h;return o(this,(function(o){switch(o.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?s().platform.fetch:e.fetchFunc,r=t.map((function(t){return n(t,e.requestInit,{isBinary:!0})})),i=0,a=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return u=o.sent(),[3,4];case 2:return[4,Af(r,e.onProgress,i,a)];case 3:u=o.sent(),o.label=4;case 4:return c=u.map((function(t){return t.arrayBuffer()})),l=.5,f=1,null!=e.onProgress?[3,6]:[4,Promise.all(c)];case 5:return h=o.sent(),[3,8];case 6:return[4,Af(c,e.onProgress,l,f)];case 7:h=o.sent(),o.label=8;case 8:return[2,h]}}))}))}function Nf(t){var e=this;return function(n,i,a){return void 0===i&&(i=""),r(e,void 0,void 0,(function(){var e,r,s,u,c,l,f,h,d,p;return o(this,(function(o){switch(o.label){case 0:if(e=n.map((function(){return!1})),r={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(t,n){var o=0;t.weights.forEach((function(t){var i=Xl["quantization"in t?t.quantization.dtype:t.dtype]*S(t.shape),c=function(){e[n]=!0,null==r[n]&&(r[n]=[]),r[n].push({manifestEntry:t,groupOffset:o,sizeBytes:i})};null!=a?a.forEach((function(e,n){e===t.name&&(c(),s[n]=!0)})):c(),u.push(t.name),o+=i}))})),!s.every((function(t){return t})))throw c=a.filter((function(t,e){return!s[e]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=e.reduce((function(t,e,n){return e&&t.push(n),t}),[]),f=[],l.forEach((function(t){n[t].paths.forEach((function(t){var e=i+(i.endsWith("/")?"":"/")+t;f.push(e)}))})),[4,t(f)];case 1:return h=o.sent(),d={},p=0,l.forEach((function(t){for(var e=n[t].paths.length,o=0,i=0;i<e;i++)o+=h[p+i].byteLength;for(var a=new ArrayBuffer(o),s=new Uint8Array(a),u=0,c=0;c<e;c++){var l=new Uint8Array(h[p+c]);s.set(l,u),u+=l.byteLength}r[t].forEach((function(t){var e=$l(a.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)d[n]=e[n]})),p+=e})),[2,d]}}))}))}}nf.registerSaveRouter((function(t){return s().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(kf.URL_SCHEME)?function(t){return void 0===t&&(t="model"),new kf(t)}(t.slice(kf.URL_SCHEME.length)):null}));var Ff=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(w("function"==typeof e.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=e.fetchFunc):this.fetch=s().platform.fetch,w(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&w(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."})),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((n=r.sent()).ok)return[2,{modelArtifactsInfo:ef(t),responses:[n]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}}))}))},t.prototype.load=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i,a,s,u,c,l,f,h;return o(this,(function(o){switch(o.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=o.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");o.label=2;case 2:return o.trys.push([2,4,,5]),[4,t.json()];case 3:return e=o.sent(),[3,5];case 4:throw o.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=e.weightsManifest,a=e.generatedBy,s=e.convertedBy,u=e.format,c=e.userDefinedMetadata,null==(r=e.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:h=o.sent(),l=h[0],f=h[1],o.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:f,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}}))}))},t.prototype.loadWeights=function(t){return r(this,void 0,void 0,(function(){var e,n,r,i,a,s,u,c,l,f;return o(this,(function(o){switch(o.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),r=n[0],i=n[1],a=this.weightPathPrefix||r,s=[],u=0,c=t;u<c.length;u++)s.push.apply(s,c[u].weights);return l=[],t.forEach((function(t){t.paths.forEach((function(t){l.push(a+t+i)}))})),[4,Rf(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=o.sent(),[2,[s,Zl(f)]]}}))}))},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function Of(t){return null!=t.match(Ff.URL_SCHEME_REGEX)}var Mf=function(t,e){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every((function(t){return Of(t)})):Of(t))?Pf(t,{onProgress:e}):null};function Pf(t,e){return new Ff(t,e)}nf.registerSaveRouter(Mf),nf.registerLoadRouter(Mf);var Lf,Bf=function(){function t(t){this.modelArtifacts=t}return t.prototype.load=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.modelArtifacts]}))}))},t}(),Wf=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.saveHandler(t)]}))}))},t}(),zf=Object.freeze({browserFiles:function(t){return new Df(t)},browserHTTPRequest:function(t,e){return Pf(t,e)},concatenateArrayBuffers:Zl,decodeWeights:$l,encodeWeights:function(t,e){return r(this,void 0,void 0,(function(){var n,i,a,s,u,c=this;return o(this,(function(l){switch(l.label){case 0:for(n=[],i=[],a=Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t),s=function(s){var u=a[s],l=Array.isArray(t)?t[s].tensor:t[u];if("float32"!==l.dtype&&"int32"!==l.dtype&&"bool"!==l.dtype&&"string"!==l.dtype)throw new Error("Unsupported dtype in weight '"+u+"': "+l.dtype);var f={name:u,shape:l.shape,dtype:l.dtype};if("string"===l.dtype){var h=new Promise((function(t){return r(c,void 0,void 0,(function(){var e,n,r,i,a,s,u;return o(this,(function(o){switch(o.label){case 0:return[4,l.bytes()];case 1:for(e=o.sent(),n=e.reduce((function(t,e){return t+e.length}),0)+4*e.length,r=new Uint8Array(n),i=0,a=0;a<e.length;a++)s=e[a],u=new Uint8Array(new Uint32Array([s.length]).buffer),r.set(u,i),r.set(s,i+=4),i+=s.length;return t(r),[2]}}))}))}));i.push(h)}else i.push(l.data());null!=e&&(f.group=e),n.push(f)},u=0;u<a.length;++u)s(u);return[4,Promise.all(i)];case 1:return[2,{data:Yl(l.sent()),specs:n}]}}))}))},fromMemory:function(t,e,n,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new Bf(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bf({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bf({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))},getLoadHandlers:function(t,e){return nf.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:ef,getSaveHandlers:function(t){return nf.getSaveHandlers(t)},http:Pf,isHTTPScheme:Of,loadWeights:function(t,e,n,i){return void 0===e&&(e=""),r(this,void 0,void 0,(function(){return o(this,(function(r){return[2,Nf((function(t){return Rf(t,{requestInit:i})}))(t,e,n)]}))}))},registerLoadRouter:function(t){return nf.registerLoadRouter(t)},registerSaveRouter:function(t){return nf.registerSaveRouter(t)},weightsLoaderFactory:Nf,withSaveHandler:function(t){return new Wf(t)},copyModel:function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(n){return[2,sf(t,e,!1)]}))}))},listModels:function(){return r(this,void 0,void 0,(function(){var t,e,n,r,i,a,s;return o(this,(function(o){switch(o.label){case 0:t=of.getSchemes(),e={},n=0,r=t,o.label=1;case 1:return n<r.length?[4,of.getManager(i=r[n]).listModels()]:[3,4];case 2:for(s in a=o.sent())e[i+rf+s]=a[s];o.label=3;case 3:return n++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(n){return[2,sf(t,e,!0)]}))}))},removeModel:function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){return e=af(t),[2,of.getManager(e.scheme).removeModel(e.path)]}))}))}}),Uf=en({confusionMatrix_:function(t,e,n){var r=He(t,"labels","confusionMatrix"),o=He(e,"predictions","confusionMatrix");w(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),w(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),w(1===o.rank,(function(){return"Expected the rank of predictions to be 1, but got "+o.rank})),w(r.shape[0]===o.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."})),w(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var i=Jn(r.asType("int32"),n),a=Jn(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}}),jf=Object.freeze({confusionMatrix:Uf}),Hf=en({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)i=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);a=!0}if(o&&o&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=f("FromPixels",Rt.backendName))return Rt.runKernel("FromPixels",{pixels:t},{numChannels:e});var s,u,c=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],h=c[1];if(a?s=t.getContext("2d").getImageData(0,0,l,h).data:r||n?s=t.data:(i||o)&&(null==Lf&&(Lf=document.createElement("canvas").getContext("2d")),Lf.canvas.width=l,Lf.canvas.height=h,Lf.drawImage(t,0,0,l,h),s=Lf.getImageData(0,0,l,h).data),4===e)u=new Int32Array(s);else{var d=l*h;u=new Int32Array(d*e);for(var p=0;p<d;p++)for(var v=0;v<e;++v)u[p*e+v]=s[4*p+v]}return fn(u,[h,l,e],"int32")}}),Vf=Object.freeze({toPixels:function(t,e){return r(this,void 0,void 0,(function(){var n,r,i,a,s,u,c,l,f,h,d,p,v,m,g,y,b,x,w,_,C;return o(this,(function(o){switch(o.label){case 0:if(n=He(t,"img","toPixels"),t instanceof pt||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],a=r[1],(s=2===n.rank?1:n.shape[2])>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,n.data()];case 1:return u=o.sent(),c=n.min(),l=n.max(),[4,Promise.all([c.data(),l.data()])];case 2:if(f=o.sent(),h=f[0][0],d=f[1][0],c.dispose(),l.dispose(),"float32"===n.dtype){if(h<0||d>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+d+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||d>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+d+"].")}for(p="float32"===n.dtype?255:1,v=new Uint8ClampedArray(a*i*4),m=0;m<i*a;++m)g=void 0,y=void 0,b=void 0,x=void 0,1===s?(g=u[m]*p,y=u[m]*p,b=u[m]*p,x=255):3===s?(g=u[3*m]*p,y=u[3*m+1]*p,b=u[3*m+2]*p,x=255):4===s&&(g=u[4*m]*p,y=u[4*m+1]*p,b=u[4*m+2]*p,x=u[4*m+3]*p),v[0+(w=4*m)]=Math.round(g),v[w+1]=Math.round(y),v[w+2]=Math.round(b),v[w+3]=Math.round(x);return null!=e&&(e.width=a,e.height=i,_=e.getContext("2d"),C=new ImageData(v,a,i),_.putImageData(C,0,0)),n!==t&&n.dispose(),[2,v]}}))}))},fromPixels:Hf}),qf=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),Gf=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function Kf(t){w(null!=t.className,(function(){return"Class being registered does not have the static className property defined."})),w("string"==typeof t.className,(function(){return"className is required to be a string, but got type "+typeof t.className})),w(t.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Gf.register(t)}var Xf=Object.freeze({Serializable:qf,SerializationMap:Gf,registerClass:Kf});function $f(){return 32===Rt.backend.floatPrecision()?.001:.1}function Yf(t,e,n){var r=!0;if((z(t)||z(e))&&(r=!1),z(t)&&z(e)&&(r=!0),r){var o=t.constructor.name,i=e.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(t)&&Array.isArray(e)){var a=Ue(t),s=Ue(e);if(!I(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=z(t)?t:E(t),c=z(e)?e:E(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var f=u[l],h=c[l];if(!n(f,h))throw new Error("Arrays differ: actual["+l+"] = "+f+", expected["+l+"] = "+h+".\nActual:   "+u+".\nExpected: "+c+".")}}function Qf(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}var Jf=Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=$f()),Yf(t,e,(function(t,e){return Qf(t,e,n)}))},testEpsilon:$f,expectPromiseToFail:function(t,e){t().then((function(){return e.fail()}),(function(){return e()}))},expectArraysEqual:function(t,e){var n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return H(t)||H(t[0])||H(e)||H(e[0])?Yf(t,n,(function(t,e){return t==e})):Yf(t,e,(function(t,e){return Qf(t,e,0)}))},expectNumbersClose:function(t,e,n){if(null==n&&(n=$f()),!Qf(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){for(var r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error("Value out of range:"+t[r]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),Zf=Object.freeze({gpgpu_util:Ki,webgl_util:Oe,forceHalfFloat:function(){s().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Qa,setWebGLContext:Wt,GPGPUContext:Xi}),th=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),o=r.value,i=r.grads;if(null!=n){var a=n.map((function(t){return{name:t.name,tensor:i[t.name]}}));this.applyGradients(a)}else this.applyGradients(i);return Be(i),e?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return Pr(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&Be(this.iterations_)},e.prototype.saveIterations=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:un(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=n.sent()[0],[2,t.slice(1)]}}))}))},e}(qf);Object.defineProperty(th,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var eh=function(t){function e(e,n,r){void 0===r&&(r=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=Rt.backend.epsilon()),o}return n(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Rt.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Le((function(){return _n(o).variable(!1)}))}),null==e.accumulatedUpdates[r]&&(e.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Le((function(){return _n(o).variable(!1)}))});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedGrads[r].variable,s=e.accumulatedUpdates[r].variable;Le((function(){var t=a.mul(e.rho).add(i.square().mul(1-e.rho)),n=s.add(e.epsilon).sqrt().div(a.add(e.epsilon).sqrt()).mul(i),r=s.mul(e.rho).add(n.square().mul(1-e.rho));a.assign(t),s.assign(r);var u=n.mul(-e.learningRate).add(o);o.assign(u)}))}})),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Be(this.accumulatedGrads.map((function(t){return t.variable}))),Be(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.slice(0,e=t.length/2).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(e,2*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="Adadelta",e}(th);Kf(eh);var nh=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return n(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Rt.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Le((function(){return yn(o.shape,e.initialAccumulatorValue).variable(!1)}))});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedGrads[r].variable;Le((function(){var t=a.add(i.square());a.assign(t);var n=i.div(t.add(Rt.backend.epsilon()).sqrt()).mul(-e.learningRate).add(o);o.assign(n)}))}})),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&Be(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(th);Kf(nh);var rh=function(t){function e(e,n,r,o){void 0===o&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=r,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Le((function(){i.accBeta1=un(n).variable(),i.accBeta2=un(r).variable()})),null==o&&(i.epsilon=Rt.backend.epsilon()),i}return n(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t);Le((function(){var r=bu(1,e.accBeta1),o=bu(1,e.accBeta2);n.forEach((function(n,i){var a=Rt.registeredVariables[n];null==e.accumulatedFirstMoment[i]&&(e.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Le((function(){return _n(a).variable(!1)}))}),null==e.accumulatedSecondMoment[i]&&(e.accumulatedSecondMoment[i]={originalName:n+"/v",variable:Le((function(){return _n(a).variable(!1)}))});var s=Array.isArray(t)?t[i].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[i].variable,c=e.accumulatedSecondMoment[i].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),f=c.mul(e.beta2).add(s.square().mul(1-e.beta2)),h=l.div(r),d=f.div(o);u.assign(l),c.assign(f);var p=h.div(d.sqrt().add(e.epsilon)).mul(-e.learningRate).add(a);a.assign(p)}})),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Be(this.accumulatedFirstMoment.map((function(t){return t.variable}))),null!=this.accumulatedSecondMoment&&Be(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return r(this,void 0,void 0,(function(){var e,n=this;return o(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),Le((function(){n.accBeta1.assign(vu(n.beta1,n.iterations_+1)),n.accBeta2.assign(vu(n.beta2,n.iterations_+1))})),this.accumulatedFirstMoment=t.slice(0,e=t.length/2).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(e,2*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="Adam",e}(th);Kf(rh);var oh=function(t){function e(e,n,r,o,i){void 0===o&&(o=null),void 0===i&&(i=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=o,a.decay=i,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],Le((function(){a.iteration=un(0).variable(),a.accBeta1=un(n).variable()})),null==o&&(a.epsilon=Rt.backend.epsilon()),a}return n(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t);Le((function(){var r=bu(1,e.accBeta1),o=ru(-e.learningRate,e.iteration.mul(e.decay).add(1));n.forEach((function(n,i){var a=Rt.registeredVariables[n];null==e.accumulatedFirstMoment[i]&&(e.accumulatedFirstMoment[i]={originalName:n+"/m",variable:_n(a).variable(!1)}),null==e.accumulatedWeightedInfNorm[i]&&(e.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:_n(a).variable(!1)});var s=Array.isArray(t)?t[i].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[i].variable,c=e.accumulatedWeightedInfNorm[i].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),f=c.mul(e.beta2),h=s.abs(),d=f.maximum(h);u.assign(l),c.assign(d);var p=o.div(r).mul(l.div(d.add(e.epsilon))).add(a);a.assign(p)}})),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Be(this.accumulatedFirstMoment.map((function(t){return t.variable}))),null!=this.accumulatedWeightedInfNorm&&Be(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(t){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="Adamax",e}(th);Kf(oh);var ih=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return n(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var i=Rt.registeredVariables[n];Le((function(){var t=e.c.mul(o).add(i);i.assign(t)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=We(un(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(th);Kf(ih);var ah=function(t){function e(e,n,r){void 0===r&&(r=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=un(o.momentum),o}return n(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Rt.registeredVariables[n];null==e.accumulations[r]&&(e.accumulations[r]={originalName:n+"/momentum",variable:Le((function(){return _n(o).variable(!1)}))});var i=e.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[n];null!=a&&Le((function(){var t,n=e.m.mul(i).add(a);t=e.useNesterov?e.c.mul(a.add(n.mul(e.m))).add(o):e.c.mul(n).add(o),i.assign(n),o.assign(t)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Be(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="Momentum",e}(ih);Kf(ah);var sh=function(t){function e(e,n,r,o,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1);var a=t.call(this)||this;if(a.learningRate=e,a.decay=n,a.momentum=r,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=i,null==o&&(a.epsilon=Rt.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return n(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Rt.registeredVariables[n];null==e.accumulatedMeanSquares[r]&&(e.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Le((function(){return _n(o).variable(!1)}))}),null==e.accumulatedMoments[r]&&(e.accumulatedMoments[r]={originalName:n+"/momentum",variable:Le((function(){return _n(o).variable(!1)}))}),null==e.accumulatedMeanGrads[r]&&e.centered&&(e.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Le((function(){return _n(o).variable(!1)}))});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedMeanSquares[r].variable,s=e.accumulatedMoments[r].variable;Le((function(){var t=a.mul(e.decay).add(i.square().mul(1-e.decay));if(e.centered){var n=e.accumulatedMeanGrads[r].variable,u=n.mul(e.decay).add(i.mul(1-e.decay)),c=s.mul(e.momentum).add(i.mul(e.learningRate).div(t.sub(u.square().add(e.epsilon)).sqrt()));a.assign(t),n.assign(u),s.assign(c);var l=o.sub(c);o.assign(l)}else{var f=a.mul(e.decay).add(i.square().mul(1-e.decay));c=s.mul(e.momentum).add(i.mul(e.learningRate).div(f.add(e.epsilon).sqrt())),a.assign(f),s.assign(c),l=o.sub(c),o.assign(l)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Be(this.accumulatedMeanSquares.map((function(t){return t.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Be(this.accumulatedMeanGrads.map((function(t){return t.variable}))),null!=this.accumulatedMoments&&Be(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedMeanSquares=t.slice(0,e=this.centered?t.length/3:t.length/2).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(e,2*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSProp",e}(th);Kf(sh);var uh=function(){function t(){}return t.sgd=function(t){return new ih(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new ah(t,e,n)},t.rmsprop=function(t,e,n,r,o){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new sh(t,e,n,r,o)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new rh(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new eh(t,e,n)},t.adamax=function(t,e,n,r,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new oh(t,e,n,r,o)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new nh(t,e)},t}(),ch="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(t){return t()};ht=Bl;var lh=Object.freeze({__proto__:null,AdadeltaOptimizer:eh,AdagradOptimizer:nh,AdamOptimizer:rh,AdamaxOptimizer:oh,DataStorage:Ur,get ENV(){return u},Environment:i,KernelBackend:jr,MomentumOptimizer:ah,Optimizer:th,RMSPropOptimizer:sh,get Rank(){return vt},get Reduction(){return el},SGDOptimizer:ih,Tensor:pt,TensorBuffer:lt,Variable:xt,abs:Za,acos:ts,acosh:es,add:Zs,addN:tu,addStrict:eu,all:bc,any:xc,argMax:wc,argMin:_c,asin:ns,asinh:rs,atan:os,atan2:nu,atanh:is,avgPool:cc,avgPool3d:hc,backend:function(){return Rt.backend},backend_util:uo,basicLSTMCell:Wc,batchNorm:Hs,batchNorm2d:Vs,batchNorm3d:qs,batchNorm4d:Gs,batchNormalization:js,batchNormalization2d:Ws,batchNormalization3d:zs,batchNormalization4d:Us,batchToSpaceND:Hn,booleanMaskAsync:Lu,broadcastTo:Vn,browser:Vf,buffer:Un,cast:qn,ceil:as,clipByValue:ss,clone:Gn,complex:nn,concat:Cn,concat1d:En,concat2d:Sn,concat3d:In,concat4d:Tn,conv1d:Uu,conv2d:ju,conv2dTranspose:Yu,conv3d:Hu,conv3dTranspose:Qu,cos:us,cosh:cs,cumsum:Kn,customGrad:Lr,deprecationWarn:Pe,depthToSpace:Xn,depthwiseConv2d:Gu,diag:Jc,disableDeprecationWarnings:function(){s().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},dispose:Be,disposeVariables:function(){Rt.disposeVariables()},div:ru,divNoNan:ou,divStrict:iu,dot:Zu,dropout:Zc,elu:Ac,enableDebugMode:function(){s().set("DEBUG",!0)},enableProdMode:function(){s().set("PROD",!0)},engine:function(){return Rt},env:s,equal:wu,equalStrict:_u,erf:ls,exp:fs,expandDims:$n,expm1:hs,eye:Yn,fft:qc,fill:yn,findBackend:function(t){return Rt.findBackend(t)},findBackendFactory:function(t){return Rt.findBackendFactory(t)},floor:ds,floorDiv:au,frame:ol,fused:Ll,gather:Mu,gatherND:Qc,gather_util:_r,getBackend:function(){return Rt.backendName},getGradient:h,getKernel:f,getKernelsForBackend:d,grad:function(t){return w(K(t),(function(){return"The f passed in grad(f) must be a function"})),function(e,n){var r=He(e,"x","tf.grad",null),o=null!=n?He(n,"dy","tf.grad"):null;return Rt.tidy((function(){var e=Rt.gradients((function(){return t(r)}),[r],o),n=e.grads;return null!=o&&_(e.value.shape,o.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Br(n),n[0]}))}},grads:function(t){return w(K(t),(function(){return"The f passed in grads(f) must be a function"})),function(e,n){w(Array.isArray(e),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=Ve(e,"args","tf.grads",null),o=null!=n?He(n,"dy","tf.grads"):null;return Rt.tidy((function(){var e=Rt.gradients((function(){return t.apply(void 0,r)}),r,o),n=e.grads;return null!=o&&_(e.value.shape,o.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Br(n),n}))}},greater:Cu,greaterEqual:Eu,greaterEqualStrict:Su,greaterStrict:Iu,hammingWindow:rl,hannWindow:nl,ifft:Gc,imag:on,image:Dl,inTopKAsync:sl,io:zf,irfft:Xc,isFinite:Ss,isInf:Es,isNaN:Cs,keep:We,leakyRelu:Rc,less:Tu,lessEqual:ku,lessEqualStrict:Du,lessStrict:Au,linalg:_l,linspace:bn,localResponseNormalization:Lc,log:ps,log1p:vs,logSigmoid:ms,logSoftmax:zr,logSumExp:Cc,logicalAnd:Ks,logicalNot:Xs,logicalOr:$s,logicalXor:Ys,losses:gl,matMul:Ju,math:jf,max:Ec,maxPool:uc,maxPool3d:fc,maximum:su,maximumStrict:uu,mean:Sc,memory:function(){return Rt.memory()},min:Ic,minimum:cu,minimumStrict:lu,mod:fu,modStrict:hu,moments:Tc,movingAverage:Uc,mul:du,mulStrict:pu,multiRNNCell:zc,multinomial:Qn,neg:gs,nextFrame:function(){return new Promise((function(t){return ch((function(){return t()}))}))},norm:Bc,notEqual:Ru,notEqualStrict:Nu,oneHot:Jn,ones:mn,onesLike:wn,op:en,outerProduct:tc,pad:Zn,pad1d:tr,pad2d:er,pad3d:nr,pad4d:rr,pool:lc,pow:vu,powStrict:mu,prelu:Nc,print:jn,prod:Dc,profile:function(t){return Rt.profile(t)},rand:or,randomGamma:ar,randomNormal:ir,randomUniform:sr,range:xn,ready:function(){return Rt.ready()},real:rn,reciprocal:ys,registerBackend:function(t,e,n){return void 0===n&&(n=1),Rt.registerBackend(t,e,n)},registerGradient:v,registerKernel:p,relu:Fc,relu6:Oc,removeBackend:function(t){Rt.removeBackend(t)},reshape:ur,reverse:ec,reverse1d:nc,reverse2d:rc,reverse3d:oc,reverse4d:ic,rfft:Kc,round:bs,rsqrt:xs,scalar:un,scatterND:Vc,scatter_util:Tr,selu:Mc,separableConv2d:$u,serialization:Xf,setBackend:function(t){return Rt.setBackend(t)},setPlatform:function(t,e){s().setPlatform(t,e)},setdiff1dAsync:vr,sigmoid:ws,sign:_s,signal:al,sin:Is,sinh:Ts,slice:dc,slice1d:pc,slice2d:vc,slice3d:mc,slice4d:gc,slice_util:Mr,softmax:Wr,softplus:ks,spaceToBatchND:cr,sparseToDense:Yc,spectral:$c,split:kn,sqrt:Ds,square:Ja,squaredDifference:gu,squaredDifferenceStrict:yu,squeeze:lr,stack:fr,step:As,stft:il,stridedSlice:jc,sub:bu,subStrict:xu,sum:kc,sumOutType:Ct,tan:Rs,tanh:Ns,tensor:an,tensor1d:cn,tensor2d:ln,tensor3d:fn,tensor4d:hn,tensor5d:dn,tensor6d:pn,tensor_util:kt,test_util:Jf,tidy:Le,tile:hr,time:function(t){return Rt.time(t)},topk:Hc,train:{sgd:uh.sgd,momentum:uh.momentum,adadelta:uh.adadelta,adagrad:uh.adagrad,rmsprop:uh.rmsprop,adamax:uh.adamax,adam:uh.adam},transpose:Pc,truncatedNormal:dr,unregisterGradient:function(t){if(!l.has(t))throw new Error("The gradient '"+t+"' for backend is not registered");l.delete(t)},unregisterKernel:function(t,e){var n=m(t,e);if(!c.has(n))throw new Error("The kernel '"+t+"' for backend '"+e+"' is not registered");c.delete(n)},unsortedSegmentSum:Pu,unstack:pr,util:ot,valueAndGrad:function(t){return w(K(t),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(e,n){w(e instanceof pt,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),w(null==n||n instanceof pt,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Rt.gradients((function(){return t(e)}),[e],n),o=r.grads,i=r.value;return Br(o),{grad:o[0],value:i}}},valueAndGrads:function(t){return w(K(t),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(e,n){w(Array.isArray(e)&&e.every((function(t){return t instanceof pt})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),w(null==n||n instanceof pt,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Rt.gradients((function(){return t.apply(void 0,e)}),e,n);return null!=n&&_(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Br(r.grads),r}},variable:vn,variableGrads:Pr,version_core:"1.5.2",webgl:Zf,where:Qs,whereAsync:Js,zeros:gn,zerosLike:_n});function fh(t,e,n){if(void 0===n&&(n=!1),t.beginPath(),e.slice(1).forEach((function(n,r){var o=n.x,i=n.y,a=e[r];t.moveTo(a.x,a.y),t.lineTo(o,i)})),n){var r=e[e.length-1],o=e[0];if(!r||!o)return;t.moveTo(r.x,r.y),t.lineTo(o.x,o.y)}t.stroke()}var hh=function(t,e){return(hh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function dh(t,e){function n(){this.constructor=t}hh(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var ph=function(){return(ph=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function vh(t,e,r,o){return new(r||(r=Promise))((function(i,a){function s(t){try{c(o.next(t))}catch(n){a(n)}}function u(t){try{c(o.throw(t))}catch(n){a(n)}}function c(t){t.done?i(t.value):new r((function(e){e(t.value)})).then(s,u)}c((o=o.apply(t,e||[])).next())}))}function mh(t,e){var r,o,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(n){a=[6,n],o=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function gh(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var yh=function(){function t(t,e){if(!Ah(t)||!Ah(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function bh(t,e){return t instanceof pt&&t.shape.length===e}function xh(t){return bh(t,2)}function wh(t){return bh(t,3)}function _h(t){return bh(t,4)}function Ch(t){return t%1!=0}function Eh(t){return t%2==0}function Sh(t,e){void 0===e&&(e=2);var n=Math.pow(10,e);return Math.floor(t*n)/n}function Ih(t){return t&&t.width&&t.height}function Th(t,e){var n=t.width,r=t.height,o=e/Math.max(r,n);return new yh(Math.round(n*o),Math.round(r*o))}function kh(t){return t.reduce((function(t,e){return t.add(e)}),new Fh(0,0)).div(new Fh(t.length,t.length))}function Dh(t,e,n){return Array(t).fill(0).map((function(t,r){return e+r*n}))}function Ah(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function Rh(t){return Ah(t)&&0<=t&&t<=1}var Nh=Object.freeze({__proto__:null,isTensor:bh,isTensor1D:function(t){return bh(t,1)},isTensor2D:xh,isTensor3D:wh,isTensor4D:_h,isFloat:Ch,isEven:Eh,round:Sh,isDimensions:Ih,computeReshapedDimensions:Th,getCenterPoint:kh,range:Dh,isValidNumber:Ah,isValidProbablitiy:Rh}),Fh=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),Oh=function(){function t(e,n){void 0===n&&(n=!0);var r=e||{},o=[r.left,r.top,r.right,r.bottom].every(Ah),i=[r.x,r.y,r.width,r.height].every(Ah);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];t.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return t.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(Ah)},t.assertIsValidBox=function(e,n,r){if(void 0===r&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new Fh(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new Fh(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new Fh(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new Fh(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map((function(t){return Math.round(t)}));return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map((function(t){return Math.floor(t)}));return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.toSquare=function(){var e=this.x,n=this.y,r=this.width,o=this.height,i=Math.abs(r-o);return r<o&&(e-=i/2,r+=i),o<r&&(n-=i/2,o+=i),new t({x:e,y:n,width:r,height:o})},t.prototype.rescale=function(e){var n=Ih(e)?e.width:e,r=Ih(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(e,n){var r=this.y,o=this.right,i=this.bottom,a=Math.max(this.x,0),s=Math.max(r,0),u=i-s;return new t({x:a,y:s,width:Math.min(o-a,e-a),height:Math.min(u,n-s)}).floor()},t.prototype.shift=function(e,n){return new t({x:this.x+e,y:this.y+n,width:this.width,height:this.height})},t.prototype.padAtBorders=function(t,e){var n=this.width+1,r=this.height+1,o=n,i=r,a=this.left,s=this.top,u=this.right,c=this.bottom;return u>e&&(o=-u+e+n,u=e),c>t&&(i=-c+t+r,c=t),a<1&&(i=2-a,a=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:o,y:s,ey:c,x:a,ex:u,w:n,h:r}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),Mh=function(t){function e(e,n,r,o,i){return void 0===i&&(i=!1),t.call(this,{left:e,top:n,right:r,bottom:o},i)||this}return dh(e,t),e}(Oh),Ph=function(){function t(t,e,n,r,o){this._imageDims=new yh(o.width,o.height),this._score=t,this._classScore=e,this._className=n,this._box=new Oh(r).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new Oh(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),Lh=function(t){function e(e,n,r){return t.call(this,e,e,"",n,r)||this}return dh(e,t),e.prototype.forSize=function(n,r){var o=t.prototype.forSize.call(this,n,r);return new e(o.score,o.relativeBox,o.imageDims)},e}(Ph);function Bh(t,e,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return n?r/(t.area+e.area-r):r/Math.min(t.area,e.area)}function Wh(t){var e=t.map((function(t){return t.x})),n=t.map((function(t){return t.y})),r=e.reduce((function(t,e){return e<t?e:t}),1/0),o=n.reduce((function(t,e){return e<t?e:t}),1/0),i=e.reduce((function(t,e){return t<e?e:t}),0),a=n.reduce((function(t,e){return t<e?e:t}),0);return new Mh(r,o,i,a)}function zh(t,e,n,r){void 0===r&&(r=!0);for(var o=e.map((function(t,e){return{score:t,boxIndex:e}})).sort((function(t,e){return t.score-e.score})).map((function(t){return t.boxIndex})),i=[],a=function(){var e=o.pop();i.push(e);for(var a=o,s=[],u=0;u<a.length;u++)s.push(Bh(t[e],t[a[u]],r));o=o.filter((function(t,e){return s[e]<=n}))};o.length>0;)a();return i}function Uh(t,e){return Le((function(){var n=e[0],r=e[1],o=e[2],i=yn(gh(t.shape.slice(0,3),[1]),n),a=yn(gh(t.shape.slice(0,3),[1]),r),s=yn(gh(t.shape.slice(0,3),[1]),o),u=Cn([i,a,s],3);return bu(t,u)}))}function jh(t,e){return void 0===e&&(e=!1),Le((function(){var n=t.shape.slice(1),r=n[0],o=n[1];if(r===o)return t;var i=Math.abs(r-o),a=Math.round(i*(e?.5:1)),s=r>o?2:1,u=function(e){var n=t.shape.slice();return n[s]=e,yn(n,0)},c=u(a),l=i-c.shape[s],f=[e&&l?u(l):null,t,c].filter((function(t){return!!t})).map((function(t){return t.toFloat()}));return Cn(f,s)}))}function Hh(t){return 1/(1+Math.exp(-t))}var Vh,qh=function(t){function e(e,n,r,o,i){return void 0===i&&(i=!1),t.call(this,{x:e,y:n,width:r,height:o},i)||this}return dh(e,t),e}(Oh),Gh=function(){function t(t,e,n){void 0===n&&(n=new Fh(0,0));var r=e.width,o=e.height;this._imgDims=new yh(r,o),this._shift=n,this._positions=t.map((function(t){return t.mul(new Fh(r,o)).add(n)}))}return Object.defineProperty(t.prototype,"shift",{get:function(){return new Fh(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map((function(e){return e.sub(t._shift).div(new Fh(t.imageWidth,t.imageHeight))}))},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new Fh(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var n=t instanceof Lh?t.box.floor():new Oh(t);return this.shiftBy(n.x,n.y).align(null,e)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),o=r.minBoxPadding;return r.useDlibAlignment?this.alignDlib():this.alignMinBbox(o)},t.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[1],n=t[2],r=function(t){return n.sub(t).magnitude()},o=(r(t[0])+r(e))/2,i=Math.floor(o/.45),a=kh(t),s=Math.floor(Math.max(0,a.x-.5*i)),u=Math.floor(Math.max(0,a.y-.43*i));return new qh(s,u,Math.min(i,this.imageWidth+s),Math.min(i,this.imageHeight+u))},t.prototype.alignMinBbox=function(t){var e=Wh(this.positions);return e.pad(e.width*t,e.height*t)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),Kh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],kh([t[3],t[4]])]},e}(Gh),Xh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(kh)},e}(Gh),$h=function(){function t(t,e){this._label=t,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){return void 0===t&&(t=!0),this.label+(t?" ("+Sh(this.distance)+")":"")},t}(),Yh=function(t){function e(e,n){var r=t.call(this,e)||this;return r._label=n,r}return dh(e,t),e.assertIsValidLabeledBox=function(t,e){if(Oh.assertIsValidBox(t,e),!Ah(t.label))throw new Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(Oh),Qh=function(){function t(t,e){if("string"!=typeof t)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some((function(t){return!(t instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map((function(t){return Array.from(t)}))}},t.fromJSON=function(e){var n=e.descriptors.map((function(t){return new Float32Array(t)}));return new t(e.label,n)},t}(),Jh=function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i._score=r,i._classScore=o,i}return dh(e,t),e.assertIsValidPredictedBox=function(t,e){if(Yh.assertIsValidLabeledBox(t,e),!Rh(t.score)||!Rh(t.classScore))throw new Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e}(Yh);function Zh(t){return t.detection instanceof Lh}function td(t,e){return Object.assign({},t,{detection:e})}function ed(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function nd(t){var e="";if(!t)try{t=require("fs")}catch(n){e=n.toString()}return{readFile:t?function(e){return new Promise((function(n,r){t.readFile(e,(function(t,e){return t?r(t):n(e)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}function rd(){var t=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,n=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},r=nd();return ph({Canvas:t||function(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){},Image:e||function(){},ImageData:global.ImageData||function(){},Video:global.HTMLVideoElement||function(){},createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:n},r)}function od(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function id(){return"object"==typeof global&&"function"==typeof require&&"undefined"!=typeof module&&"undefined"!=typeof process&&!!process.version}function ad(t){Vh=t}function sd(){od()&&ad(ed()),id()&&ad(rd())}var ud,cd={getEnv:function(){if(!Vh)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Vh},setEnv:ad,initialize:sd,createBrowserEnv:ed,createFileSystem:nd,createNodejsEnv:rd,monkeyPatch:function(t){if(Vh||sd(),!Vh)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=void 0===e?Vh.Canvas:e,r=t.Image,o=void 0===r?Vh.Image:r;Vh.Canvas=n,Vh.Image=o,Vh.createCanvasElement=t.createCanvasElement||function(){return new n},Vh.createImageElement=t.createImageElement||function(){return new o},Vh.ImageData=t.ImageData||Vh.ImageData,Vh.Video=t.Video||Vh.Video,Vh.fetch=t.fetch||Vh.fetch,Vh.readFile=t.readFile||Vh.readFile},isBrowser:od,isNodejs:id};function ld(t){return cd.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function fd(t){var e=cd.getEnv(),n=e.Canvas;if(t instanceof e.CanvasRenderingContext2D)return t;var r=ld(t);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}sd(),function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"}(ud||(ud={}));var hd=function(t){void 0===t&&(t={});var e=t.backgroundColor,n=t.fontColor,r=t.fontSize,o=t.fontStyle,i=t.padding;this.anchorPosition=t.anchorPosition||ud.TOP_LEFT,this.backgroundColor=e||"rgba(0, 0, 0, 0.5)",this.fontColor=n||"rgba(255, 255, 255, 1)",this.fontSize=r||14,this.fontStyle=o||"Georgia",this.padding=i||4},dd=function(){function t(e,n,r){void 0===r&&(r={}),this.text="string"==typeof e?[e]:e instanceof t?e.text:e,this.anchor=n,this.options=new hd(r)}return t.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map((function(e){return t.measureText(e).width})).reduce((function(t,e){return t<e?e:t}),0)+2*e},t.prototype.measureHeight=function(){var t=this.options;return this.text.length*t.fontSize+2*t.padding},t.prototype.getUpperLeft=function(t,e){var n=this.options.anchorPosition,r=n===ud.BOTTOM_RIGHT||n===ud.TOP_RIGHT,o=n===ud.BOTTOM_LEFT||n===ud.BOTTOM_RIGHT,i=this.measureWidth(t),a=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,u=o?this.anchor.y-a:this.anchor.y;if(e){var c=e.height;return{x:Math.max(Math.min(s,e.width-i),0),y:Math.max(Math.min(u,c-a),0)}}return{x:s,y:u}},t.prototype.draw=function(t){var e=ld(t),n=fd(e),r=this.options,o=r.backgroundColor,i=r.fontColor,a=r.fontSize,s=r.padding;n.font=a+"px "+r.fontStyle;var u=this.measureWidth(n),c=this.measureHeight();n.fillStyle=o;var l=this.getUpperLeft(n,e);n.fillRect(l.x,l.y,u,c),n.fillStyle=i,this.text.forEach((function(t,e){n.fillText(t,s+l.x,s+l.y+(e+1)*a)}))},t}(),pd=function(t){void 0===t&&(t={});var e=t.lineWidth,n=t.label,r=t.drawLabelOptions;this.boxColor=t.boxColor||"rgba(0, 0, 255, 1)",this.lineWidth=e||2,this.label=n,this.drawLabelOptions=new hd(Object.assign({},{anchorPosition:ud.BOTTOM_LEFT,backgroundColor:this.boxColor},r))},vd=function(){function t(t,e){void 0===e&&(e={}),this.box=new Oh(t),this.options=new pd(e)}return t.prototype.draw=function(t){var e=fd(t),n=this.options,r=n.lineWidth,o=this.box,i=o.x,a=o.y,s=o.width,u=o.height;e.strokeStyle=n.boxColor,e.lineWidth=r,e.strokeRect(i,a,s,u);var c=this.options.label;c&&new dd([c],{x:i-r/2,y:a},this.options.drawLabelOptions).draw(t)},t}();function md(t){var e=cd.getEnv();return t instanceof e.Image&&t.complete||t instanceof e.Video&&t.readyState>=3}function gd(t){return new Promise((function(e,n){if(t instanceof cd.getEnv().Canvas||md(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),e(t))}function o(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),n(t))}t.addEventListener("load",r),t.addEventListener("error",o)}))}function yd(t){return new Promise((function(e,n){if(!(t instanceof Blob))return n("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if("string"!=typeof r.result)return n("bufferToImage - expected reader.result to be a string, in onload");var t=cd.getEnv().createImageElement();t.onload=function(){return e(t)},t.onerror=n,t.src=r.result},r.onerror=n,r.readAsDataURL(t)}))}function bd(t){var e=cd.getEnv(),n=e.Video;return t instanceof e.Image?new yh(t.naturalWidth,t.naturalHeight):t instanceof n?new yh(t.videoWidth,t.videoHeight):new yh(t.width,t.height)}function xd(t){var e=t.width,n=t.height,r=(0,cd.getEnv().createCanvasElement)();return r.width=e,r.height=n,r}function wd(t,e){var n=cd.getEnv().ImageData;if(!(t instanceof n||md(t)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||bd(t),o=r.width,i=r.height,a=xd({width:o,height:i});return t instanceof n?fd(a).putImageData(t,0,0):fd(a).drawImage(t,0,0,o,i),a}function _d(t,e){return vh(this,void 0,void 0,(function(){var n,r,o,i,a,s;return mh(this,(function(u){switch(u.label){case 0:return n=e||cd.getEnv().createCanvasElement(),r=t.shape.slice(_h(t)?1:0),o=r[0],i=r[1],a=r[2],s=Le((function(){return t.as3D(o,i,a).toInt()})),[4,Vf.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}}))}))}function Cd(t){var e=cd.getEnv();return t instanceof e.Image||t instanceof e.Canvas||t instanceof e.Video}function Ed(t,e,n){void 0===n&&(n=!1);var r=cd.getEnv(),o=r.Canvas;if(!(t instanceof r.Image||t instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=bd(t),a=e/Math.max(i.height,i.width),s=a*i.width,u=a*i.height,c=xd({width:e,height:e}),l=t instanceof o?t:wd(t),f=Math.abs(s-u)/2,h=n&&s<u?f:0,d=n&&u<s?f:0;return fd(c).drawImage(l,h,d,s,u),c}var Sd=function(){function t(t,e){var n=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach((function(t,e){if(wh(t))return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape);if(_h(t)){var r=t.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape.slice(1))}var o=t instanceof cd.getEnv().Canvas?t:wd(t);n._canvases[e]=o,n._inputDimensions[e]=[o.height,o.width,3]}))}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return Dh(this.batchSize,0,1).map((function(e,n){return t.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return Th({width:this.getInputWidth(t),height:this.getInputHeight(t)},this.inputSize)},t.prototype.toBatchTensor=function(t,e){var n=this;return void 0===e&&(e=!0),this._inputSize=t,Le((function(){var r=Dh(n.batchSize,0,1).map((function(r){var o=n.getInput(r);if(o instanceof pt){var i=_h(o)?o:o.expandDims();return(i=jh(i,e)).shape[1]===t&&i.shape[2]===t||(i=Dl.resizeBilinear(i,[t,t])),i.as3D(t,t,3)}if(o instanceof cd.getEnv().Canvas)return Vf.fromPixels(Ed(o,t,e));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)}));return fr(r.map((function(t){return t.toFloat()}))).as4D(n.batchSize,t,t,3)}))},t}();function Id(t){return vh(this,void 0,void 0,(function(){var e,n,r;return mh(this,(function(o){switch(o.label){case 0:if(t instanceof Sd)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return n=function(e){return Array.isArray(t)?" at input index "+e+":":""},(r=e.map(ld)).forEach((function(t,r){if(!Cd(t)&&!wh(t)&&!_h(t)){if("string"==typeof e[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+e[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(_h(t)){var o=t.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(t){return Cd(t)&&gd(t)})))];case 1:return o.sent(),[2,new Sd(r,Array.isArray(t))]}}))}))}function Td(t,e){return vh(this,void 0,void 0,(function(){var n,r,o,i,a,s;return mh(this,(function(u){switch(u.label){case 0:return n=cd.getEnv().Canvas,r=t,t instanceof n?[3,5]:[4,Id(t)];case 1:if((o=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof n?(a=i,[3,4]):[3,2];case 2:return[4,_d(i)];case 3:a=u.sent(),u.label=4;case 4:r=a,u.label=5;case 5:return s=fd(r),[2,e.map((function(t){return t instanceof Lh?t.forSize(r.width,r.height).box.floor():t})).map((function(t){return t.clipAtImageBorders(r.width,r.height)})).map((function(t){var e=t.x,n=t.y,r=t.width,o=t.height,i=xd({width:r,height:o});return fd(i).putImageData(s.getImageData(e,n,r,o),0,0),i}))]}}))}))}function kd(t,e){return vh(this,void 0,void 0,(function(){return mh(this,(function(n){if(!wh(t)&&!_h(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(_h(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Le((function(){var n=t.shape.slice(_h(t)?1:0),r=n[0],o=n[1],i=n[2];return e.map((function(t){return t instanceof Lh?t.forSize(o,r).box:t})).map((function(t){return t.clipAtImageBorders(o,r)})).map((function(e){var n=e.x,a=e.y,s=e.width,u=e.height;return mc(t.as3D(r,o,i),[a,n,0],[u,s,i])}))}))]}))}))}function Dd(t,e){return vh(this,void 0,void 0,(function(){var n;return mh(this,(function(r){switch(r.label){case 0:return[4,(0,cd.getEnv().fetch)(t,e)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function Ad(t){return vh(this,void 0,void 0,(function(){return mh(this,(function(e){switch(e.label){case 0:return[4,Dd(t)];case 1:return[2,e.sent().json()]}}))}))}function Rd(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(r,"")).split("/").filter((function(t){return t})),i=t.endsWith(".json")?o[o.length-1]:n,a=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function Nd(t,e){return vh(this,void 0,void 0,(function(){var n,r,o;return mh(this,(function(i){switch(i.label){case 0:return n=Rd(t,e),r=n.modelBaseUri,[4,Ad(n.manifestUri)];case 1:return o=i.sent(),[2,zf.loadWeights(o,r)]}}))}))}var Fd=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map((function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}}))},t.prototype.getTrainableParams=function(){return this.getParamList().filter((function(t){return t.tensor instanceof xt}))},t.prototype.getFrozenParams=function(){return this.getParamList().filter((function(t){return!(t.tensor instanceof xt)}))},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach((function(e){t.reassignParamFromPath(e.path,e.tensor.variable())}))},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach((function(e){var n=e.path,r=e.tensor,o=an(r.dataSync());r.dispose(),t.reassignParamFromPath(n,o)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach((function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()})),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(t){return Array.from(t.tensor.dataSync())})).reduce((function(t,e){return t.concat(e)})))},t.prototype.load=function(t){return vh(this,void 0,void 0,(function(){return mh(this,(function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}}))}))},t.prototype.loadFromUri=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromUri - expected model uri");return[4,Nd(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}}))}))},t.prototype.loadFromDisk=function(t){return vh(this,void 0,void 0,(function(){var e,n,r,o,i,a,s,u,c;return mh(this,(function(l){switch(l.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromDisk - expected model file path");return e=cd.getEnv().readFile,n=Rd(t,this.getDefaultModelName()),r=n.manifestUri,o=n.modelBaseUri,i=zf.weightsLoaderFactory((function(t){return Promise.all(t.map((function(t){return e(t).then((function(t){return t.buffer}))})))})),u=(s=JSON).parse,[4,e(r)];case 1:return a=u.apply(s,[l.sent().toString()]),[4,i(a,o)];case 2:return c=l.sent(),this.loadFromWeightMap(c),[2]}}))}))},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.params;this._paramMappings=e.paramMappings,this._params=n},t.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.params;this._paramMappings=e.paramMappings,this._params=n},t.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce((function(e,n){if(!e.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+t);return{obj:e.nextObj,objProp:n,nextObj:e.nextObj[n]}}),{nextObj:this.params}),n=e.obj,r=e.objProp;if(!(n&&r&&n[r]instanceof pt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:r}},t}();function Od(t,e,n){return Le((function(){var r=$u(t,e.depthwise_filter,e.pointwise_filter,n,"same");return Zs(r,e.bias)}))}function Md(t,e,n){return void 0===n&&(n=!1),Le((function(){var r=Fc(n?Zs(ju(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):Od(t,e.conv0,[2,2])),o=Od(r,e.conv1,[1,1]),i=Od(Fc(Zs(r,o)),e.conv2,[1,1]);return Fc(Zs(r,Zs(o,i)))}))}function Pd(t,e,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),Le((function(){var o=Fc(n?Zs(ju(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Od(t,e.conv0,r?[2,2]:[1,1])),i=Od(o,e.conv1,[1,1]),a=Od(Fc(Zs(o,i)),e.conv2,[1,1]),s=Od(Fc(Zs(o,Zs(i,a))),e.conv3,[1,1]);return Fc(Zs(o,Zs(i,Zs(a,s))))}))}function Ld(t,e,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Le((function(){var o=Zs(ju(t,e.filters,[1,1],n),e.bias);return r?Fc(o):o}))}function Bd(t,e){Object.keys(t).forEach((function(n){e.some((function(t){return t.originalPath===n}))||t[n].dispose()}))}function Wd(t,e){return function(n,r,o,i){var a=hn(t(n*r*o*o),[o,o,n,r]),s=cn(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function zd(t,e){return function(n,r,o){var i=ln(t(n*r),[n,r]),a=cn(t(r));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var Ud=function(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n};function jd(t,e){return function(n,r,o){var i=hn(t(9*n),[3,3,n,1]),a=hn(t(n*r),[1,1,n,r]),s=cn(t(r));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new Ud(i,a,s)}}function Hd(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),o=t(e+"/bias",1);return new Ud(n,r,o)}}function Vd(t,e){return function(n,r,o){var i=t[n];if(!bh(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return e.push({originalPath:n,paramPath:o||n}),i}}function qd(t){var e=t;return{extractWeights:function(t){var n=e.slice(0,t);return e=e.slice(t),n},getRemainingWeights:function(){return e}}}function Gd(t,e){var n=Wd(t,e),r=jd(t,e);function o(t,e,o,i){return void 0===i&&(i=!1),{conv0:i?n(t,e,3,o+"/conv0"):r(t,e,o+"/conv0"),conv1:r(e,e,o+"/conv1"),conv2:r(e,e,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(t,e,n,i){void 0===i&&(i=!1);var a=o(t,e,n,i);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:r(e,e,n+"/conv3")}}}}function Kd(t){return function(e){return{filters:t(e+"/filters",4),bias:t(e+"/bias",1)}}}function Xd(t,e){var n=Vd(t,e),r=Kd(n),o=Hd(n);return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2"),conv3:o(t+"/conv3")}}}}var $d=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return dh(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceFeatureExtractor - load model before inference");return Le((function(){var n=Pd(Uh(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(un(255)),e.dense0,!0);return n=Pd(n,e.dense1),n=Pd(n,e.dense2),n=Pd(n,e.dense3),cc(n,[7,7],[2,2],"valid")}))},e.prototype.forward=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Id(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=Xd(t,e).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Bd(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=qd(t),r=n.getRemainingWeights,o=Gd(n.extractWeights,e).extractDenseBlock4Params,i=o(3,32,"dense0",!0),a=o(32,64,"dense1"),s=o(64,128,"dense2"),u=o(128,256,"dense3");if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{paramMappings:e,params:{dense0:i,dense1:a,dense2:s,dense3:u}}}(t)},e}(Fd);function Yd(t,e){return Le((function(){return Zs(Ju(t,e.weights),e.bias)}))}function Qd(t){var e={},n={};return Object.keys(t).forEach((function(r){(r.startsWith("fc")?n:e)[r]=t[r]})),{featureExtractorMap:e,classifierMap:n}}var Jd=function(t){function e(e,n){var r=t.call(this,e)||this;return r._faceFeatureExtractor=n,r}return dh(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Le((function(){var r=t instanceof Sd?e.faceFeatureExtractor.forwardInput(t):t;return Yd(r.as2D(r.shape[0],-1),n.fc)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.paramMappings;this._params=e.params,this._paramMappings=n},e.prototype.extractClassifierParams=function(t){return function(t,e,n){var r=[],o=qd(t),i=o.getRemainingWeights,a=zd(o.extractWeights,r)(e,n,"fc");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:a}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e=Qd(t),n=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(e.featureExtractorMap),function(t){var e=[],n=Vd(t,e),r={fc:{weights:n("fc/weights",2),bias:n("fc/bias",1)}};return Bd(t,e),{params:r,paramMappings:e}}(n)},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*e+n,o=t.slice(0,t.length-r),i=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(Fd),Zd=["neutral","happy","sad","angry","fearful","disgusted","surprised"],tp=function(){function t(t){var e=this;if(7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);Zd.forEach((function(n,r){e[n]=t[r]}))}return t.prototype.asSortedArray=function(){var t=this;return Zd.map((function(e){return{expression:e,probability:t[e]}})).sort((function(t,e){return e.probability-t.probability}))},t}(),ep=function(t){function e(e){return void 0===e&&(e=new $d),t.call(this,"FaceExpressionNet",e)||this}return dh(e,t),e.prototype.forwardInput=function(t){var e=this;return Le((function(){return Wr(e.runNet(t))}))},e.prototype.forward=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Id(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.predictExpressions=function(t){return vh(this,void 0,void 0,(function(){var e,n,r,o,i=this;return mh(this,(function(a){switch(a.label){case 0:return[4,Id(t)];case 1:return e=a.sent(),[4,this.forwardInput(e)];case 2:return n=a.sent(),[4,Promise.all(pr(n).map((function(t){return vh(i,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return[4,t.data()];case 1:return e=n.sent(),t.dispose(),[2,e]}}))}))})))];case 3:return r=a.sent(),n.dispose(),o=r.map((function(t){return new tp(t)})),[2,e.isBatchInput?o:o[0]]}}))}))},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(Jd);function np(t){return t.expressions instanceof tp}function rp(t,e){return Object.assign({},t,{expressions:e})}function op(t){return Zh(t)&&t.landmarks instanceof Gh&&t.unshiftedLandmarks instanceof Gh&&t.alignedRect instanceof Lh}function ip(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),o=r.align(),i=t.detection.imageDims,a=new Lh(t.detection.score,o.rescale(i.reverse()),i);return Object.assign({},t,{landmarks:r,unshiftedLandmarks:e,alignedRect:a})}var ap=function(t){void 0===t&&(t={});var e=t.drawLines,n=t.drawPoints,r=void 0===n||n,o=t.lineWidth,i=t.lineColor,a=t.pointSize,s=t.pointColor;this.drawLines=void 0===e||e,this.drawPoints=r,this.lineWidth=o||1,this.pointSize=a||2,this.lineColor=i||"rgba(0, 255, 255, 1)",this.pointColor=s||"rgba(255, 0, 255, 1)"},sp=function(){function t(t,e){void 0===e&&(e={}),this.faceLandmarks=t,this.options=new ap(e)}return t.prototype.draw=function(t){var e=fd(t),n=this.options,r=n.drawPoints,o=n.lineWidth,i=n.pointSize,a=n.pointColor;n.drawLines&&this.faceLandmarks instanceof Xh&&(e.strokeStyle=n.lineColor,e.lineWidth=o,fh(e,this.faceLandmarks.getJawOutline()),fh(e,this.faceLandmarks.getLeftEyeBrow()),fh(e,this.faceLandmarks.getRightEyeBrow()),fh(e,this.faceLandmarks.getNose()),fh(e,this.faceLandmarks.getLeftEye(),!0),fh(e,this.faceLandmarks.getRightEye(),!0),fh(e,this.faceLandmarks.getMouth(),!0)),r&&(e.strokeStyle=a,e.fillStyle=a,this.faceLandmarks.positions.forEach((function(t){e.beginPath(),e.arc(t.x,t.y,i,0,2*Math.PI),e.fill()})))},t}(),up=Object.freeze({__proto__:null,drawContour:fh,drawDetections:function(t,e){(Array.isArray(e)?e:[e]).forEach((function(e){var n=e instanceof Lh?e.score:Zh(e)?e.detection.score:void 0,r=e instanceof Lh?e.box:Zh(e)?e.detection.box:new Oh(e),o=n?""+Sh(n):void 0;new vd(r,{label:o}).draw(t)}))},drawFaceExpressions:function(t,e,n,r){void 0===n&&(n=.1),(Array.isArray(e)?e:[e]).forEach((function(e){var o=e instanceof tp?e:np(e)?e.expressions:void 0;if(!o)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=o.asSortedArray().filter((function(t){return t.probability>n})),a=Zh(e)?e.detection.box.bottomLeft:r||new Fh(0,0);new dd(i.map((function(t){return t.expression+" ("+Sh(t.probability)+")"})),a).draw(t)}))},DrawBoxOptions:pd,DrawBox:vd,DrawFaceLandmarksOptions:ap,DrawFaceLandmarks:sp,drawFaceLandmarks:function(t,e){(Array.isArray(e)?e:[e]).forEach((function(e){var n=e instanceof Gh?e:op(e)?e.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new sp(n).draw(t)}))},get AnchorPosition(){return ud},DrawTextFieldOptions:hd,DrawTextField:dd});function cp(t,e,n){return Zs(ju(t,e.filters,n,"same"),e.bias)}function lp(t,e,n){void 0===n&&(n=!0);var r=n?Fc(t):t;return r=Od(r,e.separable_conv0,[1,1]),r=Od(Fc(r),e.separable_conv1,[1,1]),r=uc(r,[3,3],[2,2],"same"),Zs(r,cp(t,e.expansion_conv,[2,2]))}var fp,hp=function(t){function e(e){var n=t.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return dh(e,t),e.prototype.forwardInput=function(t){var e=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Le((function(){var r=Uh(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(un(256)),o=Fc(cp(r,n.entry_flow.conv_in,[2,2]));return o=lp(o,n.entry_flow.reduction_block_0,!1),o=lp(o,n.entry_flow.reduction_block_1),Dh(e._numMainBlocks,0,1).forEach((function(t){o=function(t,e){var n=Od(Fc(t),e.separable_conv0,[1,1]);return n=Od(Fc(n),e.separable_conv1,[1,1]),n=Od(Fc(n),e.separable_conv2,[1,1]),Zs(n,t)}(o,n.middle_flow["main_block_"+t])})),o=lp(o,n.exit_flow.reduction_block),o=Fc(Od(o,n.exit_flow.separable_conv,[1,1]))}))},e.prototype.forward=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Id(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n=[],r=function(t,e){var n=Vd(t,e),r=Kd(n),o=Hd(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),expansion_conv:r(t+"/expansion_conv")}},extractMainBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),separable_conv2:o(t+"/separable_conv2")}}}}(t,n),o=r.extractSeparableConvParams,i=r.extractReductionBlockParams,a=r.extractMainBlockParams,s={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:i("entry_flow/reduction_block_0"),reduction_block_1:i("entry_flow/reduction_block_1")},u={};Dh(e,0,1).forEach((function(t){u["main_block_"+t]=a("middle_flow/main_block_"+t)}));var c={reduction_block:i("exit_flow/reduction_block"),separable_conv:o("exit_flow/separable_conv")};return Bd(t,n),{params:{entry_flow:s,middle_flow:u,exit_flow:c},paramMappings:n}}(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return function(t,e){var n=[],r=qd(t),o=r.getRemainingWeights,i=function(t,e){var n=Wd(t,e),r=jd(t,e);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(t,e,o){return{separable_conv0:r(t,e,o+"/separable_conv0"),separable_conv1:r(e,e,o+"/separable_conv1"),expansion_conv:n(t,e,1,o+"/expansion_conv")}},extractMainBlockParams:function(t,e){return{separable_conv0:r(t,t,e+"/separable_conv0"),separable_conv1:r(t,t,e+"/separable_conv1"),separable_conv2:r(t,t,e+"/separable_conv2")}}}}(r.extractWeights,n),a=i.extractSeparableConvParams,s=i.extractReductionBlockParams,u=i.extractMainBlockParams,c={conv_in:(0,i.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:s(32,64,"entry_flow/reduction_block_0"),reduction_block_1:s(64,128,"entry_flow/reduction_block_1")},l={};Dh(e,0,1).forEach((function(t){l["main_block_"+t]=u(128,"middle_flow/main_block_"+t)}));var f={reduction_block:s(128,256,"exit_flow/reduction_block"),separable_conv:a(256,512,"exit_flow/separable_conv")};if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{entry_flow:c,middle_flow:l,exit_flow:f}}}(t,this._numMainBlocks)},e}(Fd);(fp=t.Gender||(t.Gender={})).FEMALE="female",fp.MALE="male";var dp=function(e){function n(t){void 0===t&&(t=new hp(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return dh(n,e),Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Le((function(){var r=t instanceof Sd?e.faceFeatureExtractor.forwardInput(t):t,o=cc(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:Yd(o,n.fc.age).as1D(),gender:Yd(o,n.fc.gender)}}))},n.prototype.forwardInput=function(t){var e=this;return Le((function(){var n=e.runNet(t);return{age:n.age,gender:Wr(n.gender)}}))},n.prototype.forward=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Id(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},n.prototype.predictAgeAndGender=function(e){return vh(this,void 0,void 0,(function(){var n,r,o,i,a,s,u=this;return mh(this,(function(c){switch(c.label){case 0:return[4,Id(e)];case 1:return n=c.sent(),[4,this.forwardInput(n)];case 2:return r=c.sent(),o=pr(r.age),i=pr(r.gender),a=o.map((function(t,e){return{ageTensor:t,genderTensor:i[e]}})),[4,Promise.all(a.map((function(e){var n=e.ageTensor,r=e.genderTensor;return vh(u,void 0,void 0,(function(){var e,o,i,a,s;return mh(this,(function(u){switch(u.label){case 0:return[4,n.data()];case 1:return e=u.sent()[0],[4,r.data()];case 2:return o=u.sent()[0],a=(i=o>.5)?t.Gender.MALE:t.Gender.FEMALE,s=i?o:1-o,n.dispose(),r.dispose(),[2,{age:e,gender:a,genderProbability:s}]}}))}))})))];case 3:return s=c.sent(),r.age.dispose(),r.gender.dispose(),[2,n.isBatchInput?s:s[0]]}}))}))},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.paramMappings;this._params=e.params,this._paramMappings=n},n.prototype.extractClassifierParams=function(t){return function(t){var e=[],n=qd(t),r=n.getRemainingWeights,o=zd(n.extractWeights,e),i=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{paramMappings:e,params:{fc:{age:i,gender:a}}}}(t)},n.prototype.extractParamsFromWeigthMap=function(t){var e=Qd(t),n=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(e.featureExtractorMap),function(t){var e=[],n=Vd(t,e);function r(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Bd(t,e),{params:o,paramMappings:e}}(n)},n.prototype.extractParams=function(t){var e=t.slice(0,t.length-1539),n=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(n)},n}(Fd),pp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.postProcess=function(t,e,n){var r=n.map((function(t){var n=t.width,r=t.height,o=e/Math.max(r,n);return{width:n*o,height:r*o}})),o=r.length;return Le((function(){var n=function(t,e){return fr([yn([68],t),yn([68],e)],1).as2D(1,136).as1D()},i=function(t,e){var n=r[t],o=n.width,i=n.height;return e(o,i)?Math.abs(o-i)/2:0};return t.mul(yn([o,136],e)).sub(fr(Array.from(Array(o),(function(t,e){return n(function(t){return i(t,(function(t,e){return t<e}))}(e),function(t){return i(t,(function(t,e){return e<t}))}(e))})))).div(fr(Array.from(Array(o),(function(t,e){return n(r[e].width,r[e].height)}))))}))},e.prototype.forwardInput=function(t){var e=this;return Le((function(){var n=e.runNet(t);return e.postProcess(n,t.inputSize,t.inputDimensions.map((function(t){return{height:t[0],width:t[1]}})))}))},e.prototype.forward=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Id(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.detectLandmarks=function(t){return vh(this,void 0,void 0,(function(){var e,n,r,o=this;return mh(this,(function(i){switch(i.label){case 0:return[4,Id(t)];case 1:return e=i.sent(),n=Le((function(){return pr(o.forwardInput(e))})),[4,Promise.all(n.map((function(t,n){return vh(o,void 0,void 0,(function(){var r,o,i,a,s;return mh(this,(function(u){switch(u.label){case 0:return i=(o=Array).from,[4,t.data()];case 1:return r=i.apply(o,[u.sent()]),a=r.filter((function(t,e){return Eh(e)})),s=r.filter((function(t,e){return!Eh(e)})),[2,new Xh(Array(68).fill(0).map((function(t,e){return new Fh(a[e],s[e])})),{height:e.getInputHeight(n),width:e.getInputWidth(n)})]}}))}))})))];case 2:return r=i.sent(),n.forEach((function(t){return t.dispose()})),[2,e.isBatchInput?r:r[0]]}}))}))},e.prototype.getClassifierChannelsOut=function(){return 136},e}(Jd),vp=function(t){function e(e){return void 0===e&&(e=new $d),t.call(this,"FaceLandmark68Net",e)||this}return dh(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(pp),mp=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return dh(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Le((function(){var n=Md(Uh(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(un(255)),e.dense0,!0);return n=Md(n,e.dense1),n=Md(n,e.dense2),cc(n,[14,14],[2,2],"valid")}))},e.prototype.forward=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Id(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=Xd(t,e).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Bd(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=qd(t),r=n.getRemainingWeights,o=Gd(n.extractWeights,e).extractDenseBlock3Params,i=o(3,32,"dense0",!0),a=o(32,64,"dense1"),s=o(64,128,"dense2");if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{paramMappings:e,params:{dense0:i,dense1:a,dense2:s}}}(t)},e}(Fd),gp=function(t){function e(e){return void 0===e&&(e=new mp),t.call(this,"FaceLandmark68TinyNet",e)||this}return dh(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(pp),yp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e}(vp);function bp(t,e,n,r,o){void 0===o&&(o="same");var i=e.conv,a=i.bias,s=ju(t,i.filters,n,o);return s=function(t,e){return Zs(du(t,e.weights),e.biases)}(s=Zs(s,a),e.scale),r?Fc(s):s}function xp(t,e){return bp(t,e,[1,1],!1)}function wp(t,e){return bp(t,e,[2,2],!0,"valid")}function _p(t,e){var n=function(t,e){return bp(t,e,[1,1],!0)}(t,e.conv1);return n=xp(n,e.conv2),n=Zs(n,t),Fc(n)}function Cp(t,e){var n=wp(t,e.conv1);n=xp(n,e.conv2);var r=cc(t,2,2,"valid"),o=gn(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var a=gh(n.shape);a[1]=1;var s=gn(a),u=gh((n=Cn([n,s],1)).shape);u[2]=1;var c=gn(u);n=Cn([n,c],2)}return r=i?Cn([r,o],3):r,n=Zs(r,n),Fc(n)}var Ep=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return dh(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceRecognitionNet - load model before inference");return Le((function(){var n=wp(Uh(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(un(256)),e.conv32_down);n=_p(n=uc(n,3,2,"valid"),e.conv32_1),n=_p(n,e.conv32_2),n=_p(n,e.conv32_3),n=_p(n=Cp(n,e.conv64_down),e.conv64_1),n=_p(n,e.conv64_2),n=_p(n,e.conv64_3),n=_p(n=Cp(n,e.conv128_down),e.conv128_1),n=_p(n,e.conv128_2),n=_p(n=Cp(n,e.conv256_down),e.conv256_1);var r=(n=Cp(n=_p(n,e.conv256_2),e.conv256_down_out)).mean([1,2]);return Ju(r,e.fc)}))},e.prototype.forward=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Id(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.computeFaceDescriptor=function(t){return vh(this,void 0,void 0,(function(){var e,n,r,o=this;return mh(this,(function(i){switch(i.label){case 0:return[4,Id(t)];case 1:return e=i.sent(),n=Le((function(){return pr(o.forwardInput(e))})),[4,Promise.all(n.map((function(t){return t.data()})))];case 2:return r=i.sent(),n.forEach((function(t){return t.dispose()})),[2,e.isBatchInput?r:r[0]]}}))}))},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=function(t,e){var n=Vd(t,e);function r(t){return{conv:{filters:n(t+"/conv/filters",4),bias:n(t+"/conv/bias",1)},scale:function(t){return{weights:n(t+"/scale/weights",1),biases:n(t+"/scale/biases",1)}}(t)}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t){return{conv1:r(t+"/conv1"),conv2:r(t+"/conv2")}}}}(t,e),r=n.extractResidualLayerParams,o=(0,n.extractConvLayerParams)("conv32_down"),i=r("conv32_1"),a=r("conv32_2"),s=r("conv32_3"),u=r("conv64_down"),c=r("conv64_1"),l=r("conv64_2"),f=r("conv64_3"),h=r("conv128_down"),d=r("conv128_1"),p=r("conv128_2"),v=r("conv256_down"),m=r("conv256_1"),g=r("conv256_2"),y=r("conv256_down_out"),b=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!xh(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var x={conv32_down:o,conv32_1:i,conv32_2:a,conv32_3:s,conv64_down:u,conv64_1:c,conv64_2:l,conv64_3:f,conv128_down:h,conv128_1:d,conv128_2:p,conv256_down:v,conv256_1:m,conv256_2:g,conv256_down_out:y,fc:b};return Bd(t,e),{params:x,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=qd(t),n=e.extractWeights,r=e.getRemainingWeights,o=[],i=function(t,e){function n(n,r,o,i){var a=function(e,n,r){var o=t(e),i=o.length/(n*r*r);if(Ch(i))throw new Error("depth has to be an integer: "+i+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return Le((function(){return Pc(hn(o,[n,i,r,r]),[2,3,1,0])}))}(n,r,o),s=cn(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}function r(r,o,i,a){return{conv:n(r,o,i,a+"/conv"),scale:function(n,r){var o=cn(t(n)),i=cn(t(n));return e.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:o,biases:i}}(o,a+"/scale")}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t,e,n,o,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*t,e,n,o+"/conv1"),conv2:r(t,e,n,o+"/conv2")}}}}(n,o),a=i.extractResidualLayerParams,s=(0,i.extractConvLayerParams)(4704,32,7,"conv32_down"),u=a(9216,32,3,"conv32_1"),c=a(9216,32,3,"conv32_2"),l=a(9216,32,3,"conv32_3"),f=a(36864,64,3,"conv64_down",!0),h=a(36864,64,3,"conv64_1"),d=a(36864,64,3,"conv64_2"),p=a(36864,64,3,"conv64_3"),v=a(147456,128,3,"conv128_down",!0),m=a(147456,128,3,"conv128_1"),g=a(147456,128,3,"conv128_2"),y=a(589824,256,3,"conv256_down",!0),b=a(589824,256,3,"conv256_1"),x=a(589824,256,3,"conv256_2"),w=a(589824,256,3,"conv256_down_out"),_=Le((function(){return Pc(ln(n(32768),[128,256]),[1,0])}));if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:s,conv32_1:u,conv32_2:c,conv32_3:l,conv64_down:f,conv64_1:h,conv64_2:d,conv64_3:p,conv128_down:v,conv128_1:m,conv128_2:g,conv256_down:y,conv256_1:b,conv256_2:x,conv256_down_out:w,fc:_},paramMappings:o}}(t)},e}(Fd);function Sp(t,e){return Object.assign({},t,{descriptor:e})}function Ip(t,e){return Object.assign({},t,{age:e})}function Tp(t,e,n){return Object.assign({},t,{gender:e,genderProbability:n})}var kp=function(){function t(t){var e=void 0===t?{}:t,n=e.minFaceSize,r=e.scaleFactor,o=e.maxNumScales,i=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(t){return"number"!=typeof t})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(t){return"number"!=typeof t}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function Dp(t,e,n){return Le((function(){var r=ju(t,e.filters,n,"same");return r=Zs(r,e.batch_norm_offset),ss(r,0,6)}))}function Ap(t,e,n){var r=t.arraySync(),o=Math.min(r[e][0],r[e][2]),i=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),s=Math.max(r[e][1],r[e][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),h=(a-o)*(s-i),d=(l-u)*(f-c);if(h<=0||d<=0)return 0;var p=Math.max(o,u),v=Math.max(i,c),m=Math.min(a,l),g=Math.min(s,f),y=Math.max(m-p,0)*Math.max(g-v,0);return y/(h+d-y)}function Rp(t,e){return Le((function(){var n=t.shape[0];return{boxPredictionEncoding:ur(Ld(t,e.box_encoding_predictor),[n,-1,1,4]),classPrediction:ur(Ld(t,e.class_predictor),[n,-1,3])}}))}var Np=function(){function t(t){var e=void 0===t?{}:t,n=e.minConfidence,r=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),Fp=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return dh(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("SsdMobilenetv1 - load model before inference");return Le((function(){var n=t.toBatchTensor(512,!1).toFloat(),r=function(t,e){return Le((function(){var n=null,r=Dp(t,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach((function(t,e){var o=e+1,i=function(t){return[2,4,6,12].some((function(e){return e===t}))?[2,2]:[1,1]}(o);r=Dp(r=function(t,e,n){return Le((function(){var r=Gu(t,e.filters,n,"same");return r=Hs(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,.0010000000474974513),ss(r,0,6)}))}(r,t.depthwise_conv,i),t.pointwise_conv,[1,1]),11===o&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}(bu(du(n,un(.007843137718737125)),un(1)),e.mobilenetv1),o=function(t,e,n){return Le((function(){var r=Dp(t,n.conv_0,[1,1]),o=Dp(r,n.conv_1,[2,2]),i=Dp(o,n.conv_2,[1,1]),a=Dp(i,n.conv_3,[2,2]),s=Dp(a,n.conv_4,[1,1]),u=Dp(s,n.conv_5,[2,2]),c=Dp(u,n.conv_6,[1,1]),l=Dp(c,n.conv_7,[2,2]),f=Rp(e,n.box_predictor_0),h=Rp(t,n.box_predictor_1),d=Rp(o,n.box_predictor_2),p=Rp(a,n.box_predictor_3),v=Rp(u,n.box_predictor_4),m=Rp(l,n.box_predictor_5);return{boxPredictions:Cn([f.boxPredictionEncoding,h.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:Cn([f.classPrediction,h.classPrediction,d.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction],1)}}))}(r.out,r.conv11,e.prediction_layer);return function(t,e,n){return Le((function(){var r=t.shape[0],o=function(t,e){var n=function(t){var e=pr(Pc(t,[1,0])),n=[bu(e[2],e[0]),bu(e[3],e[1])];return{sizes:n,centers:[Zs(e[0],ru(n[0],un(2))),Zs(e[1],ru(n[1],un(2)))]}}(t),r=n.sizes,o=n.centers,i=pr(Pc(e,[1,0])),a=ru(du(fs(ru(i[2],un(5))),r[0]),un(2)),s=Zs(du(ru(i[0],un(10)),r[0]),o[0]),u=ru(du(fs(ru(i[3],un(5))),r[1]),un(2)),c=Zs(du(ru(i[1],un(10)),r[1]),o[1]);return Pc(fr([bu(s,a),bu(c,u),Zs(s,a),Zs(c,u)]),[1,0])}(ur(hr(n.extra_dim,[r,1,1]),[-1,4]),ur(t,[-1,4]));o=ur(o,[r,o.shape[0]/r,4]);var i=ws(dc(e,[0,0,1],[-1,-1,-1])),a=dc(i,[0,0,0],[-1,-1,1]);return a=ur(a,[r,a.shape[1]]),{boxes:pr(o),scores:pr(a)}}))}(o.boxPredictions,o.classPredictions,e.output_layer)}))},e.prototype.forward=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Id(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.locateFaces=function(t,e){return void 0===e&&(e={}),vh(this,void 0,void 0,(function(){var n,r,o,i,a,s,u,c,l,f,h,d,p,v,m,g,y,b,x,w;return mh(this,(function(_){switch(_.label){case 0:return n=new Np(e),r=n.maxResults,o=n.minConfidence,[4,Id(t)];case 1:for(i=_.sent(),a=this.forwardInput(i),c=(s=a.boxes)[0],l=(u=a.scores)[0],f=1;f<s.length;f++)s[f].dispose(),u[f].dispose();return p=(d=Array).from,[4,l.data()];case 2:return h=p.apply(d,[_.sent()]),v=function(t,e,n,r,o){var i=Math.min(n,t.shape[0]),a=e.map((function(t,e){return{score:t,boxIndex:e}})).filter((function(t){return t.score>o})).sort((function(t,e){return e.score-t.score})),s=function(t){return t<=.5?1:0},u=[];return a.forEach((function(e){if(!(u.length>=i)){for(var n=e.score,r=u.length-1;r>=0;--r){var a=Ap(t,e.boxIndex,u[r]);if(0!==a&&(e.score*=s(a),e.score<=o))break}n===e.score&&u.push(e.boxIndex)}})),u}(c,h,r,0,o),m=i.getReshapedInputDimensions(0),y=(g=i.inputSize)/m.width,b=g/m.height,x=c.arraySync(),w=v.map((function(t){var e=[Math.max(0,x[t][0]),Math.min(1,x[t][2])].map((function(t){return t*b})),n=e[0],r=e[1],o=[Math.max(0,x[t][1]),Math.min(1,x[t][3])].map((function(t){return t*y})),a=o[0];return new Lh(h[t],new qh(a,n,o[1]-a,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})})),c.dispose(),l.dispose(),[2,w]}}))}))},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=function(t,e){var n=Vd(t,e);function r(t,e,r){return{filters:n(t+"/Conv2d_"+e+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(t){var e="mobilenetv1/conv_"+t,o="MobilenetV1/Conv2d_"+t+"_depthwise",i=e+"/depthwise_conv",a=e+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",t,a)}}function i(t,e){return{filters:n(t+"/weights",4,e+"/filters"),bias:n(t+"/biases",1,e+"/bias")}}function a(t){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(t,e),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,i=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!wh(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return Bd(t,e),{params:a,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=qd(t),r=n.extractWeights,o=n.getRemainingWeights,i=function(t,e){function n(n,r,o,i,a){var s=hn(t(n*r*o*o),[o,o,n,r]),u=cn(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/"+(a?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(t,e,r,o){var i=n(t,e,r,o,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function o(n,o,i){return{depthwise_conv:function(n,r){var o=hn(t(9*n),[3,3,n,1]),i=cn(t(n)),a=cn(t(n)),s=cn(t(n)),u=cn(t(n));return e.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:o,batch_norm_scale:i,batch_norm_offset:a,batch_norm_mean:s,batch_norm_variance:u}}(n,i+"/depthwise_conv"),pointwise_conv:r(n,o,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,e),a=i.extractPredictionLayerParams,s=(0,i.extractMobilenetV1Params)(),u=a(),c={extra_dim:fn(r(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:s,prediction_layer:u,output_layer:c},paramMappings:e}}(t)},e}(Fd);function Op(t){var e=new Fp;return e.extractWeights(t),e}var Mp,Pp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e}(Fp),Lp=[new Fh(.738768,.874946),new Fh(2.42204,2.65704),new Fh(4.30971,7.04493),new Fh(10.246,4.59428),new Fh(12.6868,11.8741)],Bp=[new Fh(1.603231,2.094468),new Fh(6.041143,7.080126),new Fh(2.882459,3.518061),new Fh(4.266906,5.178857),new Fh(9.041765,10.66308)],Wp=[117.001,114.697,97.404],zp=function(t){return"number"==typeof t};function Up(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!zp(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every((function(t){return"string"==typeof t})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map((function(t){return t||{}})).every((function(t){return zp(t.x)&&zp(t.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(zp)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}function jp(t){return Le((function(){var e=du(t,un(.10000000149011612));return Zs(Fc(bu(t,e)),e)}))}function Hp(t,e){return Le((function(){var n=Zn(t,[[0,0],[1,1],[1,1],[0,0]]);return n=ju(n,e.conv.filters,[1,1],"valid"),n=bu(n,e.bn.sub),n=du(n,e.bn.truediv),jp(n=Zs(n,e.conv.bias))}))}function Vp(t,e){return Le((function(){var n=Zn(t,[[0,0],[1,1],[1,1],[0,0]]);return n=$u(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),jp(n=Zs(n,e.bias))}))}(Mp=t.TinyYolov2SizeType||(t.TinyYolov2SizeType={}))[Mp.XS=224]="XS",Mp[Mp.SM=320]="SM",Mp[Mp.MD=416]="MD",Mp[Mp.LG=608]="LG";var qp=function(){function t(t){var e=void 0===t?{}:t,n=e.inputSize,r=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),Gp=function(t){function e(e){var n=t.call(this,"TinyYolov2")||this;return Up(e),n._config=e,n}return dh(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var n=Hp(t,e.conv0);return n=Hp(n=uc(n,[2,2],[2,2],"same"),e.conv1),n=Hp(n=uc(n,[2,2],[2,2],"same"),e.conv2),n=Hp(n=uc(n,[2,2],[2,2],"same"),e.conv3),n=Hp(n=uc(n,[2,2],[2,2],"same"),e.conv4),n=Hp(n=uc(n,[2,2],[2,2],"same"),e.conv5),n=Hp(n=uc(n,[2,2],[1,1],"same"),e.conv6),Ld(n=Hp(n,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var n=this.config.isFirstLayerConv2d?jp(Ld(t,e.conv0,"valid",!1)):Vp(t,e.conv0);return n=Vp(n=uc(n,[2,2],[2,2],"same"),e.conv1),n=Vp(n=uc(n,[2,2],[2,2],"same"),e.conv2),n=Vp(n=uc(n,[2,2],[2,2],"same"),e.conv3),n=Vp(n=uc(n,[2,2],[2,2],"same"),e.conv4),n=Vp(n=uc(n,[2,2],[2,2],"same"),e.conv5),n=uc(n,[2,2],[1,1],"same"),n=e.conv6?Vp(n,e.conv6):n,Ld(n=e.conv7?Vp(n,e.conv7):n,e.conv8,"valid",!1)},e.prototype.forwardInput=function(t,e){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Le((function(){var o=t.toBatchTensor(e,!1).toFloat();return o=(o=n.config.meanRgb?Uh(o,n.config.meanRgb):o).div(un(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)}))},e.prototype.forward=function(t,e){return vh(this,void 0,void 0,(function(){var n;return mh(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Id(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent()]}}))}))},e.prototype.detect=function(t,e){return void 0===e&&(e={}),vh(this,void 0,void 0,(function(){var n,r,o,i,a,s,u,c,l,f,h,d,p=this;return mh(this,(function(v){switch(v.label){case 0:return n=new qp(e),r=n.inputSize,o=n.scoreThreshold,[4,Id(t)];case 1:return i=v.sent(),[4,this.forwardInput(i,r)];case 2:return a=v.sent(),s=Le((function(){return pr(a)[0].expandDims()})),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(s,i.getReshapedInputDimensions(0),o)];case 3:return c=v.sent(),a.dispose(),s.dispose(),l=c.map((function(t){return t.box})),f=c.map((function(t){return t.score})),h=c.map((function(t){return t.classScore})),d=c.map((function(t){return p.config.classes[t.label]})),[2,zh(l.map((function(t){return t.rescale(r)})),f,this.config.iouThreshold,!0).map((function(t){return new Ph(f[t],h[t],d[t],l[t],u)}))]}}))}))},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n,r=[],o=function(t,e){var n=Vd(t,e);function r(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(t){return{conv:r(t+"/conv"),bn:function(t){return{sub:n(t+"/sub",1),truediv:n(t+"/truediv",1)}}(t+"/bn")}},extractSeparableConvParams:Hd(n)}}(t,r),i=o.extractConvParams,a=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;n={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return Bd(t,r),{params:n,paramMappings:r}}(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(t,e,n,r){var o,i=qd(t),a=i.getRemainingWeights,s=[],u=function(t,e){var n=Wd(t,e),r=jd(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,o,i){return{conv:n(r,o,3,i+"/conv"),bn:function(n,r){var o=cn(t(n)),i=cn(t(n));return e.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:o,truediv:i}}(o,i+"/bn")}},extractSeparableConvParams:r}}(i.extractWeights,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,f=u.extractSeparableConvParams;if(e.withSeparableConvs){var h=r[0],d=r[1],p=r[2],v=r[3],m=r[4],g=r[5],y=r[6],b=r[7],x=r[8];o={conv0:e.isFirstLayerConv2d?c(h,d,3,"conv0"):f(h,d,"conv0"),conv1:f(d,p,"conv1"),conv2:f(p,v,"conv2"),conv3:f(v,m,"conv3"),conv4:f(m,g,"conv4"),conv5:f(g,y,"conv5"),conv6:b?f(y,b,"conv6"):void 0,conv7:x?f(b,x,"conv7"):void 0,conv8:c(x||b||y,5*n,1,"conv8")}}else p=r[2],v=r[3],m=r[4],g=r[5],y=r[6],b=r[7],x=r[8],o={conv0:l(h=r[0],d=r[1],"conv0"),conv1:l(d,p,"conv1"),conv2:l(p,v,"conv2"),conv3:l(v,m,"conv3"),conv4:l(m,g,"conv4"),conv5:l(g,y,"conv5"),conv6:l(y,b,"conv6"),conv7:l(b,x,"conv7"),conv8:c(x,5*n,1,"conv8")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:o,paramMappings:s}}(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,e,n){return vh(this,void 0,void 0,(function(){var r,o,i,a,s,u,c,l,f,h,d,p,v,m,g,y,b,x,w,_,C,E,S,I,T,k,D,A,R,N=this;return mh(this,(function(F){switch(F.label){case 0:return r=e.width,o=e.height,i=Math.max(r,o),a=i/r,s=i/o,u=t.shape[1],c=this.config.anchors.length,l=Le((function(){var e=t.reshape([u,u,c,N.boxEncodingSize]);return[e.slice([0,0,0,0],[u,u,c,4]),e.slice([0,0,0,4],[u,u,c,1]),N.withClassScores?Wr(e.slice([0,0,0,5],[u,u,c,N.config.classes.length]),3):un(0)]})),f=l[0],d=l[2],p=[],[4,(h=l[1]).array()];case 1:return v=F.sent(),[4,f.array()];case 2:m=F.sent(),g=0,F.label=3;case 3:if(!(g<u))return[3,12];y=0,F.label=4;case 4:if(!(y<u))return[3,11];b=0,F.label=5;case 5:return b<c?(x=Hh(v[g][y][b][0]),!n||x>n?(w=(y+Hh(m[g][y][b][0]))/u*a,_=(g+Hh(m[g][y][b][1]))/u*s,C=Math.exp(m[g][y][b][2])*this.config.anchors[b].x/u*a,E=Math.exp(m[g][y][b][3])*this.config.anchors[b].y/u*s,S=w-C/2,I=_-E/2,T={row:g,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(d,T)]:[3,7]):[3,9]):[3,10];case 6:return R=F.sent(),[3,8];case 7:R={classScore:1,label:0},F.label=8;case 8:D=(k=R).classScore,A=k.label,p.push(ph({box:new Mh(S,I,S+C,I+E),score:x,classScore:x*D,label:A},T)),F.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return g++,[3,3];case 12:return f.dispose(),h.dispose(),d.dispose(),[2,p]}}))}))},e.prototype.extractPredictedClass=function(t,e){return vh(this,void 0,void 0,(function(){var n,r,o,i;return mh(this,(function(a){switch(a.label){case 0:return n=e.row,r=e.col,o=e.anchor,[4,t.array()];case 1:return i=a.sent(),[2,Array(this.config.classes.length).fill(0).map((function(t,e){return i[n][r][o][e]})).map((function(t,e){return{classScore:t,label:e}})).reduce((function(t,e){return t.classScore>e.classScore?t:e}))]}}))}))},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Fd),Kp=function(t){function e(e){void 0===e&&(e=!0);var n=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:Bp,meanRgb:Wp}:{anchors:Lp,withClassScores:!0});return t.call(this,n)||this}return dh(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return vh(this,void 0,void 0,(function(){return mh(this,(function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map((function(t){return new Lh(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})}))]}}))}))},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(Gp),Xp=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return dh(e,t),e}(qp),$p=function(){function t(){}return t.prototype.then=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}}))}))},t.prototype.run=function(){return vh(this,void 0,void 0,(function(){return mh(this,(function(t){throw new Error("ComposableTask - run is not implemented")}))}))},t}();function Yp(t,e,n,r,o){return void 0===o&&(o=function(t){return t.alignedRect}),vh(this,void 0,void 0,(function(){var i,a,s,u,c;return mh(this,(function(l){switch(l.label){case 0:return i=t.map((function(t){return op(t)?o(t):t.detection})),(s=r)?[3,5]:e instanceof pt?[4,kd(e,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,Td(e,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,n(a=s)];case 6:return c=l.sent(),a.forEach((function(t){return t instanceof pt&&t.dispose()})),[2,c]}}))}))}function Qp(t,e,n,r,o){return vh(this,void 0,void 0,(function(){var i=this;return mh(this,(function(a){return[2,Yp([t],e,(function(t){return vh(i,void 0,void 0,(function(){return mh(this,(function(e){return[2,n(t[0])]}))}))}),r,o)]}))}))}function Jp(t,e){var n=e[1];return{height:Math.floor(e[0]*t),width:Math.floor(n*t)}}var Zp=function(t){function e(e,n,r,o){return t.call(this,{left:e,top:n,right:r,bottom:o},!0)||this}return dh(e,t),e}(Oh);function tv(t){return Le((function(){return du(bu(t,un(127.5)),un(.0078125))}))}function ev(t,e){return Le((function(){return Zs(Fc(t),du(e,gs(Fc(gs(t)))))}))}function nv(t,e,n){return void 0===n&&(n=!1),Le((function(){var r=Ld(t,e.conv1,"valid");return r=ev(r,e.prelu1_alpha),r=ev(r=Ld(r=uc(r,n?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),ev(r=Ld(r=n?r:uc(r,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)}))}function rv(t,e,n,r,o){o.stage1=[];var i=e.map((function(e){return Le((function(){var n={scale:e},o=function(t,e){return Le((function(){var n=Jp(e,t.shape.slice(1)),r=tv(Dl.resizeBilinear(t,[n.height,n.width]));return Pc(r,[0,2,1,3])}))}(t,e),i=Date.now(),a=function(t,e){return Le((function(){var n=nv(t,e,!0),r=Ld(n,e.conv4_1,"valid"),o=$n(Ec(r,3),3);return{prob:Wr(bu(r,o),3),regions:Ld(n,e.conv4_2,"valid")}}))}(o,r),s=a.prob,u=a.regions;return n.pnet=Date.now()-i,{scoresTensor:pr(pr(s,3)[1])[0],regionsTensor:pr(u)[0],scale:e,statsForScale:n}}))})).map((function(t){var e=t.scoresTensor,r=t.regionsTensor,i=t.statsForScale,a=function(t,e,n,r){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)i[a][s]>=r&&o.push(new Fh(s,a));return o.map((function(t){var r=new Mh(Math.round((2*t.y+1)/n),Math.round((2*t.x+1)/n),Math.round((2*t.y+12)/n),Math.round((2*t.x+12)/n)),o=i[t.y][t.x],a=e.arraySync();return{cell:r,score:o,region:new Zp(a[t.y][t.x][0],a[t.y][t.x][1],a[t.y][t.x][2],a[t.y][t.x][3])}}))}(e,r,t.scale,n);if(e.dispose(),r.dispose(),!a.length)return o.stage1.push(i),[];var s=Date.now(),u=zh(a.map((function(t){return t.cell})),a.map((function(t){return t.score})),.5);return i.nms=Date.now()-s,i.numBoxes=u.length,o.stage1.push(i),u.map((function(t){return a[t]}))})).reduce((function(t,e){return t.concat(e)}),[]),a=[],s=[];if(i.length>0){var u=Date.now(),c=zh(i.map((function(t){return t.cell})),i.map((function(t){return t.score})),.7);o.stage1_nms=Date.now()-u,s=c.map((function(t){return i[t].score})),a=c.map((function(t){return i[t]})).map((function(t){var e=t.cell,n=t.region;return new Mh(e.left+n.left*e.width,e.top+n.top*e.height,e.right+n.right*e.width,e.bottom+n.bottom*e.height).toSquare().round()}))}return{boxes:a,scores:s}}function ov(t,e,n){var r=n.width,o=n.height;return vh(this,void 0,void 0,(function(){var n,i,a,s=this;return mh(this,(function(u){switch(u.label){case 0:return n=fd(t),[4,Promise.all(e.map((function(e){return vh(s,void 0,void 0,(function(){var r,o,i,a;return mh(this,(function(s){return r=e.padAtBorders(t.height,t.width),a=n.getImageData(o=r.x-1,i=r.y-1,r.ex-o,r.ey-i),[2,cd.isNodejs()?wd(a):createImageBitmap(a)]}))}))})))];case 1:return i=u.sent(),a=[],i.forEach((function(t){var e=fd(xd({width:r,height:o}));e.drawImage(t,0,0,r,o);for(var n=e.getImageData(0,0,r,o).data,i=[],s=0;s<n.length;s+=4)i.push(n[s+2]),i.push(n[s+1]),i.push(n[s]);a.push(i)})),[2,a.map((function(t){return Le((function(){return tv(Pc(hn(t,[1,r,o,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function iv(t,e,n,r,o){return vh(this,void 0,void 0,(function(){var i,a,s,u,c,l,f,h,d,p,v,m,g,y;return mh(this,(function(b){switch(b.label){case 0:return i=Date.now(),[4,ov(t,e,{width:24,height:24})];case 1:return a=b.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map((function(t){var e=function(t,e){return Le((function(){var n=nv(t,e),r=ev(Yd(ur(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),o=Yd(r,e.fc2_1),i=$n(Ec(o,1),1),a=Wr(bu(o,i),1),s=Yd(r,e.fc2_2);return{scores:pr(a,1)[1],regions:s}}))}(t,r);return t.dispose(),e})),o.stage2_rnet=Date.now()-i,u=s.length>1?Cn(s.map((function(t){return t.scores}))):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[b.sent()]),u.dispose(),h=c.map((function(t,e){return{score:t,idx:e}})).filter((function(t){return t.score>n})).map((function(t){return t.idx})),d=h.map((function(t){return e[t]})),p=h.map((function(t){return c[t]})),v=[],m=[],d.length>0&&(i=Date.now(),g=zh(d,p,.7),o.stage2_nms=Date.now()-i,y=g.map((function(t){var e=s[h[t]].regions.arraySync();return new Zp(e[0][0],e[0][1],e[0][2],e[0][3])})),m=g.map((function(t){return p[t]})),v=g.map((function(t,e){return d[t].calibrate(y[e])}))),s.forEach((function(t){t.regions.dispose(),t.scores.dispose()})),[2,{boxes:v,scores:m}]}}))}))}function av(t,e,n,r,o){return vh(this,void 0,void 0,(function(){var i,a,s,u,c,l,f,h,d,p,v,m,g,y,b;return mh(this,(function(x){switch(x.label){case 0:return i=Date.now(),[4,ov(t,e,{width:48,height:48})];case 1:return a=x.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map((function(t){var e=function(t,e){return Le((function(){var n=nv(t,e);n=ev(n=Ld(n=uc(n,[2,2],[2,2],"same"),e.conv4,"valid"),e.prelu4_alpha);var r=ev(Yd(ur(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),o=Yd(r,e.fc2_1),i=$n(Ec(o,1),1),a=Wr(bu(o,i),1),s=Yd(r,e.fc2_2),u=Yd(r,e.fc2_3);return{scores:pr(a,1)[1],regions:s,points:u}}))}(t,r);return t.dispose(),e})),o.stage3_onet=Date.now()-i,u=s.length>1?Cn(s.map((function(t){return t.scores}))):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[x.sent()]),u.dispose(),h=c.map((function(t,e){return{score:t,idx:e}})).filter((function(t){return t.score>n})).map((function(t){return t.idx})),d=h.map((function(t){var e=s[t].regions.arraySync();return new Zp(e[0][0],e[0][1],e[0][2],e[0][3])})),p=h.map((function(t,n){return e[t].calibrate(d[n])})),v=h.map((function(t){return c[t]})),m=[],g=[],y=[],p.length>0&&(i=Date.now(),b=zh(p,v,.7,!1),o.stage3_nms=Date.now()-i,m=b.map((function(t){return p[t]})),g=b.map((function(t){return v[t]})),y=b.map((function(t,e){return Array(5).fill(0).map((function(n,r){var o=s[t].points.arraySync();return new Fh(o[0][r]*(m[e].width+1)+m[e].left,o[0][r+5]*(m[e].height+1)+m[e].top)}))}))),s.forEach((function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()})),[2,{boxes:m,scores:g,points:y}]}}))}))}var sv=function(t){function e(){return t.call(this,"Mtcnn")||this}return dh(e,t),e.prototype.load=function(e){return vh(this,void 0,void 0,(function(){return mh(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]}))}))},e.prototype.loadFromDisk=function(e){return vh(this,void 0,void 0,(function(){return mh(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]}))}))},e.prototype.forwardInput=function(t,e){return void 0===e&&(e={}),vh(this,void 0,void 0,(function(){var n,r,o,i,a,s,u,c,l,f,h,d,p,v,m,g,y,b,x,w;return mh(this,(function(_){switch(_.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=t.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},i=Date.now(),a=Le((function(){return t=$n(Vf.fromPixels(r)).toFloat(),Le((function(){return fr(pr(t,3).reverse(),3)}));var t})),s=function(t){return a.dispose(),o.total=Date.now()-i,t},u=a.shape.slice(1),c=u[0],l=u[1],f=new kp(e),h=f.minFaceSize,d=f.scaleFactor,p=f.maxNumScales,v=f.scoreThresholds,m=(f.scaleSteps||function(t,e,n){for(var r=12/t,o=[],i=Math.min(n[0],n[1])*r,a=0;i>=12;)o.push(r*Math.pow(e,a)),i*=e,a+=1;return o}(h,d,[c,l])).filter((function(t){var e=Jp(t,[c,l]);return Math.min(e.width,e.height)>12})).slice(0,p),o.scales=m,o.pyramid=m.map((function(t){return Jp(t,[c,l])})),g=Date.now(),[4,rv(a,m,v[0],n.pnet,o)];case 1:return y=_.sent(),o.total_stage1=Date.now()-g,y.boxes.length?(o.stage2_numInputBoxes=y.boxes.length,g=Date.now(),[4,iv(r,y.boxes,v[1],n.rnet,o)]):[2,s({results:[],stats:o})];case 2:return b=_.sent(),o.total_stage2=Date.now()-g,b.boxes.length?(o.stage3_numInputBoxes=b.boxes.length,g=Date.now(),[4,av(r,b.boxes,v[2],n.onet,o)]):[2,s({results:[],stats:o})];case 3:return x=_.sent(),o.total_stage3=Date.now()-g,w=x.boxes.map((function(t,e){return ip(td({},new Lh(x.scores[e],new qh(t.left/l,t.top/c,t.width/l,t.height/c),{height:c,width:l})),new Kh(x.points[e].map((function(e){return e.sub(new Fh(t.left,t.top)).div(new Fh(t.width,t.height))})),{width:t.width,height:t.height}))})),[2,s({results:w,stats:o})]}}))}))},e.prototype.forward=function(t,e){return void 0===e&&(e={}),vh(this,void 0,void 0,(function(){var n;return mh(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Id(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent().results]}}))}))},e.prototype.forwardWithStats=function(t,e){return void 0===e&&(e={}),vh(this,void 0,void 0,(function(){var n;return mh(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Id(t)];case 1:return[2,n.apply(this,[r.sent(),e])]}}))}))},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=function(t,e){var n=Vd(t,e);function r(t){return{filters:n(t+"/weights",4,t+"/filters"),bias:n(t+"/bias",1)}}function o(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}function i(t){return n(t,1)}function a(t){return{conv1:r(t+"/conv1"),prelu1_alpha:i(t+"/prelu1_alpha"),conv2:r(t+"/conv2"),prelu2_alpha:i(t+"/prelu2_alpha"),conv3:r(t+"/conv3"),prelu3_alpha:i(t+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=a("pnet"),e=r("pnet/conv4_1"),n=r("pnet/conv4_2");return ph(ph({},t),{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=a("rnet"),e=o("rnet/fc1"),n=i("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),s=o("rnet/fc2_2");return ph(ph({},t),{fc1:e,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var t=a("onet"),e=r("onet/conv4"),n=i("onet/prelu4_alpha"),s=o("onet/fc1"),u=i("onet/prelu5_alpha"),c=o("onet/fc2_1"),l=o("onet/fc2_2"),f=o("onet/fc2_3");return ph(ph({},t),{conv4:e,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:f})}}}(t,e),r=n.extractRNetParams,o=n.extractONetParams,i=(0,n.extractPNetParams)(),a=r(),s=o();return Bd(t,e),{params:{pnet:i,rnet:a,onet:s},paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=qd(t),n=e.getRemainingWeights,r=[],o=function(t,e){var n=Wd(t,e),r=zd(t,e);function o(n,r){var o=cn(t(n));return e.push({paramPath:r}),o}function i(t,e,r){return void 0===r&&(r=!1),{conv1:n(t[0],t[1],3,e+"/conv1"),prelu1_alpha:o(t[1],e+"/prelu1_alpha"),conv2:n(t[1],t[2],3,e+"/conv2"),prelu2_alpha:o(t[2],e+"/prelu2_alpha"),conv3:n(t[2],t[3],r?2:3,e+"/conv3"),prelu3_alpha:o(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=i([3,10,16,32],"pnet"),e=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return ph(ph({},t),{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=i([3,28,48,64],"rnet",!0),e=r(576,128,"rnet/fc1"),n=o(128,"rnet/prelu4_alpha"),a=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return ph(ph({},t),{fc1:e,prelu4_alpha:n,fc2_1:a,fc2_2:s})},extractONetParams:function(){var t=i([3,32,64,64],"onet"),e=n(64,128,2,"onet/conv4"),a=o(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=o(256,"onet/prelu5_alpha"),c=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),f=r(256,10,"onet/fc2_3");return ph(ph({},t),{conv4:e,prelu4_alpha:a,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:f})}}}(e.extractWeights,r),i=o.extractRNetParams,a=o.extractONetParams,s=(0,o.extractPNetParams)(),u=i(),c=a();if(0!==n().length)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:s,rnet:u,onet:c},paramMappings:r}}(t)},e}(Fd),uv=[new Fh(1.603231,2.094468),new Fh(6.041143,7.080126),new Fh(2.882459,3.518061),new Fh(4.266906,5.178857),new Fh(9.041765,10.66308)],cv=[117.001,114.697,97.404],lv=function(t){function e(){return t.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:uv,meanRgb:cv,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return dh(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return vh(this,void 0,void 0,(function(){return mh(this,(function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map((function(t){return new Lh(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})}))]}}))}))},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(Gp),fv={ssdMobilenetv1:new Fp,tinyFaceDetector:new lv,tinyYolov2:new Kp,mtcnn:new sv,faceLandmark68Net:new vp,faceLandmark68TinyNet:new gp,faceRecognitionNet:new Ep,faceExpressionNet:new ep,ageGenderNet:new dp},hv=function(t,e){return fv.ssdMobilenetv1.locateFaces(t,e)},dv=function(t){return fv.faceLandmark68Net.detectLandmarks(t)},pv=function(t){return fv.ssdMobilenetv1.load(t)},vv=pv,mv=hv,gv=dv,yv=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=r,o}return dh(e,t),e}($p),bv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t,e,n=this;return mh(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Yp(t=r.sent(),this.input,(function(t){return vh(n,void 0,void 0,(function(){return mh(this,(function(e){switch(e.label){case 0:return[4,Promise.all(t.map((function(t){return fv.faceExpressionNet.predictExpressions(t)})))];case 1:return[2,e.sent()]}}))}))}),this.extractedFaces)];case 2:return e=r.sent(),[2,t.map((function(t,n){return rp(t,e[n])}))]}}))}))},e.prototype.withAgeAndGender=function(){return new Ev(this,this.input)},e}(yv),xv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t,e;return mh(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,Qp(t,this.input,(function(t){return fv.faceExpressionNet.predictExpressions(t)}),this.extractedFaces)]:[2];case 2:return e=n.sent(),[2,rp(t,e)]}}))}))},e.prototype.withAgeAndGender=function(){return new Sv(this,this.input)},e}(yv),wv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.withAgeAndGender=function(){return new Iv(this,this.input)},e.prototype.withFaceDescriptors=function(){return new Dv(this,this.input)},e}(bv),_v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.withAgeAndGender=function(){return new Tv(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Av(this,this.input)},e}(xv),Cv=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=r,o}return dh(e,t),e}($p),Ev=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t,e,n=this;return mh(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Yp(t=r.sent(),this.input,(function(t){return vh(n,void 0,void 0,(function(){return mh(this,(function(e){switch(e.label){case 0:return[4,Promise.all(t.map((function(t){return fv.ageGenderNet.predictAgeAndGender(t)})))];case 1:return[2,e.sent()]}}))}))}),this.extractedFaces)];case 2:return e=r.sent(),[2,t.map((function(t,n){var r=e[n],o=r.age;return Ip(Tp(t,r.gender,r.genderProbability),o)}))]}}))}))},e.prototype.withFaceExpressions=function(){return new bv(this,this.input)},e}(Cv),Sv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t,e,n;return mh(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return(t=r.sent())?[4,Qp(t,this.input,(function(t){return fv.ageGenderNet.predictAgeAndGender(t)}),this.extractedFaces)]:[2];case 2:return e=r.sent(),n=e.age,[2,Ip(Tp(t,e.gender,e.genderProbability),n)]}}))}))},e.prototype.withFaceExpressions=function(){return new xv(this,this.input)},e}(Cv),Iv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.withFaceExpressions=function(){return new wv(this,this.input)},e.prototype.withFaceDescriptors=function(){return new Dv(this,this.input)},e}(Ev),Tv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.withFaceExpressions=function(){return new _v(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Av(this,this.input)},e}(Sv),kv=function(t){function e(e,n){var r=t.call(this)||this;return r.parentTask=e,r.input=n,r}return dh(e,t),e}($p),Dv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t;return mh(this,(function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:return[4,Yp(t=e.sent(),this.input,(function(t){return Promise.all(t.map((function(t){return fv.faceRecognitionNet.computeFaceDescriptor(t)})))}),null,(function(t){return t.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,e.sent().map((function(e,n){return Sp(t[n],e)}))]}}))}))},e.prototype.withFaceExpressions=function(){return new wv(this,this.input)},e.prototype.withAgeAndGender=function(){return new Iv(this,this.input)},e}(kv),Av=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t,e;return mh(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,Qp(t,this.input,(function(t){return fv.faceRecognitionNet.computeFaceDescriptor(t)}),null,(function(t){return t.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return e=n.sent(),[2,Sp(t,e)]}}))}))},e.prototype.withFaceExpressions=function(){return new _v(this,this.input)},e.prototype.withAgeAndGender=function(){return new Tv(this,this.input)},e}(kv),Rv=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.useTinyLandmarkNet=r,o}return dh(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?fv.faceLandmark68TinyNet:fv.faceLandmark68Net},enumerable:!0,configurable:!0}),e}($p),Nv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t,e,n,r,o,i=this;return mh(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),e=t.map((function(t){return t.detection})),this.input instanceof pt?[4,kd(this.input,e)]:[3,3];case 2:return r=a.sent(),[3,5];case 3:return[4,Td(this.input,e)];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,Promise.all(n.map((function(t){return i.landmarkNet.detectLandmarks(t)})))];case 6:return o=a.sent(),n.forEach((function(t){return t instanceof pt&&t.dispose()})),[2,t.map((function(t,e){return ip(t,o[e])}))]}}))}))},e.prototype.withFaceExpressions=function(){return new wv(this,this.input)},e.prototype.withAgeAndGender=function(){return new Iv(this,this.input)},e.prototype.withFaceDescriptors=function(){return new Dv(this,this.input)},e}(Rv),Fv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t,e,n,r,o;return mh(this,(function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?(e=t.detection,this.input instanceof pt?[4,kd(this.input,[e])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,Td(this.input,[e])];case 4:r=i.sent(),i.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((n=r)[0])];case 6:return o=i.sent(),n.forEach((function(t){return t instanceof pt&&t.dispose()})),[2,ip(t,o)]}}))}))},e.prototype.withFaceExpressions=function(){return new _v(this,this.input)},e.prototype.withAgeAndGender=function(){return new Tv(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Av(this,this.input)},e}(Rv),Ov=function(t){function e(e,n){void 0===n&&(n=new Np);var r=t.call(this)||this;return r.input=e,r.options=n,r}return dh(e,t),e}($p),Mv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t,e,n,r;return mh(this,(function(o){switch(o.label){case 0:return e=(t=this).input,(n=t.options)instanceof kp?[4,fv.mtcnn.forward(e,n)]:[3,2];case 1:return[2,o.sent().map((function(t){return t.detection}))];case 2:if(!(r=n instanceof Xp?function(t){return fv.tinyFaceDetector.locateFaces(t,n)}:n instanceof Np?function(t){return fv.ssdMobilenetv1.locateFaces(t,n)}:n instanceof qp?function(t){return fv.tinyYolov2.locateFaces(t,n)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(e)]}}))}))},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise((function(e){return vh(t,void 0,void 0,(function(){var t;return mh(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t.map((function(t){return td({},t)})))]}}))}))}))},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new Nv(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new bv(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new Ev(this.runAndExtendWithFaceDetections(),this.input)},e}(Ov),Pv=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return dh(e,t),e.prototype.run=function(){return vh(this,void 0,void 0,(function(){var t,e;return mh(this,(function(n){switch(n.label){case 0:return[4,new Mv(this.input,this.options)];case 1:return t=n.sent(),e=t[0],t.forEach((function(t){t.score>e.score&&(e=t)})),[2,e]}}))}))},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise((function(e){return vh(t,void 0,void 0,(function(){var t;return mh(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t?td({},t):void 0)]}}))}))}))},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new Fv(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new xv(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new Sv(this.runAndExtendWithFaceDetection(),this.input)},e}(Ov);function Lv(t,e){return void 0===e&&(e=new Np),new Mv(t,e)}function Bv(t,e){return vh(this,void 0,void 0,(function(){return mh(this,(function(n){switch(n.label){case 0:return console.warn("allFacesSsdMobilenetv1 is deprecated and will be removed soon, use the high level api instead"),[4,Lv(t,new Np(e?{minConfidence:e}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,n.sent()]}}))}))}var Wv=Bv;function zv(t,e){if(t.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map((function(t,e){return t-r[e]})).reduce((function(t,e){return t+Math.pow(e,2)}),0))}var Uv=function(){function t(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map((function(t){if(t instanceof Qh)return t;if(t instanceof Float32Array)return new Qh(o(),[t]);if(t.descriptor&&t.descriptor instanceof Float32Array)return new Qh(o(),[t.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}return Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(t,e){return e.map((function(e){return zv(e,t)})).reduce((function(t,e){return t+e}),0)/(e.length||1)},t.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map((function(n){return new $h(n.label,e.computeMeanDistance(t,n.descriptors))})).reduce((function(t,e){return t.distance<e.distance?t:e}))},t.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new $h("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map((function(t){return t.toJSON()}))}},t.fromJSON=function(e){return new t(e.labeledDescriptors.map((function(t){return Qh.fromJSON(t)})),e.distanceThreshold)},t}();t.AgeGenderNet=dp,t.BoundingBox=Mh,t.Box=Oh,t.ComposableTask=$p,t.ComputeAllFaceDescriptorsTask=Dv,t.ComputeFaceDescriptorsTaskBase=kv,t.ComputeSingleFaceDescriptorTask=Av,t.DetectAllFaceLandmarksTask=Nv,t.DetectAllFacesTask=Mv,t.DetectFaceLandmarksTaskBase=Rv,t.DetectFacesTaskBase=Ov,t.DetectSingleFaceLandmarksTask=Fv,t.DetectSingleFaceTask=Pv,t.Dimensions=yh,t.FACE_EXPRESSION_LABELS=Zd,t.FaceDetection=Lh,t.FaceDetectionNet=Pp,t.FaceExpressionNet=ep,t.FaceExpressions=tp,t.FaceLandmark68Net=vp,t.FaceLandmark68TinyNet=gp,t.FaceLandmarkNet=yp,t.FaceLandmarks=Gh,t.FaceLandmarks5=Kh,t.FaceLandmarks68=Xh,t.FaceMatch=$h,t.FaceMatcher=Uv,t.FaceRecognitionNet=Ep,t.LabeledBox=Yh,t.LabeledFaceDescriptors=Qh,t.Mtcnn=sv,t.MtcnnOptions=kp,t.NetInput=Sd,t.NeuralNetwork=Fd,t.ObjectDetection=Ph,t.Point=Fh,t.PredictedBox=Jh,t.Rect=qh,t.SsdMobilenetv1=Fp,t.SsdMobilenetv1Options=Np,t.TinyFaceDetector=lv,t.TinyFaceDetectorOptions=Xp,t.TinyYolov2=Kp,t.TinyYolov2Options=qp,t.allFaces=Wv,t.allFacesMtcnn=function(t,e){return void 0===e&&(e={}),vh(this,void 0,void 0,(function(){return mh(this,(function(n){switch(n.label){case 0:return console.warn("allFacesMtcnn is deprecated and will be removed soon, use the high level api instead"),[4,Lv(t,new kp(e)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,n.sent()]}}))}))},t.allFacesSsdMobilenetv1=Bv,t.allFacesTinyYolov2=function(t,e){return void 0===e&&(e={}),vh(this,void 0,void 0,(function(){return mh(this,(function(n){switch(n.label){case 0:return console.warn("allFacesTinyYolov2 is deprecated and will be removed soon, use the high level api instead"),[4,Lv(t,new qp(e)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,n.sent()]}}))}))},t.awaitMediaLoaded=gd,t.bufferToImage=yd,t.computeFaceDescriptor=function(t){return fv.faceRecognitionNet.computeFaceDescriptor(t)},t.createCanvas=xd,t.createCanvasFromMedia=wd,t.createFaceDetectionNet=function(t){return Op(t)},t.createFaceRecognitionNet=function(t){var e=new Ep;return e.extractWeights(t),e},t.createMtcnn=function(t){var e=new sv;return e.extractWeights(t),e},t.createSsdMobilenetv1=Op,t.createTinyFaceDetector=function(t){var e=new lv;return e.extractWeights(t),e},t.createTinyYolov2=function(t,e){void 0===e&&(e=!0);var n=new Kp(e);return n.extractWeights(t),n},t.detectAllFaces=Lv,t.detectFaceLandmarks=dv,t.detectFaceLandmarksTiny=function(t){return fv.faceLandmark68TinyNet.detectLandmarks(t)},t.detectLandmarks=gv,t.detectSingleFace=function(t,e){return void 0===e&&(e=new Np),new Pv(t,e)},t.draw=up,t.env=cd,t.euclideanDistance=zv,t.extendWithAge=Ip,t.extendWithFaceDescriptor=Sp,t.extendWithFaceDetection=td,t.extendWithFaceExpressions=rp,t.extendWithFaceLandmarks=ip,t.extendWithGender=Tp,t.extractFaceTensors=kd,t.extractFaces=Td,t.fetchImage=function(t){return vh(this,void 0,void 0,(function(){var e,n;return mh(this,(function(r){switch(r.label){case 0:return[4,Dd(t)];case 1:return[4,(e=r.sent()).blob()];case 2:if(!(n=r.sent()).type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+n.type+", for url: "+e.url);return[2,yd(n)]}}))}))},t.fetchJson=Ad,t.fetchNetWeights=function(t){return vh(this,void 0,void 0,(function(){var e;return mh(this,(function(n){switch(n.label){case 0:return e=Float32Array.bind,[4,Dd(t)];case 1:return[4,n.sent().arrayBuffer()];case 2:return[2,new(e.apply(Float32Array,[void 0,n.sent()]))]}}))}))},t.fetchOrThrow=Dd,t.getContext2dOrThrow=fd,t.getMediaDimensions=bd,t.imageTensorToCanvas=_d,t.imageToSquare=Ed,t.inverseSigmoid=function(t){return Math.log(t/(1-t))},t.iou=Bh,t.isMediaElement=Cd,t.isMediaLoaded=md,t.isWithAge=function(t){return"number"==typeof t.age},t.isWithFaceDetection=Zh,t.isWithFaceExpressions=np,t.isWithFaceLandmarks=op,t.isWithGender=function(e){return(e.gender===t.Gender.MALE||e.gender===t.Gender.FEMALE)&&Rh(e.genderProbability)},t.loadAgeGenderModel=function(t){return fv.ageGenderNet.load(t)},t.loadFaceDetectionModel=vv,t.loadFaceExpressionModel=function(t){return fv.faceExpressionNet.load(t)},t.loadFaceLandmarkModel=function(t){return fv.faceLandmark68Net.load(t)},t.loadFaceLandmarkTinyModel=function(t){return fv.faceLandmark68TinyNet.load(t)},t.loadFaceRecognitionModel=function(t){return fv.faceRecognitionNet.load(t)},t.loadMtcnnModel=function(t){return fv.mtcnn.load(t)},t.loadSsdMobilenetv1Model=pv,t.loadTinyFaceDetectorModel=function(t){return fv.tinyFaceDetector.load(t)},t.loadTinyYolov2Model=function(t){return fv.tinyYolov2.load(t)},t.loadWeightMap=Nd,t.locateFaces=mv,t.matchDimensions=function(t,e,n){void 0===n&&(n=!1);var r=n?bd(e):e,o=r.width,i=r.height;return t.width=o,t.height=i,{width:o,height:i}},t.minBbox=Wh,t.mtcnn=function(t,e){return fv.mtcnn.forward(t,e)},t.nets=fv,t.nonMaxSuppression=zh,t.normalize=Uh,t.padToSquare=jh,t.predictAgeAndGender=function(t){return fv.ageGenderNet.predictAgeAndGender(t)},t.recognizeFaceExpressions=function(t){return fv.faceExpressionNet.predictExpressions(t)},t.resizeResults=function t(e,n){var r=new yh(n.width,n.height),o=r.width,i=r.height;if(o<=0||i<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:o,height:i}));if(Array.isArray(e))return e.map((function(e){return t(e,{width:o,height:i})}));if(op(e)){var a=e.detection.forSize(o,i),s=e.unshiftedLandmarks.forSize(a.box.width,a.box.height);return ip(td(e,a),s)}return Zh(e)?td(e,e.detection.forSize(o,i)):e instanceof Gh||e instanceof Lh?e.forSize(o,i):e},t.resolveInput=ld,t.shuffleArray=function(t){for(var e=t.slice(),n=e.length-1;n>0;n--){var r=Math.floor(Math.random()*(n+1)),o=e[n];e[n]=e[r],e[r]=o}return e},t.sigmoid=Hh,t.ssdMobilenetv1=hv,t.tf=lh,t.tinyFaceDetector=function(t,e){return fv.tinyFaceDetector.locateFaces(t,e)},t.tinyYolov2=function(t,e){return fv.tinyYolov2.locateFaces(t,e)},t.toNetInput=Id,t.utils=Nh,t.validateConfig=Up,Object.defineProperty(t,"__esModule",{value:!0})})),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?t(require("jquery")):t(jQuery)}((function(t,e){"use strict";var n={background:"rgba(255, 255, 255, 0.8)",backgroundClass:"",image:"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 1000'><circle r='80' cx='500' cy='90'/><circle r='80' cx='500' cy='910'/><circle r='80' cx='90' cy='500'/><circle r='80' cx='910' cy='500'/><circle r='80' cx='212' cy='212'/><circle r='80' cx='788' cy='212'/><circle r='80' cx='212' cy='788'/><circle r='80' cx='788' cy='788'/></svg>",imageAnimation:"2000ms rotate_right",imageAutoResize:!0,imageResizeFactor:1,imageColor:"#202020",imageClass:"",imageOrder:1,fontawesome:"",fontawesomeAnimation:"",fontawesomeAutoResize:!0,fontawesomeResizeFactor:1,fontawesomeColor:"#202020",fontawesomeOrder:2,custom:"",customAnimation:"",customAutoResize:!0,customResizeFactor:1,customOrder:3,text:"",textAnimation:"",textAutoResize:!0,textResizeFactor:.5,textColor:"#202020",textClass:"",textOrder:4,progress:!1,progressAutoResize:!0,progressResizeFactor:.25,progressColor:"#a0a0a0",progressClass:"",progressOrder:5,progressFixedPosition:"",progressSpeed:200,progressMin:0,progressMax:100,size:50,maxSize:120,minSize:20,direction:"column",fade:!0,resizeInterval:50,zIndex:2147483647},r={"box-sizing":"border-box",position:"relative",display:"flex","flex-wrap":"nowrap","align-items":"center","justify-content":"space-around"},o={"box-sizing":"border-box",overflow:"visible",flex:"0 0 auto",display:"flex","justify-content":"center","align-items":"center"},i={width:"100%",height:"100%"},a={position:"absolute",left:"0",width:"100%"},s={position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},u={position:"absolute",left:"0"},c={count:0,container:e,settings:e,wholePage:e,resizeIntervalId:e,text:e,progress:e},l={animations:["rotate_right","rotate_left","fadein","pulse"],progressPosition:["top","bottom"]},f=[400,200];function h(e,n){e=t(e),n.size=E(n.size),n.maxSize=parseInt(n.maxSize,10)||0,n.minSize=parseInt(n.minSize,10)||0,n.resizeInterval=parseInt(n.resizeInterval,10)||0;var o=y(e),l=b(e);if(!1===l){if((l=t.extend({},c)).container=e,l.wholePage=e.is("body"),o=t("<div>",{class:"loadingoverlay"}).css(r).css("flex-direction","row"===n.direction.toLowerCase()?"row":"column"),n.backgroundClass?o.addClass(n.backgroundClass):o.css("background",n.background),l.wholePage&&o.css({position:"fixed",top:0,left:0,width:"100%",height:"100%"}),void 0!==n.zIndex&&o.css("z-index",n.zIndex),n.image){t.isArray(n.imageColor)?n.imageColor=0!==n.imageColor.length&&(1===n.imageColor.length?{fill:n.imageColor[0]}:{fill:n.imageColor[0],stroke:n.imageColor[1]}):n.imageColor&&(n.imageColor={fill:n.imageColor});var h=x(o,n.imageOrder,n.imageAutoResize,n.imageResizeFactor,n.imageAnimation);"<svg"===n.image.slice(0,4).toLowerCase()&&"</svg>"===n.image.slice(-6).toLowerCase()?(h.append(n.image),h.children().css(i),!n.imageClass&&n.imageColor&&h.find("*").css(n.imageColor)):".svg"===n.image.slice(-4).toLowerCase()||"data:image/svg"===n.image.slice(0,14).toLowerCase()?t.ajax({url:n.image,type:"GET",dataType:"html",global:!1}).done((function(t){h.html(t),h.children().css(i),!n.imageClass&&n.imageColor&&h.find("*").css(n.imageColor)})):h.css({"background-image":"url("+n.image+")","background-position":"center","background-repeat":"no-repeat","background-size":"cover"}),n.imageClass&&h.addClass(n.imageClass)}if(n.fontawesome&&(h=x(o,n.fontawesomeOrder,n.fontawesomeAutoResize,n.fontawesomeResizeFactor,n.fontawesomeAnimation).addClass("loadingoverlay_fa"),t("<div>",{class:n.fontawesome}).appendTo(h),n.fontawesomeColor&&h.css("color",n.fontawesomeColor)),n.custom&&(h=x(o,n.customOrder,n.customAutoResize,n.customResizeFactor,n.customAnimation).append(n.custom)),n.text&&(l.text=x(o,n.textOrder,n.textAutoResize,n.textResizeFactor,n.textAnimation).addClass("loadingoverlay_text").text(n.text),n.textClass?l.text.addClass(n.textClass):n.textColor&&l.text.css("color",n.textColor)),n.progress){h=x(o,n.progressOrder,n.progressAutoResize,n.progressResizeFactor,!1).addClass("loadingoverlay_progress");var d=t("<div>").css(s).appendTo(h);l.progress={bar:t("<div>").css(u).appendTo(d),fixed:!1,margin:0,min:parseFloat(n.progressMin),max:parseFloat(n.progressMax),speed:parseInt(n.progressSpeed,10)};var p=(n.progressFixedPosition+"").replace(/\s\s+/g," ").toLowerCase().split(" ");2===p.length&&C(p[0])?(l.progress.fixed=p[0],l.progress.margin=E(p[1])):2===p.length&&C(p[1])?(l.progress.fixed=p[1],l.progress.margin=E(p[0])):1===p.length&&C(p[0])&&(l.progress.fixed=p[0],l.progress.margin=0),"top"===l.progress.fixed?h.css(a).css("top",l.progress.margin?l.progress.margin.value+(l.progress.margin.fixed?l.progress.margin.units:"%"):0):"bottom"===l.progress.fixed&&h.css(a).css("top","auto"),n.progressClass?l.progress.bar.addClass(n.progressClass):n.progressColor&&l.progress.bar.css("background",n.progressColor)}n.fade?!0===n.fade?n.fade=f:"string"==typeof n.fade||"number"==typeof n.fade?n.fade=[n.fade,n.fade]:t.isArray(n.fade)&&n.fade.length<2&&(n.fade=[n.fade[0],n.fade[0]]):n.fade=[0,0],n.fade=[parseInt(n.fade[0],10),parseInt(n.fade[1],10)],l.settings=n,o.data("loadingoverlay_data",l),e.data("loadingoverlay",o),o.fadeTo(0,.01).appendTo("body"),g(e,!0),n.resizeInterval>0&&(l.resizeIntervalId=setInterval((function(){g(e,!1)}),n.resizeInterval)),o.fadeTo(n.fade[0],1)}l.count++}function d(e,n){var r=y(e=t(e)),o=b(e);!1!==o&&(o.count--,(n||o.count<=0)&&r.animate({opacity:0},o.settings.fade[1],(function(){o.resizeIntervalId&&clearInterval(o.resizeIntervalId),t(this).remove(),e.removeData("loadingoverlay")})))}function p(e){g(t(e),!0)}function v(e,n){var r=b(e=t(e));!1!==r&&r.text&&(!1===n?r.text.hide():r.text.show().text(n))}function m(e,n){var r=b(e=t(e));if(!1!==r&&r.progress)if(!1===n)r.progress.bar.hide();else{var o=100*((parseFloat(n)||0)-r.progress.min)/(r.progress.max-r.progress.min);o<0&&(o=0),o>100&&(o=100),r.progress.bar.show().animate({width:o+"%"},r.progress.speed)}}function g(e,n){var r=y(e),o=b(e);if(!1!==o){if(!o.wholePage){var i="fixed"===e.css("position"),a=i?e[0].getBoundingClientRect():e.offset();r.css({position:i?"fixed":"absolute",top:a.top+parseInt(e.css("border-top-width"),10),left:a.left+parseInt(e.css("border-left-width"),10),width:e.innerWidth(),height:e.innerHeight()})}if(o.settings.size){var s=o.wholePage?t(window):e,u=o.settings.size.value;o.settings.size.fixed||(u=Math.min(s.innerWidth(),s.innerHeight())*u/100,o.settings.maxSize&&u>o.settings.maxSize&&(u=o.settings.maxSize),o.settings.minSize&&u<o.settings.minSize&&(u=o.settings.minSize)),r.children(".loadingoverlay_element").each((function(){var e=t(this);if(n||e.data("loadingoverlay_autoresize")){var r=e.data("loadingoverlay_resizefactor");e.hasClass("loadingoverlay_fa")||e.hasClass("loadingoverlay_text")?e.css("font-size",u*r+o.settings.size.units):e.hasClass("loadingoverlay_progress")?(o.progress.bar.css("height",u*r+o.settings.size.units),o.progress.fixed?"bottom"===o.progress.fixed&&e.css("bottom",o.progress.margin?o.progress.margin.value+(o.progress.margin.fixed?o.progress.margin.units:"%"):0).css("bottom","+="+u*r+o.settings.size.units):o.progress.bar.css("top",e.position().top).css("top","-="+u*r*.5+o.settings.size.units)):e.css({width:u*r+o.settings.size.units,height:u*r+o.settings.size.units})}}))}}}function y(t){return t.data("loadingoverlay")}function b(n){var r=y(n),o=void 0===r?e:r.data("loadingoverlay_data");return void 0===o?(t(".loadingoverlay").each((function(){var e=t(this),n=e.data("loadingoverlay_data");document.body.contains(n.container[0])||(n.resizeIntervalId&&clearInterval(n.resizeIntervalId),e.remove())})),!1):(r.toggle(n.is(":visible")),o)}function x(e,n,r,i,a){var s=t("<div>",{class:"loadingoverlay_element",css:{order:n}}).css(o).data({loadingoverlay_autoresize:r,loadingoverlay_resizefactor:i}).appendTo(e);if(!0===a&&(a="2000ms rotate_right"),"string"==typeof a){var u,c,l=a.replace(/\s\s+/g," ").toLowerCase().split(" ");2===l.length&&w(l[0])&&_(l[1])?(u=l[1],c=l[0]):2===l.length&&w(l[1])&&_(l[0])?(u=l[0],c=l[1]):1===l.length&&w(l[0])?(u="rotate_right",c=l[0]):1===l.length&&_(l[0])&&(u=l[0],c="2000ms"),s.css({"animation-name":"loadingoverlay_animation__"+u,"animation-duration":c,"animation-timing-function":"linear","animation-iteration-count":"infinite"})}return s}function w(t){return!isNaN(parseFloat(t))&&("s"===t.slice(-1)||"ms"===t.slice(-2))}function _(t){return l.animations.indexOf(t)>-1}function C(t){return l.progressPosition.indexOf(t)>-1}function E(t){return!(!t||t<0)&&("string"==typeof t&&["vmin","vmax"].indexOf(t.slice(-4))>-1?{fixed:!0,units:t.slice(-4),value:t.slice(0,-4)}:"string"==typeof t&&["rem"].indexOf(t.slice(-3))>-1?{fixed:!0,units:t.slice(-3),value:t.slice(0,-3)}:"string"==typeof t&&["px","em","cm","mm","in","pt","pc","vh","vw"].indexOf(t.slice(-2))>-1?{fixed:!0,units:t.slice(-2),value:t.slice(0,-2)}:{fixed:!1,units:"px",value:parseFloat(t)})}t.LoadingOverlaySetup=function(e){t.extend(!0,n,e)},t.LoadingOverlay=function(e,r){switch(e.toLowerCase()){case"show":h("body",t.extend(!0,{},n,r));break;case"hide":d("body",r);break;case"resize":p("body");break;case"text":v("body",r);break;case"progress":m("body",r)}},t.fn.LoadingOverlay=function(e,r){switch(e.toLowerCase()){case"show":return this.each((function(){h(this,t.extend(!0,{},n,r))}));case"hide":return this.each((function(){d(this,r)}));case"resize":return this.each((function(){p(this)}));case"text":return this.each((function(){v(this,r)}));case"progress":return this.each((function(){m(this,r)}))}},t((function(){t("head").append(["<style>","@-webkit-keyframes loadingoverlay_animation__rotate_right {","to {","-webkit-transform : rotate(360deg);","transform : rotate(360deg);","}","}","@keyframes loadingoverlay_animation__rotate_right {","to {","-webkit-transform : rotate(360deg);","transform : rotate(360deg);","}","}","@-webkit-keyframes loadingoverlay_animation__rotate_left {","to {","-webkit-transform : rotate(-360deg);","transform : rotate(-360deg);","}","}","@keyframes loadingoverlay_animation__rotate_left {","to {","-webkit-transform : rotate(-360deg);","transform : rotate(-360deg);","}","}","@-webkit-keyframes loadingoverlay_animation__fadein {","0% {","opacity   : 0;","-webkit-transform : scale(0.1, 0.1);","transform : scale(0.1, 0.1);","}","50% {","opacity   : 1;","}","100% {","opacity   : 0;","-webkit-transform : scale(1, 1);","transform : scale(1, 1);","}","}","@keyframes loadingoverlay_animation__fadein {","0% {","opacity   : 0;","-webkit-transform : scale(0.1, 0.1);","transform : scale(0.1, 0.1);","}","50% {","opacity   : 1;","}","100% {","opacity   : 0;","-webkit-transform : scale(1, 1);","transform : scale(1, 1);","}","}","@-webkit-keyframes loadingoverlay_animation__pulse {","0% {","-webkit-transform : scale(0, 0);","transform : scale(0, 0);","}","50% {","-webkit-transform : scale(1, 1);","transform : scale(1, 1);","}","100% {","-webkit-transform : scale(0, 0);","transform : scale(0, 0);","}","}","@keyframes loadingoverlay_animation__pulse {","0% {","-webkit-transform : scale(0, 0);","transform : scale(0, 0);","}","50% {","-webkit-transform : scale(1, 1);","transform : scale(1, 1);","}","100% {","-webkit-transform : scale(0, 0);","transform : scale(0, 0);","}","}","</style>"].join(" "))}))})),function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.download=e()}(this,(function(){return function t(e,n,r){function o(t){var e=t.split(/[:;,]/);t=e[1];for(var n=(e=("base64"==e[2]?atob:decodeURIComponent)(e.pop())).length,r=0,o=new Uint8Array(n);r<n;++r)o[r]=e.charCodeAt(r);return new f([o],{type:t})}function i(t,e){if("download"in c)return c.href=t,c.setAttribute("download",l),c.className="download-js-link",c.innerHTML="downloading...",c.style.display="none",document.body.appendChild(c),setTimeout((function(){c.click(),document.body.removeChild(c),!0===e&&setTimeout((function(){a.URL.revokeObjectURL(c.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,"application/octet-stream")),!window.open(t)&&confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var n=document.createElement("iframe");document.body.appendChild(n),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,"application/octet-stream")),n.src=t,setTimeout((function(){document.body.removeChild(n)}),333)}var a=window,s=r||"application/octet-stream",u=!n&&!r&&e,c=document.createElement("a");r=function(t){return String(t)};var l=n||"download",f=(f=a.Blob||a.MozBlob||a.WebKitBlob||r).call?f.bind(a):Blob;if("true"===String(this)&&(s=(e=[e,s])[0],e=e[1]),u&&2048>u.length&&(l=u.split("/").pop().split("?")[0],c.href=u,-1!==c.href.indexOf(u))){var h=new XMLHttpRequest;return h.open("GET",u,!0),h.responseType="blob",h.onload=function(e){t(e.target.response,l,"application/octet-stream")},setTimeout((function(){h.send()}),0),h}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(e)){if(!(2096103.424<e.length&&f!==r))return navigator.msSaveBlob?navigator.msSaveBlob(o(e),l):i(e);s=(e=o(e)).type||"application/octet-stream"}else if(/([\x80-\xff])/.test(e)){n=0;for(var d=(u=new Uint8Array(e.length)).length;n<d;++n)u[n]=e.charCodeAt(n);e=new f([u],{type:s})}if(e=e instanceof f?e:new f([e],{type:s}),navigator.msSaveBlob)return navigator.msSaveBlob(e,l);if(a.URL)i(a.URL.createObjectURL(e),!0);else{if("string"==typeof e||e.constructor===r)try{return i("data:"+s+";base64,"+a.btoa(e))}catch(p){return i("data:"+s+","+encodeURIComponent(e))}(s=new FileReader).onload=function(t){i(this.result)},s.readAsDataURL(e)}return!0}}));